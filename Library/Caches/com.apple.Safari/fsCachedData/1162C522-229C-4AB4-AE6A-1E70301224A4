if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/treenode.js".toLowerCase()])(function(){var CONTENT_OFFSET=19;Owa.Components.TreeNode=function Owa$Components$TreeNode(el,tr){Owa.Components.TreeNode.constructBase(this);this._oElement=el;this._tr=tr};Owa.Components.TreeNode.createClass("Owa.Components.TreeNode",Owa.Components.Control);var _oPrototype=Owa.Components.TreeNode.prototype;_oPrototype._fClearTimeoutCallbackInDisposing=true;Owa.Components.TreeNode.prototype.equals=function Owa$Components$TreeNode$equals(oJN){return oJN&&this.inTr(oJN._tr)&&this.gtId()==oJN.gtId()};Owa.Components.TreeNode.prototype._get_Element=function Owa$Components$TreeNode$_get_Element(){return this._oElement};Owa.Components.TreeNode.prototype.get_Id=function Owa$Components$TreeNode$get_Id(){return this._oElement.get_Id()};Owa.Components.TreeNode.prototype.isRt=function Owa$Components$TreeNode$isRt(){var o=this.getContainer().get_ParentElement();if(o)return o.getExpando("isRoot")};Owa.Components.TreeNode.prototype.hdCnt=function Owa$Components$TreeNode$hdCnt(){this.getContent().set_IsShown(false)};Owa.Components.TreeNode.prototype.shwCnt=function Owa$Components$TreeNode$shwCnt(){this.getContent().set_IsShown(true)};Owa.Components.TreeNode.prototype.gtDspNm=function Owa$Components$TreeNode$gtDspNm(){return this.getContent().get_TextContent()};Owa.Components.TreeNode.prototype.stDspNm=function Owa$Components$TreeNode$stDspNm(sDisplayName){this.getContent().set_TextContent(sDisplayName)};Owa.Components.TreeNode.prototype.hsChld=function Owa$Components$TreeNode$hsChld(){return this._get_Element().getAttribute("_hsChld")};Owa.Components.TreeNode.prototype.getChildIndent=function Owa$Components$TreeNode$getChildIndent(){var iChildIndent=this._get_Element().getIntAttribute("_chldIndnt");return iChildIndent?iChildIndent:0};Owa.Components.TreeNode.prototype.getIndent=function Owa$Components$TreeNode$getIndent(){var iIndent=this._get_Element().getIntAttribute("_indnt");return iIndent?iIndent:0};Owa.Components.TreeNode.prototype.setIndent=function Owa$Components$TreeNode$setIndent(iIndent){var oEC=this.gtEC();var oContent=this.getContent();if(oEC){if(g_fRtl){oEC.set_Right(iIndent)}else{oEC.set_Left(iIndent)}}if(oContent){if(g_fRtl){oContent.set_Right(iIndent+CONTENT_OFFSET)}else{oContent.set_Left(iIndent+CONTENT_OFFSET)}}this._get_Element().setIntAttribute("_indnt",iIndent)};Owa.Components.TreeNode.prototype.gtEC=function Owa$Components$TreeNode$gtEC(){return this.gtHl().getChildById(EC)};Owa.Components.TreeNode.prototype.getContainer=function Owa$Components$TreeNode$getContainer(){return this.gtHl().get_ParentElement()};Owa.Components.TreeNode.prototype.gtHl=function Owa$Components$TreeNode$gtHl(){return this._get_Element().get_ParentElement()};Owa.Components.TreeNode.prototype.gtCC=function Owa$Components$TreeNode$gtCC(){return this.getContainer().getChildById(NODE_CHILDREN)};Owa.Components.TreeNode.prototype.gtId=function Owa$Components$TreeNode$gtId(){return this._get_Element().get_Id()};Owa.Components.TreeNode.prototype.getContent=function Owa$Components$TreeNode$getContent(){return this._get_Element().getChildById(NODE_CONTENT)};Owa.Components.TreeNode.prototype.gtImg=function Owa$Components$TreeNode$gtImg(){return this._get_Element().getChildById(NODE_ICON)};Owa.Components.TreeNode.prototype.stUTD=function Owa$Components$TreeNode$stUTD(fValue){this._get_Element().setAttribute("_sync",fValue?null:"1")};Owa.Components.TreeNode.prototype.isUTD=function Owa$Components$TreeNode$isUTD(){return !this._get_Element().getAttribute("_sync")};Owa.Components.TreeNode.prototype.canMv=function Owa$Components$TreeNode$canMv(){return 0};Owa.Components.TreeNode.prototype.canCp=function Owa$Components$TreeNode$canCp(){return 0};Owa.Components.TreeNode.prototype.canDel=function Owa$Components$TreeNode$canDel(){return 0};Owa.Components.TreeNode.prototype.canCrt=function Owa$Components$TreeNode$canCrt(){return 0};Owa.Components.TreeNode.prototype.canRnm=function Owa$Components$TreeNode$canRnm(){return 0};Owa.Components.TreeNode.prototype.inTr=function Owa$Components$TreeNode$inTr(tr){return this._tr.root.equals(tr.root)};Owa.Components.TreeNode.prototype.isExp=function Owa$Components$TreeNode$isExp(){return this._get_Element().getAttribute("_exp")};Owa.Components.TreeNode.prototype.getIntAttribute=function Owa$Components$TreeNode$getIntAttribute(sName){return this._get_Element().getIntAttribute(sName)};Owa.Components.TreeNode.prototype.setIntAttribute=function Owa$Components$TreeNode$setIntAttribute(sName,iV){return this._get_Element().setIntAttribute(sName,iV)};Owa.Components.TreeNode.prototype.isEC=function Owa$Components$TreeNode$isEC(oN){return oN.get_Id()==EC};Owa.Components.TreeNode.prototype._onBeforeContextMenu=function Owa$Components$TreeNode$_onBeforeContextMenu(mnu){return true};Owa.Components.TreeNode.prototype.shwPrg=function Owa$Components$TreeNode$shwPrg(iTO,iImg){if(this._get_Element().getExpando("_prg"))return;var oPrg={};oPrg={};oPrg._img=iImg;oPrg._tid=this._setTimeout(this.shwPrgTO,iTO);this._get_Element().setExpando("_prg",oPrg)};Owa.Components.TreeNode.prototype.shwPrgTO=function Owa$Components$TreeNode$shwPrgTO(){var oElement=this._get_Element();var o=oElement.getExpando("_prg");if(!o)return;o._tid=0;var oImg=o._img?this.gtImg():this.gtEC();var sClss=o._img?"prI":"prEC";var sH="<img id="+PR+" class=\""+sClss+"\" src=\""+g_sTimerIco+"\">";if(oImg){oImg.set_IsShown(false);oImg.insertAdjacentHtml("beforeBegin",sH)}else{oElement.insertAdjacentHtml("beforeBegin",sH)}var oProgImg=this.gtHl().getChildById(PR);if(oProgImg){if(g_fRtl){oProgImg.set_Right(this.getIndent())}else{oProgImg.set_Left(this.getIndent())}}};Owa.Components.TreeNode.prototype.hdPrg=function Owa$Components$TreeNode$hdPrg(){var o=this._get_Element().getExpando("_prg");if(!o)return;this._get_Element().setExpando("_prg",null);if(o._tid)return this._clearTimeout(o._tid);var oProgImg=this.gtHl().getChildById(PR);if(oProgImg){oProgImg.remove(true)}var oImg=o._img?this.gtImg():this.gtEC();if(oImg){oImg.set_IsShown(true)}};Owa.Components.TreeNode.prototype.tggl=function Owa$Components$TreeNode$tggl(){if(this.isExp())this.collapse();else this.expand()};Owa.Components.TreeNode.prototype.sync=function Owa$Components$TreeNode$sync(){if(this.hsChld()&&!this.isUTD()&&this._tr.getChildren){this._tr.getChildren(this);this.shwPrg(1);return 1}};Owa.Components.TreeNode.prototype.persistExp=function Owa$Components$TreeNode$persistExp(f){};Owa.Components.TreeNode.prototype.expand=function Owa$Components$TreeNode$expand(){if(this.isExp()||!this.hsChld())return;var oC=this.gtCC();if(!oC||!oC.hasChildNodes())if(this.sync())return;this._get_Element().setAttribute("_exp","1");this.upd();this._tr.fireOnResize();this.persistExp(1)};Owa.Components.TreeNode.prototype.collapse=function Owa$Components$TreeNode$collapse(){if(!this.isExp())return;this._get_Element().setAttribute("_exp",null);this.upd();this._tr.fireOnResize();this.persistExp(0)};Owa.Components.TreeNode.prototype.upd=function Owa$Components$TreeNode$upd(){var oC=this.gtCC();var oEC=this.gtEC();var fCC=oC&&oC.hasChildNodes()?"1":null;if(!fCC&&oC)oC.set_IsShown(false);if(this.hsChld()!=fCC&&this.isUTD())this._get_Element().setAttribute("_hsChld",fCC);if(this.hsChld()){if(oEC)oEC._get_DomNode().style.cursor=POINTER;if(this.isExp()){if(oEC)Owa.Components.CssSprites.updateImage(oEC,g_sMinusIco);oC.set_IsShown(true)}else{if(oEC){Owa.Components.CssSprites.updateImage(oEC,g_sPlusIco)}else{var sH=this._tr.mkECH(g_sPlusIco,this._get_Element());var iIndent=this.getIndent();this.gtHl().insertAdjacentHtml(Owa.ElementInsertionPoint.AfterBegin,sH);this.setIndent(iIndent)}if(oC){oC.set_IsShown(false)}}}else{if(oEC){Owa.Components.CssSprites.updateImage(oEC,g_sNoChildIco);oEC._get_DomNode().style.cursor=AUTO}}};Owa.Components.TreeNode.prototype.setHighlightEffect=function Owa$Components$TreeNode$setHighlightEffect(sClassName,oStyleObject){var oHighlightEffect=this.gtHl().getChildById(NODE_EFFECT);if(sClassName||oStyleObject){if(!oHighlightEffect){oHighlightEffect=this._tr.root.get_OwnerDocument().createElement(DIV);oHighlightEffect.set_Id(NODE_EFFECT);this.gtHl().insertAdjacentElement(Owa.ElementInsertionPoint.AfterBegin,oHighlightEffect)}}else{if(oHighlightEffect)oHighlightEffect.remove();return}if(sClassName){oHighlightEffect.set_CssClasses(["trNdSel",sClassName])}else{var oHlS=oHighlightEffect._get_DomNode().style;oHlS.backgroundColor=oStyleObject.bgC?oStyleObject.bgC:"";oHlS.borderColor=oStyleObject.bdrC?oStyleObject.bdrC:"";oHlS.borderStyle=oStyleObject.bdrS?oStyleObject.bdrS:"";oHlS.borderWidth=oStyleObject.bdrW?oStyleObject.bdrW:"";oHlS.color=oStyleObject.c?oStyleObject.c:""}};Owa.Components.TreeNode.prototype.clearHighlightEffect=function Owa$Components$TreeNode$clearHighlightEffect(){var oHighlightEffect=this.gtHl().getChildById(NODE_EFFECT);if(oHighlightEffect)oHighlightEffect.remove(true)};Owa.Components.TreeNode.prototype.canSel=function Owa$Components$TreeNode$canSel(){return !this._get_Element().getAttribute("_nosel")};Owa.Components.TreeNode.prototype.isSel=function Owa$Components$TreeNode$isSel(){return this._get_Element().getAttribute("_sel")};Owa.Components.TreeNode.prototype.stSel=function Owa$Components$TreeNode$stSel(fS){this._get_Element().setAttribute("_sel",fS?"1":null)};Owa.Components.TreeNode.prototype.stHl=function Owa$Components$TreeNode$stHl(fHl){if(fHl){this.setHighlightEffect(this._tr.getSelectionClass());this._get_Element().setAttribute("_hl","1")}else{this.clearHighlightEffect(this._tr.getSelectionClass());this._get_Element().setAttribute("_hl",null)}};Owa.Components.TreeNode.prototype.isHl=function Owa$Components$TreeNode$isHl(){return this._get_Element().getAttribute("_hl")};Owa.Components.TreeNode.prototype.stDrpHl=function Owa$Components$TreeNode$stDrpHl(fD){if(fD)this.setHighlightEffect(this._tr.getDragEffectClass());else this.stHl(this.isSel())};Owa.Components.TreeNode.prototype.canDrg=function Owa$Components$TreeNode$canDrg(){return 0};Owa.Components.TreeNode.prototype.onDrg=function Owa$Components$TreeNode$onDrg(oEvent){return};Owa.Components.TreeNode.prototype.drpIn=function Owa$Components$TreeNode$drpIn(oRootElement,iDM){return};Owa.Components.TreeNode.prototype.canDrpExp=function Owa$Components$TreeNode$canDrpExp(oRootElement){return true};Owa.Components.TreeNode.prototype.gtDrpMd=function Owa$Components$TreeNode$gtDrpMd(oJN,oEvent,oRootElement){return DRP_NONE}})();g_fModuleLoaded[".\\uicontrols/treenode.js".toLowerCase()]=1;var TN_FTN="folderTreeNode";var TN_GH="navigationGroupHeaderNode";var DIV="div";var A="a";var AUTO="auto";var POINTER="pointer";var CONTENT_OFFSET=19;var TR="divTr";var NODE_CHILDREN="divTrNdCC";var NODE_HIGHLIGHT="divTrNdHl";var NODE_EFFECT="divTrNdEff";var NODE_CONTAINER="divTrNdO";var EC="ec";var PR="pr";var NODE_ICON="imgTrNd";var NODE_CONTENT="spnTrNdCnt";var DRP_NONE=0;var DRP_COPY=1;var DRP_MOVE=2;var DRP_LINK=3;var DRP_IC_MSK=3;var DRP_EFF_MSK=12;var DRP_ABOVE=4;var DRP_BELOW=8;var AFLG_PRV=0x01;var AFLG_PRT=0x02;var AFLG_RT=0x10;var EFF_SHI=0x400;var EFF_EXB=0x02000000;var EFF_RMH=0x04000000;var EFF_XORG=0x40000000;var FRT_ALL=0x00;var FRT_HSF=0x01;var FRT_HGF=0x02;var g_sPlusIco;var g_sMinusIco;var g_sNoChildIco;var g_sTimerIco;var g_rgsFIcns=[];g_rgsFIcns[T_MSG]="fldr.png";g_rgsFIcns[T_CAL]="appt.gif";g_rgsFIcns[T_CON]="contact.gif";g_rgsFIcns[T_TSK]="tsk.gif";g_rgsFIcns[T_NTS]="notes.png";g_rgsFIcns[T_JNL]="journal.gif";var GS_FVR="1";var GS_CAL="3";var GS_CNT="4";var GS_TSK="5";var EDT_INPT=1;var EDT_CHK=2;var ECR_ESC=0;var ECR_ENTER=1;var ECR_FO=2;var FKID="FakeNode";var FNID="spnFldrNm";var AL_DEF="default";var ALP_DFT="DFT.";var g_iPrgIndQt;var CCDT_NONE=0;var CCDT_ITMC=1;(function(){var g_sDragEffectClass="trDrgEff";var g_sSelelectionClass="trDefSel";Owa.UIControls.TreeControl=function Owa$UIControls$TreeControl(root){Owa.UIControls.TreeControl.constructBase(this,[root]);this.root=root;if(!g_sPlusIco){if(g_fRtl){g_sPlusIco="plusrtl.png";g_sMinusIco="minusrtl.png"}else{g_sPlusIco="plus.png";g_sMinusIco="minus.png"}g_sNoChildIco="clear.gif";g_sTimerIco=getThmF("pgrs-sm.gif")}this._aDict={};this._sSelelectionClass=g_sSelelectionClass;this._sDragEffectClass=g_sDragEffectClass;this.root.setExpando("isRoot",1);this._sErrNm=this.root.getAttribute("_errDiv");this._sHdErrNm=this.root.getAttribute("_errHd");this.initialize()};Owa.UIControls.TreeControl.createClass("Owa.UIControls.TreeControl",Owa.UIControls.UIControl);Owa.UIControls.TreeControl.prototype.initialize=function Owa$UIControls$TreeControl$initialize(){Owa.UIControls.TreeControl.callBase(this,"initialize");if(!this._sSelNdId){this._sSelNdId=null;this._sHlNdId=null;var rgDivs=this.root.getDescendantsByTagName(DIV);for(var i=0;i<rgDivs.length;i++){if(rgDivs[i].getAttribute("_sel")){this.stNdSel(this.gtNd(rgDivs[i]),1);break}}}else{this.syncSelNHl()}if(this._onKD)this._attachEvent(this.root,"keydown",this._onKD);if(this._onDO){this._attachEvent(this.root,"dragenter",this._onDO);this._attachEvent(this.root,"dragover",this._onDO);Owa.Components.Storage.DragDrop.enableDNDInFireFox(this._get_Element())}if(this._onDrp)this._attachEvent(this.root,"drop",this._onDrp);if(this._onDL)this._attachEvent(this.root,"dragleave",this._onDL);if(this._onClk)this._attachEvent(this.root,"click",this._onClk);if(this._onContextMenuEventHandler)this._attachEvent(this.root,"contextmenu",this._onContextMenuEventHandler);if(this._onDS)this._attachEvent(this.root,"dragstart",this._onDS);if(this._onSS)this._attachEvent(this.root,"selectstart",this._onSS)};Owa.UIControls.TreeControl.prototype.dispose=function Owa$UIControls$TreeControl$dispose(){if(this._edting)this.qtEdtNd();this.root.detachAllEvents();this._oElement=null;this.root=null;this._edt=null;this._drp=null;this._aDict=null;Owa.UIControls.TreeControl.callBase(this,"dispose")};Owa.UIControls.TreeControl.prototype.stAls=function Owa$UIControls$TreeControl$stAls(sA,sId){if(sId){this._aDict[sA]=sId}else{this._aDict[sA]=null;delete this._aDict[sA]}};Owa.UIControls.TreeControl.prototype.clrAls=function Owa$UIControls$TreeControl$clrAls(){this._aDict={}};Owa.UIControls.TreeControl.prototype.get_ContextMenu=function Owa$UIControls$TreeControl$get_ContextMenu(){return this._oContextMenu};Owa.UIControls.TreeControl.prototype.set_ContextMenu=function Owa$UIControls$TreeControl$set_ContextMenu(oContextMenu){this._oContextMenu=oContextMenu};Owa.UIControls.TreeControl.prototype.gtNd=function Owa$UIControls$TreeControl$gtNd(o){if(!o)return;while(o&&!o.getExpando("isRoot")&&(o.get_Id()!=NODE_CONTAINER&&o.get_Id()!=NODE_HIGHLIGHT&&o.get_Id()!=NODE_CHILDREN))o=o.get_ParentElement();if(!o||o.getExpando("isRoot"))return;var sId=o.get_Id();var oN;if(sId==NODE_CONTAINER)oN=o.getChildById(NODE_HIGHLIGHT).getDescendantsByTagName(A)[0];else if(sId==NODE_HIGHLIGHT)oN=o.getDescendantsByTagName(A)[0];else if(sId==NODE_CHILDREN)oN=o.get_ParentElement().getChildById(NODE_HIGHLIGHT).getDescendantsByTagName(A)[0];if(oN)return this.wrapNd(oN)};Owa.UIControls.TreeControl.prototype.wrapNd=function Owa$UIControls$TreeControl$wrapNd(oN){return new Owa.Components.TreeNode(oN,this)};Owa.UIControls.TreeControl.prototype.gtNdById=function Owa$UIControls$TreeControl$gtNdById(sId){var o=this.gtDomNdById(sId);return o?this.wrapNd(o):o};Owa.UIControls.TreeControl.prototype.gtChdNdById=function Owa$UIControls$TreeControl$gtChdNdById(oJPN,sId){if(!oJPN)return;var oCC=oJPN.gtCC();if(!oCC)return;var oNode=oCC.getDescendantById(sId);if(!oNode)return;return this.gtNd(oNode)};Owa.UIControls.TreeControl.prototype.gtNdFrstChld=function Owa$UIControls$TreeControl$gtNdFrstChld(oJN){var oCC=oJN.gtCC();if(!oCC||!oCC.get_FirstChild())return;return this.gtNd(oCC.get_FirstChild())};Owa.UIControls.TreeControl.prototype.gtNdRt=function Owa$UIControls$TreeControl$gtNdRt(){return this.gtNd(this.root.get_FirstChild())};Owa.UIControls.TreeControl.prototype.gtDomNdById=function Owa$UIControls$TreeControl$gtDomNdById(sId){if(sId&&this.root)return this.root.getDescendantById(sId)};Owa.UIControls.TreeControl.prototype.gtNdPrnt=function Owa$UIControls$TreeControl$gtNdPrnt(oJN){if(oJN.isRt())return;return this.gtNd(oJN.getContainer().get_ParentElement())};Owa.UIControls.TreeControl.prototype.gtNdNxt=function Owa$UIControls$TreeControl$gtNdNxt(oJN){return this.gtNd(oJN.getContainer().get_NextSibling())};Owa.UIControls.TreeControl.prototype.gtNdPrv=function Owa$UIControls$TreeControl$gtNdPrv(oJN){return this.gtNd(oJN.getContainer().get_PreviousSibling())};Owa.UIControls.TreeControl.prototype.gtNdByAls=function Owa$UIControls$TreeControl$gtNdByAls(sA){return this.gtNdById(this._aDict[sA])};Owa.UIControls.TreeControl.prototype.isContainer=function Owa$UIControls$TreeControl$isContainer(o){return o.get_Id()==NODE_CONTAINER};Owa.UIControls.TreeControl.prototype.stKds=function Owa$UIControls$TreeControl$stKds(oJN,rgChildren){this.clrKds(oJN);this.addKds(oJN,rgChildren)};Owa.UIControls.TreeControl.prototype.clrKds=function Owa$UIControls$TreeControl$clrKds(oJN){var o=oJN._get_Element();if(oJN.gtCC())oJN.gtCC().remove(true);o.setAttribute("_exp",null);o.setAttribute("_hsChld",null);this.rplcNd(oJN.gtId(),o)};Owa.UIControls.TreeControl.prototype.rmNd=function Owa$UIControls$TreeControl$rmNd(oJN){var oJPN=this.gtNdPrnt(oJN);var oC=oJN.getContainer();oC.remove(true);if(!oJPN)return;var oC=oJPN.gtCC();if(oC.hasChildNodes()==0){if(oJN.gtId()!=FKID)oJPN._get_Element().setAttribute("_hsChld","0");oJPN._get_Element().setAttribute("_exp",null)}oJPN.upd();this.fireOnResize()};Owa.UIControls.TreeControl.prototype.rplcNd=function Owa$UIControls$TreeControl$rplcNd(sId,oNew,iIndent){var oJO=this.gtNdById(sId);if(!oJO||!oNew)return;if(!Owa.Utility.isDefined(typeof(iIndent)))iIndent=oJO.getIndent();var oC=oJO.getContainer();var oNewContainer=this.wrapContainer(oNew,iIndent);oC.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeBegin,oNewContainer);oC.remove(true);var oJN=this.gtNdById(oNew.get_Id());oJN.stSel(oJO.isSel());oJN.stHl(oJO.isHl());if(this._drp)this.drpHlNd(this._drp.oNd,this._drp.sDM);return oJN._get_Element()};Owa.UIControls.TreeControl.prototype.addKdPos=function Owa$UIControls$TreeControl$addKdPos(oJPN,oN,fFrcEC,oJN,aft){var oD=this.root.get_OwnerDocument().createElement(DIV);oD.appendChild(oN);if(oJN)this.insrtKdsPos(oJN,oD.getChildrenSnapshot(),fFrcEC,aft);else this.addKds(oJPN,oD.getChildrenSnapshot(),fFrcEC)};Owa.UIControls.TreeControl.prototype.addKds=function Owa$UIControls$TreeControl$addKds(oJN,rgChildren,fFrcEC){var oC=oJN.gtCC();oJN._get_Element().setAttribute("_hsChld","1");if(!oC){this.rplcNd(oJN.gtId(),oJN._get_Element());oC=oJN.gtCC()}var iIndent=oJN.getIndent()+oJN.getChildIndent();while(rgChildren.length>0){var oNd=rgChildren.shift();if(!this.isContainer(oNd)){oNd=this.wrapContainer(oNd,iIndent,fFrcEC)}oC.appendChild(oNd)}oJN.upd();this.fireOnResize()};Owa.UIControls.TreeControl.prototype.insrtKdsPos=function Owa$UIControls$TreeControl$insrtKdsPos(oJN,rgChildren,fFrcEC,aft){var iIndent=oJN.getIndent();var oContainer=oJN.getContainer();while(rgChildren.length>0){var oKid=aft?rgChildren.pop():rgChildren.shift();var oNewContainer;if(this.isContainer(oKid))oNewContainer=oKid;else oNewContainer=this.wrapContainer(oKid,iIndent,fFrcEC);if(!aft)oContainer.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeBegin,oNewContainer);else oContainer.insertAdjacentElement(Owa.ElementInsertionPoint.AfterEnd,oNewContainer)}this.fireOnResize()};Owa.UIControls.TreeControl.prototype.mkECH=function Owa$UIControls$TreeControl$mkECH(sEC,oN,iIndent){return Owa.Components.CssSprites.getImageMarkup(sEC,"id=\""+EC+"\" style=\""+(g_fRtl?"right":"left")+":"+iIndent+"px\"")};Owa.UIControls.TreeControl.prototype.wrapContainer=function Owa$UIControls$TreeControl$wrapContainer(oN,iIndent,fFrcEC){var hasKids=oN.getAttribute("_hsChld");var img=oN.getAttribute("_exp")?g_sMinusIco:g_sPlusIco;var imgS=hasKids?this.mkECH(img,oN,iIndent):(fFrcEC?this.mkECH(g_sNoChildIco,oN):"");var kidsDiv=hasKids?"<div id=\""+NODE_CHILDREN+"\" style=\"display: none; width: 100%\"></div>":"";var oContainer=this.root.get_OwnerDocument().createElement(DIV);var sHlCls=oN.getAttribute("_hlCls");sHlCls=sHlCls?sHlCls:"trNdHl";oContainer.set_Id(NODE_CONTAINER);oContainer.set_InnerHtml("<div id=\""+NODE_HIGHLIGHT+"\" class=\""+sHlCls+"\">"+imgS+"</div>"+kidsDiv);oContainer.get_FirstChild().appendChild(oN);if(g_fRtl){oN.set_Right(iIndent+CONTENT_OFFSET)}else{oN.set_Left(iIndent+CONTENT_OFFSET)}oN.setIntAttribute("_indnt",iIndent);return oContainer};Owa.UIControls.TreeControl.prototype.isAncstr=function Owa$UIControls$TreeControl$isAncstr(oJAN,oJN,fSlf){if(!oJAN||!oJN)return;if(fSlf&&oJAN.equals(oJN))return 1;var oJPN=oJN;while(oJPN){oJPN=this.gtNdPrnt(oJPN);if(oJPN&&oJPN.equals(oJAN))return 1}};Owa.UIControls.TreeControl.prototype.createNewNode=function Owa$UIControls$TreeControl$createNewNode(id,oJN,isSibling,isAfter,option){option=option?option:{};var oDiv=this.root.get_OwnerDocument().createElement(DIV);var html="<a class=\""+(option.bodyClassName?option.bodyClassName:"trNd")+"\" hideFocus=1 href=\"#\"";html+=" id=\""+id+"\"";if(option.nosel)html+=" _nosel=1";if(option.sync)html+=" _sync=1";else html+=" _sync=0";if(option.exp)html+=" _exp=1";if(option.padding)html+=" _pd="+option.padding;if(option.highlightClassName)html+=" _hlCls=\""+option.highlightClassName+"\"";html+=">";if(option.contentHTML){html+=option.contentHTML+"</a>"}else{if(option.iconHTML)html+=option.iconHTML;html+="<span id=\""+NODE_CONTENT+"\""+(option.contentClassName?" class=\""+option.contentClassName+"\"":"")+">"+(option.contentInnerHTML?option.contentInnerHTML:"")+"</span></a>"}oDiv.set_InnerHtml(html);var oElement=this.wrapNd(Owa.Dom.Node.wrapDomNode(oDiv._get_DomNode().childNodes[0]));if(isSibling){this.insrtKdsPos(oJN,oDiv.getChildrenSnapshot(),0,isAfter)}else{this.addKds(oJN,oDiv.getChildrenSnapshot())}return oElement};Owa.UIControls.TreeControl.prototype.shwNd=function Owa$UIControls$TreeControl$shwNd(oJN){var oJPN=this.gtNdPrnt(oJN);while(oJPN){oJPN.expand();oJPN=this.gtNdPrnt(oJPN)}var oE=oJN._get_Element();var iY=getCY(oE._get_DomNode(),0,this.root._get_DomNode().offsetParent)-getCY(this.root._get_DomNode(),0,this.root._get_DomNode().offsetParent);if(iY<0||iY>=this.root.get_OffsetHeight())oJN._get_Element()._get_DomNode().scrollIntoView()};Owa.UIControls.TreeControl.prototype.feOnBfEdt=function Owa$UIControls$TreeControl$feOnBfEdt(oJN){if(this.onBfEdt)return this.onBfEdt(oJN)};Owa.UIControls.TreeControl.prototype.crtFkNd=function Owa$UIControls$TreeControl$crtFkNd(icnMrkup){var oTreeNodeElement=this.root.get_OwnerDocument().createElement(A);oTreeNodeElement.set_CssClasses(["trNd"]);oTreeNodeElement.set_Id(FKID);oTreeNodeElement.setAttribute("hideFocus","1");oTreeNodeElement.setAttribute("src","#");oTreeNodeElement.set_InnerHtml((icnMrkup?icnMrkup:"")+"<SPAN id=\""+NODE_CONTENT+"\"></SPAN>");return oTreeNodeElement};Owa.UIControls.TreeControl.prototype.gtNwNdIcnMrkup=function Owa$UIControls$TreeControl$gtNwNdIcnMrkup(oPN,oCtx){return Owa.Components.CssSprites.getImageMarkup(g_rgsFIcns[T_MSG],"id="+NODE_ICON)};Owa.UIControls.TreeControl.prototype.strtEdt=function Owa$UIControls$TreeControl$strtEdt(oCtx){this._edting=EDT_INPT;this._fDontSyncSelection=1;if(!this._edt)this._edt={};this._edt.oCtx=oCtx};Owa.UIControls.TreeControl.prototype.crtNwNd=function Owa$UIControls$TreeControl$crtNwNd(oJPN,oCtx,fFrcEC,oJN){if(this._edting)return;this.strtEdt(oCtx);this._edt.crtNw=1;this._edt._hsChld=oJPN.hsChld();var nwNd=this.crtFkNd(this.gtNwNdIcnMrkup(oJPN,oCtx));this.addKdPos(oJPN,nwNd,fFrcEC,oJN);oJPN.expand();this.edtNd(this.gtNdById(FKID),oCtx,1)};Owa.UIControls.TreeControl.prototype.edtNd=function Owa$UIControls$TreeControl$edtNd(oJN,oCtx,fCrtNw){if(this._edting&&!fCrtNw)return;this.strtEdt(oCtx);this._edt.nd=oJN;if(this.feOnBfEdt())return;this.shwNd(oJN);var oInp=this.crtInp(oJN);this._edt.inp=oInp;oJN.gtHl().insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oInp);oInp.get_FirstChild().set_Value(oJN.gtDspNm());oInp.get_FirstChild().focus(100);this.clrHl();oJN.hdCnt();oInp.get_FirstChild()._get_DomNode().select()};Owa.UIControls.TreeControl.prototype.crtInp=function Owa$UIControls$TreeControl$crtInp(oJN){var iImgWidth=0;var oImg=oJN.gtImg();if(oImg)iImgWidth+=oImg.get_OffsetWidth()+oImg._get_EffectiveMarginWidth();var oInp=this.root.get_OwnerDocument().createElement("input");var oOuter=this.root.get_OwnerDocument().createElement(DIV);var oBorder=this.root.get_OwnerDocument().createElement(DIV);oInp.set_CssClasses(["trEdtInp"]);oOuter.set_CssClasses(["trEdtO"]);oBorder.set_CssClasses(["trEdtBd"]);oInp.setAttribute("maxLength",this.getMaxInputLength());if(g_fRtl){oBorder.set_Right(-2-iImgWidth);oOuter.set_Right(iImgWidth+oJN.getIndent()+CONTENT_OFFSET)}else{oBorder.set_Left(-2-iImgWidth);oOuter.set_Left(iImgWidth+oJN.getIndent()+CONTENT_OFFSET)}if(this.onInpKD)this._attachEvent(oInp,"keydown",this.onInpKD);if(this.onInputBlur)this._attachEvent(oInp,"blur",this.onInputBlur);oOuter.appendChild(oInp);oOuter.appendChild(oBorder);if(Owa.Utility.isFirefox()){try{document.execCommand("enableObjectResizing",false,"false")}catch(e){}}return oOuter};Owa.UIControls.TreeControl.prototype.getMaxInputLength=function Owa$UIControls$TreeControl$getMaxInputLength(){return"255"};Owa.UIControls.TreeControl.prototype.onInpKD=function Owa$UIControls$TreeControl$onInpKD(oEvent){switch(oEvent.get_KeyCodeForKeyUpDown()){case 13:if(this._edting==EDT_CHK)return;oEvent.cancelBubble();this.chkEdtNd(ECR_ENTER);break;case 27:oEvent.cancelBubble();this.chkEdtNd(ECR_ESC);break}};Owa.UIControls.TreeControl.prototype.onInputBlur=function Owa$UIControls$TreeControl$onInputBlur(oEvent){if(this._edting!=EDT_CHK)this.chkEdtNd(ECR_FO)};Owa.UIControls.TreeControl.prototype.feOnRnNd=function Owa$UIControls$TreeControl$feOnRnNd(rsn,sV){if(this.onRnNd)this.onRnNd(rsn,sV)};Owa.UIControls.TreeControl.prototype.feOnNwNd=function Owa$UIControls$TreeControl$feOnNwNd(rsn,sV){if(this.onNwNd)this.onNwNd(rsn,sV)};Owa.UIControls.TreeControl.prototype.chkEdtNd=function Owa$UIControls$TreeControl$chkEdtNd(rsn){this._edting=EDT_CHK;this._edt.nd.shwPrg(1000,this._edt.nd.gtImg()?1:0);return this._edt.crtNw?this.feOnNwNd(rsn,this._edt.inp.get_FirstChild().get_Value()):this.feOnRnNd(rsn,this._edt.inp.get_FirstChild().get_Value())};Owa.UIControls.TreeControl.prototype.reEdtNd=function Owa$UIControls$TreeControl$reEdtNd(){this._edting=EDT_INPT;try{this._edt.inp.get_FirstChild().focus(0);this._edt.nd.hdPrg()}catch(e){this.qtEdtNd()}};Owa.UIControls.TreeControl.prototype.qtEdtNd=function Owa$UIControls$TreeControl$qtEdtNd(){if(!this._edting)return;var oJN=this._edt.nd;var oJPN=this.gtNdPrnt(oJN);oJN.hdPrg();if(this._edt.crtNw){oJPN._get_Element().setAttribute("_hsChld",this._edt._hsChld);this.rmNd(oJN)}else{this._edt.inp.get_FirstChild().detachAllEvents();this._edt.inp.remove(true);oJN.shwCnt()}this._edt=null;this._edting=0;this.hdErr();this.syncSelNHl();this.feOnAfEdt()};Owa.UIControls.TreeControl.prototype.feOnAfEdt=function Owa$UIControls$TreeControl$feOnAfEdt(){if(this.onAfEdt)this.onAfEdt()};Owa.UIControls.TreeControl.prototype.shwErr=function Owa$UIControls$TreeControl$shwErr(sErr,fInlineError){var oErr=this.root.get_OwnerDocument().getElementById(this._sErrNm);if(fInlineError){showErr(oErr._get_DomNode(),sErr);if(this._sHdErrNm){var oHdErr=this.root.get_OwnerDocument().getElementById(this._sHdErrNm);oHdErr.set_IsShown(true)}this.fireOnErrorInfobarChanged();if(this._edting)this._edt.inp._get_DomNode().scrollIntoView(0)}else{shwErrDlg(0,sErr)}};Owa.UIControls.TreeControl.prototype.hdErr=function Owa$UIControls$TreeControl$hdErr(){var oErr=this.root.get_OwnerDocument().getElementById(this._sErrNm);hideErr(oErr._get_DomNode());if(this._sHdErrNm){var oHdErr=this.root.get_OwnerDocument().getElementById(this._sHdErrNm);oHdErr.set_IsShown(false)}this.fireOnErrorInfobarChanged()};Owa.UIControls.TreeControl.prototype.cbOeh=function Owa$UIControls$TreeControl$cbOeh(oR,fInlineError){var fE=this._edting;if(!cbOehST(oR)){if(fE)this.qtEdtNd();return}if(oR.sErr){this.shwErr(oR.sErr,fInlineError);if(fE)this.reEdtNd();return}var oDiv=this.root.get_OwnerDocument().createElement(DIV);oDiv.set_InnerHtml(oR.sBody);var oErr=oDiv.getDescendantById("err");if(oErr){this.shwErr(oErr.getAttribute("_msg"),fInlineError);if(fE)this.reEdtNd();return}if(fE)this.qtEdtNd();return 1};Owa.UIControls.TreeControl.prototype._onKD=function Owa$UIControls$TreeControl$_onKD(oEvent){if(this._edting)return;if(oEvent.isAltKeyDown()||oEvent.isCtrlKeyDown()||oEvent.get_KeyCodeForKeyUpDown()==9)return;var oJSel=this.gtSelNd();switch(oEvent.get_KeyCodeForKeyUpDown()){case 37:case 109:if(oJSel&&oJSel.isExp())oJSel.collapse();break;case 39:case 107:if(oJSel&&!oJSel.isExp())oJSel.expand();break;default:this.feOnKD(oEvent);return}oEvent.preventDefault()};Owa.UIControls.TreeControl.prototype.feOnKD=function Owa$UIControls$TreeControl$feOnKD(oEvent){if(this.onKD)this.onKD(oEvent)};Owa.UIControls.TreeControl.prototype._onClk=function Owa$UIControls$TreeControl$_onClk(oEvent){if(this._edting)return;var oTarget=oEvent.get_Target();var oJN=this.gtNd(oTarget);if(!oJN)return;if(oTarget.get_Id()==NODE_CHILDREN)return;if(oJN.isEC(oTarget)){oJN.tggl();oEvent.preventDefault();oEvent.cancelBubble();return}this.feOnClkNd(oEvent,oJN);oEvent.preventDefault();oEvent.cancelBubble()};Owa.UIControls.TreeControl.prototype.feOnClkNd=function Owa$UIControls$TreeControl$feOnClkNd(oEvent,oJN){if(this.onClkNd)this.onClkNd(oEvent,oJN);if(oJN.canSel()){this.selNd(oJN)}else{oJN.tggl();oEvent.preventDefault();oEvent.cancelBubble()}};Owa.UIControls.TreeControl.prototype._onSS=function Owa$UIControls$TreeControl$_onSS(oEvent){if(this._edting&&oEvent.get_Target().equals(this._edt.inp.get_FirstChild())){oEvent.cancelBubble();return}oEvent.preventDefault()};Owa.UIControls.TreeControl.prototype.getSelectionClass=function Owa$UIControls$TreeControl$getSelectionClass(){return this._sSelelectionClass};Owa.UIControls.TreeControl.prototype.setSelectionClass=function Owa$UIControls$TreeControl$setSelectionClass(sClass){this._sSelelectionClass=sClass;this.rfrshHl()};Owa.UIControls.TreeControl.prototype.hsSelNd=function Owa$UIControls$TreeControl$hsSelNd(){return !!this._sSelNdId};Owa.UIControls.TreeControl.prototype.hsHlNd=function Owa$UIControls$TreeControl$hsHlNd(){return !!this._sHlNdId};Owa.UIControls.TreeControl.prototype.gtSelNd=function Owa$UIControls$TreeControl$gtSelNd(){if(!this.hsSelNd())return;return this.gtNdById(this._sSelNdId)};Owa.UIControls.TreeControl.prototype.gtHlNd=function Owa$UIControls$TreeControl$gtHlNd(){if(!this.hsHlNd())return;return this.gtNdById(this._sHlNdId)};Owa.UIControls.TreeControl.prototype.selNdById=function Owa$UIControls$TreeControl$selNdById(sId){this.stNdSel(this.gtNdById(sId),1)};Owa.UIControls.TreeControl.prototype.gtNrstNd=function Owa$UIControls$TreeControl$gtNrstNd(oJN){var oJT=this.gtNdPrv(oJN);while(oJT){if(oJT.canSel())return oJT;oJT=this.gtNdPrv(oJT)}oJT=this.gtNdNxt(oJN);while(oJT){if(oJT.canSel())return oJT;oJT=this.gtNdNxt(oJT)}oJT=this.gtNdPrnt(oJN);if(oJT&&oJT.canSel())return oJT;if(oJT)return this.gtNrstNd(oJT)};Owa.UIControls.TreeControl.prototype.clrSel=function Owa$UIControls$TreeControl$clrSel(){this.stNdSel(this.gtSelNd(),0)};Owa.UIControls.TreeControl.prototype.clrHl=function Owa$UIControls$TreeControl$clrHl(){if(this._frst)this._frst.clrHl();else this._clrHl()};Owa.UIControls.TreeControl.prototype._clrHl=function Owa$UIControls$TreeControl$_clrHl(){this.stNdHl(this.gtHlNd(),0)};Owa.UIControls.TreeControl.prototype.stNdSel=function Owa$UIControls$TreeControl$stNdSel(oJN,fSel){if(oJN&&!oJN.canSel())return;var oJSel=this.gtSelNd();if(fSel){if(oJSel&&oJSel.equals(oJN)&&this._fcs){this.rfrshHl()}else{this.stFcs(1);if(oJSel)oJSel.stSel(0);if(oJN){this._sSelNdId=oJN.gtId();oJN.stSel(1)}else{this._sSelNdId=null}this.stNdHl(oJN,fSel)}}else{if(oJN&&oJN.equals(oJSel))oJSel.stSel(0);this._sSelNdId=null;this.stNdHl(oJN,fSel)}if(!oJSel&&oJN||oJSel&&!oJSel.equals(oJN))this.feOnSelChng(oJSel,this.gtSelNd())};Owa.UIControls.TreeControl.prototype.stFcs=function Owa$UIControls$TreeControl$stFcs(fF){if(this._frst)this._frst.stFcsTr(fF?this._nm:null);else if(this._fcs!=fF)this._stFcs(fF)};Owa.UIControls.TreeControl.prototype._stFcs=function Owa$UIControls$TreeControl$_stFcs(fF){this._fcs=fF;if(!fF)this.clrSel()};Owa.UIControls.TreeControl.prototype.stNdHl=function Owa$UIControls$TreeControl$stNdHl(oJN,fHl){var oJHlNd=this.gtHlNd();if(fHl){this.clrHl();if(oJN){this._sHlNdId=oJN.gtId();oJN.stHl(1)}}else if(oJN&&oJN.equals(oJHlNd)){oJHlNd.stHl(0)}};Owa.UIControls.TreeControl.prototype._onContextMenuCloseEventHandler=function Owa$UIControls$TreeControl$_onContextMenuCloseEventHandler(){if(!this._fDontSyncSelection)this.syncSelNHl();var oContextMenu=this.get_ContextMenu();oContextMenu.get_OnClose().remove(this._createCallback(this._onContextMenuCloseEventHandler));oContextMenu.get_OnSelect().remove(this._createCallback(this._onContextMenuSelectEventHandler))};Owa.UIControls.TreeControl.prototype._onContextMenuSelectEventHandler=function Owa$UIControls$TreeControl$_onContextMenuSelectEventHandler(oEventArgs,oJN){if(oJN){this.stNdHl(oJN,1)}if(oJN&&oJN.onContextMenuClick){return oJN.onContextMenuClick(oEventArgs)}return false};Owa.UIControls.TreeControl.prototype.syncSelNHl=function Owa$UIControls$TreeControl$syncSelNHl(){if(this._frst)this._frst.syncSelNHl();else this._syncSelNHl()};Owa.UIControls.TreeControl.prototype._syncSelNHl=function Owa$UIControls$TreeControl$_syncSelNHl(){var oJSel=this.gtSelNd();var oJHl=this.gtHlNd();if(!oJSel){this._clrHl();return}if(oJSel.equals(oJHl)){this._rfrshHl()}else{if(oJHl)oJHl.stHl(0);oJSel.stHl(1);this._sHlNdId=oJSel.gtId()}};Owa.UIControls.TreeControl.prototype.selNd=function Owa$UIControls$TreeControl$selNd(oJN){this.stNdSel(oJN,1)};Owa.UIControls.TreeControl.prototype.feOnSelChng=function Owa$UIControls$TreeControl$feOnSelChng(oJO,oJN){if(this.onSelChng)this.onSelChng(oJO,oJN)};Owa.UIControls.TreeControl.prototype.rfrshHl=function Owa$UIControls$TreeControl$rfrshHl(){if(this._frst)this._frst.rfrshHl();else this._rfrshHl()};Owa.UIControls.TreeControl.prototype._rfrshHl=function Owa$UIControls$TreeControl$_rfrshHl(){if(!this._fcs)return;var oJHl=this.gtHlNd();if(oJHl)oJHl.stHl(1)};Owa.UIControls.TreeControl.prototype.getDragEffectClass=function Owa$UIControls$TreeControl$getDragEffectClass(){return this._sDragEffectClass};Owa.UIControls.TreeControl.prototype._onDS=function Owa$UIControls$TreeControl$_onDS(oEvent){if(this._edting)return;var oTarget=oEvent.get_Target();var oJN=this.gtNd(oTarget);if(oJN&&oJN.canDrg()){this.feOnDrg(oEvent,oJN)}else{var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);oDragDrop.deny()}};Owa.UIControls.TreeControl.prototype.feOnDrg=function Owa$UIControls$TreeControl$feOnDrg(oEvent,oJN){oJN.onDrg(oEvent);if(this.onDrg)return this.onDrg(oEvent,oJN)};Owa.UIControls.TreeControl.prototype._onDrp=function Owa$UIControls$TreeControl$_onDrp(oEvent){if(this._edting)return;this.clrExpNdTO();var oJN=this._drp.oNd;if(this._drp.iTid)this._clearTimeout(this._drp.iTid);if(oJN){var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);var oDraggableObject=Owa.Components.Storage.StorableObject.createFromStorage(oDragDrop);var iDM=this._drp.sDM;if(oDraggableObject){oJN.drpIn(oDraggableObject,iDM);if(this.drpIn)this.drpIn(oJN,oDraggableObject,iDM)}}this.onDLTOCB()};Owa.UIControls.TreeControl.prototype._onDL=function Owa$UIControls$TreeControl$_onDL(oEvent){if(!this._drp)return;if(this._drp.sLstEvt=="dragenter"){this._drp.sLstEvt=null;oEvent.cancelBubble();oEvent.preventDefault();return}if(this._drp.iTid)this._clearTimeout(this._drp.iTid);if(this._drp.oNd)this._drp.iTid=Owa.Dom.Window.get_Current().setTimeout(this._createCallback(this.onDLTOCB),50);this.clrExpNdTO();oEvent.cancelBubble();oEvent.preventDefault()};Owa.UIControls.TreeControl.prototype.onDLTOCB=function Owa$UIControls$TreeControl$onDLTOCB(){this.clrDrpHl();this._drp=null};Owa.UIControls.TreeControl.prototype._onDO=function Owa$UIControls$TreeControl$_onDO(oEvent){if(isDf(typeof iAutoScr)&&iAutoScr)return;var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);if(this._edting){oDragDrop.deny();return}var oDraggableObject=Owa.Components.Storage.StorableObject.createFromStorage(oDragDrop);if(!oDraggableObject){oDragDrop.deny();this.clrDrpHl();return}if(!this._drp)this._drp={};this._drp.sLstEvt=oEvent.get_Type();if(this._drp.iTid)this._clearTimeout(this._drp.iTid);var oJN=this.gtNd(oEvent.get_Target());if(oJN){var sDM;var oJT=oJN;while(oJT){sDM=oJT.gtDrpMd(oJN,oEvent,oDraggableObject);if(sDM!=DRP_NONE)break;oJT=this.gtNdPrnt(oJT)}switch(sDM&DRP_IC_MSK){case DRP_COPY:oDragDrop.setEffect(Owa.Components.Storage.DragDrop.Effect.Copy);break;case DRP_MOVE:oDragDrop.setEffect(Owa.Components.Storage.DragDrop.Effect.Move);break;case DRP_LINK:oDragDrop.setEffect(Owa.Components.Storage.DragDrop.Effect.Link);break;default:oDragDrop.setEffect(Owa.Components.Storage.DragDrop.Effect.None);break}if(!oJT||!oJT.equals(this._drp.oNd)||this._drp.sDM!=sDM){if(!isFlgSt(sDM,DRP_BELOW)||!isFlgSt(sDM,DRP_ABOVE)||isFlgSt(sDM,DRP_ABOVE)&&!oJT.equals(this.gtNdNxt(this._drp.oNd))||isFlgSt(sDM,DRP_BELOW)&&!oJT.equals(this.gtNdPrv(this._drp.oNd))){this.drpHlNd(oJT,sDM)}}this._drp.sDM=sDM;if(oJN.hsChld()&&oJN.canDrpExp(oDraggableObject))this.stExpNdTO(oJN);else this.clrExpNdTO()}};Owa.UIControls.TreeControl.prototype.stExpNdTO=function Owa$UIControls$TreeControl$stExpNdTO(oJN){if(oJN.hsChld()&&!oJN.isExp()){if(this._expNdId==oJN.gtId())return;if(this._expNdTId)this._clearTimeout(this._expNdTId);this._expNdId=oJN.gtId();this._expNdTId=Owa.Dom.Window.get_Current().setTimeout(this._createCallback(this.expNd),800)}};Owa.UIControls.TreeControl.prototype.clrExpNdTO=function Owa$UIControls$TreeControl$clrExpNdTO(){if(this._expNdTId)this._clearTimeout(this._expNdTId);this._expNdTId=0;this._expNdId=0};Owa.UIControls.TreeControl.prototype.expNd=function Owa$UIControls$TreeControl$expNd(){var oJN=this.gtNdById(this._expNdId);if(oJN&&!oJN.isExp())oJN.expand();this._expNdId=0;this._expNdTId=0};Owa.UIControls.TreeControl.prototype.clrDrpHl=function Owa$UIControls$TreeControl$clrDrpHl(){if(!this._drp||!this._drp.oNd)return;if(this._drp.oSp){this._drp.oSp.remove(true);this._drp.oSp=null}else{if(this._drp.oNd)this._drp.oNd.stDrpHl(0)}this._drp.sDM=DRP_NONE};Owa.UIControls.TreeControl.prototype.drpHlNd=function Owa$UIControls$TreeControl$drpHlNd(oJT,sDM){if(this._drp.iTid)this._clearTimeout(this._drp.iTid);if(this._frst)this._frst.clrDrpHl();else this.clrDrpHl();if(!oJT||sDM==DRP_NONE)return;switch(sDM&DRP_EFF_MSK){case DRP_ABOVE:this.addDrpSpDiv(oJT,1);break;case DRP_BELOW:this.addDrpSpDiv(oJT,0);break;default:oJT.stDrpHl(1);break}this._drp.oNd=oJT;this._drp.sDM=sDM};Owa.UIControls.TreeControl.prototype.addDrpSpDiv=function Owa$UIControls$TreeControl$addDrpSpDiv(oJT,fTop){var oDivOuter=this.root.get_OwnerDocument().createElement(DIV);var oDivInner=this.root.get_OwnerDocument().createElement(DIV);oDivOuter.set_CssClasses(["trDrpEffO"]);oDivInner.set_CssClasses(["trDrpEffI"]);oDivOuter.insertAdjacentElement(Owa.ElementInsertionPoint.AfterBegin,oDivInner);this._drp.oSp=oDivOuter;if(fTop)oJT.getContainer().insertAdjacentElement(Owa.ElementInsertionPoint.AfterBegin,oDivOuter);else oJT.getContainer().insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oDivOuter)};Owa.UIControls.TreeControl.prototype._onContextMenuEventHandler=function Owa$UIControls$TreeControl$_onContextMenuEventHandler(oEvent){if(this._edting)return;var oJN=this.gtNd(oEvent.get_Target());if(oJN){if(this._onBeforeContextMenu(oJN))return;var oContextMenu=this.get_ContextMenu();if(!oContextMenu)return;if(oContextMenu.get_IsShown()){oContextMenu.close()}oContextMenu.get_OnClose().add(this._createCallback(this._onContextMenuCloseEventHandler));oContextMenu.get_OnSelect().add(this._createCallback(this._onContextMenuSelectEventHandler,oJN));oContextMenu.showAtEvent(oEvent);this._fDontSyncSelection=0;this.stNdHl(oJN,1)}oEvent.cancelBubble();oEvent.preventDefault()};Owa.UIControls.TreeControl.prototype._onBeforeContextMenu=function Owa$UIControls$TreeControl$_onBeforeContextMenu(oTreeNode){return oTreeNode._onBeforeContextMenu()};Owa.UIControls.TreeControl.prototype.fireOnResize=function Owa$UIControls$TreeControl$fireOnResize(){if(this.onResize)this.onResize()};Owa.UIControls.TreeControl.prototype.fireOnErrorInfobarChanged=function Owa$UIControls$TreeControl$fireOnErrorInfobarChanged(){if(this.onErrorInfobarChanged)this.onErrorInfobarChanged()}})();if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/foldertreenode.js".toLowerCase()])(function(){Owa.Components.FolderTreeNode=function Owa$Components$FolderTreeNode(oN,tr){Owa.Components.FolderTreeNode.constructBase(this,[oN,tr])};Owa.Components.FolderTreeNode.createClass("Owa.Components.FolderTreeNode",Owa.Components.TreeNode);Owa.Components.FolderTreeNode.prototype.gtFId=function Owa$Components$FolderTreeNode$gtFId(){return this.gtId().substr(1)};Owa.Components.FolderTreeNode.prototype.gtFT=function Owa$Components$FolderTreeNode$gtFT(){return this._get_Element().getAttribute("_ft")?getInt(this._get_Element().getAttribute("_ft")):0};Owa.Components.FolderTreeNode.prototype.isS=function Owa$Components$FolderTreeNode$isS(sFT){if(sFT)return this.gtFT()==sFT;else return !!this.gtFT()};Owa.Components.FolderTreeNode.prototype.gtFCC=function Owa$Components$FolderTreeNode$gtFCC(){return this._get_Element().getAttribute("_fcc")};Owa.Components.FolderTreeNode.prototype.getFolderNameElement=function Owa$Components$FolderTreeNode$getFolderNameElement(){return this.getContent().getChildById(FNID)};Owa.Components.FolderTreeNode.prototype.gtDspNm=function Owa$Components$FolderTreeNode$gtDspNm(){return this.gtFldNm()};Owa.Components.FolderTreeNode.prototype.stDspNm=function Owa$Components$FolderTreeNode$stDspNm(sNm){this.getFolderNameElement().set_TextContent(sNm);this.stFldNm(sNm)};Owa.Components.FolderTreeNode.prototype.gtFldNm=function Owa$Components$FolderTreeNode$gtFldNm(){return this.getFolderNameElement().getAttribute("fldrNm")};Owa.Components.FolderTreeNode.prototype.stFldNm=function Owa$Components$FolderTreeNode$stFldNm(sNm){this.getFolderNameElement().setAttribute("fldrNm",sNm)};Owa.Components.FolderTreeNode.prototype.isNC=function Owa$Components$FolderTreeNode$isNC(){return this._get_Element().getAttribute("_nc")};Owa.Components.FolderTreeNode.prototype.gtCCDT=function Owa$Components$FolderTreeNode$gtCCDT(){return this._get_Element().getAttribute("_ccdt")};Owa.Components.FolderTreeNode.prototype.isPlcy=function Owa$Components$FolderTreeNode$isPlcy(){return this._get_Element().getAttribute("_fPlcy")};Owa.Components.FolderTreeNode.prototype.gtAFlg=function Owa$Components$FolderTreeNode$gtAFlg(){return this._get_Element().getAttribute("_iAFlg")};Owa.Components.FolderTreeNode.prototype.gtEFFlg=function Owa$Components$FolderTreeNode$gtEFFlg(){return this._get_Element().getAttribute("_eff")};Owa.Components.FolderTreeNode.prototype.isOSF=function Owa$Components$FolderTreeNode$isOSF(){return this._get_Element().getAttribute("_osf")};Owa.Components.FolderTreeNode.prototype.isXOrg=function Owa$Components$FolderTreeNode$isXOrg(){return this.gtEFFlg()&EFF_XORG};Owa.Components.FolderTreeNode.prototype.gtER=function Owa$Components$FolderTreeNode$gtER(){return this._get_Element().getAttribute("_iER")};Owa.Components.FolderTreeNode.prototype.isPFR=function Owa$Components$FolderTreeNode$isPFR(){return this._get_Element().getAttribute("_iPFR")};Owa.Components.FolderTreeNode.prototype.canCp=function Owa$Components$FolderTreeNode$canCp(){if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){return !this.isPFR()}else{return !this.isXOrg()&&!(this.gtEFFlg()&EFF_SHI)&&!this.isS(DFT_SFR)&&!this.isOSF()&&g_oFldrMgr.gtFL(this.gtFId())!=FL_OUM&&!(this.gtAFlg()&(AFLG_RT|AFLG_PRV|AFLG_PRT))&&!this.isS(DFT_ROT)}};Owa.Components.FolderTreeNode.prototype.canMv=function Owa$Components$FolderTreeNode$canMv(){if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){return !this.isPFR()&&hasER(this.gtER(),ER_DLT)}else{var iAFlg=this.gtAFlg();return !(this.isS()||this.isXOrg()||(this.gtEFFlg()&(EFF_RMH|EFF_SHI))||this.isOSF()||(iAFlg&AFLG_PRV)||(iAFlg&AFLG_PRT))}};Owa.Components.FolderTreeNode.prototype.canDel=function Owa$Components$FolderTreeNode$canDel(){if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){return !this.isPFR()&&hasER(this.gtER(),ER_DLT)}else{var iAFlg=this.gtAFlg();return !(this.isS()||this.isXOrg()||(this.gtEFFlg()&EFF_RMH)||this.isOSF()||(iAFlg&AFLG_PRV)||(iAFlg&AFLG_PRT))}};Owa.Components.FolderTreeNode.prototype.canRnm=function Owa$Components$FolderTreeNode$canRnm(){if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){return !this.isPFR()&&hasER(this.gtER(),ER_MDF)}else{var iAFlg=this.gtAFlg();return !(this.isS()||this.isOSF()||this.isXOrg()||(this.gtEFFlg()&EFF_RMH)||(iAFlg&AFLG_PRV)||(iAFlg&AFLG_PRT))}};Owa.Components.FolderTreeNode.prototype.canAcceptSubFolderType=function Owa$Components$FolderTreeNode$canAcceptSubFolderType(sChildClass){if(this.canCrt()){if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){return true}else{var sClass=this.gtFCC();var fGeekFolder=(isOfClss(sClass,T_CAL)||isOfClss(sClass,T_CON)||isOfClss(sClass,T_TSK));var fChildGeekFolder=(isOfClss(sChildClass,T_CAL)||isOfClss(sChildClass,T_CON)||isOfClss(sChildClass,T_TSK));return !fGeekFolder||fChildGeekFolder}}else{return false}};Owa.Components.FolderTreeNode.prototype.canCrt=function Owa$Components$FolderTreeNode$canCrt(){if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){return hasER(this.gtER(),ER_CH)}else{return(g_oFldrMgr.gtFL(this.gtFId())!=FL_OUM)&&!this.isOSF()&&!this.isS(DFT_SFR)&&!(this.gtEFFlg()&(EFF_RMH|EFF_EXB))&&!(this.gtAFlg()&AFLG_RT)}};Owa.Components.FolderTreeNode.prototype.persistExp=function Owa$Components$FolderTreeNode$persistExp(){if(this._tr._fPrstRt&&this.isRt())g_oFldrMgr.prstTrExpSt()};Owa.Components.FolderTreeNode.prototype.feUpdCnts=function Owa$Components$FolderTreeNode$feUpdCnts(){g_oEd.fire("UpdateCount",this.gtFId(),getInt(this._get_Element().getAttribute("_iTC")),getInt(this._get_Element().getAttribute("_iUC")))};Owa.Components.FolderTreeNode.prototype.updCnts=function Owa$Components$FolderTreeNode$updCnts(iTC,iUC){var oContent=this.getContent();var oFldrNm=this.getFolderNameElement();var oEl=this._get_Element();if((iTC==-1||iTC==getInt(oEl.getAttribute("_iTC")))&&(iUC==-1||iUC==getInt(oEl.getAttribute("_iUC"))))return;if(iTC!=-1)oEl.setAttribute("_iTC",""+iTC);if(iUC!=-1)oEl.setAttribute("_iUC",""+iUC);if(this.gtCCDT()!=CCDT_NONE){var f=this.gtCCDT()==CCDT_ITMC;var iC=f?iTC:iUC;if(iC==-1)return;oFldrNm.set_FontWeight(iC?Owa.Style.FontWeight.Bold:Owa.Style.FontWeight.Normal);var sHtml=oFldrNm.get_OuterHtml();if(iC){sHtml+="<span id=\""+(f?"spnC":"spnUC")+"\">";sHtml+=g_sDE+(f?"[":"(")+"<span id=spnCV>"+iC+"</span>"+(f?"]":")")+g_sDE;sHtml+="</span>"}oContent.set_InnerHtml(sHtml)}};Owa.Components.FolderTreeNode.prototype.onDrg=function Owa$Components$FolderTreeNode$onDrg(oEvent){var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);var oDraggableObject=Owa.Components.Storage.StorableObject.create(Owa.Components.DraggableObjects.Type.Folder);var oFolder=oDraggableObject.get_RootElement();oFolder.set_IsOutlookSearchFolder(this.isOSF());oFolder.set_FolderId(this.gtFId());oDraggableObject.set_DenyCopy(!this.canCp());oDraggableObject.set_DenyMove(!this.canMv());var oJD=this._tr.gtNdByAls(ALP_DFT+DFT_DEL);var oJJ=this._tr.gtNdByAls(ALP_DFT+DFT_JNK);oFolder.set_IsInDeletedItems(this._tr.isAncstr(oJD,this));oFolder.set_IsInJunkItems(this._tr.isAncstr(oJJ,this));oFolder.set_FolderType(this.gtFT().toString());oFolder.set_FolderContainerClass(this.gtFCC());oDraggableObject.save(oDragDrop)};Owa.Components.FolderTreeNode.prototype.canDrg=function Owa$Components$FolderTreeNode$canDrg(){return !(g_oFldrMgr.gtFL(this.gtFId())==FL_OUM||this.isS(DFT_SFR)||(this.gtAFlg()&AFLG_RT))};Owa.Components.FolderTreeNode.prototype.canDrpExp=function Owa$Components$FolderTreeNode$canDrpExp(oDraggableObject){if((oDraggableObject.get_TypeName()!=Owa.Components.DraggableObjects.Type.Folder&&oDraggableObject.get_TypeName()!=Owa.Components.DraggableObjects.Type.Items&&oDraggableObject.get_TypeName()!=Owa.Components.DraggableObjects.Type.Conversations)||this.isS(DFT_SFR)||this.isOSF())return false;if(oDraggableObject.get_TypeName()==Owa.Components.DraggableObjects.Type.Folder&&g_oFldrMgr.gtFL(this.gtFId())==FL_OUM)return false;if(oDraggableObject.get_TypeName()==Owa.Components.DraggableObjects.Type.Folder)return true;else return isValidDropFolder(oDraggableObject,this.gtFCC())};Owa.Components.FolderTreeNode.prototype.gtDrpMd=function Owa$Components$FolderTreeNode$gtDrpMd(oJN,oEvent,oDraggableObject){if(!this.equals(oJN))return DRP_NONE;if(this.isS(DFT_TDS)||this.isS(DFT_SFR)||this.isOSF()||(this.gtAFlg()&AFLG_RT))return DRP_NONE;var fAC=!oDraggableObject.get_DenyCopy();var fAM=!oDraggableObject.get_DenyMove();var fFC=oEvent.isCtrlKeyDown();var fFM=oEvent.isShiftKeyDown();if(!fAC&&!fAM)return DRP_NONE;var sType=oDraggableObject.get_TypeName();var oRootElement=oDraggableObject.get_RootElement();if(sType===Owa.Components.DraggableObjects.Type.Folder||sType===Owa.Components.DraggableObjects.Type.Items||sType===Owa.Components.DraggableObjects.Type.Conversations){var sSrcFL=g_oFldrMgr.gtFL(oRootElement.get_FolderId());var sDstFL=g_oFldrMgr.gtFL(this.gtFId());var fMailTreeToMailTree=sSrcFL==FL_MBX&&sDstFL==FL_MBX;var fMA=(sSrcFL==FL_MBX||sSrcFL==FL_AMB)&&(sDstFL==FL_MBX||sDstFL==FL_AMB);var fC=(fMailTreeToMailTree||fMA)?fFC:!fFM;if(fC&&!fAC)return DRP_NONE;if(!fC&&!fAM)return DRP_NONE}switch(sType){case Owa.Components.DraggableObjects.Type.Items:case Owa.Components.DraggableObjects.Type.Conversations:if(g_oFldrMgr.gtFL(this.gtFId())==FL_OUM&&this.isRt())return DRP_NONE;var fSF=(this.gtFId()==oRootElement.get_FolderId())&&!oRootElement.get_IsCrossFolder();if(fSF&&!fC)return DRP_NONE;if(!isValidDropFolder(oDraggableObject,this.gtFCC()))return DRP_NONE;if(!this._hasDrpER(sType))return DRP_NONE;return fC?DRP_COPY:DRP_MOVE;case Owa.Components.DraggableObjects.Type.Folder:if(oRootElement.get_IsOutlookSearchFolder()||!this.canAcceptSubFolderType(oRootElement.get_FolderContainerClass()))return DRP_NONE;var oJS=this._tr.gtNdByFId(oRootElement.get_FolderId());if(oJS&&this._tr.isAncstr(oJS,this,1))return DRP_NONE;if(oJS&&!fC&&this.equals(this._tr.gtNdPrnt(oJS)))return DRP_NONE;if(!this._hasDrpER(sType))return DRP_NONE;return fC?DRP_COPY:DRP_MOVE;case Owa.Components.DraggableObjects.Type.NavigationNode:if(this.isS(DFT_DEL)&&fAM)return DRP_MOVE;else return DRP_NONE;default:return DRP_NONE}};Owa.Components.FolderTreeNode.prototype._hasDrpER=function Owa$Components$FolderTreeNode$_hasDrpER(sType){var iER=this.gtER();if(iER&&((sType==Owa.Components.DraggableObjects.Type.Folder&&!hasER(iER,ER_CH))||((sType==Owa.Components.DraggableObjects.Type.Items||sType==Owa.Components.DraggableObjects.Type.Conversations)&&!hasER(iER,ER_CC))))return 0;return 1};Owa.Components.FolderTreeNode.prototype.drpIn=function Owa$Components$FolderTreeNode$drpIn(oDraggableObject,iDM){var sDstFId=this.gtFId();var oRootElement=oDraggableObject.get_RootElement();switch(oDraggableObject.get_TypeName()){case Owa.Components.DraggableObjects.Type.Folder:var sSourceFolderId=oRootElement.get_FolderId();var oJD=this._tr.gtNdByAls(ALP_DFT+DFT_DEL);var oJSrc=this._tr.gtNdByFId(sSourceFolderId);var oJDst=this._tr.gtNdByFId(sDstFId);var fSrcD=this._tr.isAncstr(oJD,oJSrc,1);var fDstD=this._tr.isAncstr(oJD,oJDst,1);g_oFldrMgr.cpMvFld(this._tr,sSourceFolderId,fSrcD,sDstFId,fDstD,(iDM&DRP_IC_MSK)==DRP_COPY?1:0,!this.isUTD(),this._tr.gtFrt());break;case Owa.Components.DraggableObjects.Type.Items:case Owa.Components.DraggableObjects.Type.Conversations:var oListView;if(Owa.Utility.isDefined(typeof getLstVw))oListView=getNavigationPage().getLstVw(sSourceFolderId);if(checkLimit(oDraggableObject,oListView))return;var rgIds=[];oRootElement.foreach_Item(function(oItemElement){rgIds.push(oItemElement.get_ItemId())});g_oFldrMgr.cpMvItms(wt(),this._tr.get_SubPage(),oRootElement.get_FolderId(),rgIds,sDstFId,(iDM&DRP_IC_MSK)==DRP_COPY?1:0);break;case Owa.Components.DraggableObjects.Type.NavigationNode:var sSourceFolderId=oRootElement.get_FolderId();g_oNvNdMgr.rmvFrmFvr(this._tr,sSourceFolderId);break}};Owa.Components.FolderTreeNode.prototype._onBeforeContextMenu=function Owa$Components$FolderTreeNode$_onBeforeContextMenu(){var iFolderLocation=g_oFldrMgr.gtFL(this.gtFId());var oContextMenu;if(iFolderLocation==FL_PUB){var oContextMenu=getPublicFolderTreeMenu();this._preparePublicFolderMenu(oContextMenu)}else{if(this.isS(DFT_SFR)||(this.gtAFlg()&AFLG_RT))return true;var oContextMenu=getFolderTreeMenu();this._prepareFolderMenu(oContextMenu)}this._tr.set_ContextMenu(oContextMenu)};Owa.Components.FolderTreeNode.prototype._prepareFolderMenu=function Owa$Components$FolderTreeNode$_prepareFolderMenu(oContextMenu){var rgId=oContextMenu.getAllMenuItemIds();oContextMenu.showMenuItems(rgId,false);var fOUF=g_oFldrMgr.gtFL(this.gtFId())==FL_OUM;if(fOUF&&this.isS(DFT_ROT)){oContextMenu.showMenuItems(["divOUM","divRSF"],true);oContextMenu.enableMenuItems(["divOUM","divRSF"],true);return}var rgShowId=["divO","divON","divMvF","divCpF","divD","divRnm","divMAR","divCF"];oContextMenu.showMenuItems(rgShowId,true);oContextMenu.enableMenuItems(rgShowId,true);var sFId=this.gtFId();if(g_oNvNdMgr.isInFvr(sFId)){oContextMenu.showMenuItem("divRmFvr",true);oContextMenu.enableMenuItem("divRmFvr",true)}else if(g_oNvNdMgr.canAddToFvr(this.gtFId(),this.gtFCC(),this.gtFT(),this._tr.isAncstr(this._tr.gtNdByAls(ALP_DFT+DFT_DEL),this))){oContextMenu.showMenuItem("divFvr",true);oContextMenu.enableMenuItem("divFvr",true)}else{oContextMenu.enableMenuItem("divFvr",false)}if(g_oFldrMgr.isMyFId(sFId)){if(this.isS(DFT_ROT)&&(isFtEnab(FT_DLGACC))){oContextMenu.showMenuItem("divOUM",true);if(isExpLgn())oContextMenu.enableMenuItem("divOUM",false);else oContextMenu.enableMenuItem("divOUM",true)}if(oContextMenu._getDescendant("divDelPtg")&&!this.isS(DFT_ROT)){oContextMenu.showMenuItem("divDelPtg",true);oContextMenu.enableMenuItem("divDelPtg",true);Owa.UIControls.DeletePolicyContextMenu.get_Instance(this._tr.get_SubPage()).set_SelectedIds(new Array(sFId))}if(oContextMenu._getDescendant("divMvPtg")&&!this.isS(DFT_ROT)&&!this.isS(DFT_JNK)){var oJJ=this._tr.gtNdByAls(ALP_DFT+DFT_JNK);if(!this._tr.isAncstr(oJJ,this)){oContextMenu.showMenuItem("divMvPtg",true);oContextMenu.enableMenuItem("divMvPtg",true);Owa.UIControls.MovePolicyContextMenu.get_Instance(this._tr.get_SubPage()).set_SelectedIds(new Array(sFId))}}}if(!this.canCrt())oContextMenu.enableMenuItem("divCF",false);var oJD=this._tr.gtNdByAls(ALP_DFT+DFT_DEL);if(this._tr.isAncstr(oJD,this)){oContextMenu.showMenuItem("divRs",true);oContextMenu.enableMenuItem("divRs",true)}if(!this.canDel())oContextMenu.enableMenuItem("divD",false);if(!this.canRnm())oContextMenu.enableMenuItem("divRnm",false);if(this.isS(DFT_DEL)){oContextMenu.showMenuItem("divED",true);oContextMenu.enableMenuItem("divED",true);if(isFtEnab(FT_DUMPSTER)){oContextMenu.showMenuItem("divRD",true);oContextMenu.enableMenuItem("divRD",true)}}else if(this.isS(DFT_JNK)){oContextMenu.showMenuItem("divEJ",true);oContextMenu.enableMenuItem("divEJ",true)}else if(this.isOSF()||this.isS(DFT_RSS)||fOUF){oContextMenu.enableMenuItem("divEF",false)}else{oContextMenu.showMenuItem("divEF",true);oContextMenu.enableMenuItem("divEF",true)}if(!this.canMv())oContextMenu.enableMenuItem("divMvF",false);if(!this.canCp())oContextMenu.enableMenuItem("divCpF",false)};Owa.Components.FolderTreeNode.prototype._preparePublicFolderMenu=function Owa$Components$FolderTreeNode$_preparePublicFolderMenu(oContextMenu){var rgId=oContextMenu.getAllMenuItemIds();oContextMenu.showMenuItems(rgId,true);oContextMenu.enableMenuItems(rgId,true);if(!this.canCrt())oContextMenu.enableMenuItem("divCPF",false);if(!this.canDel())oContextMenu.enableMenuItem("divDPF",false);if(!this.canRnm())oContextMenu.enableMenuItem("divRnmPF",false);if(!this.canMv())oContextMenu.enableMenuItem("divMvPF",false);if(!this.canCp())oContextMenu.enableMenuItem("divCpPF",false);var sT=this.gtFCC();if(!isOfClss(sT,T_MSG))oContextMenu.enableMenuItem("divEPF",false);if(isOfClss(sT,T_CAL)||isOfClss(sT,T_CON)||isOfClss(sT,T_TSK))oContextMenu.showMenuItem("divMPFR",false)};Owa.Components.FolderTreeNode.prototype.onContextMenuClick=function Owa$Components$FolderTreeNode$onContextMenuClick(oEventArgs){var oT=this._tr;switch(oEventArgs.sCommand){case"openotherfolder":opnShrDlg();break;case"markread":g_oFldrMgr.mkAllRd(this._tr,this.gtFId());break;case"emptydeleted":case"emptyfldr":case"emptyjunk":this.emptyFld();break;case"recoverdeleted":this._tr.get_ContextMenu().close();var sUrl="?ae=Dialog&t=RecoverDeletedItems&id="+urlEnc(this.gtFId());opnWin(sUrl,520,620,1,null,null,null,this._tr.get_SubPage());break;case"open":if(a_iNM==NM_CAL)oT.feOnOpnCal(this.gtFId());else oT.selNdById(this.gtId());break;case"opennew":opnNew(this.gtFId(),this.gtFCC(),oT.gtSelELCNdFId?oT.gtSelELCNdFId():null);break;case"delete":var fP=g_oFldrMgr.gtFL(this.gtFId())==FL_PUB?1:0;var fD=this._tr.isAncstr(this._tr.gtNdByAls(ALP_DFT+DFT_DEL),this);this.delFld(fP,fD);break;case"rename":oT.nwFld(this,0);break;case"createfolder":oT.nwFld(this,1);break;case"move":case"movefolder":var oFolderPickerDialog=Owa.UIControls.FolderPickerDialog.get_Default();oFolderPickerDialog.set_IsShowPublicFolder(true);oFolderPickerDialog.set_ButtonCaptions([L_Mv]);oFolderPickerDialog.set_Title(L_MvToFld);oFolderPickerDialog.set_SourceTreeNode(this);oFolderPickerDialog.onCheckCustomButtons=updateFolderPickerCopyMoveFolderButton;oFolderPickerDialog.onButtonClick=this._createCallback(this.cbFolderPickerDialogButtonClick,oFolderPickerDialog);oFolderPickerDialog.show();break;case"copy":case"copyfolder":var oFolderPickerDialog=Owa.UIControls.FolderPickerDialog.get_Default();oFolderPickerDialog.set_IsShowPublicFolder(true);oFolderPickerDialog.set_ButtonCaptions([L_Cp]);oFolderPickerDialog.set_Title(L_CpToFld);oFolderPickerDialog.set_SourceTreeNode(this);oFolderPickerDialog.onCheckCustomButtons=updateFolderPickerCopyMoveFolderButton;oFolderPickerDialog.onButtonClick=this._createCallback(this.cbFolderPickerDialogButtonClick,oFolderPickerDialog);oFolderPickerDialog.show();break;case"removefromview":g_oNvNdMgr.rmvOUM(this._tr,this.gtFId());break;case"restore":if(g_oFldrMgr.gtFL(this.gtFId())==FL_AMB){var oJR=this._tr.gtNdByAls(ALP_DFT+DFT_ROT);g_oFldrMgr.cpMvFld(this._tr,this.gtFId(),1,oJR.gtFId(),0,0,0,this._tr.gtFrt())}else{if(isOfClss(this.gtFCC(),T_CAL))g_oFldrMgr.cpMvFld(this._tr,this.gtFId(),1,this._tr.gtDfCalId(),0,0,0,FRT_ALL);else if(isOfClss(this.gtFCC(),T_CON))g_oFldrMgr.cpMvFld(this._tr,this.gtFId(),1,this._tr.gtDfCntId(),0,0,0,FRT_ALL);else if(isOfClss(this.gtFCC(),T_TSK))g_oFldrMgr.cpMvFld(this._tr,this.gtFId(),1,this._tr.gtDfTskId(),0,0,0,FRT_ALL);else{var oJI=this._tr.gtNdByAls(ALP_DFT+DFT_IBX);g_oFldrMgr.cpMvFld(this._tr,this.gtFId(),1,oJI.gtFId(),0,0,0,FRT_ALL)}}break;case"createMailFld":oT.nwFld(this,1,T_MSG);break;case"createCalFld":oT.nwFld(this,1,T_CAL);break;case"createCntFld":oT.nwFld(this,1,T_CON);break;case"createTskFld":oT.nwFld(this,1,T_TSK);break;case"createNtsFld":oT.nwFld(this,1,T_NTS);break;case"addfavorite":g_oNvNdMgr.addFvr(this._tr,this.gtFId());break;case"removefromfavorite":g_oNvNdMgr.rmvFrmFvr(this._tr,this.gtFId());break}};Owa.Components.FolderTreeNode.prototype.cbFolderPickerDialogButtonClick=function Owa$Components$FolderTreeNode$cbFolderPickerDialogButtonClick(iButtonIndex,oFolderPickerDialog){var oTree=oFolderPickerDialog._get_TreeControl();var sId=oTree.gtSelNd().gtFId();var fIsDestinationInDeletedItems=oTree.isAncstr(oTree.gtNdByAls(ALP_DFT+DFT_DEL),oTree.gtSelNd(),1);var fIsCopy=oFolderPickerDialog.get_ButtonCaptions(iButtonIndex)==L_Cp;var oDestinationTreeNode=this._tr.gtNdByFId(sId);var fIsSourceInDeletedItems=this._tr.isAncstr(this._tr.gtNdByAls(ALP_DFT+DFT_DEL),this._tr.gtNdByFId(this.gtFId()),1);var fIsExpand=oDestinationTreeNode&&!oDestinationTreeNode.isUTD();g_oFldrMgr.cpMvFld(this._tr,this.gtFId(),fIsSourceInDeletedItems,sId,fIsDestinationInDeletedItems,fIsCopy,fIsExpand,(fIsDestinationInDeletedItems||isPFId(sId))?FRT_HSF:FRT_HGF)};Owa.Components.FolderTreeNode.prototype.emptyFld=function Owa$Components$FolderTreeNode$emptyFld(){var sDlgMsg;var sDlgTtl;if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){sDlgMsg=L_PrEmpPF;sDlgTtl=L_EmptDltFdrTtl}else if(this.isS(DFT_DEL)){sDlgMsg=L_WrnEmpt;sDlgTtl=L_EmptFdrTtl}else if(this.isS(DFT_JNK)){sDlgMsg=L_WrnEmptJnk;sDlgTtl=L_EmptJnk}else{sDlgMsg=L_WrnEmptFldr;sDlgTtl=L_EmptDltFdrTtl}this._tr._fDontSyncSelection=1;var oD=new BtnDlg("divDlt",htmlEnc(sDlgMsg),sDlgTtl,[L_Yes,L_No],null,Owa.BUTTON_DIALOG_ICON.QUESTION,this._createCallback(this.onEmptyFdr));oD.show()};Owa.Components.FolderTreeNode.prototype.onEmptyFdr=function Owa$Components$FolderTreeNode$onEmptyFdr(i){if(i==0){var sMthd;if(this.isS(DFT_DEL))sMthd="EmptyDeletedItems";else if(this.isS(DFT_JNK))sMthd="EmptyJunkEmail";else sMthd="EmptyFolder";g_oFldrMgr.emptyFld(this._tr,sMthd,this.gtFId())}this._tr.syncSelNHl()};Owa.Components.FolderTreeNode.prototype.delFld=function Owa$Components$FolderTreeNode$delFld(fP,fD){var sMsg;fP=fD?1:fP;sMsg=fP?L_PrDelFldrPrp:L_WrnDlFl;this._tr._fDontSyncSelection=1;var oD=new BtnDlg("divDlt",htmlEnc(sMsg),L_WrnDlFlTtl,[L_Yes,L_No],null,Owa.BUTTON_DIALOG_ICON.QUESTION,this._createCallback(this.cbOnDelFld,[fP,fD]));oD.show();return};Owa.Components.FolderTreeNode.prototype.cbOnDelFld=function Owa$Components$FolderTreeNode$cbOnDelFld(i,oContext){var fP=oContext[0];var fD=oContext[1];if(i==0)g_oFldrMgr.delFld(this._tr,this.gtFId(),fD,fP);this._tr.syncSelNHl()}})();g_fModuleLoaded[".\\uicontrols/foldertreenode.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/foldertree.js".toLowerCase()])(function(){var g_sFldIco=0;Owa.UIControls.FolderTree=function Owa$UIControls$FolderTree(root,fOS,fPrstRt){this._fOS=fOS;Owa.UIControls.FolderTree.constructBase(this,[root]);this._fPrstRt=fPrstRt?1:0;if(!g_sFldIco)g_sFldIco=g_rgsFIcns[T_MSG]};Owa.UIControls.FolderTree.createClass("Owa.UIControls.FolderTree",Owa.UIControls.TreeControl);Owa.UIControls.FolderTree.prototype.initialize=function Owa$UIControls$FolderTree$initialize(){this.root.setExpando("_frt",this.root.getAttribute("_frt")?getInt(this.root.getAttribute("_frt")):0);if(!this._fOS){var oJN=this.gtNd(this.root.get_FirstChild());var o=oJN._get_Element();if(g_oFldrMgr.isMyFId(oJN.gtFId())){if(this.gtAndShwMbxUsg)this._attachEvent(o,"mouseover",this.gtAndShwMbxUsg);if(this.hdMbxUsg)this._attachEvent(o,"mouseout",this.hdMbxUsg)}}else{this._onDrp=null;this._onDO=null;this._onDL=null;this._onDS=null;this._onContextMenuEventHandler=null}var oJS=this.crtAls(this.gtNdRt());if(oJS)this._sSelNdId=oJS.gtId();Owa.UIControls.FolderTree.callBase(this,"initialize");g_oEd.attachEvent("RenameFolder",this,"cbOnRnFld");g_oEd.attachEvent("NewFolder",this,"cbOnNwFld");g_oEd.attachEvent("MoveFolder",this,"cbOnCpMvFld");g_oEd.attachEvent("CopyFolder",this,"cbOnCpMvFld");g_oEd.attachEvent("DeleteFolder",this,"cbOnDelFld");g_oEd.attachEvent("EmptyFolder",this,"cbOnEmptyFld");g_oEd.attachEvent("UpdateCount",this,"cbOnUpdCnt");g_oEd.attachEvent("RemoveFromView",this,"cbOnRmvOUM");g_oEd.attachEvent("RemoveNavigation",this,"cbOnRmvNvNd");if(this._fOS)this.clrSel()};Owa.UIControls.FolderTree.prototype.dispose=function Owa$UIControls$FolderTree$dispose(){var oJN=this.gtNd(this.root.get_FirstChild());if(oJN){var o=oJN._get_Element();if(o){if(this.gtAndShwMbxUsg)this._detachEvent(o,"mouseover",this.gtAndShwMbxUsg);if(this.hdMbxUsg)this._detachEvent(o,"mouseout",this.hdMbxUsg)}}g_oEd.detachEvent("RenameFolder",this,"cbOnRnFld");g_oEd.detachEvent("NewFolder",this,"cbOnNwFld");g_oEd.detachEvent("MoveFolder",this,"cbOnCpMvFld");g_oEd.detachEvent("CopyFolder",this,"cbOnCpMvFld");g_oEd.detachEvent("DeleteFolder",this,"cbOnDelFld");g_oEd.detachEvent("EmptyFolder",this,"cbOnEmptyFld");g_oEd.detachEvent("UpdateCount",this,"cbOnUpdCnt");g_oEd.detachEvent("RemoveFromView",this,"cbOnRmvOUM");g_oEd.detachEvent("RemoveNavigation",this,"cbOnRmvNvNd");Owa.UIControls.FolderTree.callBase(this,"dispose")};Owa.UIControls.FolderTree.prototype.crtAls=function Owa$UIControls$FolderTree$crtAls(oJP){var oJN=this.gtNdFrstChld(oJP);var oJS;if(oJP.gtFT&&oJP.gtFT())this.stAls(ALP_DFT+oJP.gtFT(),oJP.gtId());if(oJP.isSel())oJS=oJP;while(oJN){if(!oJS&&oJN.isSel())oJS=oJN;if(oJN.hsChld()&&oJN.isUTD()){if(!oJS)oJS=this.crtAls(oJN);else this.crtAls(oJN)}else if(oJN.gtFT&&oJN.gtFT())this.stAls(ALP_DFT+oJN.gtFT(),oJN.gtId());oJN=this.gtNdNxt(oJN)}return oJS};Owa.UIControls.FolderTree.prototype.gtDfCalId=function Owa$UIControls$FolderTree$gtDfCalId(){return this.root.getAttribute("_DfCal")};Owa.UIControls.FolderTree.prototype.gtDfCntId=function Owa$UIControls$FolderTree$gtDfCntId(){return this.root.getAttribute("_DfCnt")};Owa.UIControls.FolderTree.prototype.gtDfTskId=function Owa$UIControls$FolderTree$gtDfTskId(){return this.root.getAttribute("_DfTsk")};Owa.UIControls.FolderTree.prototype.gtNdByFId=function Owa$UIControls$FolderTree$gtNdByFId(sFId){return this.gtNdById(padF(sFId))};Owa.UIControls.FolderTree.prototype.gtSelELCNdFId=function Owa$UIControls$FolderTree$gtSelELCNdFId(){var oJN=this.gtSelNd();while(oJN){if(oJN.isRt())return;if((oJN.isS()&&oJN.isPlcy())||oJN.gtAFlg())break;oJN=this.gtNdPrnt(oJN)}return oJN?oJN.gtFId():null};Owa.UIControls.FolderTree.prototype.gtFrt=function Owa$UIControls$FolderTree$gtFrt(){return this.root.getExpando("_frt")};Owa.UIControls.FolderTree.prototype.isCmptblFrt=function Owa$UIControls$FolderTree$isCmptblFrt(oJN,iFrt0,iFrt1){if(this.isAncstr(this.gtNdByAls(ALP_DFT+DFT_DEL),oJN,1))return(iFrt0&~FRT_HGF)==(iFrt1&~FRT_HGF);else return iFrt0==iFrt1};Owa.UIControls.FolderTree.prototype.wrapNd=function Owa$UIControls$FolderTree$wrapNd(oN){if(oN.getAttribute("_t")==TN_FTN)return new Owa.Components.FolderTreeNode(oN,this);else return Owa.UIControls.FolderTree.callBase(this,"wrapNd",arguments)};Owa.UIControls.FolderTree.prototype.onKD=function Owa$UIControls$FolderTree$onKD(oEvent){switch(oEvent.get_KeyCodeForKeyUpDown()){case 46:var oJSel=this.gtSelNd();var fP=g_oFldrMgr.gtFL(oJSel.gtFId())==FL_PUB?1:oEvent.isShiftKeyDown();if(oJSel&&oJSel.canDel())oJSel.delFld(fP,0)}};Owa.UIControls.FolderTree.prototype.getChildren=function Owa$UIControls$FolderTree$getChildren(oJN){this.expOeh(oJN)};Owa.UIControls.FolderTree.prototype.feUpdChldCnt=function Owa$UIControls$FolderTree$feUpdChldCnt(oJN){for(var oJNC=this.gtNdFrstChld(oJN);oJNC;oJNC=this.gtNdNxt(oJNC))oJNC.feUpdCnts()};Owa.UIControls.FolderTree.prototype.expOeh=function Owa$UIControls$FolderTree$expOeh(oJN){var oCtx={sId:oJN.gtId()};var iFrt=this.gtFrt();var oJD=this.gtNdByAls(ALP_DFT+DFT_DEL);var oR=new oeReq("Tree","Expand",oCtx,this._createCallback(this.cbExpOeh),GET);oR.add("id",oJN.gtFId());if(this.isAncstr(oJD,oJN,1))iFrt&=~FRT_HGF;oR.add("rdt",iFrt);oR.send()};Owa.UIControls.FolderTree.prototype.cbExpOeh=function Owa$UIControls$FolderTree$cbExpOeh(oR){var oJN=this.gtNdById(oR.oCtx.sId);oJN.hdPrg();if(!this.cbOeh(oR))return;var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);this.stKds(oJN,oC.getDescendantById("tn").getChildrenSnapshot());oJN.stUTD(1);oJN.expand();this.feUpdChldCnt(oJN)};Owa.UIControls.FolderTree.prototype.cbOnRmvNvNd=function Owa$UIControls$FolderTree$cbOnRmvNvNd(oR,oSndr,sNId,fP){if(oR.isErr())return;var oJD=this.gtNdByAls(ALP_DFT+DFT_DEL);if(oJD&&oJD.isUTD()){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oC=oC.getDescendantById("tn");if(oC){var rgChildrenValid=[];var rgChildren=oC.getChildrenSnapshot();while(rgChildren.length>0){var oNd=rgChildren.shift();var sFId=oNd.getAttribute("id").substr(1);if(g_oFldrMgr.gtFL(oJD.gtFId())==g_oFldrMgr.gtFL(sFId)){rgChildrenValid.push(oNd)}}if(rgChildrenValid.length>0){this.addKds(oJD,rgChildrenValid)}}}};Owa.UIControls.FolderTree.prototype.cbOnDelFld=function Owa$UIControls$FolderTree$cbOnDelFld(oR,oSndr,sFId,fD,fP){var fSndBM=oSndr==this;if(fSndBM&&!this.cbOeh(oR))return;if(oR.isErr())return;var oJF=this.gtNdByFId(sFId);var oJD=this.gtNdByAls(ALP_DFT+DFT_DEL);var oJSel=this.gtSelNd();var fSel=oJF?this.isAncstr(oJF,oJSel,1):0;var oJT;if(fSel)oJT=this.gtNrstNd(oJF);if(oJF)this.rmNd(oJF);if(!fP&&oJD&&oJF){if(oJD.isUTD()){var oDiv=this.root.get_OwnerDocument().createElement(DIV);oDiv.set_InnerHtml(oR.sBody);this.addKds(oJD,oDiv.getDescendantById("tn").getChildrenSnapshot())}else{this.clrKds(oJD);oJD.stUTD(0);oJD._get_Element().setAttribute("_hsChld","1");oJD.upd()}}if(fSel){if(!oJT){if(this._frst)this._frst.selDfN();else this.clrSel()}else this.selNd(oJT)}};Owa.UIControls.FolderTree.prototype.cbOnRmvOUM=function Owa$UIControls$FolderTree$cbOnRmvOUM(oR,oSndr){var fSndBM=oSndr==this;if(!fSndBM)return;if(!this.cbOeh(oR))return;if(this._frst)this._frst.rmTr(this._nm);var oJR=this.gtNdRt();var oJN=this.gtNdFrstChld(oJR);if(oJN)removeFolderView(oJN.gtFId());this.root.get_ParentElement().remove(true);this.dispose()};Owa.UIControls.FolderTree.prototype.cbOnCpMvFld=function Owa$UIControls$FolderTree$cbOnCpMvFld(oR,oSndr,sSrcFId,fSrcD,sDstPFId,fDstD,fC,fExp,iFrt){var fSndBM=oSndr==this;if(fSndBM&&!this.cbOeh(oR))return;if(oR.isErr())return;var oJSrc=this.gtNdByFId(sSrcFId);var oJDst=this.gtNdByFId(sDstPFId);if(!oJSrc&&!oJDst)return;var oJSel=this.gtSelNd();var fSel=this.hsSelNd()&&this.isAncstr(oJSrc,oJSel,1);var oJT;if(fSel){if(fC)oJT=oJSel;else oJT=this.gtNrstNd(oJSrc)}if(!fC&&oJSrc)this.rmNd(oJSrc);if(oJDst){if(oJDst.isUTD()||(fExp&&this.isCmptblFrt(oJDst,this.gtFrt(),iFrt))){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oC=oC.getDescendantById("tn");if(oJDst.isUTD()){var sNewId;oC.forEachChild(function(oElement){if(oElement.getAttribute("_NF")){oElement.setAttribute("_NF",null);sNewId=oElement.get_Id();return 1}});if(sNewId){oC.set_InnerHtml(oC.getDescendantById(sNewId).get_OuterHtml());if(oJDst.isS(DFT_ROT)&&(this.gtFrt()&FRT_HGF)){if(g_oFldrMgr.isMyFId(oJDst.gtFId())){var oJI=this.gtNdByAls(ALP_DFT+DFT_IBX);this.insrtKdsPos(oJI,oC.getChildrenSnapshot(),0,1)}else if(g_oFldrMgr.gtFL(oJDst.gtFId())==FL_AMB){var oJF=this.gtNdFrstChld(oJDst);this.insrtKdsPos(oJF,oC.getChildrenSnapshot(),0,0)}}else{this.addKds(oJDst,oC.getChildrenSnapshot())}}}else{var fIsExp=oJDst.isExp();this.clrKds(oJDst);this.addKds(oJDst,oC.getChildrenSnapshot());if(fIsExp)oJDst.expand();else oJDst.collapse();oJDst.stUTD(1)}}oJDst.expand();this.feUpdChldCnt(oJDst)}if(fSel){if(!oJT&&this._frst)return this._frst.selDfN();if(oJT){this.selNd(oJT);this.syncSelNHl()}}};Owa.UIControls.FolderTree.prototype.cbOnUpdCnt=function Owa$UIControls$FolderTree$cbOnUpdCnt(sFId,iTC,iUC){var oJN=this.gtNdByFId(sFId);if(!oJN)return;oJN.updCnts(iTC,iUC)};Owa.UIControls.FolderTree.prototype.cbOnEmptyFld=function Owa$UIControls$FolderTree$cbOnEmptyFld(oR,oSndr,sMthd,sFId){var fSndBM=oSndr==this;if(fSndBM&&!this.cbOeh(oR))return;if(oR.isErr())return;var oJN=this.gtNdByFId(sFId);if(!oJN)return;if(oJN.isS(DFT_DEL)||oJN.isS(DFT_JNK)){if(this.isAncstr(oJN,this.gtSelNd())){this.selNd(this.gtNdByAls(ALP_DFT+DFT_IBX))}this.clrKds(oJN)}g_oEd.fire("UpdateCount",sFId,0,0);if(a_sLstFID==sFId){var oLV=this.get_SubPage().getLstVw(sFId);if(oLV&&oLV.rfrsh)oLV.rfrsh()}else{var oSubPageController;if(oJN.isS(DFT_DEL)||oJN.isS(DFT_JNK))oSubPageController=getViewSubPageControllerByFolderId(sFId);if(oSubPageController)oSubPageController.remove()}if(oJN.isS(DFT_DEL)||oJN.isS(DFT_JNK))getMailboxUsage()};Owa.UIControls.FolderTree.prototype.nwFld=function Owa$UIControls$FolderTree$nwFld(oJPN,fNw,sCC){var oCtx={sCC:sCC};if(!fNw){return this.edtNd(oJPN,oCtx)}else if(!(oJPN.isS(DFT_ROT)&&(this.gtFrt()&FRT_HGF))||g_oFldrMgr.gtFL(oJPN.gtFId())==FL_AMB){return this.crtNwNd(oJPN,oCtx,0,this.gtNdFrstChld(oJPN))}else{var oJI=this.gtNdByAls(ALP_DFT+DFT_IBX);var oJN=this.gtNdNxt(oJI);this.crtNwNd(oJPN,oCtx,0,oJN)}};Owa.UIControls.FolderTree.prototype.onRnNd=function Owa$UIControls$FolderTree$onRnNd(rsn,sV){var oJN=this._edt.nd;if(rsn!=ECR_ESC)g_oFldrMgr.rnmFld(this,oJN.gtFId(),sV);else this.qtEdtNd()};Owa.UIControls.FolderTree.prototype.cbOnRnFld=function Owa$UIControls$FolderTree$cbOnRnFld(oR,oSndr,sFId){var fSndBM=oSndr==this;if(fSndBM&&this._edting&&!this.cbOeh(oR,true))return;if(oR.isErr())return;var oJN=this.gtNdByFId(sFId);if(oJN){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);var oC=oC.getDescendantById("tn");if(oC)oJN.stDspNm(oC.get_TextContent())}};Owa.UIControls.FolderTree.prototype.onNwNd=function Owa$UIControls$FolderTree$onNwNd(rsn,sV){var oJN=this._edt.nd;var oJPN=this.gtNdPrnt(oJN);if(rsn!=ECR_ESC){var oJD=this.gtNdByAls(ALP_DFT+DFT_DEL);var fD=this.isAncstr(oJD,oJN,1);g_oFldrMgr.nwFld(this,oJPN.gtFId(),fD,this._edt.oCtx.sCC?this._edt.oCtx.sCC:oJPN.gtFCC(),sV,oJPN.isUTD()?0:1,fD?FRT_ALL:this.gtFrt())}else{this.qtEdtNd()}};Owa.UIControls.FolderTree.prototype.cbOnNwFld=function Owa$UIControls$FolderTree$cbOnNwFld(oR,oSndr,sPFId,fD,sCC,sNwNm,fExp,iFrt){var fSndBM=oSndr==this;if(fSndBM&&this._edting&&!this.cbOeh(oR,true))return;if(oR.isErr())return;var oJPN=this.gtNdByFId(sPFId);if(!oJPN)return;if(oJPN.isUTD()||(fExp&&this.isCmptblFrt(oJPN,this.gtFrt(),iFrt))){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oC=oC.getDescendantById("tn");var sNewId;if(fSndBM||oJPN.isUTD()){oC.forEachChild(function(oElement){if(oElement.getAttribute("_NF")){oElement.setAttribute("_NF",null);sNewId=oElement.get_Id();return 1}})}if(oJPN.isUTD()&&sNewId){oC.set_InnerHtml(oC.getDescendantById(sNewId).get_OuterHtml());if(oJPN.isS(DFT_ROT)&&g_oFldrMgr.isMyFId(oJPN.gtFId())&&(this.gtFrt()&FRT_HGF)){var oJI=this.gtNdByAls(ALP_DFT+DFT_IBX);this.insrtKdsPos(oJI,oC.getChildrenSnapshot(),0,1)}else{var oJPos=this.gtNdFrstChld(oJPN);if(oJPos)this.insrtKdsPos(oJPos,oC.getChildrenSnapshot());else this.addKds(oJPN,oC.getChildrenSnapshot())}}else{var fIsExp=oJPN.isExp();this.clrKds(oJPN);this.addKds(oJPN,oC.getChildrenSnapshot());if(fIsExp)oJPN.expand();else oJPN.collapse();oJPN.stUTD(1)}this.feUpdChldCnt(oJPN)}if(fSndBM){oJPN.expand();var oJN=this.gtNdById(sNewId);this.feOnNwFld(oJN)}};Owa.UIControls.FolderTree.prototype.feOnNwFld=function Owa$UIControls$FolderTree$feOnNwFld(oJN){if(this.onNwFld)this.onNwFld(oJN)};Owa.UIControls.FolderTree.prototype.gtNwNdIcnMrkup=function Owa$UIControls$FolderTree$gtNwNdIcnMrkup(oJPN,oCtx){var img=oJPN.gtImg();var sIcnMrkup=img.get_OuterHtml();if(isOfClss(oJPN.gtFCC(),T_MSG))sIcnMrkup=Owa.Components.CssSprites.getImageMarkup(g_sFldIco,"id=\""+NODE_ICON+"\"");if(oCtx.sCC){var sT=oCtx.sCC;sIcnMrkup=Owa.Components.CssSprites.getImageMarkup(g_rgsFIcns[sT]?g_rgsFIcns[sT]:g_rgsFIcns[T_MSG],"id=\""+NODE_ICON+"\"")}return sIcnMrkup};Owa.UIControls.FolderTree.prototype.gtAndShwMbxUsg=function Owa$UIControls$FolderTree$gtAndShwMbxUsg(oEvent){g_iPrgIndQt=Owa.Dom.Window.get_Current().setTimeout(this._createCallback(this.cbGtAndShwMbxUsg,[oEvent.get_ClientX(),oEvent.get_ClientY()]),1000)};Owa.UIControls.FolderTree.prototype.cbGtAndShwMbxUsg=function Owa$UIControls$FolderTree$cbGtAndShwMbxUsg(oNull,oContext){var x=oContext[0];var y=oContext[1];if(g_iPrgIndQt!=0)getMailboxUsage(1,x,y)};Owa.UIControls.FolderTree.prototype.hdMbxUsg=function Owa$UIControls$FolderTree$hdMbxUsg(){if(g_iPrgIndQt){this._clearTimeout(g_iPrgIndQt);g_iPrgIndQt=0}hideMailboxUsage()}})();g_fModuleLoaded[".\\uicontrols/foldertree.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/navigationheadertreenode.js".toLowerCase()])(function(){Owa.Components.NavigationHeaderTreeNode=function Owa$Components$NavigationHeaderTreeNode(oN,tr){Owa.Components.NavigationHeaderTreeNode.constructBase(this,[oN,tr])};Owa.Components.NavigationHeaderTreeNode.createClass("Owa.Components.NavigationHeaderTreeNode",Owa.Components.TreeNode);Owa.Components.NavigationHeaderTreeNode.prototype.gtNId=function Owa$Components$NavigationHeaderTreeNode$gtNId(){return this.gtId().substr(1)};Owa.Components.NavigationHeaderTreeNode.prototype.gtDrpMd=function Owa$Components$NavigationHeaderTreeNode$gtDrpMd(oJN,oEvent,oDraggableObject){var oRootElement=oDraggableObject.get_RootElement();switch(oDraggableObject.get_TypeName()){case Owa.Components.DraggableObjects.Type.NavigationHeader:var sNavigationNodeId=oRootElement.get_NavigationNodeId();if(this.gtNId()==sNavigationNodeId)return DRP_NONE;var iClientY=oEvent.get_ClientY();var iNodeMiddleY=this.getContainer().get_DocumentTop()+this.getContainer().get_OffsetHeight()/2;if(iClientY>iNodeMiddleY){var oJN=this._tr.gtNdNxt(this);if(!oJN||oJN.gtNId()!=sNavigationNodeId)return DRP_BELOW|DRP_MOVE}else{var oJP=this._tr.gtNdPrv(this);if(!oJP||oJP.gtNId()!=sNavigationNodeId)return DRP_ABOVE|DRP_MOVE}return DRP_NONE;case Owa.Components.DraggableObjects.Type.NavigationNode:var sNavigationNodeId=oRootElement.get_NavigationNodeId();if(!oJN.equals(this))return DRP_NONE;var oJNN=this._tr.gtNdById(padF(sNavigationNodeId));if(!oJNN)return DRP_NONE;var oJP=this._tr.gtNdPrnt(oJNN);return oJP.gtNId()==this.gtNId()?DRP_NONE:DRP_MOVE;case Owa.Components.DraggableObjects.Type.Folder:var fCanAdd=g_oNvNdMgr.canAddToFvr(oRootElement.get_FolderId(),oRootElement.get_FolderContainerClass(),oRootElement.get_FolderType(),oRootElement.get_IsInDeletedItems());if(!fCanAdd||!this.equals(oJN)||this._tr.gtGS()!=GS_FVR)return DRP_NONE;return DRP_COPY;default:return DRP_NONE}};Owa.Components.NavigationHeaderTreeNode.prototype.drpIn=function Owa$Components$NavigationHeaderTreeNode$drpIn(oDraggableObject,iDM){var oRootElement=oDraggableObject.get_RootElement();switch(oDraggableObject.get_TypeName()){case Owa.Components.DraggableObjects.Type.NavigationNode:var oJN=this._tr.gtNdById(padF(oRootElement.get_NavigationNodeId()));if(oJN)this._tr.mv(oJN,this,1);return;case Owa.Components.DraggableObjects.Type.NavigationHeader:var oJN=this._tr.gtNdById(padF(oRootElement.get_NavigationNodeId()));if(oJN)this._tr.mv(oJN,this,(iDM&DRP_EFF_MSK)==DRP_ABOVE?0:1);return;case Owa.Components.DraggableObjects.Type.Folder:if(this._tr.gtGS()!=GS_FVR)return;g_oNvNdMgr.addFvr(this._tr,oRootElement.get_FolderId());return;default:return Owa.Components.NavigationHeaderTreeNode.callBase(this,"drpIn",arguments)}};Owa.Components.NavigationHeaderTreeNode.prototype.canDrg=function Owa$Components$NavigationHeaderTreeNode$canDrg(){return 1};Owa.Components.NavigationHeaderTreeNode.prototype.onDrg=function Owa$Components$NavigationHeaderTreeNode$onDrg(oEvent){var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);var oDraggableObject=Owa.Components.Storage.StorableObject.create(Owa.Components.DraggableObjects.Type.NavigationHeader);var oNavigationHeader=oDraggableObject.get_RootElement();oNavigationHeader.set_NavigationNodeId(this.gtNId());oNavigationHeader.set_GroupSection(this._tr.gtGS());oDraggableObject.save(oDragDrop)};Owa.Components.NavigationHeaderTreeNode.prototype.canDrpExp=function Owa$Components$NavigationHeaderTreeNode$canDrpExp(oDraggableObject){return this.hsChld()};Owa.Components.NavigationHeaderTreeNode.prototype.persistExp=function Owa$Components$NavigationHeaderTreeNode$persistExp(f){if(this._tr.gtGS()==GS_FVR){g_oFldrMgr.prstTrExpSt()}else{var oR=new oeReq("NavigationNode","PersistExpand",null,null,POST);oR.add("GS",this._tr.gtGS());oR.add("srcNId",this.gtNId());oR.add("exp",f?1:0);oR.send()}};Owa.Components.NavigationHeaderTreeNode.prototype._onBeforeContextMenu=function Owa$Components$NavigationHeaderTreeNode$_onBeforeContextMenu(){if(this._tr.gtGS()==GS_FVR)return true;var oContextMenu=getNavigationTreeMenu();if(!oContextMenu)return true;var rgShowId={_divNG:true,_divRnmGp:true,_divDelGp:true,_divMvUp:true,_divMvDn:true};var rgAllId=oContextMenu.getAllMenuItemIds();for(var iIndex=0;iIndex<rgAllId.length;iIndex++){var sId=rgAllId[iIndex];oContextMenu.showMenuItem(sId,rgShowId[sId]);if(rgShowId[sId])oContextMenu.enableMenuItem(sId,true)}if(!this._tr.gtNdPrv(this))oContextMenu.enableMenuItem("_divMvUp",false);if(!this._tr.gtNdNxt(this))oContextMenu.enableMenuItem("_divMvDn",false);switch(this._tr.gtGS()){case GS_CAL:oContextMenu.showMenuItems(["_divNCal","_divOUCal"],true);oContextMenu.enableMenuItems(["_divNCal","_divOUCal"],true);if(isExpLgn())oContextMenu.enableMenuItem("_divOUCal",false);break;case GS_CNT:oContextMenu.showMenuItems(["_divNCnt"],true);oContextMenu.enableMenuItems(["_divNCnt"],true);break;case GS_TSK:oContextMenu.showMenuItems(["_divNTsk"],true);oContextMenu.enableMenuItems(["_divNTsk"],true);break}this._tr.set_ContextMenu(oContextMenu)};Owa.Components.NavigationHeaderTreeNode.prototype.onContextMenuClick=function Owa$Components$NavigationHeaderTreeNode$onContextMenuClick(oEventArgs){var oT=this._tr;switch(oEventArgs.sCommand){case"openotherfolder":opnShrDlg();break;case"newgroup":oT.crtNwGp();break;case"new":oT.crtNw(this);break;case"rename":oT.rnmGp(this);break;case"delete":oT.rmv(this,L_WrnRmGp,L_RmGpTtl);break;case"moveup":case"movedown":oT.upDn(this,oEventArgs.sCommand=="moveup");break}}})();g_fModuleLoaded[".\\uicontrols/navigationheadertreenode.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/navigationfoldertreenode.js".toLowerCase()])(function(){Owa.Components.NavigationFolderTreeNode=function Owa$Components$NavigationFolderTreeNode(oN,tr){Owa.Components.NavigationFolderTreeNode.constructBase(this,[oN,tr])};Owa.Components.NavigationFolderTreeNode.createClass("Owa.Components.NavigationFolderTreeNode",Owa.Components.FolderTreeNode);Owa.Components.NavigationFolderTreeNode.prototype.hsChld=function Owa$Components$NavigationFolderTreeNode$hsChld(){return 0};Owa.Components.NavigationFolderTreeNode.prototype.gtImgCk=function Owa$Components$NavigationFolderTreeNode$gtImgCk(){return this._get_Element().getChildById("imgCk")};Owa.Components.NavigationFolderTreeNode.prototype.stCk=function Owa$Components$NavigationFolderTreeNode$stCk(fCk){this._get_Element().setExpando("_fCk",fCk);Owa.Components.CssSprites.updateImage(this.gtImgCk(),fCk?"chk-chkd.gif":"chk-unchk.gif")};Owa.Components.NavigationFolderTreeNode.prototype.isChkd=function Owa$Components$NavigationFolderTreeNode$isChkd(){return this._get_Element().getExpando("_fCk")};Owa.Components.NavigationFolderTreeNode.prototype.hdCnt=function Owa$Components$NavigationFolderTreeNode$hdCnt(){if(this._tr.gtGS()==GS_CAL)this.gtImgCk().set_IsShown(false);this.getContent().set_IsShown(false)};Owa.Components.NavigationFolderTreeNode.prototype.shwCnt=function Owa$Components$NavigationFolderTreeNode$shwCnt(){if(this._tr.gtGS()==GS_CAL)this.gtImgCk().set_IsShown(true);this.getContent().set_IsShown(true)};Owa.Components.NavigationFolderTreeNode.prototype.gtNId=function Owa$Components$NavigationFolderTreeNode$gtNId(){return this.gtId().substr(1)};Owa.Components.NavigationFolderTreeNode.prototype.canDel=function Owa$Components$NavigationFolderTreeNode$canDel(){var sFolderLocation=g_oFldrMgr.gtFL(this.gtFId());if(sFolderLocation==FL_OUM||sFolderLocation==FL_GS)return 0;return Owa.Components.NavigationFolderTreeNode.callBase(this,"canDel",arguments)};Owa.Components.NavigationFolderTreeNode.prototype.canRnm=function Owa$Components$NavigationFolderTreeNode$canRnm(){if(this._get_Element().getAttribute("_fltr"))return 1;return Owa.Components.NavigationFolderTreeNode.callBase(this,"canRnm",arguments)};Owa.Components.NavigationFolderTreeNode.prototype.canMv=function Owa$Components$NavigationFolderTreeNode$canMv(){var sFolderLocation=g_oFldrMgr.gtFL(this.gtFId());if(sFolderLocation==FL_OUM||sFolderLocation==FL_GS)return 0;return Owa.Components.NavigationFolderTreeNode.callBase(this,"canMv",arguments)};Owa.Components.NavigationFolderTreeNode.prototype.canCp=function Owa$Components$NavigationFolderTreeNode$canCp(){if(this.isS(DFT_TDS)||g_oFldrMgr.gtFL(this.gtFId())==FL_GS)return 0;return Owa.Components.NavigationFolderTreeNode.callBase(this,"canCp",arguments)};Owa.Components.NavigationFolderTreeNode.prototype.gtFId=function Owa$Components$NavigationFolderTreeNode$gtFId(){return this._get_Element().getAttribute("_fid")};Owa.Components.NavigationFolderTreeNode.prototype.setDisplayColor=function Owa$Components$NavigationFolderTreeNode$setDisplayColor(iClr){if(this._tr.gtGS()!=GS_CAL)return;this.setHighlightEffect("nbcal"+iClr)};Owa.Components.NavigationFolderTreeNode.prototype.saveColor=function Owa$Components$NavigationFolderTreeNode$saveColor(iClr){if(this._tr.gtGS()!=GS_CAL)return;this._get_Element().setIntAttribute("_iSavedColor",iClr);var oR=new oeReq("CalendarView","SetCalendarColor",0,cbSetColor);oR.add("fId",this.gtFId());oR.add("Idx",iClr);oR.send()};Owa.Components.NavigationFolderTreeNode.prototype.getSavedColor=function Owa$Components$NavigationFolderTreeNode$getSavedColor(){if(this._tr.gtGS()==GS_CAL){var iClr=this._get_Element().getIntAttribute("_iSavedColor");if(iClr>0)return iClr}return -1};Owa.Components.NavigationFolderTreeNode.prototype.stHl=function Owa$Components$NavigationFolderTreeNode$stHl(fHl){if(this._tr.gtGS()==GS_CAL)return;Owa.Components.NavigationFolderTreeNode.callBase(this,"stHl",arguments)};Owa.Components.NavigationFolderTreeNode.prototype.canDrg=function Owa$Components$NavigationFolderTreeNode$canDrg(){return 1};Owa.Components.NavigationFolderTreeNode.prototype.onDrg=function Owa$Components$NavigationFolderTreeNode$onDrg(oEvent){var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);var oDraggableObject=Owa.Components.Storage.StorableObject.create(Owa.Components.DraggableObjects.Type.NavigationNode);var oNavigationNode=oDraggableObject.get_RootElement();oNavigationNode.set_NavigationNodeId(this.gtNId());oNavigationNode.set_GroupSection(this._tr.gtGS());oNavigationNode.set_FolderId(this.gtFId());oDraggableObject.save(oDragDrop)};Owa.Components.NavigationFolderTreeNode.prototype.gtDrpMd=function Owa$Components$NavigationFolderTreeNode$gtDrpMd(oJN,oEvent,oDraggableObject){var iDrpEff;var oRootElement=oDraggableObject.get_RootElement();switch(oDraggableObject.get_TypeName()){case Owa.Components.DraggableObjects.Type.Items:case Owa.Components.DraggableObjects.Type.Conversations:return Owa.Components.NavigationFolderTreeNode.callBase(this,"gtDrpMd",arguments);case Owa.Components.DraggableObjects.Type.Folder:if(!g_oNvNdMgr.canAddToFvr(oRootElement.get_FolderId(),oRootElement.get_FolderContainerClass(),oRootElement.get_FolderType(),oRootElement.get_IsInDeletedItems())||this._tr.gtGS()!=GS_FVR)return DRP_NONE;iDrpEff=DRP_COPY;break;case Owa.Components.DraggableObjects.Type.NavigationNode:if(oRootElement.get_NavigationNodeId()==this.gtNId())return DRP_NONE;if(oRootElement.get_GroupSection()!=this._tr.gtGS())return DRP_NONE;iDrpEff=DRP_MOVE;break;default:return DRP_NONE}var iClientY=oEvent.get_ClientY();var iNodeMiddleY=this.getContainer().get_DocumentTop()+this.getContainer().get_OffsetHeight()/2;if(iClientY>iNodeMiddleY){var oJN=this._tr.gtNdNxt(this);if(!oJN||oJN.gtFId()!=oRootElement.get_FolderId())return DRP_BELOW|iDrpEff}else{var oJP=this._tr.gtNdPrv(this);if(!oJP||oJP.gtFId()!=oRootElement.get_FolderId())return DRP_ABOVE|iDrpEff}return DRP_NONE};Owa.Components.NavigationFolderTreeNode.prototype.drpIn=function Owa$Components$NavigationFolderTreeNode$drpIn(oDraggableObject,iDM){var oRootElement=oDraggableObject.get_RootElement();switch(oDraggableObject.get_TypeName()){case Owa.Components.DraggableObjects.Type.NavigationNode:var oJN=this._tr.gtNdById(padF(oRootElement.get_NavigationNodeId()));if(oJN)this._tr.mv(oJN,this,(iDM&DRP_EFF_MSK)==DRP_ABOVE?0:1);return;default:return Owa.Components.NavigationFolderTreeNode.callBase(this,"drpIn",arguments)}};Owa.Components.NavigationFolderTreeNode.prototype.canDrpExp=function Owa$Components$NavigationFolderTreeNode$canDrpExp(oDraggableObject){return false};Owa.Components.NavigationFolderTreeNode.prototype._onBeforeContextMenu=function Owa$Components$NavigationFolderTreeNode$_onBeforeContextMenu(){var oContextMenu=getNavigationTreeMenu();if(!oContextMenu)return true;var groupSection=this._tr.gtGS();var rgShowId={_divO:true,_divON:true,_divDel:true,_divRnm:true,_divMvUp:true,_divMvDn:true,_divRFV:groupSection!=GS_CAL,_divDonotShowCal:groupSection==GS_CAL};var rgAllId=oContextMenu.getAllMenuItemIds();for(var iIndex=0;iIndex<rgAllId.length;iIndex++){var sId=rgAllId[iIndex];oContextMenu.showMenuItem(sId,rgShowId[sId]);if(rgShowId[sId])oContextMenu.enableMenuItem(sId,true)}var fIsMyFolder=g_oFldrMgr.isMyFId(this.gtFId());if(fIsMyFolder){if(!this.isXOrg()){oContextMenu.showMenuItem("_divRFV",false);oContextMenu.showMenuItem("_divDonotShowCal",false)}}else{oContextMenu.enableMenuItem("_divDel",false)}if(groupSection==GS_CAL){oContextMenu.showMenuItem("_divShCal",true);oContextMenu.showMenuItem("_divChShPm",true);var fNotSharedInCalendar=fIsMyFolder&&!this.isXOrg();oContextMenu.enableMenuItem("_divShCal",fNotSharedInCalendar);oContextMenu.enableMenuItem("_divChShPm",fNotSharedInCalendar)}var sModuleName;switch(groupSection){case GS_CAL:oContextMenu.showMenuItem("_divPCC",true);sModuleName="Cal";break;case GS_CNT:sModuleName="Cnt";break;case GS_TSK:sModuleName="Tsk";break}if(!this._tr.gtNdPrv(this))oContextMenu.enableMenuItem("_divMvUp",false);if(!this._tr.gtNdNxt(this))oContextMenu.enableMenuItem("_divMvDn",false);oContextMenu.showMenuItem("_divN"+sModuleName,true);oContextMenu.enableMenuItem("_divN"+sModuleName,true);oContextMenu.showMenuItem("_divM"+sModuleName,true);oContextMenu.showMenuItem("_divC"+sModuleName,true);oContextMenu.showMenuItem("_divRnm",true);oContextMenu.showMenuItem("_divDel",true);if(this.canMv())oContextMenu.enableMenuItem("_divM"+sModuleName,true);else oContextMenu.enableMenuItem("_divM"+sModuleName,false);if(this.canCp())oContextMenu.enableMenuItem("_divC"+sModuleName,true);else oContextMenu.enableMenuItem("_divC"+sModuleName,false);if(this.canRnm())oContextMenu.enableMenuItem("_divRnm",true);else oContextMenu.enableMenuItem("_divRnm",false);if(this.canDel())oContextMenu.enableMenuItem("_divDel",true);else oContextMenu.enableMenuItem("_divDel",false);this._tr.set_ContextMenu(oContextMenu)};Owa.Components.NavigationFolderTreeNode.prototype.onContextMenuClick=function Owa$Components$NavigationFolderTreeNode$onContextMenuClick(oEventArgs){var oT=this._tr;switch(oEventArgs.sCommand){case"new":oT.crtNw(this._tr.gtNdPrnt(this));break;case"rename":oT.rnm(this);break;case"delete":if(oT.gtGS()==GS_FVR)return Owa.Components.NavigationFolderTreeNode.callBase(this,"onContextMenuClick",arguments);oT.rmv(this,L_WrnDlFl,L_WrnDlFlTtl);break;case"moveup":case"movedown":oT.upDn(this,oEventArgs.sCommand=="moveup");break;case"removefromview":case"donotshowthiscalendar":if(this.isXOrg()&&oT.gtGS()==GS_CAL)g_oFldrMgr.delFld(oT,this.gtFId(),0,1);else g_oNvNdMgr.rmv(oT,this.gtNId(),oT.gtGS());break;case"pickColor":var iValue=parseInt(oEventArgs.oMenuItem.sColorValue);if(this.getSavedColor()!=iValue){if(this.isChkd()){this.setDisplayColor(iValue);var oJD=g_oCalTr.gtNdByAls(AL_DEF);if(oJD.equals(this)&&iValue<0){this.setHighlightEffect(DEFAULT_CALENDAR_CLASS)}}this.saveColor(iValue);var sFId=this.gtFId();updateColorInCalendarView(iValue,null,sFId)}return true;case"sharecal":newItm("IPM.Sharing",null,"&fldId="+Owa.Encoder.urlEncode(this.gtFId()),null,null,this._tr.get_SubPage());break;case"changesharingpremissions":openEcpChangeCalendarSharingPermissionWin(this.gtFId());break;default:return Owa.Components.NavigationFolderTreeNode.callBase(this,"onContextMenuClick",arguments)}}})();g_fModuleLoaded[".\\uicontrols/navigationfoldertreenode.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/navigationtree.js".toLowerCase()])(function(){Owa.UIControls.NavigationTree=function Owa$UIControls$NavigationTree(root,fD){this._fD=fD;Owa.UIControls.NavigationTree.constructBase(this,[root])};Owa.UIControls.NavigationTree.createClass("Owa.UIControls.NavigationTree",Owa.UIControls.TreeControl);Owa.UIControls.NavigationTree.prototype.initialize=function Owa$UIControls$NavigationTree$initialize(){this._iGS=this.root.getAttribute("_iGS");var oJS=this.crtNFDict();if(oJS)this._sSelNdId=oJS.gtId();if(this._fD){this._onDrp=null;this._onDO=null;this._onDL=null;this._onDS=null;this._onContextMenuEventHandler=null}g_oEd.attachEvent("RemoveNavigation",this,"cbRmvNvNd");g_oEd.attachEvent("NewFolder",this,"cbOnFldrOeh");g_oEd.attachEvent("MoveFolder",this,"cbOnFldrOeh");g_oEd.attachEvent("CopyFolder",this,"cbOnFldrOeh");g_oEd.attachEvent("ReloadNavigationTree",this,"cbOnFldrOeh");if(this.gtGS()!=GS_FVR){g_oEd.attachEvent("DeleteFolder",this,"cbOnFldrOeh");g_oEd.attachEvent("NewNavigation",this,"cbOnNwNv");g_oEd.attachEvent("RenameNavigation",this,"cbOnRnmNv")}g_oEd.attachEvent("EmptyFolder",this,"cbOnFldrOeh");Owa.UIControls.NavigationTree.callBase(this,"initialize")};Owa.UIControls.NavigationTree.prototype.dispose=function Owa$UIControls$NavigationTree$dispose(){g_oEd.detachEvent("RemoveNavigation",this,"cbRmvNvNd");g_oEd.detachEvent("NewFolder",this,"cbOnFldrOeh");g_oEd.detachEvent("MoveFolder",this,"cbOnFldrOeh");g_oEd.detachEvent("CopyFolder",this,"cbOnFldrOeh");g_oEd.detachEvent("DeleteFolder",this,"cbOnFldrOeh");g_oEd.detachEvent("EmptyFolder",this,"cbOnFldrOeh");g_oEd.detachEvent("NewNavigation",this,"cbOnNwNv");g_oEd.detachEvent("RenameNavigation",this,"cbOnRnmNv");Owa.UIControls.NavigationTree.callBase(this,"dispose")};Owa.UIControls.NavigationTree.prototype.gtNdByFId=function Owa$UIControls$NavigationTree$gtNdByFId(sFId){var oD=this._NFDict[padF(sFId)];if(oD)return this.gtNdById(oD.id)};Owa.UIControls.NavigationTree.prototype.stDfNd=function Owa$UIControls$NavigationTree$stDfNd(){var oJN;switch(this.gtGS()){case GS_CAL:oJN=this.gtNdByAls(ALP_DFT+DFT_CAL);break;case GS_CNT:oJN=this.gtNdByAls(ALP_DFT+DFT_CNT);break;case GS_TSK:oJN=this.gtNdByAls(ALP_DFT+DFT_TDS);break}if(oJN)this.stAls(AL_DEF,oJN.gtId())};Owa.UIControls.NavigationTree.prototype.gtGS=function Owa$UIControls$NavigationTree$gtGS(){return this._iGS};Owa.UIControls.NavigationTree.prototype.wrapNd=function Owa$UIControls$NavigationTree$wrapNd(oN){switch(oN.getAttribute("_t")){case TN_FTN:return new Owa.Components.NavigationFolderTreeNode(oN,this);case TN_GH:return new Owa.Components.NavigationHeaderTreeNode(oN,this);default:return Owa.UIControls.NavigationTree.callBase(this,"wrapNd",arguments)}};Owa.UIControls.NavigationTree.prototype.gtRgFId=function Owa$UIControls$NavigationTree$gtRgFId(){return this._rgFId};Owa.UIControls.NavigationTree.prototype.gtSelFId=function Owa$UIControls$NavigationTree$gtSelFId(){return this._sSelFId};Owa.UIControls.NavigationTree.prototype.forEachNd=function Owa$UIControls$NavigationTree$forEachNd(fnProcNd){var oJR=this.gtNdRt();var oJH=this.gtNdFrstChld(oJR);while(oJH){var oJF=this.gtNdFrstChld(oJH);while(oJF){fnProcNd.call(this,oJH,oJF);oJF=this.gtNdNxt(oJF)}oJH=this.gtNdNxt(oJH)}};Owa.UIControls.NavigationTree.prototype.crtNFDict=function Owa$UIControls$NavigationTree$crtNFDict(){if(!this._NFDict)this._NFDict={};this._rgFId=[];this._sSelFId=0;g_oNvNdMgr.stNFDict(this.gtGS(),this._NFDict);var oJS;this.clrAls();this.forEachNd(function(oJH,oJF){if(this.gtGS()==GS_FVR)oJF.feUpdCnts();if(oJF.isSel()){oJS=oJF;this._sSelFId=oJF.gtFId()}if(oJF.isS())this.stAls(ALP_DFT+oJF.gtFT(),oJF.gtId());if(this._NFDict[padF(oJF.gtFId())]){var oRec=this.crtNFRec(oJF,oJH);oRec._next=this._NFDict[padF(oJF.gtFId())];this._NFDict[padF(oJF.gtFId())]=oRec}else{this._NFDict[padF(oJF.gtFId())]=this.crtNFRec(oJF,oJH)}this._rgFId.push(oJF.gtFId())});this.stDfNd();return oJS};Owa.UIControls.NavigationTree.prototype.crtNFRec=function Owa$UIControls$NavigationTree$crtNFRec(oJF,oJH){return{id:oJF.gtId(),nid:oJF.gtNId(),pid:oJH.gtId(),pnid:oJH.gtNId()}};Owa.UIControls.NavigationTree.prototype.onKD=function Owa$UIControls$NavigationTree$onKD(oEvent){switch(oEvent.get_KeyCodeForKeyUpDown()){case 46:var oJSel=this.gtSelNd();if(oJSel&&oJSel.canDel())this.rmv(oJSel,L_WrnDlFl,L_WrnDlFlTtl)}};Owa.UIControls.NavigationTree.prototype.rldFrmR=function Owa$UIControls$NavigationTree$rldFrmR(oR){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);var oN=oC.getDescendantById("ntn");if(oN){var oTr=oN.getDescendantById(this.root.get_ParentElement().get_Id());if(oTr)this.rld(oTr)}};Owa.UIControls.NavigationTree.prototype.cbRmvNvNd=function Owa$UIControls$NavigationTree$cbRmvNvNd(oR,oSndr,sNId,sGS){var oJN=this.gtNdById(padF(sNId));if((oJN) instanceof(Owa.Components.NavigationFolderTreeNode)&&g_oFldrMgr.gtFL(oJN.gtFId())==FL_OUM)removeFolderView(oJN.gtFId());this.cbOnFldrOeh(oR,oSndr)};Owa.UIControls.NavigationTree.prototype.cbOnFldrOeh=function Owa$UIControls$NavigationTree$cbOnFldrOeh(oR,oSndr){this.rldFrmR(oR);if(oSndr==this)this.cbOeh(oR)};Owa.UIControls.NavigationTree.prototype.rld=function Owa$UIControls$NavigationTree$rld(oRN){var rgColSt={};var oJR=this.gtNdRt();var oJH=this.gtNdFrstChld(oJR);var oJOS=this.gtSelNd();var oJSO;var oJST=oJOS;var fSel=this.hsSelNd();var sSTId=fSel?oJST.gtId():"";while(oJH){rgColSt[oJH.gtId()]=oJH.hsChld()?!oJH.isExp():0;oJH=this.gtNdNxt(oJH)}var oNwRtNd=oRN.get_FirstChild().get_FirstChild();if(fSel){while(sSTId&&!oNwRtNd.getDescendantById(sSTId)){oJSO=oJST;oJST=this.gtNrstNd(oJST);sSTId=oJST?oJST.gtId():null;this.rmNd(oJSO)}if(!sSTId||!oNwRtNd.getDescendantById(sSTId))sSTId=null}var rootNode=this.root.get_FirstChild();if(rootNode){rootNode.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeBegin,oRN.get_FirstChild().get_FirstChild());rootNode.remove(true)}else{this.root.appendChild(oNwRtNd)}for(var i in rgColSt){oJH=this.gtNdById(i);if(oJH){if(rgColSt[i])oJH.collapse();else oJH.expand()}}this._NFDict=null;var oJS=this.crtNFDict();var oJD=this.gtNdByAls(AL_DEF);oJST=this.gtNdById(sSTId);if(this._fcs){if(oJS)this.stNdSel(oJS,1);else{oJS=this.gtSelNd();if(oJS)this.stNdSel(oJS,1);else if(oJST)this.stNdSel(oJST,1);else if(oJD)this.stNdSel(oJD,1);else if(this._frst)this._frst.selDfN();if(!this.gtSelNd())this.stNdSel()}}this._notifyShareCalendarMenu();this.feOnAfRld();this.fireOnResize()};Owa.UIControls.NavigationTree.prototype.feOnAfRld=function Owa$UIControls$NavigationTree$feOnAfRld(){if(this.onAfRld)return this.onAfRld()};Owa.UIControls.NavigationTree.prototype.feOnOpnCal=function Owa$UIControls$NavigationTree$feOnOpnCal(sFId){if(this.onOpnCal)this.onOpnCal(sFId)};Owa.UIControls.NavigationTree.prototype.rmv=function Owa$UIControls$NavigationTree$rmv(oJN,sMsg,sTtl){this._fDontSyncSelection=1;var oD=new BtnDlg("divDlt",htmlEnc(sMsg),sTtl,[L_Yes,L_No],null,Owa.BUTTON_DIALOG_ICON.QUESTION,this._createCallback(this.cbRmv,oJN));oD.show()};Owa.UIControls.NavigationTree.prototype.cbRmv=function Owa$UIControls$NavigationTree$cbRmv(i,oJN){if(i==0)g_oNvNdMgr.rmv(this,oJN.gtNId(),this.gtGS());this.syncSelNHl()};Owa.UIControls.NavigationTree.prototype.upDn=function Owa$UIControls$NavigationTree$upDn(oJN,iD){var oJT=iD?this.gtNdPrv(oJN):this.gtNdNxt(oJN);this.mv(oJN,oJT,!iD)};Owa.UIControls.NavigationTree.prototype.mv=function Owa$UIControls$NavigationTree$mv(oJN,oJT,fIsAft){var oR=new oeReq("NavigationNode","Move",null,this._createCallback(this.cbMv),POST);oR.add("srcNId",oJN.gtNId());oR.add("tgtid",oJT.gtNId());if(oJN.constructor==oJT.constructor)oR.add("mt",fIsAft?2:1);oR.add("GS",this.gtGS());oR.send()};Owa.UIControls.NavigationTree.prototype.cbMv=function Owa$UIControls$NavigationTree$cbMv(oR){this.rldFrmR(oR);this.cbOeh(oR)};Owa.UIControls.NavigationTree.prototype.crtNw=function Owa$UIControls$NavigationTree$crtNw(oJN){this.crtNwNd(oJN,{isGp:0})};Owa.UIControls.NavigationTree.prototype.crtNwGp=function Owa$UIControls$NavigationTree$crtNwGp(oJN){var oJPos;if(oJN)oJPos=this.gtNdNxt(oJN);this.crtNwNd(this.gtNdRt(),{isGp:1,posId:oJPos?oJPos.gtId():null},1,oJPos)};Owa.UIControls.NavigationTree.prototype.gtNwNdIcnMrkup=function Owa$UIControls$NavigationTree$gtNwNdIcnMrkup(oPN,oCtx){if(!oCtx.isGp){switch(this.gtGS()){case GS_CAL:return Owa.Components.CssSprites.getImageMarkup(g_rgsFIcns[T_CAL],"id=\""+NODE_ICON+"\"");case GS_CNT:return Owa.Components.CssSprites.getImageMarkup(g_rgsFIcns[T_CON],"id=\""+NODE_ICON+"\"");case GS_TSK:return Owa.Components.CssSprites.getImageMarkup(g_rgsFIcns[T_TSK],"id=\""+NODE_ICON+"\"")}}};Owa.UIControls.NavigationTree.prototype.onNwNd=function Owa$UIControls$NavigationTree$onNwNd(rsn,sV){if(rsn!=ECR_ESC){if(this._edt.oCtx.isGp)g_oNvNdMgr.nw(this,this.gtGS(),null,sV,{posId:this._edt.oCtx.posId});else{var oJPN=this.gtNdPrnt(this._edt.nd);g_oNvNdMgr.nw(this,this.gtGS(),oJPN.gtNId(),sV)}}else{this.qtEdtNd()}};Owa.UIControls.NavigationTree.prototype.cbOnNwNv=function Owa$UIControls$NavigationTree$cbOnNwNv(oR,oSndr,sGS,sPNId){if(oSndr!=this)return;if(!this.cbOeh(oR,true))return;if(oR.isErr())return;var oJPN=sPNId?this.gtNdById(padF(sPNId)):this.gtNdRt();var oJPos=oR.oCtx?this.gtNdById(oR.oCtx.posId):null;if(oJPN){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oC=oC.getDescendantById("ntn");if(oJPos)this.insrtKdsPos(oJPos,oC.getChildrenSnapshot());else this.addKds(oJPN,oC.getChildrenSnapshot());oJPN.expand()}this._notifyShareCalendarMenu();this.crtNFDict()};Owa.UIControls.NavigationTree.prototype.rnm=function Owa$UIControls$NavigationTree$rnm(oJN){this.edtNd(oJN,{isGp:0})};Owa.UIControls.NavigationTree.prototype.rnmGp=function Owa$UIControls$NavigationTree$rnmGp(oJN){this.edtNd(oJN,{isGp:1})};Owa.UIControls.NavigationTree.prototype.onRnNd=function Owa$UIControls$NavigationTree$onRnNd(rsn,sV){var oJN=this._edt.nd;if(rsn!=ECR_ESC){if(this._edt.oCtx.isGp)g_oNvNdMgr.rnm(this,this.gtGS(),oJN.gtNId(),sV);else{var sFId=oJN.gtFId();if(this.gtGS()==GS_FVR&&(g_oFldrMgr.isMyFId(sFId)||g_oFldrMgr.gtFL(sFId)==FL_AMB))g_oFldrMgr.rnmFld(this,sFId,sV);else g_oNvNdMgr.rnm(this,this.gtGS(),oJN.gtNId(),sV)}}else this.qtEdtNd()};Owa.UIControls.NavigationTree.prototype.cbOnRnmNv=function Owa$UIControls$NavigationTree$cbOnRnmNv(oR,oSndr,sGS,sNId){if(oSndr!=this)return;if(!this.cbOeh(oR,true))return;if(oR.isErr())return;var oJN=this.gtNdById(padF(sNId));if(oJN){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oJN.stDspNm(oC.getDescendantById("ntn").get_TextContent());if(Owa.Components.FolderTreeNode.isInstance(oJN)){oJN.stFldNm(oC.getDescendantById("tn").get_TextContent())}}};Owa.UIControls.NavigationTree.prototype._notifyShareCalendarMenu=function Owa$UIControls$NavigationTree$_notifyShareCalendarMenu(){if(this.gtGS()==GS_CAL){updateCalendarFolders()}}})();g_fModuleLoaded[".\\uicontrols/navigationtree.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/favoritefoldertreenode.js".toLowerCase()])(function(){Owa.Components.FavoriteFolderTreeNode=function Owa$Components$FavoriteFolderTreeNode(oN,tr){Owa.Components.FavoriteFolderTreeNode.constructBase(this,[oN,tr])};Owa.Components.FavoriteFolderTreeNode.createClass("Owa.Components.FavoriteFolderTreeNode",Owa.Components.NavigationFolderTreeNode);Owa.Components.FavoriteFolderTreeNode.prototype._onBeforeContextMenu=function Owa$Components$FavoriteFolderTreeNode$_onBeforeContextMenu(){var oContextMenu=getFolderTreeMenu();this._prepareFolderMenu(oContextMenu);var rgShowId=["divRmFvr","divMvUp","divMvDn"];oContextMenu.showMenuItems(rgShowId,true);oContextMenu.enableMenuItems(rgShowId,true);oContextMenu.showMenuItem("divCF",false);if(!this._tr.gtNdNxt(this))oContextMenu.enableMenuItem("divMvDn",false);if(!this._tr.gtNdPrv(this))oContextMenu.enableMenuItem("divMvUp",false);this._tr.set_ContextMenu(oContextMenu)};Owa.Components.FavoriteFolderTreeNode.prototype.onContextMenuClick=function Owa$Components$FavoriteFolderTreeNode$onContextMenuClick(oEventArgs){var oT=this._tr;switch(oEventArgs.sCommand){case"removefromfavorite":g_oNvNdMgr.rmv(oT,this.gtNId(),oT.gtGS());break;case"moveup":case"movedown":oT.upDn(this,oEventArgs.sCommand=="moveup");break;default:return Owa.Components.FavoriteFolderTreeNode.callBase(this,"onContextMenuClick",arguments)}};Owa.Components.FavoriteFolderTreeNode.prototype.drpIn=function Owa$Components$FavoriteFolderTreeNode$drpIn(oDraggableObject,iDM){var oRootElement=oDraggableObject.get_RootElement();switch(oDraggableObject.get_TypeName()){case Owa.Components.DraggableObjects.Type.Folder:if(g_oNvNdMgr.isInFvr(oRootElement.get_FolderId()))return;g_oNvNdMgr.addFvr(this._tr,oRootElement.get_FolderId(),this.gtNId(),(iDM&DRP_EFF_MSK)==DRP_ABOVE?0:1);return;default:Owa.Components.FavoriteFolderTreeNode.callBase(this,"drpIn",arguments)}};Owa.Components.FavoriteFolderTreeNode.prototype.delFld=function Owa$Components$FavoriteFolderTreeNode$delFld(fP,fD){if(!fP){this._tr._fDontSyncSelection=1;var sMsg=L_WrnDlFlInFvr+"<div style=\"overflow-y:hidden; height: 4px\"></div>&nbsp;&nbsp;<input type=radio id=dlFldrInFavRd0 name=cmfDltInFvr checked>&nbsp;<label for=dlFldrInFavRd0>"+L_RdDlt+"</label><br>&nbsp;&nbsp;<input type=radio id=dlFldrInFavRd1 name=cmfDltInFvr>&nbsp;<label for=dlFldrInFavRd1>"+L_RdRmvFrmFvr+"</label>";var oD=new BtnDlg("divDlt",sMsg,L_WrnDlFlTtl,[L_OK,L_Cncl],null,Owa.BUTTON_DIALOG_ICON.QUESTION,this._createCallback(this.cbOnDelFldNP));oD.show();return}else{Owa.Components.FavoriteFolderTreeNode.callBase(this,"delFld",arguments)}};Owa.Components.FavoriteFolderTreeNode.prototype.cbOnDelFldNP=function Owa$Components$FavoriteFolderTreeNode$cbOnDelFldNP(i){if(i==0){if(chkd(wtda("dlFldrInFavRd0")))Owa.Components.FavoriteFolderTreeNode.callBase(this,"cbOnDelFld",[0,0,0]);else g_oNvNdMgr.rmv(this._tr,this.gtNId(),this._tr.gtGS())}this._tr.syncSelNHl()}})();g_fModuleLoaded[".\\uicontrols/favoritefoldertreenode.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/favoritetree.js".toLowerCase()])(function(){Owa.UIControls.FavoriteTree=function Owa$UIControls$FavoriteTree(root){Owa.UIControls.FavoriteTree.constructBase(this,[root])};Owa.UIControls.FavoriteTree.createClass("Owa.UIControls.FavoriteTree",Owa.UIControls.NavigationTree);Owa.UIControls.FavoriteTree.prototype.initialize=function Owa$UIControls$FavoriteTree$initialize(){Owa.UIControls.FavoriteTree.callBase(this,"initialize");g_oEd.attachEvent("UpdateCount",this,"cbOnUpdCnt");g_oEd.attachEvent("AddToFavorites",this,"cbAddToFvr");g_oEd.attachEvent("AddFilterToFavorites",this,"cbOnFldrOeh");g_oEd.attachEvent("DeleteFolder",this,"cbOnFldrOeh");g_oEd.attachEvent("RenameFolder",this,"cbOnRnFld");g_oEd.attachEvent("RenameNavigation",this,"cbOnRnFltr")};Owa.UIControls.FavoriteTree.prototype.dispose=function Owa$UIControls$FavoriteTree$dispose(){g_oEd.detachEvent("UpdateCount",this,"cbOnUpdCnt");g_oEd.detachEvent("AddToFavorites",this,"cbAddToFvr");g_oEd.detachEvent("DeleteFolder",this,"cbOnFldrOeh");g_oEd.detachEvent("RenameFolder",this,"cbOnRnFld");g_oEd.detachEvent("RenameNavigation",this,"cbOnRnFltr");Owa.UIControls.FavoriteTree.callBase(this,"dispose")};Owa.UIControls.FavoriteTree.prototype.wrapNd=function Owa$UIControls$FavoriteTree$wrapNd(oN){switch(oN.getAttribute("_t")){case TN_FTN:return new Owa.Components.FavoriteFolderTreeNode(oN,this);default:return Owa.UIControls.FavoriteTree.callBase(this,"wrapNd",arguments)}};Owa.UIControls.FavoriteTree.prototype.onKD=function Owa$UIControls$FavoriteTree$onKD(oEvent){switch(oEvent.get_KeyCodeForKeyUpDown()){case 46:var oJSel=this.gtSelNd();if(oJSel&&oJSel.canDel())oJSel.delFld(oEvent.isShiftKeyDown(),0)}};Owa.UIControls.FavoriteTree.prototype.onRnNd=function Owa$UIControls$FavoriteTree$onRnNd(rsn,sV){var oJN=this._edt.nd;if(rsn!=ECR_ESC&&oJN._get_Element().getAttribute("_fltr")){g_oNvNdMgr.rnm(this,this.gtGS(),oJN.gtNId(),sV);return}Owa.UIControls.FavoriteTree.callBase(this,"onRnNd",[rsn,sV])};Owa.UIControls.FavoriteTree.prototype.cbOnRnFltr=function Owa$UIControls$FavoriteTree$cbOnRnFltr(oR,oSndr,sGS,sNId){var fSndBM=oSndr==this;if(fSndBM&&!this.cbOeh(oR,true))return;if(oR.isErr())return;var oJN=this.gtNdById(padF(sNId));if(oJN){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oJN.stDspNm(oC.getDescendantById("ntn").get_TextContent())}};Owa.UIControls.FavoriteTree.prototype.cbOnRnFld=function Owa$UIControls$FavoriteTree$cbOnRnFld(oR,oSndr,sFId){var fSndBM=oSndr==this;if(fSndBM&&!this.cbOeh(oR,true))return;if(oR.isErr())return;var oJN=this.gtNdByFId(sFId);if(oJN){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oJN.stDspNm(oC.getDescendantById("ntn").get_TextContent());if(Owa.Components.FolderTreeNode.isInstance(oJN)){oJN.stFldNm(oC.getDescendantById("tn").get_TextContent())}}};Owa.UIControls.FavoriteTree.prototype.cbOnUpdCnt=function Owa$UIControls$FavoriteTree$cbOnUpdCnt(sFId,iTC,iUC){var oJN=this.gtNdByFId(sFId);if(!oJN)return;oJN.updCnts(iTC,iUC)};Owa.UIControls.FavoriteTree.prototype.gtSelELCNdFId=function Owa$UIControls$FavoriteTree$gtSelELCNdFId(){var oJN=this.gtSelNd();return oJN?oJN._get_Element().getAttribute("_sPlcyFId"):0};Owa.UIControls.FavoriteTree.prototype.cbAddToFvr=function Owa$UIControls$FavoriteTree$cbAddToFvr(oR,oSndr,sFId,sNId,fIsAft){this.rldFrmR(oR);this.cbOeh(oR)}})();g_fModuleLoaded[".\\uicontrols/favoritetree.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/buddylisttreenode.js".toLowerCase()])(function(){Owa.Components.BuddyListTreeNode=function Owa$Components$BuddyListTreeNode(oN,tr){Owa.Components.BuddyListTreeNode.constructBase(this,[oN,tr])};Owa.Components.BuddyListTreeNode.createClass("Owa.Components.BuddyListTreeNode",Owa.Components.TreeNode);Owa.Components.BuddyListTreeNode.prototype.persistExp=function Owa$Components$BuddyListTreeNode$persistExp(f){if(this.isRt())g_oFldrMgr.prstTrExpSt();else{var oBuddyList=gtIMMgr().bdyLst;var rgGrpIdsInBdyLst=oBuddyList.GetGroups();var rgGrpIds=[];var oNode;for(var sGroupId in rgGrpIdsInBdyLst){oNode=g_oBddyLst.gtNdById(sGroupId);if(oNode&&oNode.isExp()){rgGrpIds.push(sGroupId)}}var oRCtx=new Object();oRCtx.rgGrpIds=rgGrpIds;sndIMReq(IM_PSTEXP,null,0,oRCtx)}};Owa.Components.BuddyListTreeNode.prototype.canDrg=function Owa$Components$BuddyListTreeNode$canDrg(){if(this._get_Element().getAttribute("sUri")){return true}else{return false}};Owa.Components.BuddyListTreeNode.prototype.canDrpExp=function Owa$Components$BuddyListTreeNode$canDrpExp(oDraggableObject){return false};Owa.Components.BuddyListTreeNode.prototype.onDrg=function Owa$Components$BuddyListTreeNode$onDrg(oEvent){var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);var oDraggableObject=Owa.Components.Storage.StorableObject.create(Owa.Components.DraggableObjects.Type.Buddy);var oBuddy=oDraggableObject.get_RootElement();oBuddy.set_GroupId(this._get_Element().getAttribute("sGroupId"));oBuddy.set_BuddyId(this._get_Element().getAttribute("sUri"));oDraggableObject.save(oDragDrop)};Owa.Components.BuddyListTreeNode.prototype.gtDrpMd=function Owa$Components$BuddyListTreeNode$gtDrpMd(oJN,oEvent,oDraggableObject){var sType=oDraggableObject.get_TypeName();if(sType!=Owa.Components.DraggableObjects.Type.Buddy){return DRP_NONE}var oBuddyList=gtIMMgr().bdyLst;var oGroup=oBuddyList.GetGroup(this.get_Id());if(oGroup&&!oGroup.IsOtherContactsGroup()){var oRootElement=oDraggableObject.get_RootElement();if(oGroup.IsMember(oRootElement.get_BuddyId()))return DRP_NONE;if(oEvent.isCtrlKeyDown()&&!oGroup.IsOtherContactsGroup()){return DRP_COPY}else{return DRP_MOVE}}return DRP_NONE};Owa.Components.BuddyListTreeNode.prototype.drpIn=function Owa$Components$BuddyListTreeNode$drpIn(oDraggableObject,iDM){var sNewGroupId=this.get_Id();var oRootElement=oDraggableObject.get_RootElement();var sBuddyId=oRootElement.get_BuddyId();var sOldGroupId=oRootElement.get_GroupId();switch(iDM){case DRP_COPY:copyToGroupRequest(sBuddyId,sNewGroupId);break;case DRP_MOVE:if(isOCSPrv()&&sOldGroupId==gtIMMgr().bdyLst.sOtherContactsID){copyToGroupRequest(sBuddyId,sNewGroupId)}else{moveToGroupRequest(sBuddyId,sOldGroupId,sNewGroupId)}break}};Owa.Components.BuddyListTreeNode.prototype._onBeforeContextMenu=function Owa$Components$BuddyListTreeNode$_onBeforeContextMenu(){if(g_iIM_SI){return true}if(this.isRt()){this._prepContextMenu(this.gtDspNm(),true,false,false,true);return}var oBuddyList=gtIMMgr().bdyLst;var sBuddyId=this._get_Element().getAttribute("sUri");var oGroup=oBuddyList.GetGroup(this.get_Id());var oBuddy=oBuddyList.GtBdy(sBuddyId);if(oGroup){this._prepContextMenu(oGroup.groupName,true,false,false,oGroup.IsOtherContactsGroup()||oGroup.IsFavoritesGroup());return}else if(oBuddy){var oBuddyGroup=oBuddyList.GetGroup(this._get_Element().getAttribute("sGroupId"));this._prepContextMenu(oBuddy.dn,false,oBuddyGroup.IsOtherContactsGroup(),gtIMMgr().IsBlkd(oBuddy.uri));return}return true};Owa.Components.BuddyListTreeNode.prototype._prepContextMenu=function Owa$Components$BuddyListTreeNode$_prepContextMenu(sHeaderText,fGroup,fInOtherContactsGroup,fBlocked,fReadOnly){var oContextMenu=this._tr.get_ContextMenu();var oSpnHdr=oContextMenu._get_Element().getDescendantById("spnHdr");oSpnHdr.set_TextContent(sHeaderText);oSpnHdr.set_Title(sHeaderText);var fMSN=isMSNPrv();oContextMenu.enableMenuItem("divBtmChat",!fGroup);oContextMenu.enableMenuItem("divBtmRmvBase",!fGroup);oContextMenu.showMenuItem("divBtmBlock",fMSN&&(fGroup||!fBlocked));oContextMenu.enableMenuItem("divBtmBlock",!fGroup&&!fBlocked);oContextMenu.showMenuItem("divBtmUnblock",fMSN&&!fGroup&&fBlocked);oContextMenu.enableMenuItem("divBtmUnblock",!fGroup&&fBlocked);oContextMenu.showMenuItem("divBtmRmvGroup",!fGroup&&!fInOtherContactsGroup);oContextMenu.enableMenuItem("divBtmRenameGroup",fGroup&&!fReadOnly);oContextMenu.enableMenuItem("divBtmRemoveGroup",fGroup&&!fReadOnly);oContextMenu.showMenuItem("divBtmNewContact",fMSN);oContextMenu.showMenuItem("divBtmNewOcsContact",!fMSN)};Owa.Components.BuddyListTreeNode.prototype.onContextMenuClick=function Owa$Controls$BuddyListTreeNode$prototype$onContextMenuClick(oEventArgs){switch(oEventArgs.sCommand){case"chat":nwChtFrmRcp(this._getRecipientSpan());break;case"block":blkBdyReq(this._getRecipientSpan());break;case"unblock":blkBdyReq(this._getRecipientSpan(),1);break;case"removeFromGroup":rmFrmGrpReq(this._tr.get_SubPage(),this._getRecipientSpan());break;case"removeFromList":rmBdyLstReq(this._tr.get_SubPage(),this._getRecipientSpan());break;case"renameGroup":this._tr.get_ContextMenu().close();this._tr.newGroup(this,0);break;case"removeGroup":removeGroupRequest(this.get_Id());break;case"newGroup":this._tr.get_ContextMenu().close();this._tr.newGroup(this,1);break;case"newContact":this._tr.get_ContextMenu().close();this._tr.addBddyRequest();break;case"newOcsContact":this._tr.get_ContextMenu().close();this._tr.addBddyFrmAb();break}};Owa.Components.BuddyListTreeNode.prototype._getRecipientSpan=function Owa$Controls$BuddyListTreeNode$prototype$_getRecipientSpan(){return this._get_Element().get_FirstChild().get_FirstChild().get_FirstChild()._get_DomNode()}})();g_fModuleLoaded[".\\uicontrols/buddylisttreenode.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/buddylisttree.js".toLowerCase()])(function(){var ADD_BDDY_ID="addBddy";var BDDY_RT_ID="bddyRt";var LABEL="grpLB";var INF_BR_ID="divIB";var LEGACY_USER="LegacyUser";var RMT_SGNOUT_UI_ID="divRmtSgnOut";var SGNOUT_TME_UI_ID="divSgnOutTME";var SGNOUT_NTW_UI_ID="divSgnOutNTW";var CONFIG_ISSUE_UI_ID="divCfgIss";var SGNOUT_MNL_UI_ID="divSgnOutMNL";var MSN_TOU_UI_ID="divMsnTOU";var BUDDY_PADDING=3;var ABCH_MAX_GROUP_NAME_LENGTH="60";Owa.UIControls.BuddyListTree=function Owa$UIControls$BuddyListTree(root){Owa.UIControls.BuddyListTree.constructBase(this,[root]);this.fRendering=0};Owa.UIControls.BuddyListTree.createClass("Owa.UIControls.BuddyListTree",Owa.UIControls.TreeControl);Owa.UIControls.BuddyListTree.prototype.initialize=function Owa$UIControls$BuddyListTree$initialize(){Owa.UIControls.BuddyListTree.callBase(this,"initialize");this._cbOnDblClk=this._attachEvent(this.root,"dblclick",this.onDblClk);this.startRendering()};Owa.UIControls.BuddyListTree.prototype.dispose=function Owa$UIControls$BuddyListTree$dispose(){if(!this._disped){if(this.onDblClk)this._detachEvent(this.root,"dblclick",this.onDblClk);if(this._oContextMenu){this._oContextMenu.dispose()}Owa.UIControls.BuddyListTree.callBase(this,"dispose")}};Owa.UIControls.BuddyListTree.prototype.wrapNd=function Owa$UIControls$BuddyListTree$wrapNd(oN){return new Owa.Components.BuddyListTreeNode(oN,this)};Owa.UIControls.BuddyListTree.prototype._onClk=function Owa$UIControls$BuddyListTree$_onClk(oEvent){var oJN=this.gtNd(oEvent.get_Target());if(!oJN)return;if(oJN.gtId()==ADD_BDDY_ID){var imType=gtIMType();if(imType==IM_TYPE_OCS){this.addBddyFrmAb()}else if(imType==IM_TYPE_MSN){this.addBddyRequest()}oEvent.preventDefault();oEvent.cancelBubble();return}else if(this.shdCanEvt(oJN.gtId())){oEvent.preventDefault();oEvent.cancelBubble();return}Owa.UIControls.BuddyListTree.callBase(this,"_onClk",[oEvent,1])};Owa.UIControls.BuddyListTree.prototype.addBddyRequest=function Owa$UIControls$BuddyListTree$addBddyRequest(){var oP={};oP.sTgt=TO;oP.sTo="";shwDlg("AddContact",400,250,DLG_MOD|DLG_CTR,oP)};Owa.UIControls.BuddyListTree.prototype.addBddyFrmAb=function Owa$UIControls$BuddyListTree$addBddyFrmAb(){var oP={};oP.sTgt=TO;oP.sTo="";oP.fResolve=1;shwDlg("AddressBook",a_iABW,a_iABH,DLG_MOD|DLG_CTR|DLG_RSZ,oP,"&a=PickBuddy");var divBddys=getEm(DIV,god(this.root._get_DomNode()));divBddys.innerHTML=oP.sTo;var rgoBddys=divBddys.getElementsByTagName("span")["spnR"];if(!isDf(typeof(rgoBddys)))return;if(!rgoBddys.length){addBdyLstReq(this.get_SubPage(),rgoBddys)}else{for(var i=0;i<rgoBddys.length;i++){addBdyLstReq(this.get_SubPage(),rgoBddys[i])}}};Owa.UIControls.BuddyListTree.prototype.onDblClk=function Owa$UIControls$BuddyListTree$onDblClk(oEvent){var oJN=this.gtNd(oEvent.get_Target());if(!oJN||oJN.hsChld())return;var sId=oJN.gtId();if(sId==ADD_BDDY_ID||sId==LABEL||sId==FKID||oJN._get_Element().get_FirstChild().get_Id()=="dvInf")return;if(this.shdCanEvt(sId)){canEvt(oEvent);return}var spnRn=oJN._get_Element().get_FirstChild().get_FirstChild().get_FirstChild();var fExst=gtIMMgr().LdExstChtSsn(spnRn.getAttribute("_uri"));if(fExst)return;nwChtFrmRcp(spnRn._get_DomNode())};Owa.UIControls.BuddyListTree.prototype.OthrCnctGrpExists=function Owa$UIControls$BuddyListTree$OthrCnctGrpExists(){var oJBR=this.gtNdById(gtIMMgr().bdyLst.sOtherContactsID);if(oJBR){return 1}return 0};Owa.UIControls.BuddyListTree.prototype.addGrpToTr=function Owa$UIControls$BuddyListTree$addGrpToTr(sName,sGroupID,iFlags,iExpand){var oBuddyList=gtIMMgr().bdyLst;var oJBR=(oBuddyList.sOtherContactsID==null||(iFlags&Owa.IM.GROUP_FLAGS.OtherContacts)!=0)?this.gtNdById(ADD_BDDY_ID):this.gtNdById(oBuddyList.sOtherContactsID);var fSibling=1;if(!oJBR){oJBR=this.gtNdById(BDDY_RT_ID);fSibling=0}var oJN=this.createNewNode(sGroupID,oJBR,fSibling,0,{nosel:1,exp:iExpand,padding:BUDDY_PADDING});oJN.stDspNm(sName);var oGL=this.createNewNode(LABEL,oJN,0,0,{nosel:1,exp:0,padding:BUDDY_PADDING});oGL.stDspNm(L_GrpLbl);if(this._edting&&this._edt.oCtx){if(sName.trim()==this._edt.oCtx.originalValue){this.qtEdtNd()}}};Owa.UIControls.BuddyListTree.prototype.renameGroup=function Owa$UIControls$BuddyListTree$renameGroup(sGroupId,sNewName){var oNode=this.gtNdById(sGroupId);if(oNode){oNode.stDspNm(sNewName);if(this._edting&&this._edt.oCtx){if(sNewName.trim()==this._edt.oCtx.originalValue){this.qtEdtNd()}}}};Owa.UIControls.BuddyListTree.prototype.newGroup=function Owa$UIControls$BuddyListTree$newGroup(oNode,fNew){var oCtx={};if(!fNew){this.edtNd(oNode,oCtx)}else{var oBuddyList=gtIMMgr().bdyLst;this.crtNwNd(this.gtNdById(BDDY_RT_ID),oCtx,0,(oBuddyList.sOtherContactsID!=null)?this.gtNdById(oBuddyList.sOtherContactsID):this.gtNdById(ADD_BDDY_ID))}};Owa.UIControls.BuddyListTree.prototype.onNwNd=function Owa$UIControls$BuddyListTree$onNwNd(rsn,sV){if(rsn!=ECR_ESC){var sErrMsg=Owa.IM.BdyGrp.ValidateGroupName(sV,true);if(sErrMsg){this.shwErr(sErrMsg,true);this.reEdtNd()}else{this._edt.oCtx.originalValue=sV.trim();createGroupRequest(sV)}}else{this.qtEdtNd()}};Owa.UIControls.BuddyListTree.prototype.onRnNd=function Owa$UIControls$BuddyListTree$onRnNd(rsn,sV){var oJN=this._edt.nd;if(rsn!=ECR_ESC){if(oJN._get_Element().get_TextContent()==sV.trim()){this.qtEdtNd();return}var sErrMsg=Owa.IM.BdyGrp.ValidateGroupName(sV,false);if(sErrMsg){this.shwErr(sErrMsg,true);this.reEdtNd()}else{var oIMManager=gtIMMgr();if(oIMManager){this._edt.oCtx.originalValue=sV.trim();renameGroupRequest(oIMManager.bdyLst.GetGroup(oJN.get_Id()),sV)}}}else{this.qtEdtNd()}};Owa.UIControls.BuddyListTree.prototype.gtNwNdIcnMrkup=function Owa$UIControls$BuddyListTree$gtNwNdIcnMrkup(oPN,oCtx){return null};Owa.UIControls.BuddyListTree.prototype.getMaxInputLength=function Owa$UIControls$BuddyListTree$getMaxInputLength(){return ABCH_MAX_GROUP_NAME_LENGTH};Owa.UIControls.BuddyListTree.prototype.removeGroup=function Owa$UIControls$BuddyListTree$removeGroup(sGroupID){var oGroupNode=this.gtNdById(sGroupID);if(oGroupNode){this.rmNd(oGroupNode)}};Owa.UIControls.BuddyListTree.prototype.renderAddBddyLnk=function Owa$UIControls$BuddyListTree$renderAddBddyLnk(){var oJN=this.createNewNode(ADD_BDDY_ID,this.gtNdById(BDDY_RT_ID),0,0,{nosel:1,iconHTML:Owa.Components.CssSprites.getImageMarkup("adbdy.gif","id="+NODE_ICON),contentClassName:"bddyLk"});oJN.stDspNm(L_AddBddsElps);oJN.gtHl().set_Padding(Owa.Style.Side.Top,4)};Owa.UIControls.BuddyListTree.prototype.startRendering=function Owa$UIControls$BuddyListTree$startRendering(){this.fRendering=1;window.setTimeout(function(){if(g_oBddyLst){g_oBddyLst._render()}},0)};Owa.UIControls.BuddyListTree.prototype._render=function Owa$UIControls$BuddyListTree$_render(){var oIMManager=gtIMMgr();if(oIMManager){var sGroupId,oGroup,rgBdyUrisInGrp,sUri,oBuddy,iPrsnc;var start=(new Date()).getTime();var oBuddyList=oIMManager.bdyLst;var rgGrpIdsInBdyLst=oBuddyList.GetGroups();for(sGroupId in rgGrpIdsInBdyLst){oGroup=oBuddyList.GetGroup(sGroupId);if(oGroup){rgBdyUrisInGrp=oGroup.GetMembers();for(sUri in rgBdyUrisInGrp){if(oGroup.IsMember(sUri)&&!oGroup.GetRenderingStatus(sUri)){oBuddy=oBuddyList.GtBdy(sUri);if(oBuddy){iPrsnc=oIMManager.gtPrsnc(sUri);this.addBddyToGrp(oBuddy.dn,sUri,sGroupId,iPrsnc,oBuddy.iType);if((new Date()).getTime()-start>125){this.startRendering();return}}}}}}}if(!g_fSigningIn){this.shwPrgInd(1)}this.fRendering=0};Owa.UIControls.BuddyListTree.prototype.hdChldNodes=function Owa$UIControls$BuddyListTree$hdChldNodes(){var oCC=this.gtNdRt().gtCC();if(oCC){var rgNodes=oCC.getChildrenSnapshot();for(var i=0;i<rgNodes.length;i++){rgNodes[i].set_IsShown(false)}}};Owa.UIControls.BuddyListTree.prototype.addBddyToGrp=function Owa$UIControls$BuddyListTree$addBddyToGrp(sDn,sUri,sGroupId,iPrsnc,iType){var oG=this.gtNdById(sGroupId);if(oG==null)return;var oGL=this.gtChdNdById(oG,LABEL);if(oGL){var divGL=oGL.getContainer();if(divGL.get_IsShown())divGL.set_IsShown(false)}var oChildNodes=oG.gtCC()._get_DomNode().childNodes;var oJNBF=this._findInsertPosition(oChildNodes,sDn,1,oChildNodes.length-1);var oJN=this.createNewNode(sGroupId+Owa.IM.IMUtils.CleanUri(sUri),(oJNBF==null)?this.gtNdById(sGroupId):oJNBF,(oJNBF==null)?0:1,0,{nosel:1});oJN._get_Element().setAttribute("sGroupId",sGroupId);oJN._get_Element().setAttribute("sUri",sUri);var spnBddy=createOwaRcpSpan(sDn,Owa.IM.IMUtils.NrmSipUri(sUri),RT_SMTP,"",AO_O,0,"",0,sUri,1,1,1,sGroupId,iType);renderJB(spnBddy.get_FirstChild(),0,0,1,iPrsnc);oJN.getContent().appendChild(spnBddy);gtIMMgr().bdyLst.GetGroup(sGroupId).SetRenderingStatus(sUri,true)};Owa.UIControls.BuddyListTree.prototype.rmvBddyFrmGrp=function Owa$UIControls$BuddyListTree$rmvBddyFrmGrp(sGroupID,sUri){var oJN=this.gtNdById(sGroupID+Owa.IM.IMUtils.CleanUri(sUri));if(oJN)this.rmNd(oJN);var oGroup=gtIMMgr().bdyLst.GetGroup(sGroupID);if(oGroup.GtLen()==0){var oGL=this.gtChdNdById(this.gtNdById(sGroupID),LABEL);if(oGL){var divGL=oGL.getContainer();divGL.set_IsShown(true)}}oGroup.SetRenderingStatus(sUri,false)};Owa.UIControls.BuddyListTree.prototype.updateGrpPrsc=function Owa$UIControls$BuddyListTree$updateGrpPrsc(sGroupID,sDn,sUri,iPrsnc){var oJBddy=this.gtNdById(sGroupID+Owa.IM.IMUtils.CleanUri(sUri));if(oJBddy){if(isDf(typeof(iPrsnc))){var oImg=oJBddy._get_Element().getDescendantsByTagName("img")[0];if(oImg){setJBPrsnc(oImg,iPrsnc,0)}}var oBddyNm=oJBddy._get_Element().getDescendantById("bdyNm");if(sDn&&sDn!=""&&sDn!=oBddyNm.get_TextContent()){var oG=this.gtNdById(sGroupID);if(oG){var oChildNodes=oG.gtCC()._get_DomNode().childNodes;var oJNBF=this._findInsertPosition(oChildNodes,sDn,1,oChildNodes.length-1);if(oJNBF!=oJBddy){if(oJNBF==null)this.addKds(oG,[oJBddy.getContainer()]);else this.insrtKdsPos(oJNBF,[oJBddy.getContainer()],0,0)}}oBddyNm.set_TextContent(sDn);var spnIn=oJBddy._get_Element().get_FirstChild().get_FirstChild().get_FirstChild();spnIn.setAttribute("_dn",sDn);spnIn.setAttribute("title",sDn+"\n"+imns.IMUtils.NrmSipUri(sUri))}}};Owa.UIControls.BuddyListTree.prototype.shwIMUnavl=function Owa$UIControls$BuddyListTree$shwIMUnavl(iErr){Owa.IM.BdyGrp.sOtherContactsID=null;var iId=INF_BR_ID;var iFailure=isDf(typeof(iErr))?iErr:0;switch(iFailure){case IM_FAIL_SESSION_SIGN_OUT:iId=RMT_SGNOUT_UI_ID;break;case IM_FAIL_CLIENT_SIGN_OUT:iId=SGNOUT_MNL_UI_ID;break;case IM_FAIL_CLIENT_LIMIT:iId=SGNOUT_TME_UI_ID;break;case IM_FAIL_MSN_TERMS_OF_USE_NOT_SIGNED:iId=MSN_TOU_UI_ID;this.gtNdRt().collapse();break;case IM_FAIL_ADDRESS_NOT_AVAILABLE:case IM_FAIL_EXTERNAL_AUTHENTICATION_DISABLED:case IM_FAIL_EXTERNAL_IDENTITY_UNKNOWN:iId=CONFIG_ISSUE_UI_ID;break;case IM_FAIL_SERVER_TIMEOUT:iId=SGNOUT_NTW_UI_ID;break}this.shwNdById(iId)};Owa.UIControls.BuddyListTree.prototype.shwIMUnsupported=function Owa$UIControls$BuddyListTree$shwIMUnsupported(){this.shwNdById(INF_BR_ID,1)};Owa.UIControls.BuddyListTree.prototype.shwPrgInd=function Owa$UIControls$BuddyListTree$shwPrgInd(fH){if(!fH){if(!this.gtNdById(ADD_BDDY_ID)){this.renderAddBddyLnk()}this.hdChldNodes();var oCC=this.gtNdRt().gtCC();if(oCC){oCC.set_IsShown(false);this.fireOnResize()}this.gtNdById(BDDY_RT_ID).shwPrg(0)}else{if(this.gtNdRt().isExp()){var oCC=this.gtNdRt().gtCC();if(oCC){oCC.set_IsShown(true);this.fireOnResize()}}this.gtNdById(BDDY_RT_ID).hdPrg()}};Owa.UIControls.BuddyListTree.prototype.shwNdById=function Owa$UIControls$BuddyListTree$shwNdById(iId,fLU){this.hdChldNodes();this.gtNdById(BDDY_RT_ID).hdPrg();var oJIF=this.gtNdById(iId);if(!oJIF){if(isDf(typeof(fLU))&&fLU){this.createInfoNode(LEGACY_USER)}else{this.createInfoNode(iId)}}else{oJIF.getContainer().set_IsShown(true)}};Owa.UIControls.BuddyListTree.prototype.shwAddBddyLnk=function Owa$UIControls$BuddyListTree$shwAddBddyLnk(){var oJAB=this.gtNdById(ADD_BDDY_ID);if(!oJAB){this.renderAddBddyLnk();oJAB=this.gtNdById(ADD_BDDY_ID)}if(!oJAB.getContainer().get_IsShown()){oJAB.getContainer().set_IsShown(true)}};Owa.UIControls.BuddyListTree.prototype.insertInfoNode=function Owa$UIControls$BuddyListTree$insertInfoNode(sId,oJParent,contentHTML){return this.createNewNode(sId,oJParent,0,0,{nosel:1,contentHTML:contentHTML,highlightClassName:"bddyInfoNdHl",bodyClassName:"bddyInfoNd"})};Owa.UIControls.BuddyListTree.prototype.createInfoNode=function Owa$UIControls$BuddyListTree$createInfoNode(sId){var contentHTML;switch(sId){case INF_BR_ID:contentHTML="<DIV id=\"dvInf\" class=\"errBx\">"+L_IMNtAvl+"</div>";break;case LEGACY_USER:contentHTML="<DIV id=\"dvInf\" class=\"errBx\">"+L_IMLegacyUser+"</div>";break;case RMT_SGNOUT_UI_ID:contentHTML="<div id=\"dvInf\" class=\"errBx\">"+L_ErrRmtSo+"&nbsp;"+"<span id=spnSgnInAgn onclick=\"g_oBddyLst.clkSgnIn()\">"+L_sgnInAgn+"</span></div>";break;case SGNOUT_TME_UI_ID:contentHTML="<div id=\"dvInf\" class=\"errBx\">"+L_ErrManyEndpoints+"&nbsp;"+"<span id=spnSgnInAgn onclick=\"g_oBddyLst.clkSgnIn()\">"+L_sgnInAgn+"</span></div>";break;case SGNOUT_MNL_UI_ID:contentHTML="<div id=\"dvInf\" class=\"errBx\">"+L_SignedOutOfIM+"&nbsp;"+"<span id=spnSgnInAgn onclick=\"g_oBddyLst.clkSgnIn(1)\">"+L_SignIn+"</span></div>";break;case MSN_TOU_UI_ID:contentHTML="<div id=\"dvInf\" class=\"errBx\">"+L_ErrorTermsOfUseNotSigned+"&nbsp;"+"<span id=spnSgnInAgn onclick=\"g_oBddyLst.clickTOU()\">"+L_ErrorTermsOfUseLink+"</span></div>";break;case CONFIG_ISSUE_UI_ID:contentHTML="<DIV id=\"dvInf\" class=\"errBx\">"+L_IMInvConf+"</div>";break;case SGNOUT_NTW_UI_ID:contentHTML="<div id=\"dvInf\" class=\"errBx\">"+L_IMNetPblm+"&nbsp;"+"<span id=spnSgnInAgn onclick=\"g_oBddyLst.clkSgnIn()\">"+L_sgnInAgn+"</span></div>";break}var oJInfo=this.insertInfoNode(sId,this.gtNdById(BDDY_RT_ID),contentHTML);oJInfo._get_Element()._get_DomNode().removeAttribute("href");oJInfo._get_Element().set_Right(0);oJInfo._get_Element().set_Left(0)};Owa.UIControls.BuddyListTree.prototype.shdCanEvt=function Owa$UIControls$BuddyListTree$shdCanEvt(sId){if(sId==INF_BR_ID||sId==RMT_SGNOUT_UI_ID||sId==SGNOUT_TME_UI_ID||sId==SGNOUT_MNL_UI_ID||sId==MSN_TOU_UI_ID||sId==SGNOUT_NTW_UI_ID||sId==CONFIG_ISSUE_UI_ID)return true;else return false};Owa.UIControls.BuddyListTree.prototype.clkSgnIn=function Owa$UIControls$BuddyListTree$clkSgnIn(fMnlSI){ImSIR(0,1,fMnlSI);this.shwPrgInd()};Owa.UIControls.BuddyListTree.prototype._findInsertPosition=function Owa$UIControls$BuddyListTree$_findInsertPosition(oChildNodes,sDn,begin,end){if(oChildNodes==null||begin>end)return null;while(1){if(begin>=end){var oJN=Owa.Dom.Node.wrapDomNode(oChildNodes[end]);if(oJN&&oJN.get_TextContent().localeCompare(sDn)>0)return this.gtNd(oJN);else return null}else{var middle=Math.floor(begin+(end-begin)/2);var oJN=Owa.Dom.Node.wrapDomNode(oChildNodes[middle]);if(oJN&&oJN.get_TextContent().localeCompare(sDn)>0)end=middle;else begin=middle+1}}};Owa.UIControls.BuddyListTree.prototype.clickTOU=function Owa$UIControls$BuddyListTree$clickTOU(){var oDocument=Owa.Dom.Document.get_Current();var oForm=Owa.Dom.Document.get_Current().createElement("form");oForm.setAttribute("method","post");var oHiddenInput=oDocument.createElement("input");oHiddenInput.setAttribute("type","hidden");oHiddenInput.setAttribute("name","InstantMessage_TOU");oHiddenInput.setAttribute("value","1");oForm.appendChild(oHiddenInput);oDocument.appendChild(oForm);oForm._get_DomNode().submit()}})();g_fModuleLoaded[".\\uicontrols/buddylisttree.js".toLowerCase()]=1;(function(){var States={Unload:0,Loading:1,Loaded:2,Showing:3};Owa.UIControls.FolderPickerDialog=function Owa$UIControls$FolderPickerDialog(){Owa.UIControls.FolderPickerDialog.constructBase(this);this._sId=g_sFPDId+Owa.UIControls.FolderPickerDialog._iIndex;Owa.UIControls.FolderPickerDialog._iIndex++;this._attachEvent(Owa.Dom.Window.get_Current(),"unload",this._dispose);g_oEd.attachEvent("RenameFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("NewFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("MoveFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("CopyFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("DeleteFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("EmptyFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("RemoveNavigation",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("RenameNavigation",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("NewNavigation",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("UpdateCount",this,"_cbClearHtmlCacheAfterCountChanged")};Owa.UIControls.FolderPickerDialog.createClass("Owa.UIControls.FolderPickerDialog",Owa.UIControls.UIControl);Owa.UIControls.FolderPickerDialog._iIndex=0;Owa.UIControls.FolderPickerDialog.prototype._iDefaultButtonIndex=0;Owa.UIControls.FolderPickerDialog.prototype._sState=States.Unload;Owa.UIControls.FolderPickerDialog.prototype._iTreeHeight=300;Owa.UIControls.FolderPickerDialog.prototype._iTreeWidth=260;Owa.UIControls.FolderPickerDialog.prototype._fIsShowPublicFolder=true;Owa.UIControls.FolderPickerDialog.prototype._sTitle="";Owa.UIControls.FolderPickerDialog.get_Default=function Owa$UIControls$FolderPickerDialog$get_Default(){if(!Owa.Dom.Window.get_Current().equals(Owa.Utility.getIFrameParentOwaWindow())){var oTopOwa=Owa.Utility.getIFrameParentOwaWindow().getGlobalVariable("Owa");return oTopOwa.UIControls.FolderPickerDialog.get_Default()}if(!this._oDefault)this._oDefault=new Owa.UIControls.FolderPickerDialog();return this._oDefault};Owa.UIControls.FolderPickerDialog.prototype._get_State=function Owa$UIControls$FolderPickerDialog$_get_State(){return this._sState};Owa.UIControls.FolderPickerDialog.prototype._set_State=function Owa$UIControls$FolderPickerDialog$_set_State(sState){this._sState=sState};Owa.UIControls.FolderPickerDialog.prototype.set_Title=function Owa$UIControls$FolderPickerDialog$set_Title(sTitle){if(this._get_State()==States.Showing)throw new Error("Can't change title when folder picker dialog is showing");this._sTitle=sTitle};Owa.UIControls.FolderPickerDialog.prototype.set_TreeHtml=function Owa$UIControls$FolderPickerDialog$set_TreeHtml(sTreeHtml){if(this._get_State()==States.Showing){throw new Error("Can't change tree html when folder picker dialog is showing")}this._sCustomTreeHtml=sTreeHtml};Owa.UIControls.FolderPickerDialog.prototype.set_SourceTreeNode=function Owa$UIControls$FolderPickerDialog$set_SourceTreeNode(oNode){if(this._get_State()==States.Showing)throw new Error("Can't set the source tree node when folder picker dialog is showing");this._oSourceTreeNode=oNode};Owa.UIControls.FolderPickerDialog.prototype.get_SourceTreeNode=function Owa$UIControls$FolderPickerDialog$get_SourceTreeNode(){return this._oSourceTreeNode};Owa.UIControls.FolderPickerDialog.prototype.get_Title=function Owa$UIControls$FolderPickerDialog$get_Title(){return this._sTitle};Owa.UIControls.FolderPickerDialog.prototype.set_IsShowPublicFolder=function Owa$UIControls$FolderPickerDialog$set_IsShowPublicFolder(fIsShowPublicFolder){if(this._get_State()==States.Showing)throw new Error("Can't change title when folder picker dialog is showing");if(this._fIsShowPublicFolder!=fIsShowPublicFolder){this._fIsShowPublicFolder=fIsShowPublicFolder;this._set_State(States.Unload)}};Owa.UIControls.FolderPickerDialog.prototype.set_TreeWidth=function Owa$UIControls$FolderPickerDialog$set_TreeWidth(iValue){this._iTreeWidth=iValue};Owa.UIControls.FolderPickerDialog.prototype.get_TreeWidth=function Owa$UIControls$FolderPickerDialog$get_TreeWidth(){return this._iTreeWidth};Owa.UIControls.FolderPickerDialog.prototype.set_TreeHeight=function Owa$UIControls$FolderPickerDialog$set_TreeHeight(iValue){this._iTreeHeight=iValue};Owa.UIControls.FolderPickerDialog.prototype.get_TreeHeight=function Owa$UIControls$FolderPickerDialog$get_TreeHeight(){return this._iTreeHeight};Owa.UIControls.FolderPickerDialog.prototype.set_ButtonCaptions=function Owa$UIControls$FolderPickerDialog$set_ButtonCaptions(rgButtonCaption){if(this._get_State()==States.Showing)throw new Error("Can't change button when folder picker dialog is showing");this._rgButtonCaption=rgButtonCaption};Owa.UIControls.FolderPickerDialog.prototype.get_ButtonCaptions=function Owa$UIControls$FolderPickerDialog$get_ButtonCaptions(){return this._rgButtonCaption};Owa.UIControls.FolderPickerDialog.prototype.set_DefaultButtonIndex=function Owa$UIControls$FolderPickerDialog$set_DefaultButtonIndex(iDefaultButtonIndex){this._iDefaultButtonIndex=iDefaultButtonIndex};Owa.UIControls.FolderPickerDialog.prototype.get_DefaultButtonIndex=function Owa$UIControls$FolderPickerDialog$get_DefaultButtonIndex(){return this._iDefaultButtonIndex};Owa.UIControls.FolderPickerDialog.prototype.getButton=function Owa$UIControls$FolderPickerDialog$getButton(sButtonCaption){if(!sButtonCaption)return null;return this._get_ButtonDialog().getButton(sButtonCaption)};Owa.UIControls.FolderPickerDialog.prototype.get_DefaultButton=function Owa$UIControls$FolderPickerDialog$get_DefaultButton(){return this.getButton(this.get_ButtonCaptions()[this.get_DefaultButtonIndex()])};Owa.UIControls.FolderPickerDialog.prototype.show=function Owa$UIControls$FolderPickerDialog$show(){if(this._get_State()==States.Showing)throw new Error("Dialog already showed");if(this._get_State()==States.Unload){this._load();return}if(this._get_State()==States.Loading){return}this._show()};Owa.UIControls.FolderPickerDialog.prototype._show=function Owa$UIControls$FolderPickerDialog$_show(){this._createButtonDialog();var oTreeContainer=this._get_TreeControl()._get_Element().get_ParentElement();this._get_ButtonDialog().show();oTreeContainer.get_ParentElement().get_ParentElement().get_ParentElement().set_Width(this._iTreeWidth);oTreeContainer.get_ParentElement().get_ParentElement().get_ParentElement().set_Height(this._iTreeHeight);this._set_State(States.Showing)};Owa.UIControls.FolderPickerDialog.prototype._load=function Owa$UIControls$FolderPickerDialog$_load(){if(this._sCustomTreeHtml){this._sHtml=this._sCustomTreeHtml;this._set_State(States.Loaded);this._show()}else{var oRequest=new oeReq("Navigation","GetFolderPickerTree",null,this._createCallback(this._cbLoad));oRequest.add("pTr",this._fIsShowPublicFolder?1:0);oRequest.send();this._set_State(States.Loading)}};Owa.UIControls.FolderPickerDialog.prototype._cbLoad=function Owa$UIControls$FolderPickerDialog$_cbLoad(oResponse){if(!cbOeh(oResponse)){this._set_State(States.Unload);return}this._sHtml=oResponse.sBody;this._set_State(States.Loaded);this._show()};Owa.UIControls.FolderPickerDialog.prototype._createButtonDialog=function Owa$UIControls$FolderPickerDialog$_createButtonDialog(){var iMargin=52;var rgButton=this.get_ButtonCaptions();rgButton=rgButton.slice();rgButton.unshift(L_CrtNewFldElps);this._oButtonDialog=new BtnDlg(this._sId,this._sHtml,this.get_Title(),rgButton,this._iTreeWidth+iMargin,null,this._createCallback(this._cbOnButtonClick));this._oDialogElement=$(this._sId);var oTreeElement=this._oDialogElement.getDescendantById("fptree").get_FirstChild();var oTreeContainer=oTreeElement.get_ParentElement();var oTree=new Owa.UIControls.FolderTree(oTreeElement,1);if(this._oTree)unmakeTreeScrollArea(this._oTree);this._oTree=oTree;oTree.clrSel();oTreeContainer.get_ParentElement().get_ParentElement().get_ParentElement().set_Width(this._iTreeWidth);oTreeContainer.get_ParentElement().get_ParentElement().get_ParentElement().set_Height(this._iTreeHeight);makeTreeScrollArea(oTree);oTree.onSelChng=Owa.Utility.createDelegate(this,this._cbOnTreeSelectionChange);oTree.onAfEdt=Owa.Utility.createDelegate(this,this._cbOnTreeAfterEdit);oTree.onNwFld=Owa.Utility.createDelegate(this,this._cbOnTreeNewFolder);this._attachEvent(oTree.root,"dblclick",this._cbOnTreeDoublcClick);this.enableAllDialogButton(false);this._set_State(States.Loaded)};Owa.UIControls.FolderPickerDialog.prototype._dispose=function Owa$UIControls$FolderPickerDialog$_dispose(){var oTree=this._get_TreeControl();if(this._get_State()==States.Showing)this._detachEvent(oTree.root,"dblclick",this._cbOnTreeDoublcClick);g_oEd.detachEvent("RenameFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("NewFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("MoveFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("CopyFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("DeleteFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("EmptyFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("RemoveFromView",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("RemoveNavigation",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("RenameNavigation",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("NewNavigation",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("UpdateCount",this,"_cbClearHtmlCacheAfterCountChanged")};Owa.UIControls.FolderPickerDialog.prototype._get_TreeControl=function Owa$UIControls$FolderPickerDialog$_get_TreeControl(){return this._oTree};Owa.UIControls.FolderPickerDialog.prototype._get_ButtonDialog=function Owa$UIControls$FolderPickerDialog$_get_ButtonDialog(){return this._oButtonDialog};Owa.UIControls.FolderPickerDialog.prototype.enableButton=function Owa$UIControls$FolderPickerDialog$enableButton(sButtonCaption,fEnable){this._oButtonDialog.enableButton(sButtonCaption,fEnable)};Owa.UIControls.FolderPickerDialog.prototype.enableAllDialogButton=function Owa$UIControls$FolderPickerDialog$enableAllDialogButton(fEnable){var rgButton=this.get_ButtonCaptions();for(var i=0;i<rgButton.length;i++)this._oButtonDialog.enableButton(rgButton[i],fEnable);this._oButtonDialog.enableButton(L_CrtNewFldElps,fEnable)};Owa.UIControls.FolderPickerDialog.prototype._cbOnTreeNewFolder=function Owa$UIControls$FolderPickerDialog$_cbOnTreeNewFolder(oNewTreeNode){this._get_TreeControl().selNd(oNewTreeNode);this.enableAllDialogButton(true);this._onCheckCustomButtons()};Owa.UIControls.FolderPickerDialog.prototype._cbOnButtonClick=function Owa$UIControls$FolderPickerDialog$_cbOnButtonClick(iButtonIndex,oContext){var fCancelClose=false;var oTree=this._get_TreeControl();if(-1==iButtonIndex){if(oTree._edting)oTree.qtEdtNd()}else{if(0==iButtonIndex){oTree.nwFld(oTree.gtSelNd(),1,null);this.enableAllDialogButton(false);fCancelClose=true}else{fCancelClose=this._onButtonClick(iButtonIndex-1)}}if(!fCancelClose||-1==iButtonIndex){if(this._onBeforeClose()){fCancelClose=true}if(!fCancelClose||-1==iButtonIndex){this._sHtml=this._oDialogElement.getDescendantById("divFPTrR").get_OuterHtml();this._get_TreeControl().dispose();this._oTree=null;this._set_State(States.Loaded)}}return fCancelClose};Owa.UIControls.FolderPickerDialog.prototype._cbOnTreeDoublcClick=function Owa$UIControls$FolderPickerDialog$_cbOnTreeDoublcClick(oEvent){if(!this._get_TreeControl()._edting){var oDefaultButton=this.get_DefaultButton();if(oDefaultButton)oDefaultButton.click()}};Owa.UIControls.FolderPickerDialog.prototype._cbOnTreeSelectionChange=function Owa$UIControls$FolderPickerDialog$_cbOnTreeSelectionChange(oOriginSelectedTreeNode,oNewSelectedTreeNode){this.enableAllDialogButton(true);this.enableButton(L_CrtNewFldElps,oNewSelectedTreeNode?oNewSelectedTreeNode.canCrt():false);this._onCheckCustomButtons()};Owa.UIControls.FolderPickerDialog.prototype._cbOnTreeAfterEdit=function Owa$UIControls$FolderPickerDialog$_cbOnTreeAfterEdit(){var oSelectedTreeNode=this._get_TreeControl().gtSelNd();this.enableAllDialogButton(true);this.enableButton(L_CrtNewFldElps,oSelectedTreeNode?oSelectedTreeNode.canCrt():false);this._onCheckCustomButtons()};Owa.UIControls.FolderPickerDialog.prototype._cbClearHtmlCacheAfterOEH=function Owa$UIControls$FolderPickerDialog$_cbClearHtmlCacheAfterOEH(oResponse){if(oResponse.isErr())return;if(this._get_State()==States.Loaded)this._set_State(States.Unload)};Owa.UIControls.FolderPickerDialog.prototype._cbClearHtmlCacheAfterCountChanged=function Owa$UIControls$FolderPickerDialog$_cbClearHtmlCacheAfterCountChanged(sFolderId){if(this._get_State()==States.Loaded)this._set_State(States.Unload)};Owa.UIControls.FolderPickerDialog.prototype._onButtonClick=function Owa$UIControls$FolderPickerDialog$_onButtonClick(){if(this.onButtonClick)return this.onButtonClick.apply(this,arguments)};Owa.UIControls.FolderPickerDialog.prototype._onBeforeClose=function Owa$UIControls$FolderPickerDialog$_onBeforeClose(){if(this.onBeforeClose)return this.onBeforeClose.apply(this,arguments)};Owa.UIControls.FolderPickerDialog.prototype._onCheckCustomButtons=function Owa$UIControls$FolderPickerDialog$_onCheckCustomButtons(){if(this.onCheckCustomButtons)return this.onCheckCustomButtons.apply(this,arguments)}})();function calculateScrollBarOnTreeResize(){var oTreeRegion=getTreeRegion(this);Owa.DomUtility.calculateVerticalScrollBar(oTreeRegion)}function errorInfobarSizeChangedInTree(){var oErrorElement=$(this._sErrNm);var oInfobar=oErrorElement.getAncestorById("divInfobar");var iErrorHeight=0;if(oInfobar){iErrorHeight=oInfobar.get_OffsetHeight()}else if(oErrorElement){iErrorHeight=oErrorElement.get_OffsetHeight()}var oTreeRegion=getTreeRegion(this);if(!oErrorElement||!oErrorElement.get_IsShown())iErrorHeight=0;oTreeRegion.set_Top(iErrorHeight);Owa.DomUtility.calculateVerticalScrollBar(oTreeRegion)}function getTreeRegion(oTree){return oTree.root.get_ParentElement().get_ParentElement().get_ParentElement()}function makeTreeScrollArea(oTree){var oTreeRegion=getTreeRegion(oTree);var oDelegate=Owa.Utility.createContextDelegate(oTreeRegion,Owa.DomUtility.calculateVerticalScrollBar,oTreeRegion);Owa.Dom.Window.get_Current().attachEvent("resize",oDelegate);oTree.onResize=calculateScrollBarOnTreeResize;oTree.onErrorInfobarChanged=errorInfobarSizeChangedInTree;Owa.DomUtility.calculateVerticalScrollBar(oTreeRegion)}function unmakeTreeScrollArea(oTree){var oTreeRegion=getTreeRegion(oTree);var oDelegate=Owa.Utility.createContextDelegate(oTreeRegion,Owa.DomUtility.calculateVerticalScrollBar,oTreeRegion);Owa.Dom.Window.get_Current().detachEvent("resize",oDelegate);oTree.onResize=null;oTree.onErrorInfobarChanged=null}g_oEd.attachEvent("RenameFolder",null,"cbFolderChanged");g_oEd.attachEvent("NewFolder",null,"cbNavigationNodeChanged");g_oEd.attachEvent("MoveFolder",null,"cbNavigationNodeChanged");g_oEd.attachEvent("CopyFolder",null,"cbNavigationNodeChanged");g_oEd.attachEvent("UpdateCount",null,"cbFolderUpdateCount");g_oEd.attachEvent("DeleteFolder",null,"cbFolderChanged");g_oEd.attachEvent("EmptyFolder",null,"cbFolderChanged");g_oEd.attachEvent("RemoveFromView",null,"cbFolderChanged");g_oEd.attachEvent("RemoveNavigation",null,"cbFolderChanged");g_oEd.attachEvent("RenameNavigation",null,"cbNavigationNodeChanged");g_oEd.attachEvent("NewNavigation",null,"cbNavigationNodeChanged");function cbFolderChanged(oR){if(oR.isErr())return;updCMM();cchFpdTrH(0,null);cchFpdTrH(1,null)}function cbNavigationNodeChanged(oR){if(oR.isErr())return;cchFpdTrH(0,null);cchFpdTrH(1,null)}function cbFolderUpdateCount(){cchFpdTrH(0,null);cchFpdTrH(1,null)}function shwFPDlg(oArg,cbOnClickButton,oCtx){if(!isDf(typeof(oArg.fP)))oArg.fP=1;if(!isDf(typeof(oArg.iHTr)))oArg.iHTr=300;if(shwFPDlg.fLd)return;var oOehCtx=new Object();oOehCtx.oArg=oArg;oOehCtx.cbOnClickButton=cbOnClickButton;oOehCtx.oFpdCtx=oCtx;var oR=new oeReq("Navigation","GetFolderPickerTree",oOehCtx,cbDownloadFolderPickerTree);oR.add("pTr",oArg.fP);oR.send();shwFPDlg.fLd=1}shwFPDlg.fLd=0;function cbDownloadFolderPickerTree(oR){shwFPDlg.fLd=0;if(!cbOeh(oR))return;var o=oR.oCtx;var o=new FolderPickerDialog(oR.sBody,o.oArg,o.cbOnClickButton,o.oFpdCtx);o.show()}if(!isDf(typeof(wt()._rgFpdTrH)))wt()._rgFpdTrH=[];function cchFpdTrH(fP,sH){wt()._rgFpdTrH[fP?0:1]=sH}var g_sFPDId="divFPD";function FolderPickerDialog(sTrHtml,oArg,cbOnClickButton,oCtx){var iWTr=260;var iMgn=40;var rgB=[L_CrtNewFldElps,oArg.sBtn];var oBDCtx=new Object();oBDCtx.idxNewBtn=0;oBDCtx.onClickButton=cbOnClickButton;oBDCtx.oFpdCtx=oCtx;var oDlg=new BtnDlg(g_sFPDId,sTrHtml,oArg.sTtl,rgB,iWTr+iMgn,null,fpdOnCls,null,0,0,null,null,oBDCtx);oDlg.sBtn=oArg.sBtn;oDlg.fP=oArg.fP;oDlg.iMgn=iMgn;oDlg.gtTr=fpdGtTr;oDlg.fnBDShow=oDlg.show;oDlg.show=fpdShw;oDlg.fnOnBfCls=oArg.cbOnBfCls;var oT=oDlg.gtTr();var oTCntr=oT.parentNode;oDlg.tree=new Owa.UIControls.FolderTree(Owa.Dom.Node.wrapDomNode(oT),1);oTCntr.parentNode.parentNode.parentNode.style.height=oArg.iHTr+"px";oTCntr.parentNode.parentNode.parentNode.style.width=iWTr+"px";makeTreeScrollArea(oDlg.tree);oDlg.tree.onSelChng=fpdTrOnSelNd;oDlg.tree.onAfEdt=fpdTrOnAfEdt;oDlg.tree.onNwFld=fpdSelNwFld;oDlg.tree.onBfEdt=fpdTrOnBfEdt;oT.ondblclick=fpdTrOnDblClk;enbFpdBtns(0);if(oArg.cbOnCrt)oArg.cbOnCrt(oDlg);return oDlg}function fpdSelNwFld(oJN){this.selNd(oJN)}function fpdOnCls(i,oCtx){var fKpOn;var oFpd=getFpd();var oT=oFpd.tree;if(-1==i){fKpOn=oT._edting}else{if(!oT.hsSelNd()){fKpOn=1}else{if(oCtx.idxNewBtn==i){oT.nwFld(oT.gtSelNd(),1,null);fKpOn=1}else if(oCtx.onClickButton){var fD=oT.isAncstr(oT.gtNdByAls(ALP_DFT+DFT_DEL),oT.gtSelNd(),1)?1:0;fKpOn=oCtx.onClickButton([oT.gtSelNd().gtFId(),fD,oT.gtSelNd().gtDspNm(),oT.gtSelNd().gtFCC(),oCtx.oFpdCtx])}}}if(!fKpOn){var sH=oFpd.gtTr().parentNode.parentNode.outerHTML;cchFpdTrH(oFpd.fP,sH.replace(/\r\n/g,""));if(oFpd.fnOnBfCls)oFpd.fnOnBfCls();oT.dispose()}return fKpOn}function fpdTrOnDblClk(e){if(!e)e=getEvt(this);var o=getEvtTgt(e);var oFp=getFpd();var oTr=oFp.tree;var oJN=oTr.gtNd(Owa.Dom.Node.wrapDomNode(o));if(oJN)oFp.getBtn(oFp.sBtn).click()}function enbFpdBtns(fE){if(!wtda(g_sFPDId))return;wtda(g_sFPDId).oDlg.enableButton(L_CrtNewFldElps,fE);wtda(g_sFPDId).oDlg.enableButton(getFpd().sBtn,fE)}function fpdGtTr(){return getOneDescendant(wtda(this.sId),TR)}function fpdShw(){this.fnBDShow();var oTCntr=this.gtTr().parentNode;if(oTCntr)spw(oTCntr.parentNode.parentNode.parentNode,gow(wtda(this.sId))-this.iMgn)}function fpdTrOnSelNd(oJO,oJN){if(!wtda(g_sFPDId))return;wtda(g_sFPDId).oDlg.enableButton(L_CrtNewFldElps,oJN?oJN.canCrt():0);wtda(g_sFPDId).oDlg.enableButton(getFpd().sBtn,oJN?oJN.canHvChld():0)}function fpdTrOnAfEdt(){fpdTrOnSelNd.call(this,null,this.gtSelNd())}function fpdTrOnBfEdt(){enbFpdBtns(0)}function getFpd(){return wtda(g_sFPDId).oDlg}stJS("ctree.js");