Type.createNamespace("Owa.Components");if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\components/pipes.js".toLowerCase()])(function(){Owa.PipeType={Small:1,Large:2};var PipeNode=function PipeNode(oParentElement,oItemPart,stopElement,childConnectorElement){this._oItemPart=oItemPart;this._stopElement=stopElement;this._childConnectorElement=childConnectorElement;this._stopElement.set_IsShown(false);this._childConnectorElement.set_IsShown(false);oParentElement.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,this._stopElement);oParentElement.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,this._childConnectorElement)};PipeNode.prototype.get_StopElement=function PipeNode$prototype$get_StopElement(){return this._stopElement};PipeNode.prototype.get_ChildConnectorElement=function PipeNode$prototype$get_ChildConnectorElement(){return this._childConnectorElement};PipeNode.prototype.get_ItemPart=function PipeNode$prototype$get_ItemPart(){return this._oItemPart};PipeNode.prototype.dispose=function PipeNode$prototype$dispose(){if(this._stopElement){this._stopElement.remove(true)}if(this._childConnectorElement){this._childConnectorElement.remove(true)}};Owa.Components.Pipes=function Owa$Components$Pipes(oParentElement,iType){this._oParentElement=oParentElement;this._rgPipeStops=new Array();this._iType=iType;this._initPipeComponents()};Owa.Components.Pipes.prototype.dispose=function Owa$Components$Pipes$prototype$dispose(){this.clearPipes();this.oPpPH.remove(true);this.oPpPV.remove(true);this.oPsP2.remove(true);this.oPsP1.remove(true);this.oPpA.remove(true);this.oPsA.remove(true);this.oBkg.remove(true);this.oPpPH=null;this.oPpPV=null;this.oPsP2=null;this.oPsP1=null;this.oPpA=null;this.oPsA=null;this.oBkg=null};Owa.Components.Pipes.prototype.drawPipes=function Owa$Components$Pipes$prototype$drawPipes(oItemPart){this.clearPipes();this._rgPipeStops.add(new PipeNode(this._oParentElement,oItemPart,this.oPsP1.clone(true),this.oPpPH.clone(true)));oItemPart=oItemPart.get_ParentItemPart();while(oItemPart!=null){this._rgPipeStops.add(new PipeNode(this._oParentElement,oItemPart,(this._rgPipeStops.get_Length()==1?this.oPsP2:this.oPsA).clone(true),(this._rgPipeStops.get_Length()==1?this.oPpPV:this.oPpA).clone(true)));oItemPart=oItemPart.get_ParentItemPart()}this._oBkg=this.oBkg.clone(true);this._oParentElement.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,this._oBkg);this.updatePipes()};Owa.Components.Pipes.prototype.updatePipes=function Owa$Components$Pipes$prototype$updatePipes(){if(this._rgPipeStops.get_Length()<2){return}var oStopElement=this._rgPipeStops[0].get_StopElement();var oChildConnectorElement=this._rgPipeStops[0].get_ChildConnectorElement();var iPipeStopOffset=(oStopElement.get_Height()-1)/2;var iPipeHorizontalOffset=(oChildConnectorElement.get_Height()-1)/2;var rgPipeConnectorTops=new Array();for(var iPipe=0;iPipe<this._rgPipeStops.get_Length();++iPipe){rgPipeConnectorTops.add(this._rgPipeStops[iPipe].get_ItemPart().get_PipeConnectorTop())}if(rgPipeConnectorTops[0]==rgPipeConnectorTops[1]){return}var iMinTop=rgPipeConnectorTops[0]-iPipeStopOffset;var iMaxTop=iMinTop;oStopElement.set_Top(rgPipeConnectorTops[0]-iPipeStopOffset);oStopElement.set_IsShown(true);oChildConnectorElement.set_Top(rgPipeConnectorTops[0]-iPipeHorizontalOffset);oChildConnectorElement.set_IsShown(true);for(var iPipe=1;iPipe<this._rgPipeStops.get_Length();++iPipe){oStopElement=this._rgPipeStops[iPipe].get_StopElement();oChildConnectorElement=this._rgPipeStops[iPipe].get_ChildConnectorElement();var iTop=rgPipeConnectorTops[iPipe]-iPipeStopOffset;oStopElement.set_Top(iTop);oStopElement.set_IsShown(true);oChildConnectorElement.set_IsShown(true);if(iTop<iMinTop){iMinTop=iTop}if(iTop>iMaxTop){iMaxTop=iTop}var iPrevItemPartPipeOffset=iPipe==1?iPipeHorizontalOffset:iPipeStopOffset;var iPipeHeight=0;if(rgPipeConnectorTops[iPipe]<rgPipeConnectorTops[iPipe-1]){oChildConnectorElement.set_Top(rgPipeConnectorTops[iPipe]+iPipeStopOffset);iPipeHeight=rgPipeConnectorTops[iPipe-1]-rgPipeConnectorTops[iPipe]-(iPrevItemPartPipeOffset+iPipeStopOffset)}else{oChildConnectorElement.set_Top(rgPipeConnectorTops[iPipe-1]+iPrevItemPartPipeOffset);iPipeHeight=rgPipeConnectorTops[iPipe]-rgPipeConnectorTops[iPipe-1]-(iPrevItemPartPipeOffset+iPipeStopOffset)}oChildConnectorElement.set_Height(iPipeHeight>0?iPipeHeight:0)}this._oBkg.set_Top(iMinTop);this._oBkg.set_Height(iMaxTop-iMinTop)};Owa.Components.Pipes.prototype.clearPipes=function Owa$Components$Pipes$prototype$clearPipes(){for(var iPipe=0;iPipe<this._rgPipeStops.get_Length();++iPipe){this._rgPipeStops[iPipe].dispose()}this._rgPipeStops=new Array();if(this._oBkg)this._oBkg.remove(true)};Owa.Components.Pipes.prototype._initPipeComponents=function Owa$Components$Pipes$prototype$_initPipeComponents(){var fL=(this._iType==Owa.PipeType.Large);var sPipePositionClass=Owa.Strings.CssClass.LeftPipe;var sStopPositionClass=fL?Owa.Strings.CssClass.LeftStopLarge:Owa.Strings.CssClass.LeftStopSmall;var sChildStopPositionClass=fL?Owa.Strings.CssClass.LeftChildStopLarge:Owa.Strings.CssClass.LeftChildStopSmall;if(g_fRtl){sPipePositionClass=Owa.Strings.CssClass.RightPipe;sStopPositionClass=fL?Owa.Strings.CssClass.RightStopLarge:Owa.Strings.CssClass.RightStopSmall;sChildStopPositionClass=fL?Owa.Strings.CssClass.RightChildStopLarge:Owa.Strings.CssClass.RightChildStopSmall}var oStop=Owa.Components.CssSprites.getImageElement(fL?"pipe-stop-l.png":"pipe-stop-s.png");var oClr=Owa.Dom.Document.get_Current().createElement("IMG");oClr._get_DomNode().src=getThmF("clear1x1.gif");this.oBkg=oClr.clone();this.oBkg.addCssClass(Owa.Strings.CssClass.PipeBackground);this.oBkg.set_Title(L_PipesTooltip);this.oPsP1=oStop.clone();this.oPsP1.addCssClass(fL?Owa.Strings.CssClass.ParentStopLarge:Owa.Strings.CssClass.ParentStopSmall);this.oPsP2=this.oPsP1.clone();this.oPsP1.addCssClass(sChildStopPositionClass);this.oPsP2.addCssClass(sStopPositionClass);this.oPpPH=oClr.clone();this.oPpPH.addCssClass(Owa.Strings.CssClass.ChildPipe);this.oPpPH.addCssClass(sPipePositionClass);this.oPpPV=oClr.clone();this.oPpPV.addCssClass(Owa.Strings.CssClass.ParentPipe);this.oPpPV.addCssClass(sPipePositionClass);this.oPsA=oStop.clone();this.oPsA.addCssClass(fL?Owa.Strings.CssClass.AncestorStopLarge:Owa.Strings.CssClass.AncestorStopSmall);this.oPsA.addCssClass(sStopPositionClass);this.oPpA=oClr.clone();this.oPpA.addCssClass(Owa.Strings.CssClass.AncestorPipe);this.oPpA.addCssClass(sPipePositionClass)}})();g_fModuleLoaded[".\\components/pipes.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/MediaPlayer.js".toLowerCase()])(function(){var _oInstance=null;var fError=false;Owa.UIControls.MediaPlayer=function Owa$UIControls$MediaPlayer(){Owa.UIControls.MediaPlayer.constructBase(this);try{var oElement=Owa.Dom.Document.get_Current().createElement("OBJECT");var oDomElement=oElement._get_DomNode();oElement.set_Id("oMediaPlayer");oElement.set_IsShown(false);oDomElement.classid="clsid:6BF52A52-394A-11d3-B153-00C04F79FAA6";Owa.Dom.Document.get_Current().appendChild(oElement);if(oDomElement.controls){oDomElement.attachEvent("error",this._createCallback(this._onMediaPlayerError));oDomElement.attachEvent("playstatechange",this._createCallback(this._checkMediaPlayerState));this._initializeDomElement(oElement)}else{oElement.remove(true);fError=true}this._oController=null}catch(e){fError=true}};var _oPrototype=Owa.UIControls.MediaPlayer.prototype;Owa.UIControls.MediaPlayer.get_Instance=function Owa$UIControls$MediaPlayer$get_Instance(){if(!_oInstance&&!fError){_oInstance=new Owa.UIControls.MediaPlayer();Owa.Components.Application.get_RootSubPage().addResource(_oInstance)}if(fError){_oInstance=null;return null}return _oInstance};_oPrototype.get_Controller=function Owa$UIControls$MediaPlayer$get_Controller(){return this._oController};_oPrototype.set_Controller=function Owa$UIControls$MediaPlayer$set_Controller(oController){if(this._oController==oController)return;if(this.isPlaying())this.stop();var oContext={};oContext.oOldController=this._oController;oContext.oNewController=oController;this.reset();this._oController=oController};_oPrototype.reset=function Owa$UIControls$MediaPlayer$reset(){if(this.isPlaying())this.stop();this._oController=null;this.get_OnError().clear();this.get_OnStop().clear();this.get_OnComplete().clear()};_oPrototype._get_MediaPlayer=function Owa$UIControls$MediaPlayer$_get_MediaPlayer(){return this._get_Element()._get_DomNode()};_oPrototype._onMediaPlayerError=function Owa$UIControls$MediaPlayer$_onMediaPlayerError(){var oMediaPlayer=this._get_MediaPlayer();var iErrorCount=oMediaPlayer.Error.errorCount;if(iErrorCount>0)this._dispatchEvent(ON_ERROR)};_oPrototype._checkMediaPlayerState=function Owa$UIControls$MediaPlayer$_checkMediaPlayerState(){var oMediaPlayer=this._get_MediaPlayer();var iPlayState=null;try{iPlayState=oMediaPlayer.playState}catch(e){}switch(iPlayState){case 1:this._dispatchEvent(ON_STOP);break;case 8:this._dispatchEvent(ON_COMPLETE);break}};_oPrototype.isPlaying=function Owa$UIControls$MediaPlayer$isPlaying(){var oMediaPlayer=this._get_MediaPlayer();return oMediaPlayer.playState==3||oMediaPlayer.playState==6};_oPrototype.play=function Owa$UIControls$MediaPlayer$play(sUrl){var oMediaPlayer=this._get_MediaPlayer();oMediaPlayer.URL=sUrl};_oPrototype.stop=function Owa$UIControls$MediaPlayer$stop(){try{this._get_MediaPlayer().controls.stop();this._dispatchEvent(ON_STOP)}catch(e){}};var ON_COMPLETE="OnComplete";var ON_STOP="OnStop";var ON_ERROR="OnError";_oPrototype.get_OnComplete=function Owa$UIControls$MediaPlayer$get_OnComplete(){return this._getEventHandlerCollection(ON_COMPLETE)};_oPrototype.get_OnStop=function Owa$UIControls$MediaPlayer$get_OnStop(){return this._getEventHandlerCollection(ON_STOP)};_oPrototype.get_OnError=function Owa$UIControls$MediaPlayer$get_OnError(){return this._getEventHandlerCollection(ON_ERROR)};Owa.UIControls.MediaPlayer.createClass("Owa.UIControls.MediaPlayer",Owa.UIControls.UIControl)})();g_fModuleLoaded[".\\uicontrols/MediaPlayer.js".toLowerCase()]=1;(function(){var ns=Owa.UIControls;var Utility=Owa.Utility;var Document=Owa.Dom.Document;var Node=Owa.Dom.Node;var VR="vr";var SR="sr";var VER="ver";var IL="divVLVIL";var LIST="divList";var VP="divViewport";var SCR="divScrollbar";var SCROLL_REGION="divScrollRegion";var HDRS="divHeaders";var CATEGORY_CELL="divCat";var CATEGORY_GROUP="divCatGroup";var FLAG_CELL="divFlg";var PROGRESS_BACKGROUND="divPrgBg";var PROGRESS_INDICATOR="divPrgrs";var CHUNK="divChnk";var FILTER_BACKGROUND="divFltrBg";var SELECTED="sel";var SELECTED_EXPANSION_ROW="vlvExpSel";var SELECTED_CONVERSATION="vlvFamSel";var HOVER="vlvHvr";var CHNK_SZ=50;var MAX_CHNK_SZ=99;var SCR_WAIT=100;var SCR_THRESH=4;var SAFARI_SCROLL=40;var FF_MAC_SCROLL=15;var FF_WIN_SCROLL=13;var MAX_SCROLL_HEIGHT=1300000;var PRGRS_DLY=1100;var TD_DLY=1000;var DRAG_DELAY=200;var PRELOAD_DELAY=1000;var CONSECUTIVE_NAVIGATION_DELAY=400;var LD_NONE=1;var LD_FRSH=2;var LD_NXT=3;var LD_PRV=4;var PRG_LD=0;var PRG_SRCH=1;var PRG_FLTR=2;var PRG_NONE=3;var RET_VW=2;var LEFT=37;var UP=38;var RIGHT=39;var DOWN=40;var PONT_DELCNV=64;var PONT_FILTEREDBYUNREAD=512;var PP_OFFST=9;var LOAD_FRESH="ldFrsh";var LOAD_ADJACENT="ldAdj";var SORT="srt";var TYPEDOWN="tdSrch";var SEEK="ldSk";var PP="pP";var NP="nP";var ROW_NOTIFICATION="rowNotification";var ROW_ADDED="3";var ROW_DELETED="4";var ROW_MODIFIED="5";var LOAD_PRIORITY={};LOAD_PRIORITY[PP]=LOAD_PRIORITY[NP]=LOAD_PRIORITY[LOAD_ADJACENT]=LOAD_PRIORITY[ROW_NOTIFICATION]=0;LOAD_PRIORITY[LOAD_FRESH]=1;LOAD_PRIORITY[TYPEDOWN]=LOAD_PRIORITY[SEEK]=2;LOAD_PRIORITY[SORT]=3;var ConversationSortColumn={"ConversationLastDeliveryTime":82,"ConversationMVFrom":87,"ConversationMVTo":94,"ConversationTopic":84,"ConversationHasAttach":86,"ConversationImportance":88,"ConversationSize":90,"ConversationFlagStaus":91,"ConversationMessageClasses":83};var MessageSortColumn={"Date":7,"SentDate":8,"From":1,"To":2,"Subject":3,"HasAttachment":5,"Importance":6,"Size":9,"FlagDueDate":67,"FlagStartDate":68,"Type":0};var CONVERSATION_ID_PREFIX="CID";var ARCHIVE_CONVERSATION_ID_PREFIX="ACI";RowPosition=function RowPosition(iRow,iSubRow){if(!iRow)iRow=0;if(!iSubRow)iSubRow=0;this.iRow=iRow;this.iSubRow=iSubRow};RowPosition.prototype.equals=function RowPosition$prototype$equals(oRight){if(oRight!=null){return oRight.iRow==this.iRow&&oRight.iSubRow==this.iSubRow}return false};RowInfo=function RowInfo(oRow,oRowPosition,iViewPortOffset,iChunkOffset,sSectionHeaderText,sRowId,sInstanceKey,iCacheIndex){this.oRow=oRow;this.oRowPosition=oRowPosition;this.iViewPortOffset=iViewPortOffset;this.iChunkOffset=iChunkOffset;this.sSectionHeaderText=sSectionHeaderText;this.sId=oRow.get_Id();this.sRowId=sRowId;this.sInstanceKey=sInstanceKey;this.iCacheIndex=iCacheIndex};Owa.UIControls.VLV=function Owa$UIControls$VLV(oSubPage,oElement){Owa.UIControls.VLV.constructBase(this,[oElement]);this.set_SubPage(oSubPage);this.iT=oElement.getIntAttribute("iT");this.sEvtNS=oElement.getAttribute("sEvtNS");this.sSid=oElement.getAttribute("sSid");this.sDataFolderId=null;this.fML=oElement.getIntAttribute("fML");this.iSC=oElement.getIntAttribute("iSC");this.iSO=oElement.getIntAttribute("iSO");this.iWP=getInt(oElement.getAttribute("iWP"));this.iTC=oElement.getIntAttribute("iTC");this.iTIC=oElement.getIntAttribute("iTIC");this.fROLv=!!getInt(oElement.getAttribute("fROLv"));this.iNsDir=oElement.getIntAttribute("iNsDir");this.oCurRowPosition=new RowPosition(0,0);this.iScrollTimer=0;this.oScrollRowPosition=null;this.fPndLd=0;this.rgPndLd=new Array();this.iH=oElement.get_ClientHeight();this.oSel={};this.sSelA=0;this.sNextSelA=0;this.sLstSel=0;this.iPrgT=0;this.fIgnScr=0;this.fTD=getInt(oElement.getAttribute("fTD"));this.sTD="";this.iTDTmr=0;this.iDragTimer=0;this.iScrTp=this._getDescendant(SCR).get_ScrollTop();this.iDragTimer=0;this._iTypicalRowHeight=-1;this._iGHHeight=0;this._rgRowInfos=null;this._oIdToRow=null;this._oInstanceKeyToRow=null;this._rgHeaderRows=null;this._oConsecutiveNavigationTimer=null;this._iStoredViewportPosition=-1;this._rgRowNotification=[];this._oRowNotificationQueueTimer=null;this._fnOnShow=null;this.fSrchInProg=0;this._iLastLoadActionTime=0;var iFilterTemp=getInt(oElement.getAttribute("iFltr"));this.iFltr=iFilterTemp?iFilterTemp:0;var sExpandos=oElement.getAttribute("sPbPrps");if(sExpandos.length)this.rgPbPrps=sExpandos.split(";");this.fSrch=0};Owa.UIControls.VLV.createClass("Owa.UIControls.VLV",Owa.UIControls.UIControl);var VLV=ns.VLV.prototype;Owa.UIControls.VLV.prototype.initialize=function Owa$UIControls$VLV$initialize(){Owa.UIControls.VLV.callBase(this,"initialize");var oViewport=this._getDescendant(VP);var oScrollbar=this._getDescendant(SCR);var oVLV=this._get_Element();var oHeaders=this._getDescendant(HDRS);this.initChnk(oViewport.get_FirstChild());this.updScr();var oLV=this;this._attachEvent(oScrollbar,"scroll",function(oEvent){oLV.onScr(oEvent)});this._attachEvent(oVLV,"mousewheel",function(oEvent){oLV.onMWhl(oEvent)});this._attachEvent(oViewport,"contextmenu",function(oEvent){oLV.onCMVP(oEvent)});this._attachEvent(oHeaders,"contextmenu",function(oEvent){oLV.onCMHdr(oEvent)});this._attachEvent(oViewport,"click",function(oEvent){oLV.onClkVP(oEvent)});this._attachEvent(oHeaders,"click",function(oEvent){oLV.onClkHdr(oEvent)});this._attachEvent(oViewport,"dblclick",function(oEvent){oLV.onDblClkVP(oEvent)});this._attachEvent(oViewport,"mousedown",function(oEvent){oLV.onMD(oEvent)});this._attachEvent(oViewport,"mouseup",function(oEvent){oLV.onMU(oEvent)});this._attachEvent(oViewport,"mousemove",function(oEvent){oLV.onMouseMove(oEvent)});this._attachEvent(oViewport,"mouseout",function(oEvent){oLV.onMouseMove(oEvent)});this._attachEvent(oViewport,"dragstart",function(oEvent){oLV.onDS(oEvent)});this._attachEvent(oVLV,"resize",function(oEvent){oLV.onRsz(oEvent)});Owa.Components.Storage.DragDrop.enableDNDInFireFox(oViewport);var oDocument=Document.get_Current();this._attachEvent(oDocument,"keypress",function(oEvent){oLV.onKP(oEvent)});this.get_SubPage().get_KeyDownPage().add(this._createCallback(this.onKD));var rgR=this.gtRws();if(rgR.get_Length()>0)this.selSngl(rgR.get_Item(0));this._iPreloadTimer=this._setTimeout(this.prld,PRELOAD_DELAY)};Owa.UIControls.VLV.prototype.dispose=function Owa$UIControls$VLV$dispose(){this.onErr=null;this.onNav=null;this.onBRfrsh=null;this.onSelChg=null;this.onRmvRws=null;this.isReadingPaneOn=null;this.stGtSF=null;Owa.UIControls.VLV.callBase(this,"dispose")};Owa.UIControls.VLV.prototype.stOnErr=function Owa$UIControls$VLV$stOnErr(fn){this.onErr=fn};Owa.UIControls.VLV.prototype.stOnNav=function Owa$UIControls$VLV$stOnNav(fn){this.onNav=fn};Owa.UIControls.VLV.prototype.stOnBRfrsh=function Owa$UIControls$VLV$stOnBRfrsh(fn){this.onBRfrsh=fn};Owa.UIControls.VLV.prototype.stOnERfrsh=function Owa$UIControls$VLV$stOnERfrsh(fn){this.onERfrsh=fn};Owa.UIControls.VLV.prototype.stOnSelChg=function Owa$UIControls$VLV$stOnSelChg(fn){this.onSelChg=fn};Owa.UIControls.VLV.prototype.stOnRowNotification=function Owa$UIControls$VLV$stOnRowNotification(fn){this.onRowNotification=fn};Owa.UIControls.VLV.prototype.stOnRmvRws=function Owa$UIControls$VLV$stOnRmvRws(fn){this.onRmvRws=fn};Owa.UIControls.VLV.prototype.stReadingPaneOn=function Owa$UIControls$VLV$stReadingPaneOn(fn){this.isReadingPaneOn=fn};Owa.UIControls.VLV.prototype._get_IsShown=function Owa$UIControls$VLV$_get_IsShown(){return this.get_SubPage().get_IsShown()};Owa.UIControls.VLV.prototype.onShowHide=function Owa$UIControls$VLV$onShowHide(fShow){if(fShow){if(this._fnOnShow){this._fnOnShow();this._fnOnShow=null}if(this.fPndUpd){this.clearRowCache();this.updVwprt()}}};Owa.UIControls.VLV.prototype.stCM=function Owa$UIControls$VLV$stCM(o,fnOnSelect,fnOnDataBind){var onSelectCM=function Owa$UIControls$VLV$stCM$onSelectCM(oEventArgs){fnOnSelect(oEventArgs.sCommand,oEventArgs.oMenuItem)};this.oCM=this.addResource(Owa.UIControls.ContextMenu.create(Owa.Dom.Node.wrapDomNode(o),null,this.get_SubPage()));this.oCM.get_OnSelect().add(onSelectCM);this.oCM.get_OnDataBind().add(fnOnDataBind)};Owa.UIControls.VLV.prototype.get_ContextMenu=function Owa$UIControls$VLV$get_ContextMenu(){return this.oCM};Owa.UIControls.VLV.prototype.stABM=function Owa$UIControls$VLV$stABM(o){this.oABMDiv=Node.wrapDomNode(o);var oLV=this;var fn=function(oEventArgs){oLV.onClkABM(oEventArgs)};this.oABM=this.addResource(Owa.UIControls.ContextMenu.create(this.oABMDiv,null,this.get_SubPage()));this.oABM.get_OnSelect().add(fn)};Owa.UIControls.VLV.prototype.stGtSF=function Owa$UIControls$VLV$stGtSF(fn){this.fnGtSF=fn};Owa.UIControls.VLV.prototype.get_SearchControl=function Owa$UIControls$VLV$get_SearchControl(){return this.get_SubPage().get_SearchControl()};Owa.UIControls.VLV.prototype.get_FolderId=function Owa$UIControls$VLV$get_FolderId(){return this.get_SubPage().get_FolderId()};Owa.UIControls.VLV.prototype.get_ItemIdInReadingPane=function Owa$UIControls$VLV$get_ItemIdInReadingPane(){return this.get_SubPage().get_ItemIdInReadingPane()};Owa.UIControls.VLV.prototype.get_IsSearch=function Owa$UIControls$VLV$get_IsSearch(){return this.get_SubPage().getSubPageVariable("a_fSrch")};Owa.UIControls.VLV.prototype.find=function Owa$UIControls$VLV$find(){this.fSrch=1;this.clrSel(1);var oLV=this;var fn=function(){var rgR=oLV.gtRws();if(rgR.get_Length()>0)oLV.selSngl(rgR.get_Item(0))};this.ldFrsh(0,PRG_SRCH,1,fn)};Owa.UIControls.VLV.prototype.clrFind=function Owa$UIControls$VLV$clrFind(fSR){this.fSrch=0;if(!fSR){this.ldFrsh(0,PRG_LD,1)}};Owa.UIControls.VLV.prototype.gtVPH=function Owa$UIControls$VLV$gtVPH(){if(!this.iVPH){var oVP=this._getDescendant(VP);this.iVPH=oVP.get_ClientHeight()}return this.iVPH};Owa.UIControls.VLV.prototype.getViewportPosition=function Owa$UIControls$VLV$getViewportPosition(){var fAlreadyIgnoring=this.fIgnScr;this.fIgnScr=1;var oViewport=this._getDescendant(VP);var iViewportPosition=oViewport.get_ScrollTop();if(!fAlreadyIgnoring){this.fIgnScr=0}return iViewportPosition};Owa.UIControls.VLV.prototype._storeViewportPosition=function Owa$UIControls$VLV$_storeViewportPosition(){if(this._iStoredViewportPosition<0){this._iStoredViewportPosition=this.getViewportPosition()}else{throw new Error("Trying to store viewport position before it has been reset")}};Owa.UIControls.VLV.prototype._resetViewportPosition=function Owa$UIControls$VLV$_resetViewportPosition(iCompensation){if(!isDf(typeof(iCompensation))){iCompensation=0}var fAlreadyIgnoring=this.fIgnScr;this.fIgnScr=1;var oViewport=this._getDescendant(VP);oViewport.set_ScrollTop(this._iStoredViewportPosition+iCompensation);this._iStoredViewportPosition=-1;if(!fAlreadyIgnoring){this.fIgnScr=0}};Owa.UIControls.VLV.prototype._isPushNotificationSupported=function Owa$UIControls$VLV$_isPushNotificationSupported(){return false};Owa.UIControls.VLV.prototype.gtRwPrp=function Owa$UIControls$VLV$gtRwPrp(sId,sP,oDf){var oR=this.gtRwById(sId);if(oR){var o=this.gtPrpV(oR,sP);return(o!==null)?o:oDf}else{var o=this.oSel[sId];return o?o[sP]:oDf}};Owa.UIControls.VLV.prototype.stRwPrp=function Owa$UIControls$VLV$stRwPrp(sId,sP,oV){if(this.oSel[sId])this.oSel[sId][sP]=oV;var oR=this.gtRwById(sId);if(oR)this.getData(oR).setAttribute(sP,String(oV))};Owa.UIControls.VLV.prototype.stML=function Owa$UIControls$VLV$stML(fML){if(this.fML==fML)return;this.fML=fML;this.ldFrsh(this.oCurRowPosition.iRow,PRG_LD,0,0,0,"SetML")};Owa.UIControls.VLV.prototype.isFltrd=function Owa$UIControls$VLV$isFltrd(){return this.fSrch};Owa.UIControls.VLV.prototype.gtTC=function Owa$UIControls$VLV$gtTC(){return this.iTC};Owa.UIControls.VLV.prototype.gtTIC=function Owa$UIControls$VLV$gtTIC(){return this.iTIC};Owa.UIControls.VLV.prototype.isEmpty=function Owa$UIControls$VLV$gtTC(){return(this.iTC==0)};Owa.UIControls.VLV.prototype.isTskVw=function Owa$UIControls$VLV$isTskVw(){return(this.iT==LVT_TSK)};Owa.UIControls.VLV.prototype.isDumpsterVw=function Owa$UIControls$VLV$isDumpsterVw(){return(this.iT==LVT_DMP)};Owa.UIControls.VLV.prototype.isML=function Owa$UIControls$VLV$isML(){return this.fML};Owa.UIControls.VLV.prototype.isFldr=function Owa$UIControls$VLV$isFldr(){return 0};Owa.UIControls.VLV.prototype.gtFltr=function Owa$UIControls$VLV$gtFltr(){return this.iFltr};Owa.UIControls.VLV.prototype.stFltr=function Owa$UIControls$VLV$stFltr(i){this.iFltr=i};Owa.UIControls.VLV.prototype.get_DataFolderId=function Owa$UIControls$VLV$get_DataFolderId(){return(this.sDataFolderId?this.sDataFolderId:this.sSid)};Owa.UIControls.VLV.prototype.isAsyncSrchEnabled=function Owa$UIControls$VLV$isAsyncSrchEnabled(){var fEnabled=0;var oRootWin=Owa.Utility.getRootOwaWindow();var oTopWin=Owa.Dom.Window.get_Current().get_TopWindow();if(this.isFldr()&&oTopWin.equals(oRootWin)&&oRootWin.getGlobalVariable("a_fStPg")&&oRootWin.getGlobalVariable("a_fPushNotif")){fEnabled=1}return fEnabled};Owa.UIControls.VLV.prototype.isPushNotificationEnabled=function Owa$UIControls$VLV$isPushNotificationEnabled(){var fEnabled=0;var oRootWin=Owa.Utility.getRootOwaWindow();var oTopWin=Owa.Dom.Window.get_Current().get_TopWindow();if(this._isPushNotificationSupported()&&oTopWin.equals(oRootWin)&&oRootWin.getGlobalVariable("a_fStPg")&&oRootWin.getGlobalVariable("a_fPushNotif")){fEnabled=1}return fEnabled};Owa.UIControls.VLV.prototype.gtSel=function Owa$UIControls$VLV$gtSel(){var rg=[];for(var sId in this.oSel){if(this.oSel[sId].fSel){rg.push(sId)}}return rg};Owa.UIControls.VLV.prototype.gtSelCnt=function Owa$UIControls$VLV$gtSelCnt(){var iC=0;for(var s in this.oSel){if(this.oSel[s].fSel){iC++}}return iC};Owa.UIControls.VLV.prototype.rfrsh=function Owa$UIControls$VLV$rfrsh(fA,sRId,fForceRefresh){this.ldFrsh(this.oCurRowPosition.iRow,fA?PRG_NONE:PRG_LD,0,0,0,0,fA,sRId,fForceRefresh)};Owa.UIControls.VLV.prototype.onBeforeRemoveRows=function Owa$UIControls$VLV$onBeforeRemoveRows(rgId){for(var i=0;i<rgId.length;i++){this.stRwPrp(rgId[i],"deleting","1")}};Owa.UIControls.VLV.prototype.rmvRws=function Owa$UIControls$VLV$rmvRws(rgId,sCtx,fNI){this.feRmvRws();var oNxtSel;if(fNI!=-1){if(!sCtx){fNI=this.iNsDir}oNxtSel=this.gtSelAftrRmv(fNI,rgId)}var idsToDelete=Array();if(this.isCnvVw&&this.isCnvVw()&&(this.iSC==ConversationSortColumn.ConversationMVFrom||this.iSC==ConversationSortColumn.ConversationMVTo||this.iSC==ConversationSortColumn.ConversationMessageClasses)){for(var k=0;k<rgId.get_Length();k++){var rgIdParts=rgId[k].split(".");if(rgIdParts&&(rgIdParts[0]==CONVERSATION_ID_PREFIX||rgIdParts[0]==ARCHIVE_CONVERSATION_ID_PREFIX)){for(var j=0;j<this._rgRowInfos.get_Length();j++){var rgIdPartsForRow=this._rgRowInfos[j].sRowId.split(".");if(rgIdPartsForRow&&(rgIdPartsForRow[0]==CONVERSATION_ID_PREFIX||rgIdPartsForRow[0]==ARCHIVE_CONVERSATION_ID_PREFIX)){if(rgIdParts[1]==rgIdPartsForRow[1]){idsToDelete.add(this._rgRowInfos[j].sRowId)}}}}else{idsToDelete.add(rgId[k])}}}else{idsToDelete=rgId}var fRowSelected=this.oSel[idsToDelete.get_Item(0)];for(var i=0;i<idsToDelete.get_Length();++i){this.rmvRw(idsToDelete.get_Item(i),true)}if(!this.gtSelCnt()&&oNxtSel){this.selSngl(oNxtSel);this.scrToVwprt(oNxtSel)}else if(fRowSelected){this.feSelChg(idsToDelete.get_Item(0))}if(sCtx){this.feNav(sCtx)}if(!this.isFltrd()){this.updScr();this.updVwprt()}return(sCtx&&fNI==RET_VW)};Owa.UIControls.VLV.prototype.updCnts=function Owa$UIControls$VLV$updCnts(oR){};Owa.UIControls.VLV.prototype.crtDC=function Owa$UIControls$VLV$crtDC(){var rg=this.gtSel();return this.crtItmsDC(rg)};Owa.UIControls.VLV.prototype.crtItmsDC=function Owa$UIControls$VLV$crtItmsDC(rgItemId){if(rgItemId.length<1)return;var oDraggableObject=Owa.Components.Storage.StorableObject.create(this.isCnvVw&&this.isCnvVw()&&!this.isSelExp()?Owa.Components.DraggableObjects.Type.Conversations:Owa.Components.DraggableObjects.Type.Items);var oRootElement=oDraggableObject.get_RootElement();var fCrossFolder=false;oRootElement.set_FolderId(this.get_DataFolderId());for(var i=0;i<rgItemId.length;i++){var oItem=oRootElement.createOne_Item();oItem.set_ItemId(rgItemId[i]);if(chkMime()){oItem.set_UrlEncItemId(urlEnc(rgItemId[i]))}oItem.set_ItemType(this.gtRwPrp(rgItemId[i],"t"));oRootElement.append_Item(oItem);fCrossFolder=fCrossFolder||this.isXF&&this.isXF(this.gtRwById(rgItemId[i]))}if(fCrossFolder)oRootElement.set_IsCrossFolder(true);return oDraggableObject};Owa.UIControls.VLV.prototype.selRwById=function Owa$UIControls$VLV$selRwById(sId){var oR=this.gtRwById(sId);if(oR)this.selSngl(oR)};Owa.UIControls.VLV.prototype.selNPRw=function Owa$UIControls$VLV$selNPRw(sId,sCtx,fNI,fF){var oR=this.gtNPRw(sId,fNI);if(!oR){if(this.selectAtDataSetLimit(fNI)){return}if(fF){if(sCtx)this.feNav(sCtx,1)}else{var oLV=this;var fn=function(){oLV.selNPRw(sId,sCtx,fNI,1)};this.ldSk(sId,fNI,fn)}return}this.selSngl(oR,false,true);this.scrToVwprt(oR);if(sCtx)this.feNav(sCtx)};Owa.UIControls.VLV.prototype.gtNPRw=function Owa$UIControls$VLV$gtNPRw(sId,fNI){var oOriginalRowInfo=this._getOIdToRow()[sId];if(oOriginalRowInfo==null){return}var iIncrement=fNI?1:-1;var iCacheIndex=oOriginalRowInfo.iCacheIndex+iIncrement;var rgRowInfos=this.getRowInfos();while(iCacheIndex>=0&&iCacheIndex<rgRowInfos.length){var oNPRowInfo=rgRowInfos[iCacheIndex];if(oNPRowInfo.sId!=SR){return oNPRowInfo.oRow}iCacheIndex+=iIncrement}};Owa.UIControls.VLV.prototype.selectAtDataSetLimit=function Owa$UIControls$VLV$selectAtDataSetLimit(fNI,fRangeSelect){var oLastSelectedRowInfo=this._getOIdToRow()[this.sLstSel];if(oLastSelectedRowInfo){var oLastSelectedRowPosition=oLastSelectedRowInfo.oRowPosition;if(!this.iTC||(!fNI&&oLastSelectedRowPosition.iRow==0)||(fNI&&oLastSelectedRowPosition.iRow==this.iTC-1)){if(!fRangeSelect){var oR=this.gtRw(oLastSelectedRowPosition.iRow,oLastSelectedRowPosition.iSubRow);if(oR){this.selSngl(oR,false,true)}}return true}}return false};Owa.UIControls.VLV.prototype.seekRw=function Owa$UIControls$VLV$seekRw(sId,fSuppressLoad){var oR=this.gtRwById(sId);if(oR){this.scrToVwprt(oR)}else if(!fSuppressLoad){var fnCallback=function(oLV,oResponse){oLV.seekRw(sId,1)};this.ldSk(sId,1,fnCallback)}};Owa.UIControls.VLV.prototype.fP=function Owa$UIControls$VLV$fP(fRng){var oLV=this;var fn=function(){oLV.cbFLP(0,fRng)};this.ldFrsh(0,0,1,fn)};Owa.UIControls.VLV.prototype.lP=function Owa$UIControls$VLV$lP(fRng){var oLV=this;var fn=function(){oLV.cbFLP(1,fRng)};this.ldFrsh(this.iTC-1,0,1,fn)};Owa.UIControls.VLV.prototype.cbFLP=function Owa$UIControls$VLV$cbFLP(fL,fRng){var rg=this.gtRws();if(rg.get_Length()){var oR=fL?rg.get_Item(rg.get_Length()-1):rg.get_Item(0);if(fRng)this.selRng(oR);else this.selSngl(oR)}if(fL&&this.iTC-1==this.ER()){this.posVwprt(new RowPosition(this.iTC-1,0));this.updScr()}};Owa.UIControls.VLV.prototype.pP=function Owa$UIControls$VLV$pP(fRng,fNoSel){if(!this.iTC)return;var oVP=this._getDescendant(VP);var iVPPosition=this.getViewportPosition();var iVPH=this.gtVPH();var oRowPosition=new RowPosition();if(iVPPosition==0){oRowPosition=new RowPosition(0,0)}else if(iVPPosition>iVPH){var iRwOffst=iVPPosition-iVPH+(this.gtRw(this.oCurRowPosition.iRow,this.oCurRowPosition.iSubRow)).get_OffsetHeight();oRowPosition=this.getFirstRowAfterHeight(iRwOffst)}else if(this.SR()!=0){this.prld();if(this.fPndLd)this.enqOp(PP,arguments);return}this.posVwprt(oRowPosition);this.updScr();if(!fNoSel){var oR=this.gtRw(oRowPosition.iRow);if(fRng)this.selRng(oR);else this.selSngl(oR,false,true)}this.prld()};Owa.UIControls.VLV.prototype.nP=function Owa$UIControls$VLV$nP(fRng,fNoSel){if(!this.iTC)return;var oVP=this._getDescendant(VP);var iVPH=this.gtVPH();var iDH=this.gtDtaHt();var iRwOffst=this.getViewportPosition()+iVPH;var oRowPosition=new RowPosition();if(iDH>iRwOffst){oRowPosition=this.getLastVisibleRow()}else if(this.ER()==this.iTC-1){oRowPosition=new RowPosition(this.iTC-1,0)}else{this.prld();if(this.fPndLd)this.enqOp(NP,arguments);return}this.posVwprt(oRowPosition);this.updScr();if(!fNoSel){var oLastVisibleRowPosition=this.getLastVisibleRow();var oR=this.gtRw(oLastVisibleRowPosition.iRow);if(oLastVisibleRowPosition.iRow<this.iTC-1&&oLastVisibleRowPosition.iRow>this.oCurRowPosition.iRow&&oLastVisibleRowPosition.iSubRow==0){var oNextR=oR.get_NextSibling();if(oNextR&&!this.isRowHeading(oNextR)){oR=this.gtRw(oLastVisibleRowPosition.iRow-1)}}if(fRng)this.selRng(oR);else this.selSngl(oR,false,true)}this.prld()};Owa.UIControls.VLV.prototype.feBRfrsh=function Owa$UIControls$VLV$feBRfrsh(fA){if(this.onBRfrsh)this.onBRfrsh(fA)};Owa.UIControls.VLV.prototype.feERfrsh=function Owa$UIControls$VLV$feERfrsh(spnSR){if(this.onERfrsh)this.onERfrsh(spnSR)};Owa.UIControls.VLV.prototype.feSelChg=function Owa$UIControls$VLV$feSelChg(sId,fForceRpUd){this._clearConsecutiveNavigationTimer();if(this.onSelChg){var oE={};if(sId){oE.sMid=sId;if(this.oSel[sId]){oE.fSel=this.oSel[sId].fSel}}if(fForceRpUd){oE.fForceRpUd=fForceRpUd}this.onSelChg(oE)}};Owa.UIControls.VLV.prototype.feNav=function Owa$UIControls$VLV$feNav(sCtx,fCb){if(this.onNav){var oE={};if(sCtx)oE.oCtx=sCtx;if(fCb)oE.fCl=fCb;this.onNav(oE)}};Owa.UIControls.VLV.prototype.feRmvRws=function Owa$UIControls$VLV$feRmvRws(){if(this.onRmvRws)this.onRmvRws()};Owa.UIControls.VLV.prototype.onClkHdr=function Owa$UIControls$VLV$onClkHdr(oEvent){var o=oEvent.get_Target();var oH=o.getAncestorById("col",HDRS);if(oH&&oH.getAttribute("sO")){this.srt(oH.getIntAttribute("cId"),oH.getIntAttribute("sO"));this.fTD=getInt(oH.getAttribute("tD"))}oH=o.getAncestorById("tdSO",HDRS);if(oH&&oH.getAttribute("sO"))this.srt(this.iSC,oH.getIntAttribute("sO"));if(o.getAncestorById("tdAB",HDRS)&&this.oABM)this.oABM.showAtEvent(oEvent)};Owa.UIControls.VLV.prototype.onClkABM=function Owa$UIControls$VLV$onClkABM(oEventArgs){if(!oEventArgs.oMenuItem)return;var o=oEventArgs.oMenuItem;this.srt(o.getIntAttribute("_cid"),o.getIntAttribute("_so"));this.fTD=getInt(o.getAttribute("_tD"))};Owa.UIControls.VLV.prototype.onScr=function Owa$UIControls$VLV$onScr(oEvent){if(this.fIgnScr)return;var oR=this.gtRwFrmScr();if(this.iScrollTimer&&(Math.abs(this.oScrollRowPosition.iRow-oR.iRow)>SCR_THRESH)){this._clearTimeout(this.iScrollTimer);this.iScrollTimer=0}if(!this.iScrollTimer){this.iScrollTimer=this._setTimeout(this.calculateScrolling,SCR_WAIT);this.oScrollRowPosition=oR}};Owa.UIControls.VLV.prototype.calculateScrolling=function Owa$UIControls$VLV$calculateScrolling(){if(this.iScrollTimer){this._clearTimeout(this.iScrollTimer);this.iScrollTimer=0}var oS=this._getDescendant(SCR);var iScrollChange=oS.get_ScrollTop()-this.iScrTp;var iScrollbarHeight=oS.get_OffsetHeight();var iScrollChangePercentage=iScrollChange/iScrollbarHeight;if(Math.abs(iScrollChangePercentage)<=0.01)return;if(Utility.isIE()&&Math.abs(iScrollChangePercentage)>0.11&&Math.abs(iScrollChangePercentage)<0.13||Utility.isSafari()&&Math.abs(iScrollChange)==SAFARI_SCROLL||Utility.isFirefox()&&Utility.isMac()&&Math.abs(iScrollChange)==FF_MAC_SCROLL||Utility.isFirefox()&&Utility.isWin()&&Math.abs(iScrollChange)==FF_WIN_SCROLL){this.scrollSingleRow(iScrollChangePercentage>0);return}if(Utility.isIE()&&Math.abs(iScrollChangePercentage)>0.86&&Math.abs(iScrollChangePercentage)<0.88||Utility.isSafari()&&Math.abs(iScrollChange)==(iScrollbarHeight-SAFARI_SCROLL)||Utility.isFirefox()&&Utility.isMac()&&Math.abs(iScrollChange)==(iScrollbarHeight-FF_MAC_SCROLL)||Utility.isFirefox()&&Utility.isWin()&&Math.abs(iScrollChange)==(iScrollbarHeight-FF_WIN_SCROLL)){if(iScrollChangePercentage<0)this.pP(0,1);else this.nP(0,1);return}var oRowPosition=this.gtRwFrmScr();if(oRowPosition.iRow==0&&oRowPosition.iSubRow==0&&iScrollChangePercentage>0){this.scrollSingleRow(iScrollChangePercentage>0);return}this.iScrTp=oS.get_ScrollTop();this.updVwprt()};Owa.UIControls.VLV.prototype.onMWhl=function Owa$UIControls$VLV$onMWhl(oEvent){var iD=oEvent.get_WheelDirection();this.scrollSingleRow(iD>0);oEvent.preventDefault();oEvent.cancelBubble()};Owa.UIControls.VLV.prototype.onClkVP=function Owa$UIControls$VLV$onClkVP(oEvent){oEvent.preventDefault();oEvent.cancelBubble()};Owa.UIControls.VLV.prototype.onDblClkVP=function Owa$UIControls$VLV$onDblClkVP(oEvent){var oR=this.fndRw(oEvent.get_Target());if(!oR)return;this.feNav()};Owa.UIControls.VLV.prototype.onMD=function Owa$UIControls$VLV$onMD(oEvent){this.oMU=0;var oR=this.fndRw(oEvent.get_Target());if(!oR)return;if(this.isSel(oR)&&!oEvent.isShiftKeyDown()){this.oMU={};this.oMU.fCtrl=oEvent.isCtrlKeyDown();this.oMU.oR=oR}else if(oEvent.isShiftKeyDown()){this.selRng(oR,oEvent.isCtrlKeyDown())}else if(oEvent.isCtrlKeyDown()){this.sel(oR);this.set_SelectionAnchorId(this.getData(oR).sId)}else{this.selSngl(oR,false,true)}if(Utility.isSafari()&&Utility.isWin()&&oEvent.isRightButtonDown())this.onCMVP(oEvent)};Owa.UIControls.VLV.prototype.onMU=function Owa$UIControls$VLV$onMU(oEvent){if(!this.oMU)return;if(!this.oMU.oR.get_ParentElement()){this.oMU=0;return}if(this.oMU.fCtrl)this.unsel(this.oMU.oR);else if(!oEvent.isRightButtonDown())this.selSngl(this.oMU.oR);this.oMU=0};Owa.UIControls.VLV.prototype.onMouseMove=function Owa$UIControls$VLV$onMouseMove(oEvent){if(oEvent.isLeftButtonDown()&&this._getDescendant(VP)._get_DomNode().dragDrop)this.iDragTimer=this._setTimeout(this.initDragDrop,DRAG_DELAY)};Owa.UIControls.VLV.prototype.initDragDrop=function Owa$UIControls$VLV$initDragDrop(){if(this.iDragTimer){this._clearTimeout(this.iDragTimer);this.iDragTimer=0}if(Utility.isIE()){this._getDescendant(VP)._get_DomNode().dragDrop()}};Owa.UIControls.VLV.prototype.onCMVP=function Owa$UIControls$VLV$onCMVP(oEvent){if(oEvent.isCtrlKeyDown()){oEvent.preventDefault();oEvent.cancelBubble();return}var oR=this.fndRw(oEvent.get_Target());if(oR&&this.oCM){this.oCM.showAtEvent(oEvent)}};Owa.UIControls.VLV.prototype.onCMHdr=function Owa$UIControls$VLV$onCMHdr(oEvent){if(this.oABM)this.oABM.showAtEvent(oEvent)};Owa.UIControls.VLV.prototype.onDS=function Owa$UIControls$VLV$onDS(oEvent){var oDraggableObject=this.crtDC();var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);if(oDraggableObject){oDraggableObject.save(oDragDrop);if(Owa.Utility.isSafari()){var oImage=new Image();oImage.src=getThmF("clear1x1.gif");oEvent._oEvent.dataTransfer.setDragImage(oImage,1,1)}}else{oEvent.preventDefault();oEvent.cancelBubble()}};Owa.UIControls.VLV.prototype.onKD=function Owa$UIControls$VLV$onKD(oEvent){if(Owa.Dom.Input.isInstance(oEvent.get_Target())&&!oEvent.get_Target().hasCssClass("offscreen")){return}var iK=oEvent.get_KeyCodeForKeyUpDown();var fC=false;var fF=false;switch(iK){case Owa.KeyCodes.ENTER:if(!this.isDumpsterVw()){this.feNav()}break;case Owa.KeyCodes.UP:case Owa.KeyCodes.DOWN:var fNI=(iK==DOWN);if(oEvent.isShiftKeyDown()){this.extndRng(fNI)}else{if(this.sLstSel)this.selNPRw(this.sLstSel,0,fNI)}fC=true;break;case Owa.KeyCodes.PAGE_UP:fF=fC=true;this.pP(oEvent.isShiftKeyDown());break;case Owa.KeyCodes.PAGE_DOWN:fF=fC=true;this.nP(oEvent.isShiftKeyDown());break;case Owa.KeyCodes.END:fF=fC=true;this.lP(oEvent.isShiftKeyDown());break;case Owa.KeyCodes.HOME:fF=fC=true;this.fP(oEvent.isShiftKeyDown());break;case Owa.KeyCodes.F9:fF=fC=true;this.rfrsh();break;default:break}if(fF){this.makeFocused()}if(fC){oEvent.preventDefault();oEvent.cancelBubble()}};Owa.UIControls.VLV.prototype.onKP=function Owa$UIControls$VLV$onKP(oEvent){if(Owa.Dom.Input.isInstance(oEvent.get_Target())&&!oEvent.get_Target().hasCssClass("offscreen")){return}var iK=oEvent.get_CharCodeForKeyPress();if(!this.fTD||iK==13||iK==27||Utility.isFirefox()&&iK==0||Utility.isSafari()&&iK>63000||oEvent.isCtrlKeyDown())return;if(this.iTDTmr)this._clearTimeout(this.iTDTmr);this.sTD+=String.fromCharCode(oEvent.get_CharCodeForKeyPress());this.iTDTmr=this._setTimeout(this.tdSrch,TD_DLY)};Owa.UIControls.VLV.prototype.onRsz=function Owa$UIControls$VLV$onRsz(){var iH=this._get_Element().get_ClientHeight();if(iH!=this.iH){this.updScr();if(iH>this.iH)this.updVwprt();this.iH=iH;this.iVPH=0}};Owa.UIControls.VLV.prototype.makeFocused=function Owa$UIControls$VLV$makeFocused(){this._getDescendant("linkVLV")._get_DomNode().focus()};Owa.UIControls.VLV.prototype.updVwprt=function Owa$UIControls$VLV$updVwprt(){if(!this._get_IsShown()){this.fPndUpd=1;return}this.fPndUpd=0;if(this.iScrollTimer)return;var oRowPosition=this.gtRwFrmScr();switch(this.gtLdTyp(oRowPosition.iRow)){case LD_NONE:this.posVwprt(oRowPosition);break;case LD_NXT:this.ldAdj(1);break;case LD_PRV:this.ldAdj(0);break;case LD_FRSH:this.ldFrsh(oRowPosition.iRow);break}this.prld()};Owa.UIControls.VLV.prototype.posVwprt=function Owa$UIControls$VLV$posVwprt(oRowPosition){var iT=0;if(!oRowPosition){oRowPosition=new RowPosition(0,0)}var oRow=this.gtRw(oRowPosition.iRow,oRowPosition.iSubRow);if((oRowPosition.iRow>0||oRowPosition.iSubRow>0)&&oRow)iT=this.getRowPosition(oRow);var oVP=this._getDescendant(VP);oVP.set_ScrollTop(iT);if(iT>(oVP.get_ScrollHeight()-oVP.get_ClientHeight())){this._resetCurrentRowPosition()}else{this.oCurRowPosition=new RowPosition(oRowPosition.iRow,oRowPosition.iSubRow)}};Owa.UIControls.VLV.prototype._resetCurrentRowPosition=function Owa$UIControls$VLV$_resetCurrentRowPosition(){var oRowPosition=this.getFirstVisibleRow();this.oCurRowPosition=new RowPosition(oRowPosition.iRow,oRowPosition.iSubRow)};Owa.UIControls.VLV.prototype.prld=function Owa$UIControls$VLV$prld(){if(this._iPreloadTimer){this._clearTimeout(this._iPreloadTimer);this._iPreloadTimer=0}if(this.iTC==0||this.isViewportEmpty()){return}if(!this._get_IsShown()){this.fPndUpd=1;return}if(this.fPndLd)return;if(this.iScrollTimer)return;var oVP=this._getDescendant(VP);var oFrstCh=oVP.get_FirstChild();var iVPH=this.gtVPH();var iDH=this.gtDtaHt();var iB=this.getViewportPosition();var iMinB=Math.max(this.gtChHt(oFrstCh)/2.0,iVPH);if(iB<iMinB&&oFrstCh.getIntAttribute("iSR")>0){this.ldAdj(0);return}if(oFrstCh.get_NextSibling()){var iMaxB=this.gtChHt(oFrstCh)+this.gtChHt(oFrstCh.get_NextSibling())/2.0;if(iB>iMaxB&&iB-this.gtChHt(oFrstCh)>iMinB){var iNewScrollTop=iB-this.gtChHt(oFrstCh);iDH-=this.gtChHt(oFrstCh);oFrstCh.remove(true);oVP.set_ScrollTop(iNewScrollTop);this.updScr()}}var oLstCh=oVP.get_LastChild();iB=iDH-this.getViewportPosition()-iVPH;iMinB=Math.max(this.gtChHt(oLstCh)/2.0,iVPH);if(iB<iMinB&&(oLstCh.getIntAttribute("iER")<this.iTC-1)){this.ldAdj(1);return}if(oLstCh.get_PreviousSibling()){iMaxB=this.gtChHt(oLstCh)+this.gtChHt(oLstCh.get_PreviousSibling())/2.0;if(iB>iMaxB&&(iB-this.gtChHt(oLstCh)>iMinB)){this._storeViewportPosition();oLstCh.remove(true);this._resetViewportPosition();this.updScr()}}};Owa.UIControls.VLV.prototype.updScr=function Owa$UIControls$VLV$updScr(){if(!this._get_IsShown()){this.fPndUpd=1;return}var iH=1;var iEstimatedViewHeight=this.getEstimatedViewHeight();if(this.iTC>0){iH=iEstimatedViewHeight;iH=Math.max(iH,this.getTotalChunkHeight());iH=Math.min(iH,MAX_SCROLL_HEIGHT)}this.fIgnScr=1;var oS=this._getDescendant(SCR);var oScrRegion=this._getDescendant(SCROLL_REGION);oScrRegion.set_Height(iH);iH=oS.get_ScrollHeight();var iScrollableRange=iH-oS.get_OffsetHeight();if(iScrollableRange<=0)return;var iST=0;if(this.iTC>0){iST=this.getCurrentViewTop()}if(iEstimatedViewHeight>iH){var iScrollbarRatio=iScrollableRange/(iEstimatedViewHeight-oS.get_OffsetHeight());iST=Math.floor(iST*iScrollbarRatio)}if(oS.get_ScrollTop()!=iST){oS.set_ScrollTop(iST);this.iScrTp=iST}oS.get_OffsetHeight();this.fIgnScr=0};Owa.UIControls.VLV.prototype.ldFrsh=function Owa$UIControls$VLV$ldFrsh(iR,iPrg,fUpdScr,fnCb,fnBfCb,sCmd,fA,sRId,fForceRefresh){if(this.shouldClearPendingRequests(fForceRefresh,sRId)){this.clearPendingRequests()}if(!this.strtLd(LOAD_FRESH,arguments))return;if(isDf(typeof(this._clearRowNotifications))){this._clearRowNotifications()}cancelPendingThrottledRefresh(this.get_SubPage());if(this._oConsecutiveNavigationTimer){this.feSelChg(this._oConsecutiveNavigationTimer.sId);this._clearConsecutiveNavigationTimer()}this.feBRfrsh(iPrg==PRG_NONE);var iSR=0;if(this.iTC>0){var iNumOfRows=Math.ceil(this.gtVPH()/this.getTypicalRowHeight());var iBuffer=Math.floor((CHNK_SZ-iNumOfRows)/2.0);var iFirstVisibleRow=iR;if(iR==this.iTC-1){iFirstVisibleRow=Math.max(0,iR-iNumOfRows)}iSR=Math.max(0,iFirstVisibleRow-Math.max(0,iBuffer))}var oC={};oC.iSR=iSR;oC.iER=iSR+CHNK_SZ-1;oC.iR=iR;oC.fChkScr=!fUpdScr;oC.fnCb=fnCb;oC.fnBfCb=fnBfCb;var rgSelectedRows=this.gtSel();var oSelectedRowsHash={};for(var i=0;i<rgSelectedRows.get_Length();i++){oSelectedRowsHash[rgSelectedRows.get_Item(i)]=this.gtRwPrp(rgSelectedRows.get_Item(i),"read")}if(this.sExpId){oSelectedRowsHash[this.sExpId]=this.gtRwPrp(this.sExpId,"read")}oC.oSelectedRowsState=oSelectedRowsHash;if(!sCmd)sCmd="LoadFresh";var oR=new oeReq(this.sEvtNS,sCmd,oC,this._createCallback(this.cbLdSafe),POST,0,0,fA,0,sRId);this.addLVSt(oR);oR.add("SR",iSR);oR.add("RC",CHNK_SZ);oR.send();if(iPrg!=PRG_NONE)this.iPrgT=this._setTimeout(this.shwPrgrs,PRGRS_DLY,(iPrg==PRG_SRCH)?PRG_SRCH:PRG_LD)};Owa.UIControls.VLV.prototype.cbLdSafe=function Owa$UIControls$VLV$cbLdSafe(oR){if(!this._get_IsShown()){var oLV=this;this._fnOnShow=function(){oLV.cbLdSafe(oR)};return}var oC=oR.oCtx;try{if(oC&&oC.fIsLoadAdjacent){this.cbLdAdj(oR)}else{this.cbLdFrsh(oR)}}finally{this.endLd();this.updVwprt()}};Owa.UIControls.VLV.prototype.cbLdFrsh=function Owa$UIControls$VLV$cbLdFrsh(oR){if(this._oConsecutiveNavigationTimer){this.feSelChg(this._oConsecutiveNavigationTimer.sId);this._clearConsecutiveNavigationTimer()}this.cnclPrgrs();if(!cbOeh(oR)){return}var fPrcsRsp=0;var oRowPosition=new RowPosition(0,0);var oC=oR.oCtx?oR.oCtx:{};if(!oC.fChkScr){fPrcsRsp=1}else{if(this.iTC>0){oRowPosition=this.gtRwFrmScr();var iSR;var iER;var iNumOfRows=Math.ceil(this.gtVPH()/this.getTypicalRowHeight());if(oRowPosition.iRow==this.iTC-1){iER=oRowPosition.iRow;iSR=Math.max(0,iER-iNumOfRows)}else{iSR=oRowPosition.iRow;iER=Math.min(this.iTC-1,iSR+iNumOfRows)}fPrcsRsp=(iSR>=oC.iSR&&iER<=oC.iER)}else{fPrcsRsp=1}}if(fPrcsRsp){if(oC.fnBfCb)oC.fnBfCb(this,oR);var fSelF=!this.iTC;var oD=Document.get_Current().createElement("DIV");oD.set_InnerHtml(oR.sBody);var oL=this._getDescendant(VP);var oPrnt=oL.get_ParentElement();oPrnt.removeChild(oL);oL.set_InnerHtml("");var oChunk=oD.getChildById(CHUNK);oL.appendChild(oChunk);oPrnt.appendChild(oL);this.initChnk(oChunk);var fWasCnv=this.isCnvVw&&this.isCnvVw();this.prcsDta(oD);if(this.fSrchInProg){this.iPrgT=this.stTmout("shwPrgrs",PRGRS_DLY,PRG_SRCH);this.fSrchInProg=0}var fForceRpUd=0;if(fWasCnv&&!this.isCnvVw()&&this.gtSelCnt()>1){fForceRpUd=1}if(!oC.fChkScr||oRowPosition.iRow<this.SR()||oRowPosition.iRow>this.ER())oRowPosition.iRow=this.SR();this.posVwprt(oRowPosition);this.updScr();var rgSelectedRows=this.gtSel();if(oC.oSelectedRowsState){var oRowState;for(var i=0;i<rgSelectedRows.get_Length();i++){var iRowId=rgSelectedRows.get_Item(i);var oRow=this.gtRwById(iRowId);oRowState=oC.oSelectedRowsState[iRowId];if(oRow&&isDf(typeof(oRowState))){if(oRowState==String(MSG_MARKED_UNREAD)&&!this.isRd(oRow)){this.getData(oRow).setAttribute("read",oRowState)}}}if(this.sExpId){var oRow=this.gtRwById(this.sExpId);oRowState=oC.oSelectedRowsState[this.sExpId];if(oRow&&isDf(typeof(oRowState))){if(oRowState==String(MSG_MARKED_UNREAD)&&!this.isRd(oRow)){this.getData(oRow).setAttribute("read",oRowState)}}}}if(rgSelectedRows.get_Length()>0){if(this.SR()==0&&this.ER()==this.iTC-1){for(var i=0;i<rgSelectedRows.get_Length();i++){var oRow=this.gtRwById(rgSelectedRows[i]);if(!oRow){delete this.oSel[rgSelectedRows[i]]}}rgSelectedRows=this.gtSel()}if(this.iTC==0){this.clrSel(1)}else if(rgSelectedRows.get_Length()==0){fSelF=true}else{this.feSelChg(rgSelectedRows.get_Item(0),fForceRpUd,1);fSelF=false}}else{fSelF=true}if(fSelF&&this.iTC)this.selSngl(this.gtRw(oRowPosition.iRow))}if(oC.fnCb)oC.fnCb(this,oR);this.set_SelectionAnchorId(this.get_SelectionAnchorId())};Owa.UIControls.VLV.prototype.ldAdj=function Owa$UIControls$VLV$ldAdj(fNxt){if(!this.strtLd(LOAD_ADJACENT,arguments))return;var rg=this.gtRws();if(rg.get_Length()==0){this.endLd();if(!this.isEmpty()){this.rfrsh()}return}var sAId=this.getData(fNxt?rg.get_Item(rg.get_Length()-1):rg.get_Item(0)).sId;var oC=new Object();oC.fIsLoadAdjacent=true;oC.fNxt=fNxt;var sOp=fNxt?"LoadNext":"LoadPrevious";var oR=new oeReq(this.sEvtNS,sOp,oC,this._createCallback(this.cbLdSafe),POST);this.addLVSt(oR);oR.add("AId",sAId);oR.add("RC",CHNK_SZ);oR.send()};Owa.UIControls.VLV.prototype.cbLdAdj=function Owa$UIControls$VLV$cbLdAdj(oR){if(!cbOeh(oR)){return}var fNxt=oR.oCtx.fNxt;var oD=Document.get_Current().createElement("DIV");oD.set_InnerHtml(oR.sBody);if(getInt(oD.getChildById("data").getAttribute("fR"))||(this.isViewportEmpty()&&this.iTC>0)){this.rfrsh();return}var oScrollToRow=this.gtRwFrmScr();var oC=oD.getChildById(CHUNK);this.initChnk(oC);var iD=0;var oVP=this._getDescendant(VP);if(fNxt){if(getInt(oC.getAttribute("fNull"))){var oData=oD.getChildById("data");var iTC=oData.getIntAttribute("iTC");iD=(iTC-1)-this.ER()}else{this._storeViewportPosition();oVP.appendChild(oC);this._resetViewportPosition();iD=oC.getIntAttribute("iSR")-oC.get_PreviousSibling().getIntAttribute("iER")-1}}else{if(getInt(oC.getAttribute("fNull"))){iD=-this.SR()}else{var iNewScrollTop=0;var fResetScroll=Utility.isFirefox()&&Utility.isWin();if(fResetScroll){iNewScrollTop=this.getViewportPosition()+this.gtChHt(oC)}oVP.insertAdjacentElement(Owa.ElementInsertionPoint.AfterBegin,oC);if(fResetScroll){oVP.set_ScrollTop(iNewScrollTop)}iD=oC.getIntAttribute("iER")-oC.get_NextSibling().getIntAttribute("iSR")+1}}if(iD!=0){oVP.forEachChild(function(oChild){if(oChild!=oC){oChild.setIntAttribute("iSR",oChild.getIntAttribute("iSR")+iD);oChild.setIntAttribute("iER",oChild.getIntAttribute("iER")+iD)}});oScrollToRow.iRow+=iD}this.posVwprt(oScrollToRow);this.updScr();this.prcsDta(oD);this.set_SelectionAnchorId(this.get_SelectionAnchorId())};Owa.UIControls.VLV.prototype.gtLdTyp=function Owa$UIControls$VLV$gtLdTyp(iR){var oL=this._getDescendant(VP);if(!oL.hasChildNodes())return LD_FRSH;if(getInt(oL.get_FirstChild().getAttribute("fNoRws")))return LD_NONE;var iSR=this.SR();var iER=this.ER();if(iR>iER)return LD_FRSH;if(iR<iSR){if(iSR-iR<CHNK_SZ)return LD_PRV;else return LD_FRSH}var oR=this.gtRw(iR);if((this.gtDtaHt()-this.getRowPosition(oR)<this.gtVPH())&&(iER<this.iTC-1))return LD_NXT;else return LD_NONE};Owa.UIControls.VLV.prototype.getRowPosition=function Owa$UIControls$VLV$getRowPosition(oR){var iPosition=this.getRowPositionInChunk(oR);var oChunk=this.fndChnk(oR);iPosition+=oChunk.get_PositionalTop();return iPosition};Owa.UIControls.VLV.prototype.getRowPositionInChunk=function Owa$UIControls$VLV$getRowPositionInChunk(oR){var iPosition=0;var o=oR;do{iPosition+=o.get_PositionalTop();o=o.get_PositionalParent();if(o.get_TagName()=="HTML"){throw new Error("Can't find "+CHUNK+" in getRowPositionInChunk")}}while(o.get_Id()!=CHUNK);return iPosition};Owa.UIControls.VLV.prototype.gtRwFrmScr=function Owa$UIControls$VLV$gtRwFrmScr(){var oS=this._getDescendant(SCR);var iScrollableRange=oS.get_ScrollHeight()-oS.get_OffsetHeight();if(iScrollableRange==0||this.iTC==0){return new RowPosition(0,0)}var iViewTop=oS.get_ScrollTop();var iTotalDataScrollableRange=this.getEstimatedViewHeight()-oS.get_OffsetHeight();var iScrollbarRatio=iScrollableRange/iTotalDataScrollableRange;if(iScrollbarRatio<1.0){iViewTop=Math.ceil(iViewTop/iScrollbarRatio)}var iChunkTop=this.getTypicalRowHeight()*this.SR();var iChunkBottom=iChunkTop+this.getTotalChunkHeight();var oRetVal=null;if(iViewTop<iChunkTop){oRetVal=new RowPosition(Math.ceil(iViewTop/this.getTypicalRowHeight()),0)}else if(iViewTop>=Math.ceil(iTotalDataScrollableRange)){oRetVal=new RowPosition(this.iTC-1,0)}else if(iViewTop<iChunkBottom){oRetVal=this.getFirstRowAfterHeight(iViewTop-iChunkTop)}else{oRetVal=new RowPosition(this.ER()+Math.ceil((iViewTop-iChunkBottom)/this.getTypicalRowHeight()),0)}return oRetVal};Owa.UIControls.VLV.prototype.prcsDta=function Owa$UIControls$VLV$prcsDta(oD){var oData=oD.getChildById("data");this.iTC=oData.getIntAttribute("iTC");this.iTIC=oData.getIntAttribute("iTIC");this.sDataFolderId=oData.getAttribute("sDataFId");if(oData.getIntAttribute("fSrchInProg")==1){this.fSrchInProg=1}var oHeaders=oD.getChildById(HDRS);if(oHeaders)this._getDescendant(HDRS).get_FirstChild().replace(oHeaders.get_FirstChild());var oNewSelection=oD.getChildById("nwSel");if(oNewSelection){var oR=this.gtRwById(oNewSelection.getAttribute("sId"));if(oR){this.selSngl(oR)}}else if(this.isCnvVw&&!this.isCnvVw()){var rgSelected=this.gtSel();if(rgSelected.get_Length()&&this.get_SubPage().isCnvId(rgSelected.get_Item(0))){var rg=this.gtRws();if(rg.get_Length()>0){this.selSngl(rg.get_Item(0))}}}var oFBg=this._getDescendant(FILTER_BACKGROUND);if(this.isFltrd()&&!oFBg){oFBg=Document.get_Current().createElement("DIV");this._getDescendant(LIST).appendChild(oFBg);oFBg.set_Id(FILTER_BACKGROUND);oFBg.addCssClass("fltrBg")}if(!this.isFltrd()&&oFBg){oFBg.remove(true)}this.feERfrsh(oD.getChildById("spnSR"))};Owa.UIControls.VLV.prototype.srt=function Owa$UIControls$VLV$srt(iSC,iSO){if(!this.strtLd(SORT,arguments))return;this.iSC=iSC;this.iSO=iSO;this.feBRfrsh(0);var oR=new oeReq(this.sEvtNS,"Sort",0,this._createCallback(this.cbLdSafe),POST);this.addLVSt(oR);oR.add("RC",CHNK_SZ);if(this.get_SelectionAnchorId())oR.add("SId",this.get_SelectionAnchorId());oR.send();this.iPrgT=this._setTimeout(this.shwPrgrs,PRGRS_DLY,PRG_LD)};Owa.UIControls.VLV.prototype.tdSrch=function Owa$UIControls$VLV$tdSrch(){if(!this.strtLd(TYPEDOWN,arguments))return;this.feBRfrsh(0);var oC={};var oLV=this;oC.fnCb=function(){var rg=oLV.gtRws();if(rg.get_Length())oLV.selSngl(rg.get_Item(0))};var oR=new oeReq(this.sEvtNS,"TypeDown",oC,this._createCallback(this.cbLdSafe),POST);this.addLVSt(oR);oR.add("td",this.sTD);oR.add("RC",CHNK_SZ);oR.send();this.sTD="";this.iPrgT=this._setTimeout(this.shwPrgrs,PRGRS_DLY,PRG_LD)};Owa.UIControls.VLV.prototype._getArrangeByColumnId=function Owa$UIControls$VLV$_getArrangeByColumnId(sId){return this.oABMDiv.getChildById(sId).getIntAttribute("_cid")};Owa.UIControls.VLV.prototype.set_SelectionAnchorId=function Owa$UIControls$VLV$prototype$set_SelectionAnchorId(sId){this.sSelA=sId;if(this.sSelA){var sNextSelectionId=null;var iSelectedRow=-1;var rgRowInfos=this.getRowInfos();for(var iRowInfo=0;iRowInfo<rgRowInfos.length;++iRowInfo){if(rgRowInfos[iRowInfo].sRowId==this.sSelA){iSelectedRow=iRowInfo;continue}else if(rgRowInfos[iRowInfo].sId==VR){sNextSelectionId=rgRowInfos[iRowInfo].sRowId;if(iSelectedRow>=0){break}}}if(iSelectedRow>=0){this.sNextSelA=sNextSelectionId}else if(this.sNextSelA==this.sSelA){this.sNextSelA=0}}else{this.sNextSelA=0}};Owa.UIControls.VLV.prototype.get_SelectionAnchorId=function Owa$UIControls$VLV$prototype$get_SelectionAnchorId(){return this.sSelA};Owa.UIControls.VLV.prototype.removeSelectionAnchoredRow=function Owa$UIControls$VLV$prototype$removeSelectionAnchoredRow(){var sSelId=this.get_SelectionAnchorId();if(this.gtSelCnt()==1&&this.sNextSelA){var oR=this.gtRwById(this.sNextSelA);if(oR){this.selSngl(oR)}}this.rmvRws([sSelId])};Owa.UIControls.VLV.prototype.sel=function Owa$UIControls$VLV$sel(oR,fSE,fConsecutiveNavigation){fSE|=this.isSel(oR)&&this.getData(oR).sId==this.get_ItemIdInReadingPane();var oSR;var fIsExp=false;if(oR.get_Id()==VR){oSR=oR;if(this.isSelExp&&this.isSelExp()){this.clrSel(1);if(this.sExpId){var oPR=this.gtRwById(this.sExpId);if(oPR)this.sel(oPR)}}fIsExp=this.sExpId?(this.sExpId==this.getData(oR).sId):false}else if(oR.get_Id()==VER){fIsExp=true;if(this.isSelExp&&this.isSelExp())oSR=null;else oSR=this.gtExpCnv(oR);if(oSR&&(this.gtSelCnt()>0)){if(!this.isSel(oSR))this.sel(oSR);return}}var isCnvVw=this.isCnvVw&&this.isCnvVw();while(oSR){if(isCnvVw){if(fIsExp)oSR.addCssClass(SELECTED_CONVERSATION);else oSR.addCssClass(SELECTED)}else{oSR.addCssClass(SELECTED)}oSR=oSR.get_NextSibling();if(!oSR||(oSR.get_Id()!=SR))break}if(oR.get_Id()==VER){oR.removeCssClass(SELECTED_CONVERSATION);oR.addCssClass(SELECTED_EXPANSION_ROW)}var sId=this.getData(oR).sId;var o={};this.oSel[sId]=o;o.fSel=1;var rg=this.rgPbPrps;if(rg){for(var i=0;i<rg.get_Length();i++)o[rg.get_Item(i)]=this.gtPrpV(oR,rg.get_Item(i))}if(oR.get_Id()==VER){oSR=this.gtExpCnv(oR);if(oSR){var sCnvId=this.getData(oSR).sId;o.sCnvId=sCnvId}}if(!fSE){if(fConsecutiveNavigation){this._resetConsecutiveNavigationTimer(sId)}else{this.feSelChg(sId)}}if(isCnvVw){this.udPp()}};Owa.UIControls.VLV.prototype._resetConsecutiveNavigationTimer=function Owa$UIControls$VLV$_resetConsecutiveNavigationTimer(sId){if(this._oConsecutiveNavigationTimer){this._clearConsecutiveNavigationTimer()}this._oConsecutiveNavigationTimer={};this._oConsecutiveNavigationTimer.sId=sId;this._oConsecutiveNavigationTimer.oTimer=this._setTimeout(this.feSelChg,CONSECUTIVE_NAVIGATION_DELAY,sId)};Owa.UIControls.VLV.prototype._clearConsecutiveNavigationTimer=function Owa$UIControls$VLV$_clearConsecutiveNavigationTimer(){if(this._oConsecutiveNavigationTimer){this._clearTimeout(this._oConsecutiveNavigationTimer.oTimer);this._oConsecutiveNavigationTimer=null}};Owa.UIControls.VLV.prototype.unsel=function Owa$UIControls$VLV$unsel(oR,fSE){var oSR;if(oR.get_Id()==VR){oSR=oR}else if(oR.get_Id()==VER){oR.addCssClass(SELECTED_CONVERSATION);oR.removeCssClass(SELECTED_EXPANSION_ROW);if(this.gtSelCnt()>1){oSR=null}else{oSR=this.gtExpCnv(oR)}}while(oSR){oSR.removeCssClass(SELECTED_CONVERSATION);oSR.removeCssClass(SELECTED_EXPANSION_ROW);oSR.removeCssClass(SELECTED);oSR=oSR.get_NextSibling();if(!oSR||(oSR.get_Id()!=SR))break}var sId=this.getData(oR).sId;if(this.oSel[sId]){this.oSel[sId].fSel=false;if(!fSE)this.feSelChg(sId);delete this.oSel[sId]}if(this.isCnvVw&&this.isCnvVw())this.udPp();this._setTimeout(this.updateExpansion,10)};Owa.UIControls.VLV.prototype.updateExpansion=function Owa$UIControls$VLV$updateExpansion(){if(this.sExpId){var fKeepExpansion=false;for(var sId in this.oSel){if(sId==this.sExpId){fKeepExpansion=true;break}else if(this.sExpId==this.oSel[sId].sCnvId){fKeepExpansion=true;break}}if(!fKeepExpansion){this.expRw(0)}}};Owa.UIControls.VLV.prototype.selSngl=function Owa$UIControls$VLV$selSngl(oR,fSE,fConsecutiveNavigation){var sId=this.getData(oR).sId;this.unSelRemaining(new Array(sId),1);this.sel(oR,fSE,fConsecutiveNavigation);this.sLstSel=this.getData(oR).sId;this.set_SelectionAnchorId(this.sLstSel)};Owa.UIControls.VLV.prototype.selRng=function Owa$UIControls$VLV$selRng(oR,fPS){var sId=this.getData(oR).sId;if(!this.get_SelectionAnchorId())this.set_SelectionAnchorId(sId);this.sLstSel=sId;if(!fPS){this.unSelRemaining(new Array(sId),this.isSelExp&&this.isSelExp())}var oSelA=this.gtRwById(this.get_SelectionAnchorId());if(!oSelA){this.selSngl(oR);alrt(this._get_Element().getAttribute("L_BigSel"));return}if(oSelA.get_Id()!=oR.get_Id()){if(oR.get_Id()==VER){var oPR=this.gtExpCnv(oR);if(oSelA.equals(oPR)){oSelA=oPR.get_NextSibling().get_NextSibling()}else{oR=oPR}}else{var oPR=this.gtExpCnv(oSelA);if(oR.equals(oPR)){oR=oPR.get_NextSibling().get_NextSibling()}else{oSelA=oPR}}sId=this.getData(oR).sId;this.set_SelectionAnchorId(this.getData(oSelA).sId)}var sId0,sId1;if(this.getRowPosition(oSelA)<this.getRowPosition(oR)){sId0=this.get_SelectionAnchorId();sId1=sId}else{sId0=sId;sId1=this.get_SelectionAnchorId()}var f=0;var rgR=this.gtRws(oR.get_Id()==VER?1:0);for(var i=0;i<rgR.get_Length();i++){var sTmpId=this.getData(rgR.get_Item(i)).sId;if(sTmpId==sId0)f=1;if(f)this.sel(rgR.get_Item(i),1);if(sTmpId==sId1)break}this.feSelChg(sId)};Owa.UIControls.VLV.prototype.extndRng=function Owa$UIControls$VLV$extndRng(fNI,fF){if(!this.sLstSel){return}var oR=this.gtNPRw(this.sLstSel,fNI);if(!oR){if(this.selectAtDataSetLimit(fNI,true)){return}if(!fF){var oLV=this;var fn=function(){oLV.extndRng(fNI,1)};this.ldSk(this.sLstSel,fNI,fn)}return}this.selRng(oR);this.scrToVwprt(oR)};Owa.UIControls.VLV.prototype.unSelRemaining=function Owa$UIControls$VLV$unSelRemaining(rgsIds,fE){var rg=this.gtSel();for(var i=0;i<rg.get_Length();i++){if(rgsIds){var fSkip=false;for(var j=0;j<rgsIds.get_Length();j++){if(rgsIds[j]==rg[i]){fSkip=true;break}}if(fSkip){continue}}var sId=rg.get_Item(i);var oR=this.gtRwById(sId);if(oR){this.unsel(oR,!fE||(i<rg.get_Length()-1))}else{this.oSel[sId].fSel=false;if(fE&&(i==rg.get_Length()-1)){this.feSelChg(sId)}delete this.oSel[sId]}}};Owa.UIControls.VLV.prototype.clrSel=function Owa$UIControls$VLV$clrSel(fE){this.unSelRemaining(null,fE)};Owa.UIControls.VLV.prototype.isSel=function Owa$UIControls$VLV$isSel(oR){return(oR!=null)&&this.oSel[this.getData(oR).sId]&&this.oSel[this.getData(oR).sId].fSel};Owa.UIControls.VLV.prototype.gtSelAftrRmv=function Owa$UIControls$VLV$gtSelAftrRmv(fN,rgId){var iCount=0;var oP=0;var oN=0;var rg=this.gtRws(this.isSelExp&&this.isSelExp());var oItems=new Object();for(var i=0;i<rgId.get_Length();i++){oItems[rgId[i]]=true}for(var i=0;i<rg.get_Length();i++){var sId=this.getData(rg[i]).sId;if(oItems[sId]){iCount++}if(!iCount){oP=rg.get_Item(i)}if(iCount==rgId.get_Length()&&!oN&&!oItems[sId]){oN=rg.get_Item(i);break}}var oR;if(iCount==rgId.get_Length()){oR=(fN&&oN||!oP)?oN:oP}if(!oR&&this.iTC>0){var iR=this.oCurRowPosition.iRow-this.SR();while(iR<rg.get_Length()){if(!this.isSel(rg.get_Item(iR))){oR=rg.get_Item(iR);break}iR++}}return oR};Owa.UIControls.VLV.prototype.ldSk=function Owa$UIControls$VLV$ldSk(sId,fNI,fnCb,oCtx){if(!this.strtLd(SEEK,arguments))return;this.feBRfrsh(0);var oC={};oC.fnCb=fnCb;oC.oCtx=oCtx;var sC=fNI?"SeekNext":"SeekPrevious";var oR=new oeReq(this.sEvtNS,sC,oC,this._createCallback(this.cbLdSafe),POST);this.addLVSt(oR);oR.add("SId",sId);oR.add("RC",CHNK_SZ);oR.send();this.iPrgT=this._setTimeout(this.shwPrgrs,PRGRS_DLY,PRG_LD)};Owa.UIControls.VLV.prototype.scrToVwprt=function Owa$UIControls$VLV$scrToVwprt(oR){var oVP=this._getDescendant(VP);var iViewportPosition=this.getViewportPosition();var iViewportHeight=this.gtVPH();var iRowPosition=this.getRowPosition(oR);var iRowHeight=this.gtRwHt(oR);var iRowBottom=iRowPosition+iRowHeight;var iViewportBottom=iViewportPosition+iViewportHeight;var iDownShift=iRowBottom-iViewportBottom;var oRowPosition=this.oCurRowPosition;if(iDownShift>0){var iNewViewportPosition=iViewportPosition+iDownShift;var oTmpRowPosition=this.getFirstRowAfterHeight(iNewViewportPosition);if(oRowPosition==null||oRowPosition.iRow<oTmpRowPosition.iRow||(oRowPosition.iRow==oTmpRowPosition.iRow&&oRowPosition.iSubRow<oTmpRowPosition.iSubRow)){oRowPosition=oTmpRowPosition}}else if(iRowPosition<iViewportPosition){oRowPosition=this.getFirstRowAfterHeight(iRowPosition-5)}if(oRowPosition.iRow!=this.oCurRowPosition.iRow||oRowPosition.iSubRow!=this.oCurRowPosition.iSubRow){this.posVwprt(oRowPosition);this.updScr();this.prld()}};Owa.UIControls.VLV.prototype.SR=function Owa$UIControls$VLV$SR(){var o=this._getDescendant(VP).get_FirstChild();return(!o||getInt(o.getAttribute("fNoRws"))?0:o.getIntAttribute("iSR"))};Owa.UIControls.VLV.prototype.ER=function Owa$UIControls$VLV$ER(){if(!this.iTC||this.isViewportEmpty())return 0;var o=this._getDescendant(VP).get_LastChild();return o.getIntAttribute("iER")};Owa.UIControls.VLV.prototype.isViewportEmpty=function Owa$UIControls$VLV$isViewportEmpty(){var oVP=this._getDescendant(VP);if(oVP.getChildById(CHUNK)==null)return true;return false};Owa.UIControls.VLV.prototype.gtDtaHt=function Owa$UIControls$VLV$gtDtaHt(){var iH=0;var oVP=this._getDescendant(VP);var oLV=this;oVP.forEachChild(function(oChild){iH+=oLV.gtChHt(oChild)});return iH};Owa.UIControls.VLV.prototype.gtChHt=function Owa$UIControls$VLV$gtChHt(oCh){var iH=oCh.get_OffsetHeight();if(!iH&&oCh.get_ParentElement().get_OffsetHeight()!=0)throw new Error("VLV chunk height is 0.");return iH};Owa.UIControls.VLV.prototype._getChunkCount=function Owa$UIControls$VLV$_getChunkCount(oChunk){return(oChunk.getIntAttribute("iER")-oChunk.getIntAttribute("iSR"))};Owa.UIControls.VLV.prototype._updateItemCounts=function Owa$UIControls$VLV$_updateItemCounts(oCounts,fIncrementSR,oChunk,fIsRead){this.iTC+=oCounts.iTCDelta;this.iTIC+=oCounts.iTICDelta;if(this.isCnvVw()||(!this.isCnvVw()&&(!fIsRead||fIsRead=="0"))){this.iUC+=oCounts.iUCDelta}var oTCh=oChunk.get_NextSibling();while(oTCh){oTCh.setIntAttribute("iSR",oTCh.getIntAttribute("iSR")+oCounts.iTCDelta);oTCh.setIntAttribute("iER",oTCh.getIntAttribute("iER")+oCounts.iTCDelta);oTCh=oTCh.get_NextSibling()}var iSR=oChunk.getIntAttribute("iSR");var iER=oChunk.getIntAttribute("iER");if(fIncrementSR){oChunk.setIntAttribute("iSR",iSR+oCounts.iTCDelta)}oChunk.setIntAttribute("iER",iER+oCounts.iTCDelta)};Owa.UIControls.VLV.prototype.gtRwById=function Owa$UIControls$VLV$gtRwById(sId){var o=this._getDescendant("b"+sId);if(o)return this.fndRw(o)};Owa.UIControls.VLV.prototype.gtRw=function Owa$UIControls$VLV$gtRw(iR,iSubR){if(!iSubR||iSubR<0){iSubR=0}var oRowInfo=this.getRowInfoFromPosition(new RowPosition(iR,iSubR));return oRowInfo!=null?oRowInfo.oRow:null};Owa.UIControls.VLV.prototype.gtRws=function Owa$UIControls$VLV$gtRws(fExp){if(fExp){return this._getDescendant(VP).getAllDescendantsById(VER)}this.validateRowCache();if(this._rgHeaderRows==null){this._rgHeaderRows=this._getDescendant(VP).getAllDescendantsById(VR)}return this._rgHeaderRows};Owa.UIControls.VLV.prototype._getIdFromInstanceKey=function Owa$UIControls$VLV$_getIdFromInstanceKey(sInstanceKey){var oRowInfo=this._getOInstanceKeyToRow()[sInstanceKey];if(oRowInfo){return oRowInfo.sRowId}return null};Owa.UIControls.VLV.prototype.getRowInfoFromPosition=function Owa$UIControls$VLV$prototype$getRowInfoFromPosition(oRowPosition){var rgRowInfos=this.getRowInfos();if(rgRowInfos.length==0)return null;if(oRowPosition.iRow<rgRowInfos[0].oRowPosition.iRow){return rgRowInfos[0]}else if(rgRowInfos[rgRowInfos.length-1].oRowPosition.iRow>=oRowPosition.iRow){for(var iRow=0;iRow<rgRowInfos.length;++iRow){if(rgRowInfos[iRow].oRowPosition.equals(oRowPosition)){return rgRowInfos[iRow]}else if(iRow>0&&rgRowInfos[iRow].iRow>oRowPosition.iRow&&rgRowInfos[iRow-1].iRow==oRowPosition.iRow){return rgRowInfos[iRow-1]}}}else{for(var iRow=rgRowInfos.length-1;iRow>=0;--iRow){if(rgRowInfos[iRow].sId!=SR){return rgRowInfos[iRow]}}}return null};Owa.UIControls.VLV.prototype.getRowInfos=function Owa$UIControls$VLV$prototype$getRowInfos(){this.validateRowCache();if(this._rgRowInfos==null){var rgAllRows=[];var rgHeaderRows=this.gtRws();var iChunkPosition=0;var iViewPortPosition=0;var iSR=this.SR();var fNewSection=true;var sSectionHeaderText="";var iCacheIndex=0;for(var iRow=0;iRow<rgHeaderRows.length;++iRow){var oRow=rgHeaderRows[iRow];var iSubRow=0;if(fNewSection){sSectionHeaderText=this._getRowHeaderText(oRow);iChunkPosition=this.getRowPositionInChunk(oRow);iViewPortPosition=iChunkPosition+this.fndChnk(oRow).get_PositionalTop();if(iViewPortPosition<0){iViewPortPosition=0}fNewSection=false}do{if(this.isRow(oRow)){var oData=this.getData(oRow);rgAllRows.add(new RowInfo(oRow,new RowPosition(iSR+iRow,iSubRow),iViewPortPosition,iChunkPosition,sSectionHeaderText,oData.sId,oData.sInstanceKey,iCacheIndex));var iRowOffsetHeight=oRow.get_OffsetHeight();iChunkPosition+=iRowOffsetHeight;iViewPortPosition+=iRowOffsetHeight;iSubRow++;iCacheIndex++}oRow=oRow.get_NextSibling()}while(oRow!=null&&!this.isRowHeading(oRow));if(oRow==null){fNewSection=true}}this._rgRowInfos=rgAllRows}return this._rgRowInfos};Owa.UIControls.VLV.prototype._getOIdToRow=function Owa$UIControls$VLV$prototype$_getOIdToRow(){this.validateRowCache();if(this._oIdToRow==null){this._updateRowInfoHashTables()}return this._oIdToRow};Owa.UIControls.VLV.prototype._getOInstanceKeyToRow=function Owa$UIControls$VLV$prototype$_getOInstanceKeyToRow(){this.validateRowCache();if(this._oInstanceKeyToRow==null){this._updateRowInfoHashTables()}return this._oInstanceKeyToRow};Owa.UIControls.VLV.prototype._updateRowInfoHashTables=function Owa$UIControls$VLV$prototype$_updateRowInfoHashTables(){var rgInfos=this.getRowInfos();var oIdToRow={};var oInstanceKeyToRow={};for(var iRow=0;iRow<rgInfos.length;++iRow){var rowInfo=rgInfos[iRow];if(rowInfo.oRow.get_Id()==VR||rowInfo.oRow.get_Id()==VER){oIdToRow[rowInfo.sRowId]=rowInfo;oInstanceKeyToRow[rowInfo.sInstanceKey]=rowInfo}}this._oIdToRow=oIdToRow;this._oInstanceKeyToRow=oInstanceKeyToRow};Owa.UIControls.VLV.prototype._getRowInfoByInstanceKey=function Owa$UIControls$VLV$_getRowInfoByInstanceKey(sInstanceKey){return this._getOInstanceKeyToRow()[sInstanceKey]};Owa.UIControls.VLV.prototype._getPreviousRowInstanceKey=function Owa$UIControls$VLV$_getPreviousRowInstanceKey(sInstanceKey){var oRowInfo=this._getOInstanceKeyToRow()[sInstanceKey];if(!oRowInfo){return null}else if(oRowInfo.iCacheIndex==0){return""}var oRowInfos=this.getRowInfos();var iLocation=oRowInfo.iCacheIndex-1;for(var i=iLocation;i>=0;i--){if(oRowInfos[i].sId==VR){return oRowInfos[i].sInstanceKey}}return null};Owa.UIControls.VLV.prototype._getRowByInstanceKey=function Owa$UIControls$VLV$_getRowByInstanceKey(sInstanceKey){var oRowInfo=this._getRowInfoByInstanceKey(sInstanceKey);return(oRowInfo?oRowInfo.oRow:null)};Owa.UIControls.VLV.prototype._insertRowInRowCache=function Owa$UIControls$VLV$prototype$_insertRowInRowCache(oR,oNextPrevRowInfo,fInsertBefore,iRowOffsetDelta){var iRowHeight=iRowOffsetDelta;this._updateRowInfoHashTables();var oRowInfos=this.getRowInfos();var oData=this.getData(oR);var fIsLastRow=(!fInsertBefore&&this._isLastRow(oNextPrevRowInfo));var oReplaceRowInfo=oNextPrevRowInfo;var rgoNewRowInfos=[];var iIndexToInsert=(fInsertBefore?oNextPrevRowInfo.iCacheIndex:oNextPrevRowInfo.iCacheIndex+2);var iHeaderTableIndex=iIndexToInsert/2;if(this.isCnvVw()&&!fInsertBefore&&this._isExpandedConversation(oNextPrevRowInfo.sRowId)&&(oRowInfos.get_Length()>2)){var i=oNextPrevRowInfo.iCacheIndex;var oTempRow=oRowInfos[i+2];while(oTempRow&&!this.isRowHeading(oTempRow.oRow)){i++;oTempRow=oRowInfos[i+2]}oReplaceRowInfo=oRowInfos[i];iRowOffsetDelta=oRowInfos[i].oRow.get_OffsetHeight()+oRowInfos[i+1].oRow.get_OffsetHeight();iIndexToInsert=oReplaceRowInfo.iCacheIndex+2}for(var i=0;i<2;i++){rgoNewRowInfos.push(new RowInfo(oR,new RowPosition((fInsertBefore?oReplaceRowInfo.oRowPosition.iRow:oReplaceRowInfo.oRowPosition.iRow+1),i),(fInsertBefore?oReplaceRowInfo.iViewPortOffset:oReplaceRowInfo.iViewPortOffset+iRowOffsetDelta),(fInsertBefore?oReplaceRowInfo.iChunkOffset:oReplaceRowInfo.iChunkOffset+iRowOffsetDelta),oReplaceRowInfo.sSectionHeaderText,oData.sId,oData.sInstanceKey,(fInsertBefore?oReplaceRowInfo.iCacheIndex:oReplaceRowInfo.iCacheIndex+2)));oReplaceRowInfo=oRowInfos[oReplaceRowInfo.iCacheIndex+1];var oR=oR.get_NextSibling()}oRowInfos.splice(iIndexToInsert,0,rgoNewRowInfos[0],rgoNewRowInfos[1]);this._rgHeaderRows.splice(iHeaderTableIndex,0,rgoNewRowInfos[0].oRow);for(var i=iIndexToInsert+2;i<oRowInfos.get_Length();i++){var oPresentRow=oRowInfos[i];oPresentRow.oRowPosition.iRow++;oPresentRow.iViewPortOffset+=iRowHeight;oPresentRow.iChunkOffset+=iRowHeight;oPresentRow.iCacheIndex+=2}this._oIdToRow[oData.sId]=rgoNewRowInfos[0];this._oInstanceKeyToRow[oData.sInstanceKey]=rgoNewRowInfos[0]};Owa.UIControls.VLV.prototype._isLastRow=function Owa$UIControls$VLV$prototype$_isLastRow(oRowInfo){return(this._rgHeaderRows[this._rgHeaderRows.get_Length()-1].get_Id()==oRowInfo.sRowId)};Owa.UIControls.VLV.prototype.getRowCacheSignature=function Owa$UIControls$VLV$prototype$getRowCacheSignature(){var oReturnValue={rgChunks:[]};var oVP=this._getDescendant(VP);oVP.forEachChild(function(oChunk){if(oChunk.get_Id()==CHUNK){oReturnValue.rgChunks.add(oChunk)}});return oReturnValue};Owa.UIControls.VLV.prototype.validateRowCache=function Owa$UIControls$VLV$prototype$validateRowCache(){var oRowCacheSignature=this.getRowCacheSignature();if(this._oRowCacheSignature!=null){if(this._oRowCacheSignature.rgChunks.length!=oRowCacheSignature.rgChunks.length){this.clearRowCache(oRowCacheSignature);return}for(var iChunk=0;iChunk<oRowCacheSignature.rgChunks.length;++iChunk){if(!oRowCacheSignature.rgChunks[iChunk].equals(this._oRowCacheSignature.rgChunks[iChunk])){this.clearRowCache(oRowCacheSignature);return}}}else{this.clearRowCache(oRowCacheSignature)}};Owa.UIControls.VLV.prototype.clearRowCache=function Owa$UIControls$VLV$prototype$clearRowCache(oSignature){this._rgRowInfos=null;this._oIdToRow=null;this._oInstanceKeyToRow=null;this._rgHeaderRows=null;this._oRowCacheSignature=oSignature};Owa.UIControls.VLV.prototype.scrollSingleRow=function Owa$UIControls$VLV$prototype$scrollSingleRow(fForward){if(this.iTC==0){return}var iViewportPosition=this.getRowPosition(this.gtRw(this.oCurRowPosition.iRow,this.oCurRowPosition.iSubRow));var oScrollToRowPosition=!fForward?this.getLastRowBeforeHeight(iViewportPosition):this.getFirstRowAfterHeight(iViewportPosition+5);if(this.gtLdTyp(oScrollToRowPosition.iRow)==LD_NONE)this.posVwprt(oScrollToRowPosition);this.updScr();this.prld()};Owa.UIControls.VLV.prototype.getFirstVisibleRow=function Owa$UIControls$VLV$getFirstVisibleRow(){var oViewport=this._getDescendant(VP);var iViewportPosition=oViewport.get_ScrollTop();return this.getFirstRowAfterHeight(iViewportPosition)};Owa.UIControls.VLV.prototype.getLastVisibleRow=function Owa$UIControls$VLV$getLastVisibleRow(){var oViewport=this._getDescendant(VP);var iViewportBottom=oViewport.get_ScrollTop()+this.gtVPH();return this.getLastRowBeforeHeight(iViewportBottom)};Owa.UIControls.VLV.prototype.getFirstRowAfterHeight=function Owa$UIControls$VLV$prototype$getFirstRowAfterHeight(iHeight){return this.getRowAroundHeight(iHeight,true)};Owa.UIControls.VLV.prototype.getLastRowBeforeHeight=function Owa$UIControls$VLV$prototype$getLastRowBeforeHeight(iHeight){return this.getRowAroundHeight(iHeight,false)};var _rowPosition={VISIBLE:0,ABOVE_VIEWPORT:1,BELOW_VIEWPORT:2};Owa.UIControls.VLV.prototype._getRowPosition=function Owa$UIControls$VLV$prototype$_getRowPosition(oR){var iRowPosition=this.getRowPosition(oR);var oViewport=this._getDescendant(VP);var iViewportPosition=oViewport.get_ScrollTop();if(iViewportPosition>iRowPosition){return _rowPosition.ABOVE_VIEWPORT}else if(iRowPosition<iViewportPosition+this.gtVPH()){return _rowPosition.VISIBLE}else{return _rowPosition.BELOW_VIEWPORT}};Owa.UIControls.VLV.prototype.getRowAroundHeight=function Owa$UIControls$VLV$prototype$getRowAroundHeight(iHeight,fAfter){var oRetVal=null;var rgRowInfo=this.getRowInfos();var iLastGoodRow=0;for(var iRow=0;iRow<rgRowInfo.length;++iRow){if(rgRowInfo[iRow].sId!=SR){if(rgRowInfo[iRow].iViewPortOffset>=iHeight){if(fAfter){return rgRowInfo[iRow].oRowPosition}else{return rgRowInfo[iLastGoodRow].oRowPosition}}iLastGoodRow=iRow}}oRetVal=new RowPosition(this.ER(),0);return oRetVal};Owa.UIControls.VLV.prototype.isRowHeading=function Owa$UIControls$VLV$prototype$isRowHeading(oRw){return oRw.get_Id()==VR};Owa.UIControls.VLV.prototype.isRow=function Owa$UIControls$VLV$prototype$isRow(oRw){var id=oRw.get_Id();return(id==VR||id==SR||id==VER)&&oRw.get_IsShown()};Owa.UIControls.VLV.prototype.gtRwHt=function Owa$UIControls$VLV$gtRwHt(oR){var iH=oR.get_OffsetHeight();if(oR.get_Id()==VR){oR=oR.get_NextSibling();while(oR&&(oR.get_Id()==SR||oR.get_Id()==VER)){if(this.isRow(oR)){iH+=oR.get_OffsetHeight()}oR=oR.get_NextSibling()}}return iH};Owa.UIControls.VLV.prototype.getTypicalRowHeight=function Owa$UIControls$VLV$getTypicalRowHeight(){if(this._iTypicalRowHeight<=0){this._iTypicalRowHeight=this.getTotalChunkHeight()/(this.ER()-this.SR()+1)}return this._iTypicalRowHeight};Owa.UIControls.VLV.prototype.getEstimatedViewHeight=function Owa$UIControls$VLV$prototype$getEstimatedViewHeight(){return(this.getTypicalRowHeight()*(this.iTC-(this.ER()-this.SR()+1)))+this.getTotalChunkHeight()};Owa.UIControls.VLV.prototype.getCurrentViewTop=function Owa$UIControls$VLV$prototype$getCurrentViewTop(){if(this.oCurRowPosition.iRow==0&&this.oCurRowPosition.iSubRow==0){return 0}var rgRowInfo=this.getRowInfos();for(var iRow=0;iRow<rgRowInfo.length;++iRow){if(rgRowInfo[iRow].oRowPosition.equals(this.oCurRowPosition)){return Math.floor(rgRowInfo[iRow].iViewPortOffset+(this.SR()*this.getTypicalRowHeight()))}}return Math.floor(this.gtVPH()+this.getTypicalRowHeight()*this.SR())};Owa.UIControls.VLV.prototype.getTotalChunkHeight=function Owa$UIControls$VLV$getTotalChunkHeight(){var rgRowInfo=this.getRowInfos();var oLastRowInfo=rgRowInfo[rgRowInfo.length-1];if(oLastRowInfo){return oLastRowInfo.iViewPortOffset+oLastRowInfo.oRow.get_OffsetHeight()}else{return 0}};Owa.UIControls.VLV.prototype.initChnk=function Owa$UIControls$VLV$initChnk(oC){if(getInt(oC.getAttribute("fNoRws"))||getInt(oC.getAttribute("fNull")))return;var rgR=oC.getAllDescendantsById(VR);for(var i=0;i<rgR.get_Length();i++){if(this.oSel[this.getData(rgR.get_Item(i)).sId]&&this.oSel[this.getData(rgR.get_Item(i)).sId].fSel){this.sel(rgR.get_Item(i),1)}}};Owa.UIControls.VLV.prototype.getData=function Owa$UIControls$VLV$getData(o){if(!o)return;var oData=o;if(!o.hasCssClass("cData"))oData=o.get_FirstChild();if(oData.get_NodeType()==Owa.NodeType.Element){oData.sId=oData.get_Id().substring(1);var sInstanceKey=oData.getAttribute("ik");oData.sInstanceKey=sInstanceKey?sInstanceKey:0}return oData};Owa.UIControls.VLV.prototype.fndRw=function Owa$UIControls$VLV$fndRw(o){var oR;if(!oR)oR=o.getAncestorById(VR,CHUNK);if(!oR){oR=o.getAncestorById(SR,CHUNK);if(oR){while(oR.get_Id()!=VR)oR=oR.get_PreviousSibling()}}if(!oR){oR=o.getAncestorById(VER,CHUNK)}return oR};Owa.UIControls.VLV.prototype.gtPrpV=function Owa$UIControls$VLV$gtPrpV(oR,sP){var oData=this.getData(oR);var oV=oData.getAttribute(sP);if(oV)return oV;var oE=oR.getDescendantById(sP);while(!oE&&oR.get_NextSibling()&&oR.get_NextSibling().get_Id()==SR){oR=oR.get_NextSibling();oE=oR.getDescendantById(sP)}if(!oE){return null}oV=oE.getAttribute("v");if(oV)return oV;var iEI=1;if(oE._oDomNode){var oEDom=oE._oDomNode;if(oEDom.tagName=="SELECT"){iEI=oEDom.selectedIndex+1;oEDom=oEDom[oEDom.selectedIndex]}if(sP=="ea"){var oEA={};oEA._em=oEDom.getAttribute("em");oEA._uri=oEDom.getAttribute("uri");oEA._dn=oEDom.getAttribute("dn");oEA._ao=oEDom.getAttribute("aO");oEA._rf=oEDom.getAttribute("rf");oEA._rt=oEDom.getAttribute("rt");oEA._lgDn=oEDom.getAttribute("lgDn");oEA._ei=(oEDom.getAttribute("aO")==AO_S&&oEDom.getAttribute("rt")!=RT_PDL?iEI:0);if(!oEA._uri&&isMSNPrv()){oEA._uri=oEA._em}return oEA}}return oE.get_TextContent()};Owa.UIControls.VLV.prototype.rmvRw=function Owa$UIControls$VLV$rmvRw(sId,fSE){if(this.oSel[sId]){this.oSel[sId].fSel=false;if(!fSE){this.feSelChg(sId,0,1)}delete this.oSel[sId]}if(this.get_SelectionAnchorId()==sId)this.set_SelectionAnchorId(0);if(this.sLstSel==sId)this.sLstSel=0;var oR=this.gtRwById(sId);if(!oR)return;this.clearRowCache();if(oR.get_Id()!=VR){oR.remove(true);return}var oCh=this.fndChnk(oR);var oGH=this.fndGH(oR);var oSR=oR.get_NextSibling();while(oSR&&oSR.get_Id()==SR){oSR.remove(true);oSR=oR.get_NextSibling()}this.iTC--;if(this.isCnvVw&&this.isCnvVw()&&this.isRowHeading(oR)){var rgCnv=[sId];this.iTIC-=this.gtCnvTC(rgCnv);this.iUC-=this.gtCnvUC(rgCnv,1)}else{this.iTIC--}if(oR.get_Id()==VER){var sParentPartId=this.gtPrpV(oR,"pId");var fChildFound=false;var oSibling=oR.get_PreviousSibling();while(oSibling&&oSibling.get_Id()==VER){if(this.gtPrpV(oSibling,"pId")==sId){oSibling.setAttribute("pId",sParentPartId);fChildFound=true}oSibling=oSibling.get_PreviousSibling()}if(!fChildFound){var oSibling=oR.get_NextSibling();while(oSibling&&oSibling.get_Id()==VER){if(this.gtPrpV(oSibling,"pId")==sId){oSibling.setAttribute("pId",sParentPartId)}oSibling=oSibling.get_NextSibling()}}}oR.remove(true);if(oGH)this.rmvG(oGH);var oTCh=oCh.get_NextSibling();while(oTCh){oTCh.setIntAttribute("iSR",oTCh.getIntAttribute("iSR")-1);oTCh.setIntAttribute("iER",oTCh.getIntAttribute("iER")-1);oTCh=oTCh.get_NextSibling()}oCh.setIntAttribute("iER",oCh.getIntAttribute("iER")-1);if(oCh.getIntAttribute("iER")<oCh.getIntAttribute("iSR"))oCh.remove(true)};Owa.UIControls.VLV.prototype.fndGH=function Owa$UIControls$VLV$fndGH(o){o=o.getAncestorById("gc",VP);if(o){return o.get_PreviousSibling()}};Owa.UIControls.VLV.prototype._getGroupHeaderHeight=function Owa$UIControls$VLV$_getGroupHeaderHeight(oR){if(!oR){oR=this.getRowInfoFromPosition(new RowPosition(0,0)).oRow}if(!this._iGHHeight){var oGH=this.fndGH(oR);this._iGHHeight=((oGH)?oGH.get_OffsetHeight():0)}return this._iGHHeight};Owa.UIControls.VLV.prototype._getRowHeaderText=function Owa$UIControls$VLV$prototype$_getRowHeaderText(oR){var oGH=this.fndGH(oR);if(!oGH){return""}return oGH.get_TextContent()};Owa.UIControls.VLV.prototype.rmvG=function Owa$UIControls$VLV$rmvG(oH){var oC=oH.get_NextSibling();var oIL=oC.getChildById(IL);if(oIL.hasChildNodes())return;oC.remove(true);oH.remove(true)};Owa.UIControls.VLV.prototype.fndChnk=function Owa$UIControls$VLV$fndChnk(o){return o.getAncestorById(CHUNK,VP)};Owa.UIControls.VLV.prototype.gtRwChld=function Owa$UIControls$VLV$gtRwChld(oR,sId){var o=oR.getDescendantById(sId);if(!o){oR=oR.get_NextSibling();while(!o&&oR&&oR.get_Id()==SR){o=oR.getDescendantById(sId);oR=oR.get_NextSibling()}}return o};Owa.UIControls.VLV.prototype.addLVSt=function Owa$UIControls$VLV$addLVSt(oR){};Owa.UIControls.VLV.prototype.shwPrgrs=function Owa$UIControls$VLV$shwPrgrs(iPrg){var oLV=this._get_Element();this.iPrgT=0;var o=this._getDescendant(PROGRESS_BACKGROUND);o.set_Height(oLV.get_ClientHeight());o.set_Width(oLV.get_ClientWidth());o.moveToTop();o.set_IsShown(true);var o=this._getDescendant(PROGRESS_INDICATOR);var sAttributeName;switch(iPrg){case PRG_LD:sAttributeName="L_Ldng";break;case PRG_SRCH:sAttributeName="L_Srchng";break;case PRG_FLTR:sAttributeName="L_Fltrng";break}o.getChildById("spnTxt").set_TextContent(oLV.getAttribute(sAttributeName));o.set_Top(-10000);o.set_Left(-10000);o.set_IsShown(true);var iWidth=0;o.forEachChild(function(oChild){iWidth+=oChild.get_OffsetWidth()});o.set_Width(iWidth+o._get_EffectivePaddingBorderWidth());o.set_Top((oLV.get_ClientHeight()-o.get_ClientHeight())/2);o.set_Left((oLV.get_ClientWidth()-o.get_ClientWidth())/2);o.moveToTop()};Owa.UIControls.VLV.prototype.cnclPrgrs=function Owa$UIControls$VLV$cnclPrgrs(){if(this.iPrgT){this._clearTimeout(this.iPrgT);this.iPrgT=0}this._getDescendant(PROGRESS_BACKGROUND).set_IsShown(false);this._getDescendant(PROGRESS_INDICATOR).set_IsShown(false)};Owa.UIControls.VLV.prototype.strtLd=function Owa$UIControls$VLV$strtLd(sFn,rgArgs){if(this.fPndLd||(this.rgPndLd.get_Length()&&!this._fQLd)){this.enqOp(sFn,rgArgs);return 0}else{this.fPndLd=1;this._iLastLoadActionTime=(new Date()).getTime();return 1}};Owa.UIControls.VLV.prototype.shouldClearPendingRequests=function(fForceRefresh,sRId){return(this.fPndLd&&(fForceRefresh||(isDf(typeof(sRId))&&sRId=="manualrefresh"&&(this._iLastLoadActionTime>0&&((new Date()).getTime()>this._iLastLoadActionTime+60*1000)))))};Owa.UIControls.VLV.prototype.clearPendingRequests=function Owa$UIControls$VLV$clearPendingRequests(){Owa.Components.OehRequest.abortOehRequests(this.sEvtNS,{"LoadFresh":1,"LoadNext":1,"LoadPrevious":1,"SeekNext":1,"SeekPrevious":1,"Sort":1,"TypeDown":1});this.cnclPrgrs();this.rgPndLd=[];this.fPndLd=0};Owa.UIControls.VLV.prototype.enqOp=function Owa$UIControls$VLV$enqOp(sFn,rgArgs){if(LOAD_PRIORITY[sFn]>0){var i=0;while(i<this.rgPndLd.get_Length()){if(this.rgPndLd[i]&&((LOAD_PRIORITY[this.rgPndLd[i].sFn]<=1)||(LOAD_PRIORITY[this.rgPndLd[i].sFn]==LOAD_PRIORITY[sFn]))){this.rgPndLd.splice(i,1)}else{i++}}}var o={};o.sFn=sFn;o.rgArgs=rgArgs;this.rgPndLd.push(o)};Owa.UIControls.VLV.prototype.endLd=function Owa$UIControls$VLV$endLd(){if(this.fPndLd){this.fPndLd=0;this._setTimeout(this.cbEndLd,1)}};Owa.UIControls.VLV.prototype.cbEndLd=function Owa$UIControls$VLV$cbEndLd(){while(this.rgPndLd.get_Length()>0&&!this.fPndLd){var o=this.rgPndLd.shift();this._fQLd=1;this[o.sFn].apply(this,o.rgArgs);this._fQLd=0}};Owa.UIControls.FldrVLV=function Owa$UIControls$FldrVLV(oSubPage,o){Owa.UIControls.FldrVLV.constructBase(this,[oSubPage,o]);this.fFltrdVw=0};Owa.UIControls.FldrVLV.createClass("Owa.UIControls.FldrVLV",Owa.UIControls.VLV);var FldrVLV=ns.FldrVLV.prototype;Owa.UIControls.FldrVLV.prototype.initialize=function Owa$UIControls$FldrVLV$initialize(){Owa.UIControls.FldrVLV.callBase(this,"initialize")};Owa.UIControls.FldrVLV.prototype.isFldr=function Owa$UIControls$FldrVLV$isFldr(){return 1};Owa.UIControls.FldrVLV.prototype.onMouseMove=function Owa$UIControls$FldrVLV$onMouseMove(oEvent){var oS=oEvent.get_Target();var oE=this.fndFlg(oS);if(!oE)oE=this.fndCat(oS);if(oE){if(oEvent.get_Type()=="mouseout")oE.removeCssClass(HOVER);else oE.addCssClass(HOVER)}else{Owa.UIControls.FldrVLV.callBase(this,"onMouseMove",[oEvent])}};Owa.UIControls.FldrVLV.prototype.fltrVw=function Owa$UIControls$FldrVLV$fltrVw(oFilterCriteria,oFn){this._oPrevFilterCriteria=null;this._oFilterCriteria=oFilterCriteria;this._cbFilterCallback=oFn;if(this._oFilterCriteria.get_isValid()){this.clrSel(1);this.ldFrsh(0,PRG_FLTR,1,this.cbFltrVw,this.cbEnblFltrVw)}else{this.dsblFltrVw()}};Owa.UIControls.FldrVLV.prototype.get_FilterViewCriteria=function Owa$UIControls$FldrVLV$get_FilterViewCriteria(){return this._oFilterCriteria};Owa.UIControls.FldrVLV.prototype.enblFltrVw=function Owa$UIControls$FldrVLV$enblFltrVw(){if(this.isInFltrdVw())return;this._oFilterCriteria=this._oPrevFilterCriteria;var fSucc=this._oFilterCriteria.get_isValid();if(!fSucc){this.dsblFltrVw();return}this.clrSel(1);this.ldFrsh(0,PRG_FLTR,1,this.cbFltrVw,this.cbEnblFltrVw)};Owa.UIControls.FldrVLV.prototype.dsblFltrVw=function Owa$UIControls$FldrVLV$dsblFltrVw(){if(!this._oFilterCriteria||!this.isInFltrdVw())return;this.clrSel(1);this._oPrevFilterCriteria=this._oFilterCriteria;this._oFilterCriteria=null;this.ldFrsh(0,PRG_LD,1,this.cbFltrVw,this.cbDsblFltrVw)};Owa.UIControls.FldrVLV.prototype.cbEnblFltrVw=function Owa$UIControls$FldrVLV$cbEnblFltrVw(oLV,oR){oLV.fFltrdVw=1};Owa.UIControls.FldrVLV.prototype.cbDsblFltrVw=function Owa$UIControls$FldrVLV$cbDsblFltrVw(oLV,oR){oLV.fFltrdVw=0};Owa.UIControls.FldrVLV.prototype.cbFltrVw=function Owa$UIControls$FldrVLV$cbFltrVw(oLV,oR){var rgR=oLV.gtRws();if(rgR.get_Length()>0)oLV.selSngl(rgR.get_Item(0));if(isDf(typeof oLV._cbFilterCallback))oLV._cbFilterCallback(oLV,oR)};Owa.UIControls.FldrVLV.prototype.isInFltrdVw=function Owa$UIControls$FldrVLV$isInFltrdVw(){return this.fFltrdVw};Owa.UIControls.FldrVLV.prototype.prcsDta=function Owa$UIControls$FldrVLV$prcsDta(oD){Owa.UIControls.FldrVLV.callBase(this,"prcsDta",[oD])};Owa.UIControls.FldrVLV.prototype.addFltrVwSt=function Owa$UIControls$FldrVLV$addFltrVwSt(oR){if(!this._oFilterCriteria)return;this._oFilterCriteria.addStatement(oR,this.sSid)};Owa.UIControls.FldrVLV.prototype.addLVSt=function Owa$UIControls$FldrVLV$addLVSt(oR){var oST=new oeSt(oR,"FVLVS");oST.add("sId",this.sSid);oST.add("mL",this.fML);oST.add("sC",this.iSC);oST.add("sO",this.iSO);oR.addSt("St",oST);this.addFltrVwSt(oR);if(this.fSrch)this.fnGtSF(oR);if(this.iFltr)oR.add("fltr",this.iFltr)};Owa.UIControls.FldrVLV.prototype.onMD=function Owa$UIControls$FldrVLV$onMD(oEvent){var o=oEvent.get_Target();var oR=this.fndRw(o);var oData=this.getData(oR);if(this.fndFlg(o)&&oEvent.isLeftButtonDown()){var iFA=FA_MrkCmpl;var sId;if(!this.isSel(oR))sId=oData.sId;this.oMU=0;var sFS=oData.getAttribute("sFS");var sFA=oData.getAttribute("sFA");if((sFS&&getInt(sFS))||!Owa.UIControls.FlagContextMenu.isFlagAction((isDf(typeof(sFA)))?getInt(sFA):0))iFA=FA_Dflt;this.flgItms(iFA,0,sId)}else if(this.fndCat(o)){if(!this.isSel(oR)){this.selSngl(oR,false,true)}this.shwCatMnu(oEvent.get_ClientX(),oEvent.get_ClientY())}else if(oData&&this.sExpId&&this.sExpId==oData.sId){return}else{Owa.UIControls.FldrVLV.callBase(this,"onMD",[oEvent])}};Owa.UIControls.FldrVLV.prototype.onCMVP=function Owa$UIControls$FldrVLV$onCMVP(oEvent){if(oEvent.isCtrlKeyDown()){oEvent.preventDefault();oEvent.cancelBubble();return}var o=oEvent.get_Target();if(this.fndFlg(o)){this.shwFlgMnu(oEvent.get_ClientX(),oEvent.get_ClientY())}else if(this.fndCat(o)){return}else{Owa.UIControls.FldrVLV.callBase(this,"onCMVP",[oEvent])}};Owa.UIControls.FldrVLV.prototype.emptyFolder=function Owa$UIControls$FldrVLV$emptyFolder(){var sMthd;var oCallerSubPage=this.get_SubPage();if(isDf(typeof(this.getSubPageVariable("a_fInDelItms")))&&this.getSubPageVariable("a_fInDelItms"))sMthd="EmptyDeletedItems";else if(isJnkFld(oCallerSubPage))sMthd="EmptyJunkEmail";else sMthd="EmptyFolder";g_oFldrMgr.emptyFld(this,sMthd,this.sSid)};Owa.UIControls.FldrVLV.prototype.shwFlgMnu=function Owa$UIControls$FldrVLV$shwFlgMnu(iX,iY,oFlagButton){var oFlagMenu=Owa.UIControls.FlagContextMenu.get_Instance(true);var oLV=this;oFlagMenu.get_OnSelectFlag().add(function(oEventArgs){oLV.flgItms(oEventArgs.sCommand,oEventArgs.dtDate)});var iSC=this.gtSelCnt();oFlagMenu.set_SelectCount(iSC);if(iSC==1){var rgR=this.gtSel();var oR=this.gtRwById(rgR.get_Item(0));var oData=this.getData(oR);var sFA=oData.getAttribute("sFA");var iFA=sFA?getInt(sFA):0;oFlagMenu.set_FlagAction(iFA);oFlagMenu.set_IsOnConversationHeader(oData.getAttribute("t")=="IPM.Conversation");var sFlgDt=oData.getAttribute("sFlgDt");var dt=sFlgDt?new Date(sFlgDt):0;if(dt)oFlagMenu.set_DueDate(dt);var fTask=isOfClss(oData.getAttribute("t"),"IPM.Task");oFlagMenu.set_IsSelectedItemTask(fTask)}oFlagMenu.set_FlagButton(oFlagButton);oFlagMenu.show(iX,iY)};Owa.UIControls.FldrVLV.prototype.flgItms=function Owa$UIControls$FldrVLV$flgItms(sC,dt,sId){var rgItms=[sId];if(!sId)rgItms=this.gtSel();var iFA=getInt(sC);if(iFA==FA_DtRem){var oLV=this;var fn=function(iFA,sId,sCK,sIB,dtDD){oLV.onClsFD(iFA,sId,sCK,sIB,dtDD)};Owa.UIControls.FlagDialog.loadInstanceAndShow(fn,rgItms.get_Item(0));return}if(rgItms.length==0)return;var oC={};oC.rgItms=rgItms;oC.iFA=iFA;oC.fSI=!!sId;var oR=new oeReq(this.sEvtNS,"flgItms",oC,this._createCallback(this.cbFlgItms));oR.addRg("Itms",rgItms);oR.add("flga",sC);if(dt)oR.add("ddt",dt);oR.send()};Owa.UIControls.FldrVLV.prototype.cbFlgItms=function Owa$UIControls$FldrVLV$cbFlgItms(oR){if(!cbOeh(oR))return;eval(oR.sBody);var oC=oR.oCtx;var rgItms=oC.rgItms;var fSI=oC.fSI;var iFA=oC.iFA;var fSel=false;for(var i=0;i<rgItms.get_Length();++i){var sId=rgItms.get_Item(i);if(fSI)this.selRwById(sId);if(sCR.charAt(i)!='1')continue;if(dtDD)this.stRwPrp(sId,"sFlgDt",dtDD);var sType=this.gtRwPrp(sId,"t");if(iFA==FA_ClrFlg&&(isOfClss(sType,IT_TSK)||this.get_SubPage().get_IsFlaggedMailAndTasks()))this.rmvRws([sId]);else this.flgItm(iFA,sId);if(this.oSel[sId]){fSel=true}}var oW=window.parent;if(oW&&oW.stDrty&&a_sTsks)oW.stDrty(a_sTsks,0);if(!fSI&&fSel){this._setTimeout(this.feSelChg,100)}};Owa.UIControls.FldrVLV.prototype.flgItm=function Owa$UIControls$FldrVLV$flgItm(iFA,sId){var sImg="icon-flag.gif";if(iFA==FA_MrkCmpl)sImg="flg-compl.gif";else if(iFA==FA_ClrFlg)sImg="flg-empty.gif";var oData=this.getData(this.gtRwById(sId));if(oData!=null){oData.setIntAttribute("sFA",iFA);oData.setIntAttribute("sFS",0);var oFlg=oData.get_ParentElement().getDescendantById("imgFlg");if(oFlg){Owa.Components.CssSprites.updateImage(oFlg,sImg)}}};Owa.UIControls.FldrVLV.prototype.onClsFD=function Owa$UIControls$FldrVLV$onClsFD(iFA,sId,sCK,sIB,dtDD){this.flgItm(iFA,sId);if(dtDD)this.stRwPrp(sId,"sFlgDt",dtDD);this.feSelChg()};Owa.UIControls.FldrVLV.prototype.fndFlg=function Owa$UIControls$FldrVLV$fndFlg(o){return o.getAncestorById(FLAG_CELL,VP)};Owa.UIControls.FldrVLV.prototype.shwCatMnu=function Owa$UIControls$FldrVLV$shwCatMnu(iX,iY,oCategoryButton){var oCategoryMenu=Owa.UIControls.CategoryMenu.get_Instance(true);var oLV=this;var fnOnSel=function(oArguments){oLV.onSelCat(oArguments.rgAdd,oArguments.rgRem)};var fnOnClr=function(){oLV.onClrCat()};oCategoryMenu.set_ItemType(this.getSubPageVariable("a_iT"));oCategoryMenu.set_FolderId(this.sSid);oCategoryMenu.get_OnChangeCategory().add(fnOnSel);oCategoryMenu.get_OnClearCategory().add(fnOnClr);this.rgCatSelItms=this.gtSel();var rgCategoriesOfItems=[];for(var i=0;i<this.rgCatSelItms.get_Length();i++){var rgCategories=[];var oCats=this.gtRwChld(this.gtRwById(this.rgCatSelItms.get_Item(i)),CATEGORY_GROUP);var sTitle=oCats.getAttribute("title");if(sTitle&&sTitle.length){rgCategories=sTitle.split(";")}rgCategoriesOfItems.add(rgCategories)}oCategoryMenu.updateStates(rgCategoriesOfItems,oCategoryButton);oCategoryMenu.show(iX,iY)};Owa.UIControls.FldrVLV.prototype.onSelCat=function Owa$UIControls$FldrVLV$onSelCat(rgAdd,rgRem){var oR=new oeReq(this.sEvtNS,"catItms",this.rgCatSelItms,this._createCallback(this.cbSelCat));oR.addRg("Itms",this.rgCatSelItms);oR.addRg("catAdd",rgAdd);oR.addRg("catRem",rgRem);oR.add("fId",this.sSid);oR.send()};Owa.UIControls.FldrVLV.prototype.cbSelCat=function Owa$UIControls$FldrVLV$cbSelCat(oR){if(!cbOeh(oR))return;this.feSelChg(this.gtSel()[0],true);var ci=function(sS,sT){return{sSwtch:sS,sTtl:sT}};eval(oR.sBody);var rgItms=oR.oCtx;for(var i=0;i<rgItms.get_Length();++i){if(sCR.charAt(i)=='1'){var oCI=rgItmCats.get_Item(i);this.stItmCats(rgItms.get_Item(i),oCI.sTtl,oCI.sSwtch)}}};Owa.UIControls.FldrVLV.prototype.onClrCat=function Owa$UIControls$FldrVLV$onClrCat(){var oR=new oeReq(this.sEvtNS,"catClr",this.rgCatSelItms,this._createCallback(this.cbClrCat));oR.addRg("Itms",this.rgCatSelItms);oR.send()};Owa.UIControls.FldrVLV.prototype.cbClrCat=function Owa$UIControls$FldrVLV$cbClrCat(oR){if(!cbOeh(oR))return;var rgItms=oR.oCtx;eval(oR.sBody);for(var i=0;i<rgItms.get_Length();++i){if(sCR.charAt(i)=='1')this.stItmCats(rgItms.get_Item(i),"",sECS)}this.feSelChg()};Owa.UIControls.FldrVLV.prototype.stItmCats=function Owa$UIControls$FldrVLV$stItmCats(sId,sTtl,sSwtch){var oR=this.gtRwById(sId);if(!oR)return;var oCats=this.gtRwChld(oR,CATEGORY_GROUP);oCats.setAttribute("title",sTtl);oCats.set_InnerHtml(sSwtch)};Owa.UIControls.FldrVLV.prototype.fndCat=function Owa$UIControls$FldrVLV$fndCat(o){return o.getAncestorById(CATEGORY_CELL,VP)};Owa.UIControls.MsgVLV=function Owa$UIControls$MsgVLV(oSubPage,o){Owa.UIControls.MsgVLV.constructBase(this,[oSubPage,o]);var oN=o;this.iUC=oN.getIntAttribute("iUC");this.fCV=getInt(oN.getAttribute("fCV"));this.fFUR=getInt(oN.getAttribute("fFUR"));this.fOutlookFUR=getInt(oN.getAttribute("fOutlookFUR"));this.fJnk=!!getInt(oN.getAttribute("fJnk"));this.fPndExp=0;this._oPipe=null;this._MapMsToCs=null;this._MapCsToMs=null;this.initSortMappings()};Owa.UIControls.MsgVLV.createClass("Owa.UIControls.MsgVLV",Owa.UIControls.FldrVLV);var MsgVLV=ns.MsgVLV.prototype;Owa.UIControls.MsgVLV.prototype.initialize=function Owa$UIControls$MsgVLV$initialize(){Owa.UIControls.MsgVLV.callBase(this,"initialize");this._showFilteredByUnreadPont()};Owa.UIControls.MsgVLV.prototype.dispose=function Owa$UIControls$MsgVLV$dispose(){this.onCnvVwChg=null;this.onRfExp=null;Owa.UIControls.MsgVLV.callBase(this,"dispose")};Owa.UIControls.MsgVLV.prototype.stOnCnvVwChg=function Owa$UIControls$MsgVLV$stOnCnvVwChg(fn){this.onCnvVwChg=fn};Owa.UIControls.MsgVLV.prototype.stOnRfExp=function Owa$UIControls$MsgVLV$stOnRfExp(fn){this.onRfExp=fn};Owa.UIControls.MsgVLV.prototype.onDblClkVP=function Owa$UIControls$MsgVLV$onDblClkVP(oEvent){if(this._shouldExpandConvo(oEvent)){this.expCnv(oEvent)}else{Owa.UIControls.MsgVLV.callBase(this,"onDblClkVP",[oEvent])}};Owa.UIControls.MsgVLV.prototype.onKD=function Owa$UIControls$MsgVLV$onKD(oEvent){if(Owa.Dom.Input.isInstance(oEvent.get_Target())&&!oEvent.get_Target().hasCssClass("offscreen")){return}if((oEvent.get_KeyCodeForKeyUpDown()==Owa.KeyCodes.ENTER)&&this._shouldExpandConvo(oEvent)){this.expCnv(oEvent)}else{Owa.UIControls.MsgVLV.callBase(this,"onKD",[oEvent])}};Owa.UIControls.MsgVLV.prototype.onMD=function Owa$UIControls$MsgVLV$onMD(oEvent){var o=oEvent.get_Target();if(this.fndExp(o)&&oEvent.isLeftButtonDown()&&this._shouldExpandConvo(oEvent)){this.expCnv(oEvent)}else{Owa.UIControls.MsgVLV.callBase(this,"onMD",[oEvent])}};Owa.UIControls.MsgVLV.prototype.onClkVP=function Owa$UIControls$MsgVLV$onClkVP(oEvent){var oTarget=oEvent.get_Target();var sId=oTarget.get_Id();if(sId=="startVM")this._startVM(oTarget);else if(sId=="stopVM")this._stopVM(oTarget);Owa.UIControls.MsgVLV.callBase(this,"onClkVP",[oEvent])};Owa.UIControls.MsgVLV.prototype.onClkHdr=function Owa$UIControls$MsgVLV$onClkHdr(oEvent){this._computeABMCtxMnu(oEvent);Owa.UIControls.MsgVLV.callBase(this,"onClkHdr",[oEvent])};Owa.UIControls.MsgVLV.prototype.onCMHdr=function Owa$UIControls$MsgVLV$onCMHdr(oEvent){this._computeABMCtxMnu(oEvent);Owa.UIControls.MsgVLV.callBase(this,"onCMHdr",[oEvent])};Owa.UIControls.MsgVLV.prototype._computeABMCtxMnu=function Owa$UIControls$MsgVLV$_computeABMCtxMnu(oEvent){var o=oEvent.get_Target();var isCnv=this.isCnvVw&&this.isCnvVw();if(o.getAncestorById("tdAB",HDRS)&&this.oABM){var rgAllMenuItems=this.oABM.getAllMenuItems();for(var iIndex=0;iIndex<rgAllMenuItems.length;iIndex++){var oMenuItem=rgAllMenuItems[iIndex];var oCidAttribute=oMenuItem.getAttribute("_cid");if(oCidAttribute==MessageSortColumn.FlagDueDate||oCidAttribute==MessageSortColumn.FlagStartDate){oMenuItem.set_IsShown(isCnv?false:true)}else if(oCidAttribute==ConversationSortColumn.ConversationFlagStaus){oMenuItem.set_IsShown(isCnv?true:false)}else if(oMenuItem.get_Id()=="gbyCnv"){this.oABM.replaceMenuItemIcon(oMenuItem.get_Id(),isCnv?"chk-chkd.gif":"chk-unchk.gif")}if(this.doesMIMatchSC(isCnv,oCidAttribute)){var oImg=oMenuItem.getDescendantById("imgI");Owa.Components.CssSprites.updateImage(oImg,"flg-compl.gif")}else if(oCidAttribute){var oImg=oMenuItem.getDescendantById("imgI");Owa.Components.CssSprites.updateImage(oImg,"clear.gif")}}}};Owa.UIControls.MsgVLV.prototype.doesMIMatchSC=function Owa$UIControls$MsgVLV$doesMIMatchSC(isCnv,oCidAttribute){if(isCnv){if(oCidAttribute==ConversationSortColumn.ConversationFlagStaus&&oCidAttribute==this.iSC){return true}else if(oCidAttribute==this._MapCsToMs[this.iSC]){return true}}else{if(oCidAttribute==this.iSC){return true}}if(oCidAttribute==MessageSortColumn.SentDate&&(this.iSC==MessageSortColumn.Date||this.iSC==ConversationSortColumn.ConversationLastDeliveryTime)){return true}return false};Owa.UIControls.MsgVLV.prototype.onClkABM=function Owa$UIControls$MsgVLV$onClkABM(oEventArgs){if(!oEventArgs.oMenuItem)return;var o=oEventArgs.oMenuItem;var oMenu=oEventArgs.oMenu;if(o.get_Id()=="gbyCnv"){var isCnv=o.getIntAttribute("isCnv");oMenu.replaceMenuItemIcon(o.get_Id(),isCnv?"chk-unchk.gif":"chk-chkd.gif");o.setIntAttribute("isCnv",isCnv?0:1);this.srt(this.iSC,this.iSO)}else{Owa.UIControls.MsgVLV.callBase(this,"onClkABM",[oEventArgs])}};Owa.UIControls.MsgVLV.prototype.initSortMappings=function Owa$UIControls$MsgVLV$initSortMappings(){if(this._MapMsToCs==null){var mSToCs={};mSToCs[MessageSortColumn.Type]=ConversationSortColumn.ConversationMessageClasses;mSToCs[MessageSortColumn.From]=ConversationSortColumn.ConversationMVFrom;mSToCs[MessageSortColumn.To]=ConversationSortColumn.ConversationMVTo;mSToCs[MessageSortColumn.Subject]=ConversationSortColumn.ConversationTopic;mSToCs[MessageSortColumn.HasAttachment]=ConversationSortColumn.ConversationHasAttach;mSToCs[MessageSortColumn.Importance]=ConversationSortColumn.ConversationImportance;mSToCs[MessageSortColumn.Date]=ConversationSortColumn.ConversationLastDeliveryTime;mSToCs[MessageSortColumn.SentDate]=ConversationSortColumn.ConversationLastDeliveryTime;mSToCs[MessageSortColumn.Size]=ConversationSortColumn.ConversationSize;mSToCs[MessageSortColumn.FlagDueDate]=ConversationSortColumn.ConversationFlagStaus;mSToCs[MessageSortColumn.FlagStartDate]=ConversationSortColumn.ConversationFlagStaus;this._MapMsToCs=mSToCs}if(this._MapCsToMs==null){var cSToMs={};cSToMs[ConversationSortColumn.ConversationMessageClasses]=MessageSortColumn.Type;cSToMs[ConversationSortColumn.ConversationMVFrom]=MessageSortColumn.From;cSToMs[ConversationSortColumn.ConversationMVTo]=MessageSortColumn.To;cSToMs[ConversationSortColumn.ConversationTopic]=MessageSortColumn.Subject;cSToMs[ConversationSortColumn.ConversationHasAttach]=MessageSortColumn.HasAttachment;cSToMs[ConversationSortColumn.ConversationImportance]=MessageSortColumn.Importance;cSToMs[ConversationSortColumn.ConversationLastDeliveryTime]=MessageSortColumn.Date;cSToMs[ConversationSortColumn.ConversationSize]=MessageSortColumn.Size;cSToMs[ConversationSortColumn.ConversationFlagStaus]=MessageSortColumn.FlagDueDate;this._MapCsToMs=cSToMs}};Owa.UIControls.MsgVLV.prototype.srt=function Owa$UIControls$MsgVLV$srt(iSC,iSO){var oMenuItem;if(this.oABM){oMenuItem=this.oABM.getMenuItem("gbyCnv")}var isCnv=oMenuItem&&oMenuItem.getIntAttribute("isCnv");var iNewSC=isCnv?this._MapMsToCs[iSC]:this._MapCsToMs[iSC];if(iNewSC==undefined){iNewSC=iSC}if(this.sExpId&&this.sExpId!=""&&!isCnv){var oR=this.gtRwById(this.sExpId);this.expRw(0);this.selSngl(oR,false,false)}if(isCnv)this.clrSel(1);Owa.UIControls.MsgVLV.callBase(this,"srt",[iNewSC,iSO])};Owa.UIControls.MsgVLV.prototype._stopVM=function Owa$UIControls$MsgVLV$_stopVM(oElement){var oMediaPlayer=Owa.UIControls.MediaPlayer.get_Instance();this.switchVMImgState(oElement,false);oMediaPlayer.stop()};Owa.UIControls.MsgVLV.prototype._startVM=function Owa$UIControls$MsgVLV$_startVM(oElement){if(!oElement.getAttribute("_vmExt")){var oC=new Object();oC.oElement=oElement;var oR=new oeReq("ReadVMessage","GetAttachExt",oC,this._createCallback(this.cbGetAttExt));oR.add("Id",this.getData(this.fndRw(oElement)).sId);oR.send()}else{this.playVM(oElement)}};Owa.UIControls.MsgVLV.prototype.cbGetAttExt=function Owa$UIControls$MsgVLV$cbGetAttExt(oR){if(oR.sErr){if(oR.fST)popLgn();else shwErrDlg(oR);return}oR.oCtx.oElement.setAttribute("_vmExt",oR.sBody);this.playVM(oR.oCtx.oElement)};Owa.UIControls.MsgVLV.prototype.playVM=function Owa$UIControls$MsgVLV$playVM(oElement){var oMediaPlayer=Owa.UIControls.MediaPlayer.get_Instance();if(oMediaPlayer==null){shwErrDlg(0,L_MpUnErr);return}else{if(oMediaPlayer.isPlaying())oMediaPlayer.stop();this.switchVMImgState(oElement,true);oMediaPlayer.play(getVMAtt(oElement.getAttribute("_bId"),1,oElement.getAttribute("_vmExt")));var oContext={};oContext.oElement=oElement;oMediaPlayer.set_Controller(this);oMediaPlayer.get_OnComplete().add(this._createCallback(this._onVMPlayStop,oContext));oMediaPlayer.get_OnStop().add(this._createCallback(this._onVMPlayStop,oContext));oMediaPlayer.get_OnError().add(this._createCallback(this._onVMPlayError,oContext));this.mkRd(this.getData(this.fndRw(oElement)).sId)}};Owa.UIControls.MsgVLV.prototype._onVMPlayStop=function Owa$UIControls$MsgVLV$_onVMPlayStop(oArgument,oContext){var oMediaPlayer=Owa.UIControls.MediaPlayer.get_Instance();oMediaPlayer.set_Controller(null);this.switchVMImgState(oContext.oElement,false)};Owa.UIControls.MsgVLV.prototype._onVMPlayError=function Owa$UIControls$MsgVLV$_onVMPlayError(oArgument,oContext){var oMediaPlayer=Owa.UIControls.MediaPlayer.get_Instance();oMediaPlayer.set_Controller(null);this.switchVMImgState(oContext.oElement,false);shwErrDlg(0,L_MpErr)};Owa.UIControls.MsgVLV.prototype.switchVMImgState=function Owa$UIControls$MsgVLV$switchVMImgState(oElement,fIsPlaying){var oStartImg,oStopImg;if(oElement.get_Id()=="startVM"){oStartImg=oElement;oStopImg=oElement.get_NextSibling()}else{oStartImg=oElement.get_PreviousSibling();oStopImg=oElement}oStartImg.set_IsShown(!fIsPlaying);oStopImg.set_IsShown(fIsPlaying)};Owa.UIControls.MsgVLV.prototype._shouldExpandConvo=function Owa$UIControls$MsgVLV$_shouldExpandConvo(oEvent){var oR=this._findRowFromEventTarget(oEvent);if(!oR){return}var oData=this.getData(oR);var iGC=this.gtCnvGC([oData.sId]);return(this.get_SubPage().isCnvId(oData.sId)&&(iGC>1))};Owa.UIControls.MsgVLV.prototype._findRowFromEventTarget=function Owa$UIControls$MsgVLV$_findRowFromEventTarget(oEvent){var sT=oEvent.get_Type();var fMouseEvent=(sT.contains("mouse")||sT.contains("click"));var oR;if(fMouseEvent){oR=this.fndRw(oEvent.get_Target())}else if(this.sLstSel){var oLstSelRow=this._getOIdToRow()[this.sLstSel];if(oLstSelRow){oR=oLstSelRow.oRow}}return oR};Owa.UIControls.MsgVLV.prototype.expCnv=function Owa$UIControls$MsgVLV$expCnv(oEvent){var oR=this._findRowFromEventTarget(oEvent);var oData=this.getData(oR);if(this.gtCnvGC([oData.sId])<=1){return}if(this.sExpId&&this.sExpId==oData.sId){this.expRw(0);this.selSngl(oR);this.feSelChg(oData.sId,0,1);return}this.selSngl(oR);this.expRw(0);this.exp(oData.sId)};Owa.UIControls.MsgVLV.prototype.gtUC=function Owa$UIControls$MsgVLV$gtUC(){return this.iUC};Owa.UIControls.MsgVLV.prototype.isCnvVw=function Owa$UIControls$MsgVLV$isCnvVw(){return this.fCV};Owa.UIControls.MsgVLV.prototype.isFilteredByUnread=function Owa$UIControls$MsgVLV$isFilteredByUnread(){return this.fOutlookFUR||this.fFUR};Owa.UIControls.MsgVLV.prototype._isExpandedConversation=function Owa$UIControls$MsgVLV$_isExpandedConversation(sCnvId){return(this.sExpId?(this.sExpId==sCnvId):false)};Owa.UIControls.MsgVLV.prototype.feSelChg=function Owa$UIControls$MsgVLV$feSelChg(sId,fForceRpUd,fA){if(!this.isCnvVw()){Owa.UIControls.MsgVLV.callBase(this,"feSelChg",[sId,fForceRpUd]);return}this._clearConsecutiveNavigationTimer();if(this.onSelChg){var oE={};if(sId&&this.oSel[sId]){if(this.oSel[sId].sCnvId){oE.sMid=this.oSel[sId].sCnvId;oE.sIid=sId;oE.fExp=1}else{oE.sMid=sId}oE.fSel=this.oSel[sId].fSel;oE.fDontUdRP=fA}this.onSelChg(oE)}};Owa.UIControls.MsgVLV.prototype.feCnvVwChg=function Owa$UIControls$MsgVLV$feCnvVwChg(fCV){if(this.onCnvVwChg)this.onCnvVwChg(fCV)};Owa.UIControls.MsgVLV.prototype.feRfExp=function Owa$UIControls$MsgVLV$feRfExp(){if(this.onRfExp)this.onRfExp()};Owa.UIControls.MsgVLV.prototype.setSel=function Owa$UIControls$MsgVLV$setSel(rgIds){var iReadingPaneItemId=this.get_ItemIdInReadingPane();if(iReadingPaneItemId&&!(this.sExpId&&this.sExpId==iReadingPaneItemId))return;var oPR=this.gtRwById(this.sExpId);var iSC=this.gtSelCnt();if(this.isSel(oPR)&&iSC>1){this.sel(oPR,1);return}else if(!((this.isSel(oPR)&&iSC==1)||this.isSelExp()||iSC==0)){return}this.unSelRemaining(rgIds,1);if(rgIds){for(var i=0;i<rgIds.get_Length();i++){var oR=this.gtRwById(rgIds.get_Item(i));if(oR&&!this.isSel(oR)){this.sel(oR)}}}if(this.gtSelCnt()==0&&this.isSel(oPR)){this.selSngl(oPR)}};Owa.UIControls.MsgVLV.prototype.mkRd=function Owa$UIControls$MsgVLV$mkRd(sId,fRC){this.stRS(sId,1,fRC)};Owa.UIControls.MsgVLV.prototype.mkRdIP=function Owa$UIControls$MsgVLV$mkRdIP(sId,sFId,sCnvId){var oPR=this.gtRwById(sCnvId);if(oPR&&this.sExpId&&sCnvId==this.sExpId){this.stRS(sId,1)}else if(sFId==this.sSid){if(oPR){var iUC=getInt(this.gtRwPrp(sCnvId,"iUC"))-1;this.stCnvCts(sCnvId,oPR,iUC,-1,-1)}this.iUC--;this.feERfrsh()}};Owa.UIControls.MsgVLV.prototype.mkUnrd=function Owa$UIControls$MsgVLV$mkUnrd(sId,iR,fRC){if(iR===null||iR===undefined)iR=-1;this.stRS(sId,iR,fRC)};Owa.UIControls.MsgVLV.prototype.mkAllRd=function Owa$UIControls$MsgVLV$mkAllRd(){var rg=this._getDescendant(VP).getAllDescendantsById(VR);if(!rg)return;if(!("length" in rg))rg=[rg];for(var i=0;i<rg.get_Length();i++)this.mkRd(this.getData(rg.get_Item(i)).sId);this.iUC=0;this.feERfrsh()};Owa.UIControls.MsgVLV.prototype.cnvDel=function Owa$UIControls$MsgVLV$cnvDel(rg,oMM,fP,fRf,cb,fIgnore){if(fIgnore&&this.isSelExp()){this.selSngl(this.gtRwById(rg[0]))}var oR=this.gtRwById(rg.get_Item(0));if(!oR){g_fDeleteInProgress=0;return}if(oR.get_Id()==VR){var oData=this.getData(oR);var iChildrenCnvCount=this.gtCnvTC(new Array(oData.sId));if(!fIgnore&&(PONT_DELCNV&a_iEnblPnt)&&(iChildrenCnvCount>1)){var oC={};oC.rg=rg;oC.oMM=oMM;oC.fRf=fRf;oC.fP=fP;oC.cb=cb;var oLV=this;var fn=function(iB,oC){oLV.cbDelCnvPont(iB,oC)};shwPont(PONT_DELCNV,L_DelCnv,L_WrnDlFlTtl,[L_OK,L_Cncl],0,fn,oC)}else{cb(fP,rg,oMM,0,fRf,0,fIgnore)}}else{fRf|=this.cnvDelCpMv(rg,-1,0,1,fRf,fIgnore);cb(fP,rg,oMM,0,fRf,1,fIgnore)}};Owa.UIControls.MsgVLV.prototype.cbDelCnvPont=function Owa$UIControls$MsgVLV$cbDelCnvPont(iB,oC){var fAbort=(iB==-1||iB==1);if(!fAbort){oC.fRf|=this.cnvDelCpMv(oC.rg,-1,0,0,oC.fRf)}oC.cb(oC.fP,oC.rg,oC.oMM,0,oC.fRf,0,0,fAbort)};Owa.UIControls.MsgVLV.prototype.cnvCpMv=function Owa$UIControls$MsgVLV$cnvCpMv(oReq,rg,sDstFId,fC){if(rg.get_Length()<=0)return;var oR=this.gtRwById(rg.get_Item(0));if(!oR)return;this.addLVSt(oReq);var fDel=g_oFldrMgr.isDelFId(sDstFId)&&(g_oFldrMgr.gtFL(this.get_FolderId())==g_oFldrMgr.gtFL(sDstFId));if(fC&&fDel)return;var iA=1;if(!fC)iA=fDel?-1:0;oReq.send();this.cnvDelCpMv(rg,iA,sDstFId&&sDstFId==this.get_FolderId(),oR.get_Id()==VER?1:0)};Owa.UIControls.MsgVLV.prototype.cbCnvCpMv=function Owa$UIControls$MsgVLV$cbCnvCpMv(oR){var oD=Document.get_Current().createElement("DIV");oD.set_InnerHtml(oR.sBody);this.initExp(oD)};Owa.UIControls.MsgVLV.prototype.cnvDelCpMv=function Owa$UIControls$MsgVLV$cnvDelCpMv(rg,iA,fDCF,fExp,fRf){if(fExp){if(!fRf&&iA<0){for(var i=0;i<rg.get_Length();i++){var oR=this.gtRwById(rg.get_Item(i));if(oR){if(this.gtRwPrp(rg.get_Item(i),"fLR")){fRf=1;break}}else{delete this.oSel[rg.get_Item(i)]}}if(this.isFltrd()){fRf=1}}this.cnvUdCts(rg,iA,fDCF);if(iA>0||(iA==0&&fDCF))return 0;var fCFR=0;var iT=0;var oR=this.gtRwById(rg.get_Item(0));var oPR=this.gtExpCnv(oR);var oR=oPR.get_NextSibling().get_NextSibling();var sSnglId=null;while(oR&&oR.get_Id()==VER){if(!this.isSel(oR)){iT++;if(iT==1){sSnglId=this.getData(oR).sId}if(!this.isXF(oR)){fCFR=1;if(iT>1)break}}oR=oR.get_NextSibling()}if(!this.isNonLclSrch()&&!fCFR){this.selSngl(oPR);this.rmvRws([this.getData(oPR).sId])}else if(iT<=1&&iA<0){this.cnvMkSngl(oPR);var oRP=this.get_SubPage().gtCnvRP();if(oRP&&sSnglId)oRP.setSel([sSnglId])}else if(fRf){var oNxtSel=this.gtSelAftrRmv(false,rg);if(oNxtSel)this.selSngl(oNxtSel);else this.selSngl(oPR)}return fRf}else{if(iA==0&&!fDCF){this.rmvRws(rg);this.feERfrsh()}else if(iA>0){var iFUC=this.iUC;var iFTC=this.iTIC;for(var i=0;i<rg.get_Length();i++){var rgCnv=[rg.get_Item(i)];var iCUC=this.gtCnvUC(rgCnv);var iCTC=this.gtCnvTC(rgCnv);var iCGC=this.gtCnvGC(rgCnv);var oR=this.gtRwById(rg.get_Item(i));if(!oR)continue;if(fDCF){iFUC+=iCUC;iFTC+=iCTC}if(iCGC==1)this.cnvMkMult(oR);iCGC+=iCTC;this.stCnvCts(rg.get_Item(i),oR,fDCF?iCUC*2:-1,fDCF?iCTC*2:-1,iCGC)}if(fDCF){this.iUC=iFUC;this.iTIC=iFTC;this.feERfrsh()}}}};Owa.UIControls.MsgVLV.prototype.cnvUdCts=function Owa$UIControls$MsgVLV$cnvUdCts(rg,iA,fDCF){var oR=this.gtRwById(rg.get_Item(0));var oPR=this.gtExpCnv(oR);var rgCnv=[this.getData(oPR).sId];var iFUC=this.iUC;var iFTC=this.iTIC;var iCUC=this.gtCnvUC(rgCnv);var iCTC=this.gtCnvTC(rgCnv);var iCGC=this.gtCnvGC(rgCnv);for(var i=0;i<rg.get_Length();i++){var oR=this.gtRwById(rg.get_Item(i));if(!oR)continue;var fR=this.isRd(oR);var fCF=!this.isXF(oR);switch(iA){case -1:if(fCF){if(!fR){iCUC--;iFUC--}iCTC--;iFTC--}iCGC--;break;case 0:if(!fCF&&fDCF){if(!fR){iCUC++;iFUC++}iCTC++;iFTC++}else if(fCF&&!fDCF){if(!fR){iCUC--;iFUC--}iCTC--;iFTC--}break;case 1:if(fDCF){if(!fR){iCUC++;iFUC++}iCTC++;iFTC++}iCGC++;break}}var fFR=0;if(this.iUC!=iFUC){this.iUC=iFUC;fFR=1}if(this.iTIC!=iFTC){this.iTIC=iFTC;fFR=1}if(fFR)this.feERfrsh();this.stCnvCts(rgCnv.get_Item(0),oPR,iCUC,iCTC,iCGC)};Owa.UIControls.MsgVLV.prototype.cnvMkSngl=function Owa$UIControls$MsgVLV$cnvMkSngl(oR){this.expRw(0);this.selSngl(oR);var oExp=oR.getDescendantById("divExp");if(oExp)oExp.get_FirstChild().remove(true)};Owa.UIControls.MsgVLV.prototype.cnvMkMult=function Owa$UIControls$MsgVLV$cnvMkMult(oR){var oExp=oR.getDescendantById("divExp");var oImg=Document.get_Current().createElement("IMG");if(!oImg||!oExp)return;Owa.Components.CssSprites.updateImage(oImg,(g_fRtl?Owa.Strings.Icons.CollapsedRtl:Owa.Strings.Icons.Collapsed));oExp.insertAdjacentElement(Owa.ElementInsertionPoint.AfterBegin,oImg)};Owa.UIControls.MsgVLV.prototype.stRS=function Owa$UIControls$MsgVLV$stRS(sId,iR,fRC){this.stRwPrp(sId,"read",iR);var oR=this.gtRwById(sId);if(!oR)return;if(this.isCnvVw()&&oR.get_Id()==VR){this.stCnvRS(sId,iR);return}var fR=(iR==1);var fOR=(!oR.hasCssClass("ur"));if(fOR!=fR){if(fR){oR.removeCssClass("ur");if(!this.isXF(oR)){this.iUC--;if(this.iUC<0)this.iUC=0}}else{oR.addCssClass("ur");if(!this.isXF(oR))this.iUC++}if(this.isCnvVw()&&oR.get_Id()==VER){oR.set_IsShown(false);oR.set_IsShown(true);if(!this.isXF(oR))this.udCnvUC(oR,!fR);if(iR==-1){this.stRwPrp(this.sExpId,"read",iR)}}}if(fRC){this.feERfrsh()}};Owa.UIControls.MsgVLV.prototype.gtCnvRS=function Owa$UIControls$MsgVLV$gtCnvRS(sId){if(this.sExpId&&this.sExpId==sId){var oPR=this.gtRwById(sId);if(!oPR)return;var oR=oPR.get_NextSibling().get_NextSibling();if(!oR)return;var iR=this.isRd(oR)?1:-1;oR=oR.get_NextSibling();while(oR&&oR.get_Id()==VER){if(!this.isSntItm(oR)||this.isSntItm(oPR)){if(this.isRd(oR)){if(iR<0)return 0}else{if(iR>0)return 0}}oR=oR.get_NextSibling()}return iR}else{var rg=[sId];var iUC=this.gtCnvUC(rg);if(iUC==0)return 1;var iTC=this.gtCnvTC(rg);if(iUC==iTC)return -1;return 0}};Owa.UIControls.MsgVLV.prototype.stCnvRS=function Owa$UIControls$MsgVLV$stCnvRS(sId,iR){var oPR=this.gtRwById(sId);if(!oPR)return;if(this.sExpId&&this.sExpId==sId){var oR=oPR.get_NextSibling().get_NextSibling();while(oR&&oR.get_Id()==VER){if(!this.isSntItm(oR))this.stRS(this.getData(oR).sId,iR);oR=oR.get_NextSibling()}}else{var rgCnv=[sId];var iCTC=this.gtCnvTC(rgCnv);var iCUC=this.gtCnvUC(rgCnv);if(iR>0){this.stCnvCts(sId,oPR,0,-1,-1);this.iUC-=iCUC}else{this.stCnvCts(sId,oPR,iCTC,-1,-1);this.iUC+=iCTC-iCUC}if(this.iUC<=0)this.iUC=0;if(this.oSel[sId]){this.feERfrsh()}}var oSbj=oPR.getDescendantById("divSubject");if(!oSbj)return;if(iR>0)oSbj.removeCssClass("ur");else oSbj.addCssClass("ur")};Owa.UIControls.MsgVLV.prototype.udCnvUC=function Owa$UIControls$MsgVLV$udCnvUC(oR,fInc){var oPR=this.gtExpCnv(oR);var sId=this.getData(oPR).sId;var rgCnv=[sId];var iUC=this.gtCnvUC(rgCnv);iUC=fInc?iUC+1:iUC-1;if(iUC<0)iUC=0;this.stCnvCts(rgCnv,oPR,iUC,-1,-1)};Owa.UIControls.MsgVLV.prototype.prcsDta=function Owa$UIControls$MsgVLV$prcsDta(oD){var oNewData=oD.getChildById("data");this.iUC=oNewData.getIntAttribute("iUC");var fCVNw=getInt(oNewData.getAttribute("fCV"));if(this.fCV!=fCVNw){this.feCnvVwChg(fCVNw)}this.fCV=fCVNw;if(this.isCnvVw()){this.initExp(oD)}var fOldFUR=this.isFilteredByUnread();this.fFUR=getInt(oNewData.getAttribute("fFUR"));if(!fOldFUR&&this.fFUR){this._showFilteredByUnreadPont()}Owa.UIControls.MsgVLV.callBase(this,"prcsDta",[oD])};Owa.UIControls.MsgVLV.prototype.addLVSt=function Owa$UIControls$MsgVLV$addLVSt(oR){Owa.UIControls.MsgVLV.callBase(this,"addLVSt",[oR]);this.addExpId(oR)};Owa.UIControls.MsgVLV.prototype.addExpId=function Owa$UIControls$MsgVLV$addExpId(oR){if(this.isCnvVw()&&this.sExpId)oR.add("expId",this.sExpId)};Owa.UIControls.MsgVLV.prototype.rmvRw=function Owa$UIControls$MsgVLV$rmvRw(sId,fSE){if(this.isCnvVw()){var oR=this.gtRwById(sId);if(!oR)return;if((oR.get_Id()==VR)&&(this.sExpId&&sId==this.sExpId)){this.expRw(0)}else if(oR.get_Id()==VER){if(oR.hasCssClass("eclr"))oR.get_PreviousSibling().addCssClass("eclr")}}else{this.mkRd(sId)}Owa.UIControls.MsgVLV.callBase(this,"rmvRw",[sId,fSE])};Owa.UIControls.MsgVLV.prototype.rmvExp=function Owa$UIControls$MsgVLV$rmvExp(oR,rgsSubRowsMarkedAsUnread){this._storeViewportPosition();this.clrPp();var iCompensation=0;var iPosition=this.getViewportPosition();var fTestAbove=true;var oER=oR.get_NextSibling().get_NextSibling();while(oER&&oER.get_Id()==VER){if(fTestAbove){if(this.getRowPosition(oER)<iPosition){var iHeight=oER.get_OffsetHeight();iCompensation-=iHeight;iPosition-=iHeight}else{fTestAbove=false}}var oData=this.getData(oER);var sId=oData.sId;if(this.oSel[sId]){this.oSel[sId].fSel=false;this.feSelChg(sId,0,1);delete this.oSel[sId]}if(rgsSubRowsMarkedAsUnread&&oData.getAttribute("read")==String(MSG_MARKED_UNREAD)){rgsSubRowsMarkedAsUnread[sId]=String(MSG_MARKED_UNREAD)}oER.remove(true);oER=oR.get_NextSibling().get_NextSibling()}this.clearRowCache();this._resetViewportPosition(iCompensation);this._resetCurrentRowPosition()};Owa.UIControls.MsgVLV.prototype.fndExp=function Owa$UIControls$MsgVLV$fndExp(o){return o.getAncestorById("divExp",VP)};Owa.UIControls.MsgVLV.prototype.exp=function Owa$UIControls$MsgVLV$exp(sId,rgsSubRowsMarkedAsUnread){if(this.fPndExp)return;this.fPndExp=1;var oRw=this.gtRwById(sId);var oExp=oRw.getDescendantById("divExp");if(oExp){oExp.get_FirstChild().set_IsShown(false);var oImgPrg=oExp.getDescendantById("imgPrg");oImgPrg.set_IsShown(true);if(!Utility.isIE()){oImgPrg.set_Margin(Owa.Style.Side.Bottom,4);oImgPrg.set_Margin(Owa.Style.Side.Top,0)}}var oC={};if(!rgsSubRowsMarkedAsUnread){rgsSubRowsMarkedAsUnread={}}oC.rgsSubRowsMarkedAsUnread=rgsSubRowsMarkedAsUnread;var oR=new oeReq(this.sEvtNS,"ExpandConversation",oC,this._createCallback(this.cbExp),POST);this.sExpId=sId;this.addLVSt(oR);oR.send()};Owa.UIControls.MsgVLV.prototype.cbExp=function Owa$UIControls$MsgVLV$cbExp(oR){this.fPndExp=0;var oRw=this.gtRwById(this.sExpId);if(oRw){var oExp=oRw.getDescendantById("divExp");if(oExp){oExp.getDescendantById("imgPrg").set_IsShown(false);oExp.get_FirstChild().set_IsShown(true)}}if(!cbOeh(oR)){this.sExpId="";return}var oD=Document.get_Current().createElement("DIV");oD.set_InnerHtml(oR.sBody);this.initExp(oD,oR.oCtx.rgsSubRowsMarkedAsUnread)};Owa.UIControls.MsgVLV.prototype.isSameConversation=function Owa$UIControls$MsgVLV$isSameConversation(owaConvId,newOwaConvId){if(this.get_SubPage().isCnvId(owaConvId)&&this.get_SubPage().isCnvId(newOwaConvId)){if(owaConvId!=newOwaConvId){var rgIdParts=owaConvId.split(".");var rgNewIdParts=newOwaConvId.split(".");if(rgIdParts&&rgNewIdParts){return(rgIdParts[0]==rgNewIdParts[0]&&rgIdParts[1]==rgNewIdParts[1]&&rgIdParts[rgIdParts.length-1]==rgNewIdParts[rgNewIdParts.length-1])}}else{return true}}return false};Owa.UIControls.MsgVLV.prototype.initExp=function Owa$UIControls$MsgVLV$initExp(oD,rgsSubRowsMarkedAsUnread){var oExp=oD.getChildById("tblExp");if(!oExp)return;var expId=oExp.getAttribute("expId");if(!expId||!this.sExpId)return;if(expId!=this.sExpId){if(this.isSameConversation(expId,this.sExpId)){this.sExpId=expId}else{return}}var oR=this.gtRwById(expId);if(!oR)return;var oSR=oR.get_NextSibling();if(!oSR||oSR.get_Id()!=SR)return;var oRestorePosition=this.oCurRowPosition;this.rmvExp(oR,rgsSubRowsMarkedAsUnread);var oNR=oSR;this._storeViewportPosition();var rgoChildNodes=oExp._get_DomNode().childNodes;var iLength=rgoChildNodes.length;for(var i=0;i<iLength;i++){oNR.insertAdjacentElement(Owa.ElementInsertionPoint.AfterEnd,Node.wrapDomNode(rgoChildNodes[rgoChildNodes.length-1]))}this._resetViewportPosition();oExp.remove(true);this.expRw(1,rgsSubRowsMarkedAsUnread);if(oRestorePosition.iSubRow!=0){var oRestoreRow=this.gtRw(oRestorePosition.iRow,oRestorePosition.iSubRow);if(!oRestoreRow){oRestorePosition=new RowPosition(Math.min(this.ER(),oRestorePosition.iRow+1),0)}this.posVwprt(oRestorePosition);this.updScr()}var rgSel=this.gtSel();if(this.get_SelectionAnchorId()==this.sExpId&&rgSel.length==1){this.set_SelectionAnchorId(rgSel[0])}var oRP=this.get_SubPage().gtCnvRP();if(oRP){var iLVGC=oExp.getAttribute("iGC");var iRPGC=oRP.get_GlobalMessageCount();if(iLVGC!=iRPGC)this.get_SubPage().refreshConversationRP(true)}if(this.gtSelCnt()==0){var oExpRow=oSR.get_NextSibling();if(oExpRow.get_Id()==VER){this.selSngl(oExpRow)}}};Owa.UIControls.MsgVLV.prototype.expRw=function Owa$UIControls$MsgVLV$expRw(fExp,rgsSubRowsMarkedAsUnread){if(!this.sExpId)return;this.clearRowCache();var oR=this.gtRwById(this.sExpId);if(!oR){this.sExpId="";return}var sImg=(!fExp?(g_fRtl?Owa.Strings.Icons.CollapsedRtl:Owa.Strings.Icons.Collapsed):(g_fRtl?Owa.Strings.Icons.ExpandedRtl:Owa.Strings.Icons.Expanded));var oExp=oR.getDescendantById("divExp");if(oExp)Owa.Components.CssSprites.updateImage(oExp.get_FirstChild(),sImg);this._storeViewportPosition();var oSR=oR.get_NextSibling();oSR.set_IsShown(!fExp);this._resetViewportPosition();if(fExp){this._storeViewportPosition();oR.addCssClass("eclr");oSR.removeCssClass("lr");var oER=oSR.get_NextSibling();while(oER&&oER.get_Id()==VER){if(this.isSel(oER)){oER.addCssClass(SELECTED_EXPANSION_ROW);this.shwPp()}else{oER.addCssClass(SELECTED_CONVERSATION)}var oData=this.getData(oER);var sId=oData.sId;if(rgsSubRowsMarkedAsUnread&&isDf(typeof(rgsSubRowsMarkedAsUnread[sId]))&&!this.isRd(oER)){oData.setAttribute("read",String(MSG_MARKED_UNREAD))}oER=oER.get_NextSibling()}this._resetViewportPosition();this.feRfExp()}else{oSR.addCssClass("lr");oR.removeCssClass("eclr");this.rmvExp(oR,rgsSubRowsMarkedAsUnread);this.sExpId=""}this.updScr()};Owa.UIControls.MsgVLV.prototype.gtExpCnv=function Owa$UIControls$MsgVLV$gtExpCnv(oR){if(oR.get_Id()!=VER)return;var oPR=oR.get_PreviousSibling();while(oPR){if(oPR&&oPR.get_Id()==VR)break;oPR=oPR.get_PreviousSibling()}return oPR};Owa.UIControls.MsgVLV.prototype.gtExpCnvId=function Owa$UIControls$MsgVLV$gtExpCnvId(){return this.sExpId};Owa.UIControls.MsgVLV.prototype.isSelExp=function Owa$UIControls$MsgVLV$isSelExp(){var rg=this.gtSel();if(rg&&(rg.get_Length()>0)){var oR=this.gtRwById(rg.get_Item(0));if(oR&&oR.get_Id()==VER)return 1}return 0};Owa.UIControls.MsgVLV.prototype.gtCnvUC=function Owa$UIControls$MsgVLV$gtCnvUC(rgCnv){return this.gtCnvCt(rgCnv,"iUC")};Owa.UIControls.MsgVLV.prototype.gtCnvTC=function Owa$UIControls$MsgVLV$gtCnvTC(rgCnv){return this.gtCnvCt(rgCnv,"iTC")};Owa.UIControls.MsgVLV.prototype.gtCnvGC=function Owa$UIControls$MsgVLV$gtCnvGC(rgCnv){return this.gtCnvCt(rgCnv,"iGC")};Owa.UIControls.MsgVLV.prototype.gtCnvCt=function Owa$UIControls$MsgVLV$gtCnvCt(rgCnv,sCt){var iT=0;for(var i=0;i<rgCnv.get_Length();i++){var iC=getInt(this.gtRwPrp(rgCnv[i],sCt));if(!isNaN(iC))iT+=iC}return iT};Owa.UIControls.MsgVLV.prototype.stCnvCts=function Owa$UIControls$MsgVLV$stCnvCts(sId,oR,iUC,iTC,iGC){if(iUC<0&&iTC<0&&iGC<0)return;var rgCnv=[sId];if(iUC<0)iUC=this.gtCnvUC(rgCnv);if(iTC<0)iTC=this.gtCnvTC(rgCnv);if(iGC<0)iGC=this.gtCnvGC(rgCnv);if(isNaN(iUC))iUC=0;if(isNaN(iTC))iTC=0;if(isNaN(iGC))iGC=0;oR.getChildById("divUC").set_TextContent((iUC>1&&iTC>1)?("("+getStr(iUC)+")"):"");oR.getChildById("divSubject").set_FontWeight(iUC>0?Owa.Style.FontWeight.Bold:Owa.Style.FontWeight.Normal);oR.getChildById("divUC").setAttribute("title",getStr(iTC)+" Items"+(iUC>0?(", "+getStr(iUC)+" Unread"):""));this.stRwPrp(sId,"iUC",iUC);this.stRwPrp(sId,"iTC",iTC);this.stRwPrp(sId,"iGC",iGC)};Owa.UIControls.MsgVLV.prototype.isXF=function Owa$UIControls$MsgVLV$isXF(oR){return oR&&oR.get_Id()==VER&&(oR.hasCssClass("df"))};Owa.UIControls.MsgVLV.prototype.isSntItm=function Owa$UIControls$MsgVLV$isSntItm(oR){if(oR&&oR.get_Id()==VER)return(this.gtRwPrp(this.getData(oR).sId,"fId").indexOf(a_sSntId)!=-1)};Owa.UIControls.MsgVLV.prototype.isRd=function Owa$UIControls$MsgVLV$isRd(oR){var iR=this.gtRwPrp(this.getData(oR).sId,"read");return(iR&&iR<=0)?0:1};Owa.UIControls.MsgVLV.prototype.udPp=function Owa$UIControls$MsgVLV$udPp(){this._storeViewportPosition();if(this.gtSelCnt()==1&&this.isSelExp()){this.shwPp()}else{this.clrPp()}this._resetViewportPosition()};var PipeItemPartInfo=function(oR,oVlv){this._oR=oR;this._oVlv=oVlv};PipeItemPartInfo.prototype.get_ParentItemPart=function PipeItemPartInfo$prototype$get_ParentItemPart(){var oR=this._oVlv.gtParItm(this._oR);if(oR){return new PipeItemPartInfo(oR,this._oVlv)}else{return null}};PipeItemPartInfo.prototype.get_PipeConnectorTop=function PipeItemPartInfo$prototype$get_PipeConnectorTop(){var sId=this._oVlv.getData(this._oR).sId;return this._oVlv._oIdToRow[sId].iChunkOffset+PP_OFFST};Owa.UIControls.MsgVLV.prototype.shwPp=function Owa$UIControls$MsgVLV$shwPp(){var oR=this.gtRwById(this.gtSel().get_Item(0));if(this._oPipe)return;var oCh=this.fndChnk(oR);this._oPipe=new Owa.Components.Pipes(oCh,Owa.PipeType.Small);this._getOIdToRow();this._oPipe.drawPipes(new PipeItemPartInfo(oR,this))};Owa.UIControls.MsgVLV.prototype.clrPp=function Owa$UIControls$MsgVLV$clrPp(){if(this._oPipe){this._oPipe.clearPipes();this._oPipe.dispose();this._oPipe=null}};Owa.UIControls.MsgVLV.prototype.gtParItm=function Owa$UIControls$MsgVLV$gtParItm(oR){var pId=this.gtPrpV(oR,"pId");return(pId)?(this._oIdToRow[pId]?this._oIdToRow[pId].oRow:null):null};Owa.UIControls.MsgVLV.prototype.isNonLclSrch=function Owa$UIControls$MsgVLV$isNonLclSrch(){var oSearchControl=this.get_SearchControl();return(this.get_IsSearch()||(this.fSrch&&oSearchControl.iScope&&oSearchControl.iScope!=SearchScope.SS_FLD))};var _notificationIndex={TYPE:0,ITEM_INSTANCE_KEY:1,PREVIOUS_ITEM_INSTANCE_KEY:2,ROW1_HTML:3,ROW2_HTML:4,ISREAD:5,HEADER:6,TITLE:7};Owa.UIControls.MsgVLV.prototype.processRowNotification=function Owa$UIControls$MsgVLV$processRowNotification(rgoNotification){if(this._shouldIgnoreNotification()){return}if(this.gtTC()==0){this.rfrsh(true);return}var sType=rgoNotification[_notificationIndex.TYPE];switch(sType){case ROW_ADDED:this._processRowAddedNotification(rgoNotification);break;case ROW_DELETED:this._processRowDeletedNotification(rgoNotification);break;case ROW_MODIFIED:this._processRowModifiedNotification(rgoNotification);break;default:throw new Error("Invalid row notification type: "+sType)}this._setTimeout(this._deqRowNotification,10)};Owa.UIControls.MsgVLV.prototype._processRowAddedNotification=function Owa$UIControls$MsgVLV$_processRowAddedNotification(rgoNotification,fFromRowModifiedNotification){var fInsertBefore=false;if(this._getRowByInstanceKey(rgoNotification[_notificationIndex.ITEM_INSTANCE_KEY])!=null){return}var sPreviousInstanceKey=rgoNotification[_notificationIndex.PREVIOUS_ITEM_INSTANCE_KEY];if(sPreviousInstanceKey==""&&this.SR()!=0){var oRowInfo=this.getRowInfoFromPosition(new RowPosition(0,0));if(!this.isCnvVw()){this._updateItemCounts({iTCDelta:1,iTICDelta:1,iUCDelta:1},true,this.fndChnk(oRowInfo.oRow),rgoNotification[_notificationIndex.ISREAD])}else{var oD=Document.get_Current().createElement("DIV");oD.set_InnerHtml(rgoNotification[_notificationIndex.ROW1_HTML]);var oData=this.getData(oD.get_FirstChild().get_FirstChild());this._updateItemCounts({iTCDelta:1,iTICDelta:oData.getIntAttribute("iTC"),iUCDelta:oData.getIntAttribute("iUC")},true,this.fndChnk(oRowInfo.oRow),rgoNotification[_notificationIndex.ISREAD])}return}var o=this._getNextPrevRow(sPreviousInstanceKey,rgoNotification[_notificationIndex.HEADER],rgoNotification);var oNextPrevRowInfo=o.oRowInfo;if(!oNextPrevRowInfo){return}var fInsertBefore=o.fInsertBefore;var oChunk=this.fndChnk(oNextPrevRowInfo.oRow);if(o.fRefresh||(this._getChunkCount(oChunk)>=MAX_CHNK_SZ)){this.rfrsh(true);rgoNotification.fRefreshedWhileAdding=true}this._storeViewportPosition();var iRowPosition=this._getRowPosition(oNextPrevRowInfo.oRow);var oNewRow=this._insertRow(oNextPrevRowInfo,rgoNotification[_notificationIndex.ROW1_HTML],rgoNotification[_notificationIndex.ROW2_HTML],fInsertBefore);var iCompensation=0;iCompensation+=oNewRow.get_OffsetHeight();iCompensation+=oNewRow.get_NextSibling().get_OffsetHeight();this._resetViewportPosition((iRowPosition==_rowPosition.ABOVE_VIEWPORT)?iCompensation:0);if(!this.isCnvVw()){this._updateItemCounts({iTCDelta:1,iTICDelta:1,iUCDelta:1},false,oChunk,rgoNotification[_notificationIndex.ISREAD])}else{oData=this.getData(oNewRow);this._updateItemCounts({iTCDelta:1,iTICDelta:oData.getIntAttribute("iTC"),iUCDelta:oData.getIntAttribute("iUC")},false,oChunk,rgoNotification[_notificationIndex.ISREAD])}this._insertRowInRowCache(oNewRow,oNextPrevRowInfo,fInsertBefore,iCompensation);this._resetCurrentRowPosition();this.updScr();if(this.sExpId&&!fFromRowModifiedNotification){this.clrPp();this.udPp()}};Owa.UIControls.MsgVLV.prototype._processRowDeletedNotification=function Owa$UIControls$MsgVLV$_processRowDeletedNotification(rgoNotification){var sId=this._getIdFromInstanceKey(rgoNotification[_notificationIndex.ITEM_INSTANCE_KEY]);if(sId&&(this.gtRwPrp(sId,"deleting")!="1")){var fIsExpanded=this._isExpandedConversation(sId);if(fIsExpanded){var oR=this.gtRwById(sId);this.expRw(0);this.selSngl(oR,false,false)}this.rmvRws([sId])}};Owa.UIControls.MsgVLV.prototype._processRowModifiedNotification=function Owa$UIControls$MsgVLV$_processRowModifiedNotification(rgoNotification){var sInstanceKey=rgoNotification[_notificationIndex.ITEM_INSTANCE_KEY];this._discardDuplicateNotification(ROW_MODIFIED,sInstanceKey);var oR=this._getRowByInstanceKey(sInstanceKey);if(!oR){return}var sId=this.getData(oR).sId;var fIsSel=this.isSel(oR);var fSelectionAlreadyApplied=false;var iReadState=this.gtRwPrp(sId,"read");var rgsSubRowsMarkedAsUnread={};var sPreviousInstanceKey=rgoNotification[_notificationIndex.PREVIOUS_ITEM_INSTANCE_KEY];var sPreviousRowInstanceKey=this._getPreviousRowInstanceKey(sInstanceKey);var oRowInfo=this._getRowInfoByInstanceKey(sInstanceKey);if(sPreviousInstanceKey==sPreviousRowInstanceKey&&(oRowInfo&&htmlDec(rgoNotification[_notificationIndex.HEADER])==oRowInfo.sSectionHeaderText)){var rgCnv=[sId];if(this.isCnvVw()){this.iTIC-=this.gtCnvTC(rgCnv);this.iUC-=this.gtCnvUC(rgCnv)}this._replaceRowHTML(oR,rgoNotification[_notificationIndex.ROW1_HTML],rgoNotification[_notificationIndex.ROW2_HTML]);if(this.isCnvVw()&&this._isExpandedConversation(sId)){this.exp(sId)}if(this.isCnvVw()){this.iTIC+=this.gtCnvTC(rgCnv);this.iUC+=this.gtCnvUC(rgCnv)}}else{var fIsExpanded=this._isExpandedConversation(sId);if(this.isCnvVw()&&fIsExpanded){this.expRw(0,rgsSubRowsMarkedAsUnread)}var oRow1=this.gtRwById(sId);var sRow1Css=oRow1._get_DomNode().className;var sRow2Css=oRow1.get_NextSibling()._get_DomNode().className;this.rmvRws([sId],null,-1);rgoNotification[_notificationIndex.ROW1_HTML]="<div id=\""+VR+"\" class=\""+sRow1Css+"\">"+rgoNotification[_notificationIndex.ROW1_HTML]+"</div>";rgoNotification[_notificationIndex.ROW2_HTML]="<div id=\""+SR+"\" class=\""+sRow2Css+"\">"+rgoNotification[_notificationIndex.ROW2_HTML]+"</div>";rgoNotification[_notificationIndex.TYPE]=ROW_ADDED;this._processRowAddedNotification(rgoNotification,true);if(isDf(typeof(rgoNotification.fRefreshedWhileAdding))&&rgoNotification.fRefreshedWhileAdding){return}oR=this._getRowByInstanceKey(sInstanceKey);if(!oR){return}if(this.isCnvVw()){if(fIsExpanded){this.sel(oR,true);fSelectionAlreadyApplied=true;this.exp(sId,rgsSubRowsMarkedAsUnread)}else{this.clrPp();this.udPp()}}}if(!this.isCnvVw()){var iReadStateIn=rgoNotification[_notificationIndex.ISREAD];this.stRS(this._getIdFromInstanceKey(sInstanceKey),iReadStateIn,false);oR.set_Title(rgoNotification[_notificationIndex.TITLE])}if(iReadState==String(MSG_MARKED_UNREAD)&&!this.isRd(oR)){this.stRwPrp(sId,"read",iReadState)}if(fIsSel&&!fSelectionAlreadyApplied){this.sel(oR,true)}if(this.isCnvVw()&&this.isReadingPaneOn()){this.onRowNotification(sId)}};Owa.UIControls.MsgVLV.prototype._getNextPrevRow=function Owa$UIControls$MsgVLV$_getNextPrevRow(sPreviousInstanceKey,sNewRowHeader,rgoNotification){var oRowInfo;var fInsertBefore=false;var fRefresh=false;if(sPreviousInstanceKey==""){oRowInfo=this.getRowInfoFromPosition(new RowPosition(0,0));fInsertBefore=true}else{oRowInfo=this._getRowInfoByInstanceKey(sPreviousInstanceKey);if(!oRowInfo){this._enqRowNotification(rgoNotification);return{fRefresh:false,oRowInfo:null,fInsertBefore:false}}}if(oRowInfo&&sNewRowHeader&&sNewRowHeader!=""){var sRowHeader=oRowInfo.sSectionHeaderText;sNewRowHeader=htmlDec(sNewRowHeader);if(sRowHeader!=""&&sRowHeader!=sNewRowHeader){if(sPreviousInstanceKey!=""){var oNextRowInfo=this.getRowInfoFromPosition(new RowPosition(oRowInfo.oRowPosition.iRow+1,0));if(oNextRowInfo){sRowHeader=oNextRowInfo.sSectionHeaderText;if(sRowHeader==sNewRowHeader){oRowInfo=oNextRowInfo;fInsertBefore=true}else{fRefresh=true}}else{fRefresh=true}}else{fRefresh=true}}}return{fRefresh:fRefresh,oRowInfo:oRowInfo,fInsertBefore:fInsertBefore}};Owa.UIControls.MsgVLV.prototype._insertRow=function Owa$UIControls$MsgVLV$_insertRow(oRowInfo,sHtmlVR,sHtmlVER,fInsertBefore){var oVR;var oR=oRowInfo.oRow;if(!fInsertBefore){var oSR=oR.get_NextSibling();if(this.isCnvVw()&&this._isExpandedConversation(oRowInfo.sRowId)){var oPSR;while(oSR&&!this.isRowHeading(oSR)){oPSR=oSR;oSR=oSR.get_NextSibling()}oSR=oPSR}this._insertARow(oSR,sHtmlVER,false);oVR=this._insertARow(oSR,sHtmlVR,false)}else{oVR=this._insertARow(oR,sHtmlVR,true);this._insertARow(oR,sHtmlVER,true)}return oVR};Owa.UIControls.MsgVLV.prototype._replaceRowHTML=function Owa$UIControls$MsgVLV$_replaceRowHTML(oR,sHtmlVR,sHtmlVER){var oSR=oR.get_NextSibling();oR.set_InnerHtml(sHtmlVR);oSR.set_InnerHtml(sHtmlVER)};Owa.UIControls.MsgVLV.prototype._insertARow=function Owa$UIControls$MsgVLV$_insertARow(oR,sHtml,fInsertBefore){var oD=Document.get_Current().createElement("DIV");oD.set_InnerHtml(sHtml);var oNewRow=oD.get_FirstChild();if(!fInsertBefore){oR.insertAdjacentElement(Owa.ElementInsertionPoint.AfterEnd,oNewRow)}else{oR.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeBegin,oNewRow)}return oNewRow};var ROW_NOTIFICATION_THRESHOLD=3;var ROW_NOTIFICATION_QUEUE_THRESHOLD=5;var ROW_NOTIFICATION_TIMER_DELAY=2000;Owa.UIControls.MsgVLV.prototype._enqRowNotification=function Owa$UIControls$MsgVLV$_enqRowNotification(rgoNotification){if((isDf(typeof(rgoNotification.iCount))&&rgoNotification.iCount>=ROW_NOTIFICATION_THRESHOLD)||this._rgRowNotification.get_Length()>=ROW_NOTIFICATION_QUEUE_THRESHOLD){this._clearRowNotifications();return}else if(rgoNotification.iCount&&rgoNotification.iCount<ROW_NOTIFICATION_THRESHOLD){rgoNotification.iCount++}else{rgoNotification.iCount=1}if(!isDf(typeof(rgoNotification.iTime))){rgoNotification.iTime=(new Date()).getTime()+ROW_NOTIFICATION_TIMER_DELAY-10}this._rgRowNotification.push(rgoNotification)};Owa.UIControls.MsgVLV.prototype._deqRowNotification=function Owa$UIControls$MsgVLV$_deqRowNotification(){var rgoNotification=null;var fProcess=false;var i;for(i=0;i<this._rgRowNotification.get_Length();i++){rgoNotification=this._rgRowNotification[i];var iT=(new Date()).getTime();if(rgoNotification.iTime>iT){continue}else{this._rgRowNotification.splice(i,1);fProcess=true;break}}if(fProcess&&rgoNotification){this.processRowNotification(rgoNotification)}else if(this._rgRowNotification.get_Length()>0&&!this._oRowNotificationQueueTimer){this._oRowNotificationQueueTimer=this._setTimeout(this._rowNotificationQueueTimerCallback,ROW_NOTIFICATION_TIMER_DELAY)}};Owa.UIControls.MsgVLV.prototype._rowNotificationQueueTimerCallback=function Owa$UIControls$MsgVLV$_rowNotificationQueueTimerCallback(){this._oRowNotificationQueueTimer=null;this._deqRowNotification()};Owa.UIControls.MsgVLV.prototype._clearRowNotifications=function Owa$UIControls$MsgVLV$_clearRowNotifications(){this._rgRowNotification=[]};Owa.UIControls.MsgVLV.prototype._discardDuplicateNotification=function Owa$UIControls$MsgVLV$_discardDuplicateNotification(iType,sInstanceKey){var rgoNotification;var i=0;while(i<this._rgRowNotification.get_Length()){rgoNotification=this._rgRowNotification[i];if(rgoNotification[_notificationIndex.TYPE]==iType&&rgoNotification[_notificationIndex.ITEM_INSTANCE_KEY]==sInstanceKey){this._rgRowNotification.splice(i,1)}else{i++}}};Owa.UIControls.MsgVLV.prototype._shouldIgnoreNotification=function Owa$UIControls$MsgVLV$_shouldIgnoreNotification(){return this.isFltrd()};Owa.UIControls.MsgVLV.prototype._isPushNotificationSupported=function Owa$UIControls$MsgVLV$_isPushNotificationSupported(){return true};Owa.UIControls.MsgVLV.prototype._showFilteredByUnreadPont=function Owa$UIControls$MsgVLV$_showFilteredByUnreadPont(){var iMarkAsReadSetting=this.get_SubPage().getSubPageVariable("a_iMR");if(this.isFilteredByUnread()&&PONT_FILTEREDBYUNREAD&a_iEnblPnt&&(isDf(typeof(iMarkAsReadSetting))&&iMarkAsReadSetting!=MR_NEVER)){shwPont(PONT_FILTEREDBYUNREAD,L_AutoMarkAsReadDisabled,L_MarkAsRead,[L_OK],Owa.BUTTON_DIALOG_ICON.INFORMATION,0,0)}};Owa.UIControls.TskVLV=function Owa$UIControls$TskVLV(oSubPage,o){Owa.UIControls.TskVLV.constructBase(this,[oSubPage,o]);this.iPndCnt=0;this.fRfrsh=0};Owa.UIControls.TskVLV.createClass("Owa.UIControls.TskVLV",Owa.UIControls.FldrVLV);var TskVLV=ns.TskVLV.prototype;Owa.UIControls.TskVLV.prototype.get_IsFlaggedMailAndTasks=function Owa$UIControls$get_IsFlaggedMailAndTasks$mkSelCmp(){return this.get_SubPage().get_IsFlaggedMailAndTasks()};Owa.UIControls.TskVLV.prototype.mkSelCmp=function Owa$UIControls$TskVLV$mkSelCmp(){var rg=this.gtSel();var o=this.gtNATsks(L_EdAT,L_MltEdAT);rg=o.rg;if(o.sErr)alrt(o.sErr);if(!rg.get_Length())return;var fRT=0;for(var i=0;i<rg.get_Length();i++)fRT|=(this.gtRwPrp(rg.get_Item(i),"fRT"));this.mkCmp(rg,fRT);if(!this.get_SubPage().isPF()&&!this.get_SubPage().isOMF())for(var i=0;i<rg.get_Length();i++)this.updTskCmp(rg.get_Item(i))};Owa.UIControls.TskVLV.prototype.onMD=function Owa$UIControls$TskVLV$onMD(oEvent){var o=oEvent.get_Target();var oRow=this.fndRw(o);if((this.fndChk(o)||this.fndFlg(o))&&oEvent.isLeftButtonDown()){this.clkMkCmp(oRow)}else if(this.fndImp(o)&&oEvent.isLeftButtonDown()){this.clkTgImp(oRow)}else if(this.fndDD(o)&&oEvent.isLeftButtonDown()&&this.isSel(oRow)){var oLV=this;var fn=function(oDiv){oLV.setDD(oDiv)};this.shwTskDP(oRow.getChildById("dd"),new Date(this.getData(oRow).getAttribute("dtDD")),fn)}else{Owa.UIControls.TskVLV.callBase(this,"onMD",[oEvent])}};Owa.UIControls.TskVLV.prototype.incPndCnt=function Owa$UIControls$TskVLV$incPndCnt(fR){this.iPndCnt++;this.fRfrsh|=fR};Owa.UIControls.TskVLV.prototype.decPndCnt=function Owa$UIControls$TskVLV$decPndCnt(fR){this.iPndCnt--;this.fRfrsh|=fR;if(!this.iPndCnt&&this.fRfrsh){this.rfrsh(1);this.fRfrsh=0}};Owa.UIControls.TskVLV.prototype.isSrtCmp=function Owa$UIControls$TskVLV$isSrtCmp(){var i=this.iSC;var iComplete=this._getArrangeByColumnId("divCmp");var iFlag=this._getArrangeByColumnId("divFlg");return(i==iComplete||i==iFlag)};Owa.UIControls.TskVLV.prototype.delTsks=function Owa$UIControls$TskVLV$delTsks(fP){var o=this.gtNATsks(L_DelAT,L_MltDelAT);var oC={};oC.rg=o.rg;oC.sErr=o.sErr;oC.fP=fP;var iPT=0;if(this.get_IsFlaggedMailAndTasks()){if(oC.rg.get_Length()==1){var sT=this.gtRwPrp(oC.rg.get_Item(0),"t");if(isOfClss(sT,IT_CNT))iPT=PONT_CNT;else if(!isOfClss(sT,IT_TSK))iPT=PONT_MSG}else{for(var i=0;i<oC.rg.get_Length();i++){if(!isOfClss(this.gtRwPrp(oC.rg.get_Item(i),"t"),IT_TSK)){iPT=PONT_MLT;break}}}}if(iPT&a_iEnblPnt){var sMsg;if(iPT==PONT_MSG)sMsg=L_PntMsg;else if(iPT==PONT_CNT)sMsg=L_PntCnt;else sMsg=L_PntMlt;sMsg=sMsg+"<br>"+L_Cntnu;var oLV=this;var fn=function(iB,oC){oLV.cbDelPont(iB,oC)};shwPont(iPT,sMsg,L_Wrn,[L_Yes,L_No],Owa.BUTTON_DIALOG_ICON.WARNING,fn,oC);return}this.cbDelPont(0,oC)};Owa.UIControls.TskVLV.prototype.cbDelPont=function Owa$UIControls$TskVLV$cbDelPont(iB,oC){if(iB==-1||iB==1)return;oC.iIdx=0;oC.rgDl=[];oC.rgDlO=[];oC.fRf=0;this.prRcTsks(oC)};Owa.UIControls.TskVLV.prototype.prRcTsks=function Owa$UIControls$TskVLV$prRcTsks(oC){while(oC.iIdx<oC.rg.get_Length()){var sId=oC.rg.get_Item(oC.iIdx);if(this.gtRwPrp(sId,"fRT")){oC.fRf=1;if(!this.gtRwPrp(sId,"fRgT")){var sSbj=this.gtRwById(sId).getChildById("sb").get_TextContent();var oLV=this;var fn=function(iB,fDO,oC){oLV.cbDelRcrTskDlg(iB,fDO,oC)};shwDelRcrTskDlg(fn,sSbj,oC);return}}oC.rgDl.push(sId);oC.iIdx++}if(oC.sErr)alrt(oC.sErr);this.get_SubPage().del(oC.fP,oC.rgDl,oC.rgDlO,oC.fRf)};Owa.UIControls.TskVLV.prototype.cbDelRcrTskDlg=function Owa$UIControls$TskVLV$cbDelRcrTskDlg(iB,fDO,oC){if(iB==-1||iB==1)return;if(fDO)oC.rgDlO.push(oC.rg.get_Item(oC.iIdx));else oC.rgDl.push(oC.rg.get_Item(oC.iIdx));oC.iIdx++;this.prRcTsks(oC)};Owa.UIControls.TskVLV.prototype.fndChk=function Owa$UIControls$TskVLV$fndChk(o){return o.getAncestorById("chkMkCmp",VP)};Owa.UIControls.TskVLV.prototype.clkMkCmp=function Owa$UIControls$TskVLV$clkMkCmp(oRow){var oData=this.getData(oRow);if(oData.getBoolAttribute("fAT"))return;var fChecked=oRow.getDescendantById("chkMkCmp").get_IsChecked();this.mkCmp([oData.sId],oData.getAttribute("fRT"),fChecked);this.updTskCmp(oData.sId,fChecked);updCmp(window)};Owa.UIControls.TskVLV.prototype.mkCmp=function Owa$UIControls$TskVLV$mkCmp(rg,fRT,fIC){this.incPndCnt(this.isSrtCmp()||fRT&&!fIC);var oCtx={};oCtx.oItms=rg;oCtx.f=0;var oR=new oeReq(this.sEvtNS,"MarkComplete",oCtx,this._createCallback(this.cbMkCmp));oR.addRg("Itms",rg);if(fIC){oR.add("mkIncmp",1);oCtx.f=1}oR.send()};Owa.UIControls.TskVLV.prototype.cbMkCmp=function Owa$UIControls$TskVLV$cbMkCmp(oR){this.decPndCnt(!!oR.sErr);if(!cbOeh(oR))return;if(this.get_SubPage().isPF()||this.get_SubPage().isOMF())for(var i=0;i<oR.oCtx.oItms.get_Length();i++)this.updTskCmp(oR.oCtx.oItms.get_Item(i),oR.oCtx.f);this.feSelChg()};Owa.UIControls.TskVLV.prototype.flgItm=function Owa$UIControls$TskVLV$flgItm(iFA,sId){if(iFA==FA_ClrFlg||iFA==FA_MrkCmpl)this.updTskCmp(sId,0);else this.rfrsh(1)};Owa.UIControls.TskVLV.prototype.updTskCmp=function Owa$UIControls$TskVLV$updTskCmp(sId,f){var iF=this.iFltr;if((!f&&(iF==TF_ACT||iF==TF_OVD))||(f&&(iF==TF_CMP))){if(this.gtRwPrp(sId,"fRT"))return;var oNxtSel=this.gtSelAftrRmv(this.iNsDir,[sId]);this.rmvRw(sId);if(!this.gtSelCnt()&&oNxtSel){this.selSngl(oNxtSel);this.scrToVwprt(oNxtSel)}this._resetCurrentRowPosition()}else{var oRow=this.gtRwById(sId);if(!oRow)return;oRow.getDescendantById("chkMkCmp").set_IsChecked(!f);this.updTskStls(oRow);var oData=this.getData(oRow);oData.setIntAttribute("sFA",f?FA_Dflt:FA_MrkCmpl)}};Owa.UIControls.TskVLV.prototype.fndImp=function Owa$UIControls$TskVLV$fndImp(o){return o.getAncestorById("divImp",VP)};Owa.UIControls.TskVLV.prototype.clkTgImp=function Owa$UIControls$TskVLV$clkTgImp(oRow){var oData=this.getData(oRow);if(oData.getBoolAttribute("fAT"))return;this.incPndCnt(this._getArrangeByColumnId("divIm")==this.iSC);if(oData.getIntAttribute("iTO")){this._clearTimeout(oData.getIntAttribute("iTO"));oData.setIntAttribute("iTO",0);this.decPndCnt()}var oDivImp=oRow.getChildById("divImp");var sImageFileName;if(oData.getIntAttribute("iI")==I_N){sImageFileName="ih.gif";oData.setIntAttribute("iI",I_HI)}else if(oData.getIntAttribute("iI")==I_HI){sImageFileName="il.gif";oData.setIntAttribute("iI",I_LO)}else{oData.setIntAttribute("iI",I_N)}oDivImp.removeAllChildNodes();if(sImageFileName){var oImage=Owa.Components.CssSprites.getImageElement(sImageFileName);oImage.addCssClass("imp");oDivImp.appendChild(oImage)}var oLV=this;var fn=function(){oLV.tgI(oData)};oData.setIntAttribute("iTO",this._setTimeout(fn,750))};Owa.UIControls.TskVLV.prototype.tgI=function Owa$UIControls$TskVLV$tgI(oData){var oR=new oeReq(this.sEvtNS,"SetImportance",0,this._createCallback(this.cbTgI));oR.add("id",oData.sId);oR.add("imp",oData.getIntAttribute("iI"));oR.send();oData.setIntAttribute("iTO",0)};Owa.UIControls.TskVLV.prototype.cbTgI=function Owa$UIControls$TskVLV$cbTgI(oR){this.decPndCnt(!!oR.sErr);if(!cbOeh(oR))return;this.feSelChg()};Owa.UIControls.TskVLV.prototype.fndDD=function Owa$UIControls$TskVLV$fndDD(o){return o.getAncestorById("dd",VP)};Owa.UIControls.TskVLV.prototype.setDD=function Owa$UIControls$TskVLV$setDD(oDiv){this.incPndCnt(1);var oR=new oeReq(this.sEvtNS,"SetDueDate",oDiv,this._createCallback(this.cbSetDD));oR.add("id",this.getData(this.fndRw(oDiv)).sId);var dt=this.oDatePickerDropDown.get_SelectedValue();if(dt)oR.add("ddt",dt);oR.send()};Owa.UIControls.TskVLV.prototype.cbSetDD=function Owa$UIControls$TskVLV$cbSetDD(oR){this.decPndCnt(!!oR.sErr);if(!cbOeh(oR))return;var oDiv=oR.oCtx;var oD=Document.get_Current().createElement("DIV");oD.set_InnerHtml(oR.sBody);oD=oD.getChildById("data");oDiv.set_InnerHtml(oD.get_InnerHtml());var oRow=this.fndRw(oDiv);var oData=this.getData(oRow);oData.setAttribute("dtDD",oD.getAttribute("dtDD"));oData.setAttribute("fOD",oD.getAttribute("fOD"));this.updTskStls(oRow);this.feSelChg()};Owa.UIControls.TskVLV.prototype.shwTskDP=function Owa$UIControls$TskVLV$shwTskDP(oDateDiv,dt,cb){var oDatePickerDropDown=this.oDatePickerDropDown;if(this.fDPLd&&!oDatePickerDropDown)return;if(oDatePickerDropDown){oDatePickerDropDown.selectValue(dt);oDatePickerDropDown.showUnder(oDateDiv,3,true);oDatePickerDropDown.oE=oDateDiv;oDatePickerDropDown.cb=cb}else{this.fDPLd=1;var oC={};oC.oE=oDateDiv;oC.dt=dt;oC.cb=cb;var oR=new oeReq(this.sEvtNS,"GetDatePicker",oC,this._createCallback(this.cbShwTskDP));oR.send()}};Owa.UIControls.TskVLV.prototype.cbShwTskDP=function Owa$UIControls$TskVLV$cbShwTskDP(oR){if(!cbOeh(oR))return;var oDiv=Document.get_Current().createElement("div");oDiv.set_InnerHtml(oR.sBody);var oDueDateDropDown=oDiv.getDescendantById("divDueDateDropDown");var oDueDate=this._getDescendant("divDueDate");Document.get_Current().get_Body().insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oDiv.get_FirstChild());oDiv.remove(true);this.oDatePickerDropDown=this.addResource(new Owa.UIControls.DatePickerDropDown(oDueDateDropDown,oDueDate));this.oDatePickerDropDown.set_SubPage(this.get_SubPage());this.oDatePickerDropDown.initialize();var oLV=this;var fn=function(){oLV.onDPSelDt()};this.oDatePickerDropDown.get_OnChange().add(fn);this.fDPLd=0;this.shwTskDP(oR.oCtx.oE,oR.oCtx.dt,oR.oCtx.cb)};Owa.UIControls.TskVLV.prototype.onDPSelDt=function Owa$UIControls$TskVLV$onDPSelDt(){this.oDatePickerDropDown.close();this.oDatePickerDropDown.cb(this.oDatePickerDropDown.oE)};Owa.UIControls.TskVLV.prototype.gtNATsks=function Owa$UIControls$TskVLV$gtNATsks(sSS,sMS){var o={};o.rg=[];var rg=this.gtSel();for(var i=0;i<rg.get_Length();i++){if(!this.gtRwPrp(rg.get_Item(i),"fAT"))o.rg.push(rg.get_Item(i))}if(rg.get_Length()-o.rg.get_Length())o.sErr=(rg.get_Length()==1)?sSS:sMS;return o};Owa.UIControls.TskVLV.prototype.updTskStls=function Owa$UIControls$TskVLV$updTskStls(oRow){var oData=this.getData(oRow);var CLASS_OVERDUE="tskOvd";var CLASS_COMPLETE="tskCmp";if(oRow.getDescendantById("chkMkCmp").get_IsChecked()){oRow.removeCssClass(CLASS_OVERDUE);oRow.addCssClass(CLASS_COMPLETE);Owa.Components.CssSprites.updateImage(oRow.getDescendantById("imgFlg"),"flg-compl.gif")}else{oRow.removeCssClass(CLASS_COMPLETE);if(oData.getAttribute("fOD"))oRow.addCssClass(CLASS_OVERDUE);Owa.Components.CssSprites.updateImage(oRow.getDescendantById("imgFlg"),"icon-flag.gif")}};Owa.UIControls.AddressBookVLV=function Owa$UIControls$AddressBookVLV(oSubPage,o){Owa.UIControls.AddressBookVLV.constructBase(this,[oSubPage,o]);var oN=o;this.fPaaPicker=!!getInt(oN.getAttribute("fPaa"));this.fMobilePicker=!!getInt(oN.getAttribute("fMbl"));this.sCookie=oN.getAttribute("sCki");this.iCookieLcid=oN.getIntAttribute("iLcid");this.sPreferredDC=oN.getAttribute("sPfdDC");this.iCookieIndex=0;this.fAD=1};Owa.UIControls.AddressBookVLV.createClass("Owa.UIControls.AddressBookVLV",Owa.UIControls.VLV);Owa.UIControls.AddressBookVLV.prototype.find=function Owa$UIControls$AddressBookVLV$find(){this.clearCookieInformation();Owa.UIControls.AddressBookVLV.callBase(this,"find")};Owa.UIControls.AddressBookVLV.prototype.clrFind=function Owa$UIControls$AddressBookVLV$clrFind(fSR){this.clearCookieInformation();Owa.UIControls.AddressBookVLV.callBase(this,"clrFind",[fSR])};Owa.UIControls.AddressBookVLV.prototype.clearCookieInformation=function Owa$UIControls$AddressBookVLV$clearCookieInformation(){this.sCookie="";this.iCookieLcid=0;this.sPreferredDC="";this.iCookieIndex=0};Owa.UIControls.AddressBookVLV.prototype.tdSrch=function Owa$UIControls$AddressBookVLV$tdSrch(){if(this.fSrch){return}Owa.UIControls.AddressBookVLV.callBase(this,"tdSrch")};Owa.UIControls.AddressBookVLV.prototype.addLVSt=function Owa$UIControls$AddressBookVLV$addLVSt(oR){var oST=new oeSt(oR,"ADVLVS");oST.add("sId",this.sSid);oST.add("mL",this.fML);oST.add("sC",this.iSC);oST.add("sO",this.iSO);oST.add("cki",this.sCookie);oST.add("ckii",this.iCookieIndex);oST.add("clcid",this.iCookieLcid);oST.add("cPfdDC",this.sPreferredDC);oR.addSt("St",oST);if(this.fSrch)this.fnGtSF(oR);if(this.fPaaPicker){oR.add("paa",this.fPaaPicker?1:0)}if(this.fMobilePicker){oR.add("mbl",new String(this.fMobilePicker))}};Owa.UIControls.AddressBookVLV.prototype.initChnk=function Owa$UIControls$AddressBookVLV$initChnk(oC){if(getInt(oC.getAttribute("fNoRws"))||getInt(oC.getAttribute("fNull")))this.iCookieIndex=0;else this.iCookieIndex=oC.getIntAttribute("iER");Owa.UIControls.AddressBookVLV.callBase(this,"initChnk",[oC])};Owa.UIControls.AddressBookVLV.prototype.prcsDta=function Owa$UIControls$AddressBookVLV$prcsDta(oD){Owa.UIControls.AddressBookVLV.callBase(this,"prcsDta",[oD]);var oNewData=oD.getChildById("data");this.sCookie=oNewData.getAttribute("sCki");this.iCookieLcid=oNewData.getIntAttribute("iLcid");this.sPreferredDC=oNewData.getAttribute("sPfdDC")};Owa.UIControls.AddressBookVLV.prototype.ldAdj=function Owa$UIControls$AddressBookVLV$ldAdj(fNxt){if(!this.strtLd(LOAD_ADJACENT,arguments))return;var iStartRange=fNxt?this.ER()+1:this.SR()-CHNK_SZ;var iRowCount=CHNK_SZ;if(iStartRange<0){iStartRange=0;iRowCount=this.SR()}else if(iStartRange+iRowCount>this.iTC-1){iRowCount=this.iTC-1-this.ER()}var oC=new Object();oC.fIsLoadAdjacent=true;oC.fNxt=fNxt;var oR=new oeReq(this.sEvtNS,"LoadFresh",oC,this._createCallback(this.cbLdSafe),POST);this.addLVSt(oR);oR.add("SR",iStartRange);oR.add("RC",iRowCount);oR.send()};Owa.UIControls.AddressBookVLV.prototype.ldSk=function Owa$UIControls$AddressBookVLV$ldSk(sId,fNI,fnCb,oCtx){if(fnCb){fnCb(this)}};Owa.UIControls.AddressBookVLV.prototype.selNPRw=function Owa$UIControls$AddressBookVLV$selNPRw(sId,sCtx,fNI,fF){if(!fF){Owa.UIControls.AddressBookVLV.callBase(this,"selNPRw",[sId,sCtx,fNI]);return}this.selectFirstLastVisibleRow(fNI);if(sCtx){this.feNav(sCtx)}};Owa.UIControls.AddressBookVLV.prototype.seekRw=function Owa$UIControls$AddressBookVLV$seekRw(sId,fSuppressLoad){if(!fSuppressLoad){Owa.UIControls.AddressBookVLV.callBase(this,"seekRw",[sId]);return}this.selectFirstLastVisibleRow(true)};Owa.UIControls.AddressBookVLV.prototype.extndRng=function Owa$UIControls$AddressBookVLV$extndRng(fNI,fF){if(!fF){Owa.UIControls.AddressBookVLV.callBase(this,"extndRng",[fNI]);return}this.selectFirstLastVisibleRow(fNI,true)};Owa.UIControls.AddressBookVLV.prototype.selectFirstLastVisibleRow=function Owa$UIControls$AddressBookVLV$selectFirstLastVisibleRow(fNI){var oRowPosition=fNI?this.getFirstVisibleRow():this.getLastVisibleRow();var oR=this.gtRw(oRowPosition.iRow,oRowPosition.iSubRow);if(oR){this.selSngl(oR,false,true)}};Owa.UIControls.AddressBookVLV.prototype.onClkHdr=function Owa$UIControls$AddressBookVLV$onClkHdr(oEvent){oEvent.preventDefault();oEvent.cancelBubble()};Owa.UIControls.ContactsVLV=function Owa$UIControls$ContactsVLV(oSubPage,o){Owa.UIControls.ContactsVLV.constructBase(this,[oSubPage,o]);var oN=o;this.fPaaPicker=!!getInt(oN.getAttribute("fPaa"));this.fMobilePicker=!!getInt(oN.getAttribute("fMbl"))};Owa.UIControls.ContactsVLV.createClass("Owa.UIControls.ContactsVLV",Owa.UIControls.FldrVLV);Owa.UIControls.ContactsVLV.prototype.addLVSt=function Owa$UIControls$ContactsVLV$addLVSt(oR){Owa.UIControls.ContactsVLV.callBase(this,"addLVSt",[oR]);if(this.fPaaPicker){oR.add("paa",this.fPaaPicker?1:0)}if(this.fMobilePicker){oR.add("mbl",new String(this.fMobilePicker))}};Owa.UIControls.DumpsterVLV=function Owa$UIControls$DumpsterVLV(oSubPage,oElement){Owa.UIControls.DumpsterVLV.constructBase(this,[oSubPage,oElement])};Owa.UIControls.DumpsterVLV.createClass("Owa.UIControls.DumpsterVLV",Owa.UIControls.FldrVLV);Owa.UIControls.DumpsterVLV.prototype.addLVSt=function Owa$UIControls$DumpsterVLV$addLVSt(oR){var oST=new oeSt(oR,"FVLVS");oST.add("sId",this.sSid);oST.add("mL",this.fML);oST.add("sC",this.iSC);oST.add("sO",this.iSO);oR.addSt("St",oST);if(this.fSrch)this.fnGtSF(oR)};Owa.UIControls.DumpsterVLV.prototype.onDblClkVP=function Owa$UIControls$DumpsterVLV$onDblClkVP(oEvent){alrt(L_RcvWrng);oEvent.preventDefault();oEvent.cancelBubble()};Owa.UIControls.DumpsterVLV.prototype.onDS=function Owa$UIControls$DumpsterVLV$onDS(oEvent){oEvent.preventDefault();oEvent.cancelBubble()};Owa.UIControls.DumpsterVLV.prototype.updCnts=function Owa$UIControls$DumpsterVLV$updCnts(){this.get_SubPage()._getDescendant("spnIC").set_TextContent(this.gtTIC().toString())};Owa.UIControls.DumpsterVLV.prototype.purgeItems=function Owa$UIControls$DumpsterVLV$purgeItems(){var rgId=this.gtSel(1);var iC=rgId.length;if(!iC){return}if(iC>MAX_REQ_ITMS){alrt(L_ErrMaxItms);return}if(!confirm(L_ConfirmPD))return;var oCtx=new Object();oCtx.isPD=true;oCtx.rgId=rgId;var oR=new oeReq(this.sEvtNS,"PermanentDelete",oCtx,this._createCallback(this.cbPurgeItems));oR.addRg("Itms",rgId);oR.add("fId",this.sSid);oR.send()};Owa.UIControls.DumpsterVLV.prototype.cbPurgeItems=function Owa$UIControls$DumpsterVLV$cbPurgeItems(oR){if(!cbOeh(oR))return;var sErr;var oDiv=Document.get_Current().createElement("div");oDiv.set_InnerHtml(oR.sBody);if(oDiv.getDescendantById("eib"))sErr=oDiv.getDescendantById("eib").get_InnerHtml();oDiv.remove(true);var oBody=Document.get_Current().get_Body();if(sErr){alrt(sErr)}this.rmvRws(oR.oCtx.rgId);this.updCnts()}})();stJS("vlv.js");