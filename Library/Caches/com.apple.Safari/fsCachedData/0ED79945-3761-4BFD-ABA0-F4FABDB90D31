!function(t,e){t.rails!==e&&t.error("jquery-ujs has already been loaded!");var n,r=t(document);t.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not(form button), button[data-confirm]:not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",CSRFProtection:function(e){var n=t('meta[name="csrf-token"]').attr("content");n&&e.setRequestHeader("X-CSRF-Token",n)},refreshCSRFTokens:function(){var e=t("meta[name=csrf-token]").attr("content"),n=t("meta[name=csrf-param]").attr("content");t('form input[name="'+n+'"]').val(e)},fire:function(e,n,r){var i=t.Event(n);return e.trigger(i,r),i.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t[0].href},handleRemote:function(r){var i,o,a,s,u,l;if(n.fire(r,"ajax:before")){if(s=r.data("with-credentials")||null,u=r.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,r.is("form")){i=r.attr("method"),o=r.attr("action"),a=r.serializeArray();var c=r.data("ujs:submit-button");c&&(a.push(c),r.data("ujs:submit-button",null))}else r.is(n.inputChangeSelector)?(i=r.data("method"),o=r.data("url"),a=r.serialize(),r.data("params")&&(a=a+"&"+r.data("params"))):r.is(n.buttonClickSelector)?(i=r.data("method")||"get",o=r.data("url"),a=r.serialize(),r.data("params")&&(a=a+"&"+r.data("params"))):(i=r.data("method"),o=n.href(r),a=r.data("params")||null);return l={type:i||"GET",data:a,dataType:u,beforeSend:function(t,i){return i.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+i.accepts.script),n.fire(r,"ajax:beforeSend",[t,i])?void r.trigger("ajax:send",t):!1},success:function(t,e,n){r.trigger("ajax:success",[t,e,n])},complete:function(t,e){r.trigger("ajax:complete",[t,e])},error:function(t,e,n){r.trigger("ajax:error",[t,e,n])},crossDomain:n.isCrossDomain(o)},s&&(l.xhrFields={withCredentials:s}),o&&(l.url=o),n.ajax(l)}return!1},isCrossDomain:function(t){var e=document.createElement("a");e.href=location.href;var n=document.createElement("a");try{return n.href=t,n.href=n.href,!n.protocol||!n.host||e.protocol+"//"+e.host!=n.protocol+"//"+n.host}catch(r){return!0}},handleMethod:function(r){var i=n.href(r),o=r.data("method"),a=r.attr("target"),s=t("meta[name=csrf-token]").attr("content"),u=t("meta[name=csrf-param]").attr("content"),l=t('<form method="post" action="'+i+'"></form>'),c='<input name="_method" value="'+o+'" type="hidden" />';u===e||s===e||n.isCrossDomain(i)||(c+='<input name="'+u+'" value="'+s+'" type="hidden" />'),a&&l.attr("target",a),l.hide().append(c).appendTo("body"),l.submit()},formElements:function(e,n){return e.is("form")?t(e[0].elements).filter(n):e.find(n)},disableFormElements:function(e){n.formElements(e,n.disableSelector).each(function(){n.disableFormElement(t(this))})},disableFormElement:function(t){var n,r;n=t.is("button")?"html":"val",r=t.data("disable-with"),t.data("ujs:enable-with",t[n]()),r!==e&&t[n](r),t.prop("disabled",!0)},enableFormElements:function(e){n.formElements(e,n.enableSelector).each(function(){n.enableFormElement(t(this))})},enableFormElement:function(t){var e=t.is("button")?"html":"val";t.data("ujs:enable-with")&&t[e](t.data("ujs:enable-with")),t.prop("disabled",!1)},allowAction:function(t){var e,r=t.data("confirm"),i=!1;return r?(n.fire(t,"confirm")&&(i=n.confirm(r),e=n.fire(t,"confirm:complete",[i])),i&&e):!0},blankInputs:function(e,n,r){var i,o,a=t(),s=n||"input,textarea",u=e.find(s);return u.each(function(){if(i=t(this),o=i.is("input[type=checkbox],input[type=radio]")?i.is(":checked"):i.val(),!o==!r){if(i.is("input[type=radio]")&&u.filter('input[type=radio]:checked[name="'+i.attr("name")+'"]').length)return!0;a=a.add(i)}}),a.length?a:!1},nonBlankInputs:function(t,e){return n.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(t){var r=t.data("disable-with");t.data("ujs:enable-with",t.html()),r!==e&&t.html(r),t.bind("click.railsDisable",function(t){return n.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable")}},n.fire(r,"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,r){t.crossDomain||n.CSRFProtection(r)}),t(window).on("pageshow.rails",function(){t(t.rails.enableSelector).each(function(){var e=t(this);e.data("ujs:enable-with")&&t.rails.enableFormElement(e)}),t(t.rails.linkDisableSelector).each(function(){var e=t(this);e.data("ujs:enable-with")&&t.rails.enableElement(e)})}),r.delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(t(this))}),r.delegate(n.buttonDisableSelector,"ajax:complete",function(){n.enableFormElement(t(this))}),r.delegate(n.linkClickSelector,"click.rails",function(r){var i=t(this),o=i.data("method"),a=i.data("params"),s=r.metaKey||r.ctrlKey;if(!n.allowAction(i))return n.stopEverything(r);if(!s&&i.is(n.linkDisableSelector)&&n.disableElement(i),i.data("remote")!==e){if(s&&(!o||"GET"===o)&&!a)return!0;var u=n.handleRemote(i);return u===!1?n.enableElement(i):u.fail(function(){n.enableElement(i)}),!1}return o?(n.handleMethod(i),!1):void 0}),r.delegate(n.buttonClickSelector,"click.rails",function(e){var r=t(this);if(!n.allowAction(r))return n.stopEverything(e);r.is(n.buttonDisableSelector)&&n.disableFormElement(r);var i=n.handleRemote(r);return i===!1?n.enableFormElement(r):i.fail(function(){n.enableFormElement(r)}),!1}),r.delegate(n.inputChangeSelector,"change.rails",function(e){var r=t(this);return n.allowAction(r)?(n.handleRemote(r),!1):n.stopEverything(e)}),r.delegate(n.formSubmitSelector,"submit.rails",function(r){var i,o,a=t(this),s=a.data("remote")!==e;if(!n.allowAction(a))return n.stopEverything(r);if(a.attr("novalidate")==e&&(i=n.blankInputs(a,n.requiredInputSelector),i&&n.fire(a,"ajax:aborted:required",[i])))return n.stopEverything(r);if(s){if(o=n.nonBlankInputs(a,n.fileInputSelector)){setTimeout(function(){n.disableFormElements(a)},13);var u=n.fire(a,"ajax:aborted:file",[o]);return u||setTimeout(function(){n.enableFormElements(a)},13),u}return n.handleRemote(a),!1}setTimeout(function(){n.disableFormElements(a)},13)}),r.delegate(n.formInputClickSelector,"click.rails",function(e){var r=t(this);if(!n.allowAction(r))return n.stopEverything(e);var i=r.attr("name"),o=i?{name:i,value:r.val()}:null;r.closest("form").data("ujs:submit-button",o)}),r.delegate(n.formSubmitSelector,"ajax:send.rails",function(e){this==e.target&&n.disableFormElements(t(this))}),r.delegate(n.formSubmitSelector,"ajax:complete.rails",function(e){this==e.target&&n.enableFormElements(t(this))}),t(function(){n.refreshCSRFTokens()}))}(jQuery),/*!
 * jQuery Templates Plugin 1.0.0pre
 * http://github.com/jquery/jquery-tmpl
 * Requires jQuery 1.4.2
 *
 * Copyright 2011, Software Freedom Conservancy, Inc.
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 */
function(t){function e(e,n,r,i){var o={data:i||0===i||i===!1?i:n?n.data:{},_wrap:n?n._wrap:null,tmpl:null,parent:n||null,nodes:[],calls:l,nest:c,wrap:h,html:d,update:p};return e&&t.extend(o,e,{nodes:[],parent:n}),r&&(o.tmpl=r,o._ctnt=o._ctnt||o.tmpl(t,o),o.key=++_,(k.length?y:v)[_]=o),o}function n(e,i,o){var a,s=o?t.map(o,function(t){return"string"==typeof t?e.key?t.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+g+'="'+e.key+'" $2'):t:n(t,e,t._ctnt)}):e;return i?s:(s=s.join(""),s.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(e,n,i,o){a=t(i).get(),u(a),n&&(a=r(n).concat(a)),o&&(a=a.concat(r(o)))}),a?a:r(s))}function r(e){var n=document.createElement("div");return n.innerHTML=e,t.makeArray(n.childNodes)}function i(e){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+t.trim(e).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(e,n,r,i,o,s,u){var l,c,h,d=t.tmpl.tag[r];if(!d)throw"Unknown template tag: "+r;return l=d._default||[],s&&!/\w$/.test(o)&&(o+=s,s=""),o?(o=a(o),u=u?","+a(u)+")":s?")":"",c=s?o.indexOf(".")>-1?o+a(s):"("+o+").call($item"+u:o,h=s?c:"(typeof("+o+")==='function'?("+o+").call($item):("+o+"))"):h=c=l.$1||"null",i=a(i),"');"+d[n?"close":"open"].split("$notnull_1").join(o?"typeof("+o+")!=='undefined' && ("+o+")!=null":"true").split("$1a").join(h).split("$1").join(c).split("$2").join(i||l.$2||"")+"__.push('"})+"');}return __;")}function o(e,r){e._wrap=n(e,!0,t.isArray(r)?r:[b.test(r)?r:t(r).html()]).join("")}function a(t){return t?t.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function s(t){var e=document.createElement("div");return e.appendChild(t.cloneNode(!0)),e.innerHTML}function u(n){function r(n){function r(t){t+=l,a=c[t]=c[t]||e(a,v[a.parent.key+l]||a.parent)}var i,o,a,s,u=n;if(s=n.getAttribute(g)){for(;u.parentNode&&1===(u=u.parentNode).nodeType&&!(i=u.getAttribute(g)););i!==s&&(u=u.parentNode?11===u.nodeType?0:u.getAttribute(g)||0:0,(a=v[s])||(a=y[s],a=e(a,v[u]||y[u]),a.key=++_,v[_]=a),w&&r(s)),n.removeAttribute(g)}else w&&(a=t.data(n,"tmplItem"))&&(r(a.key),v[a.key]=a,u=t.data(n.parentNode,"tmplItem"),u=u?u.key:0);if(a){for(o=a;o&&o.key!=u;)o.nodes.push(n),o=o.parent;delete a._ctnt,delete a._wrap,t.data(n,"tmplItem",a)}}var i,o,a,s,u,l="_"+w,c={};for(a=0,s=n.length;s>a;a++)if(1===(i=n[a]).nodeType){for(o=i.getElementsByTagName("*"),u=o.length-1;u>=0;u--)r(o[u]);r(i)}}function l(t,e,n,r){return t?void k.push({_:t,tmpl:e,item:this,data:n,options:r}):k.pop()}function c(e,n,r){return t.tmpl(t.template(e),n,r,this)}function h(e,n){var r=e.options||{};return r.wrapped=n,t.tmpl(t.template(e.tmpl),e.data,r,e.item)}function d(e,n){var r=this._wrap;return t.map(t(t.isArray(r)?r.join(""):r).filter(e||"*"),function(t){return n?t.innerText||t.textContent:t.outerHTML||s(t)})}function p(){var e=this.nodes;t.tmpl(null,null,null,this).insertBefore(e[0]),t(e).remove()}var f,m=t.fn.domManip,g="_tmplitem",b=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,v={},y={},$={key:0,data:{}},_=0,w=0,k=[];t.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,n){t.fn[e]=function(r){var i,o,a,s,u=[],l=t(r),c=1===this.length&&this[0].parentNode;if(f=v||{},c&&11===c.nodeType&&1===c.childNodes.length&&1===l.length)l[n](this[0]),u=this;else{for(o=0,a=l.length;a>o;o++)w=o,i=(o>0?this.clone(!0):this).get(),t(l[o])[n](i),u=u.concat(i);w=0,u=this.pushStack(u,e,l.selector)}return s=f,f=null,t.tmpl.complete(s),u}}),t.fn.extend({tmpl:function(e,n,r){return t.tmpl(this[0],e,n,r)},tmplItem:function(){return t.tmplItem(this[0])},template:function(e){return t.template(e,this[0])},domManip:function(e,n,r){if(e[0]&&t.isArray(e[0])){for(var i,o=t.makeArray(arguments),a=e[0],s=a.length,u=0;s>u&&!(i=t.data(a[u++],"tmplItem")););i&&w&&(o[2]=function(e){t.tmpl.afterManip(this,e,r)}),m.apply(this,o)}else m.apply(this,arguments);return w=0,f||t.tmpl.complete(v),this}}),t.extend({tmpl:function(r,i,a,s){var u,l=!s;if(l)s=$,r=t.template[r]||t.template(null,r),y={};else if(!r)return r=s.tmpl,v[s.key]=s,s.nodes=[],s.wrapped&&o(s,s.wrapped),t(n(s,null,s.tmpl(t,s)));return r?("function"==typeof i&&(i=i.call(s||{})),a&&a.wrapped&&o(a,a.wrapped),u=t.isArray(i)?t.map(i,function(t){return t?e(a,s,r,t):null}):[e(a,s,r,i)],l?t(n(s,null,u)):u):[]},tmplItem:function(e){var n;for(e instanceof t&&(e=e[0]);e&&1===e.nodeType&&!(n=t.data(e,"tmplItem"))&&(e=e.parentNode););return n||$},template:function(e,n){return n?("string"==typeof n?n=i(n):n instanceof t&&(n=n[0]||{}),n.nodeType&&(n=t.data(n,"tmpl")||t.data(n,"tmpl",i(n.innerHTML))),"string"==typeof e?t.template[e]=n:n):e?"string"!=typeof e?t.template(null,e):t.template[e]||t.template(null,b.test(e)?e:t(e)):null},encode:function(t){return(""+t).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}}),t.extend(t.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){v={}},afterManip:function(e,n,r){var i=11===n.nodeType?t.makeArray(n.childNodes):1===n.nodeType?[n]:[];r.call(e,n),u(i),w++}})}(jQuery),/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.7.2
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.com/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */
function(t){function e(t){return t.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function n(t){return"[object Array]"===String(Object.prototype.toString.call(t))}function r(e,r){var i,o,a={};if(n(r))for(i=0,o=r.length;o>i;i++)a[r[i]]=!0;else a[r]=!0;for(i=0,o=e.length;o>i;i++)a[e[i]]!==t&&(e.splice(i,1),o--,i--);return e}function i(t){return encodeURIComponent(t).replace(/[!'()*]/g,escape)}var o="undefined"!=typeof module&&module.exports,a=function(t){return o?require("./"+t):window[t]},s=a("punycode"),u=a("IPv6"),l=a("SecondLevelDomains"),c=function(e,n){return this instanceof c?(e===t&&(e="undefined"!=typeof location?location.href+"":""),this.href(e),n!==t?this.absoluteTo(n):this):new c(e,n)},h=c.prototype;c.idn_expression=/[^a-z0-9\.-]/i,c.punycode_expression=/(xn--)/i,c.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,c.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,c.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gi,c.defaultPorts={http:"80",https:"443",ftp:"21"},c.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,c.encode=i,c.decode=decodeURIComponent,c.iso8859=function(){c.encode=escape,c.decode=unescape},c.unicode=function(){c.encode=i,c.decode=decodeURIComponent},c.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}},c.encodeQuery=function(t){return c.encode(t+"").replace(/%20/g,"+")},c.decodeQuery=function(t){return c.decode((t+"").replace(/\+/g,"%20"))},c.recodePath=function(t){for(var e=(t+"").split("/"),n=0,r=e.length;r>n;n++)e[n]=c.encodePathSegment(c.decode(e[n]));return e.join("/")},c.decodePath=function(t){for(var e=(t+"").split("/"),n=0,r=e.length;r>n;n++)e[n]=c.decodePathSegment(e[n]);return e.join("/")};var d,p={encode:"encode",decode:"decode"},f=function(t,e){return function(n){return c[e](n+"").replace(c.characters[t][e].expression,function(n){return c.characters[t][e].map[n]})}};for(d in p)c[d+"PathSegment"]=f("pathname",p[d]);c.encodeReserved=f("reserved","encode"),c.parse=function(t){var e,n={};return e=t.indexOf("#"),e>-1&&(n.fragment=t.substring(e+1)||null,t=t.substring(0,e)),e=t.indexOf("?"),e>-1&&(n.query=t.substring(e+1)||null,t=t.substring(0,e)),"//"===t.substring(0,2)?(n.protocol="",t=t.substring(2),t=c.parseAuthority(t,n)):(e=t.indexOf(":"),e>-1&&(n.protocol=t.substring(0,e),"//"===t.substring(e+1,e+3)?(t=t.substring(e+3),t=c.parseAuthority(t,n)):(t=t.substring(e+1),n.urn=!0))),n.path=t,n},c.parseHost=function(t,e){var n,r=t.indexOf("/");if(-1===r&&(r=t.length),"["===t[0]){var i=t.indexOf("]");e.hostname=t.substring(1,i)||null,e.port=t.substring(i+2,r)||null}else t.indexOf(":")!==t.lastIndexOf(":")?(e.hostname=t.substring(0,r)||null,e.port=null):(n=t.substring(0,r).split(":"),e.hostname=n[0]||null,e.port=n[1]||null);return e.hostname&&"/"!==t.substring(r)[0]&&(r++,t="/"+t),t.substring(r)||"/"},c.parseAuthority=function(t,e){return t=c.parseUserinfo(t,e),c.parseHost(t,e)},c.parseUserinfo=function(t,e){var n,r=t.indexOf("@"),i=t.indexOf("/");return r>-1&&(-1===i||i>r)?(n=t.substring(0,r).split(":"),e.username=n[0]?c.decode(n[0]):null,e.password=n[1]?c.decode(n[1]):null,t=t.substring(r+1)):(e.username=null,e.password=null),t},c.parseQuery=function(t){if(!t)return{};if(t=t.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!t)return{};for(var e={},n=t.split("&"),r=n.length,i=0;r>i;i++){var o=n[i].split("="),a=c.decodeQuery(o.shift()),s=o.length?c.decodeQuery(o.join("=")):null;e[a]?("string"==typeof e[a]&&(e[a]=[e[a]]),e[a].push(s)):e[a]=s}return e},c.build=function(t){var e="";return t.protocol&&(e+=t.protocol+":"),t.urn||!e&&!t.hostname||(e+="//"),e+=c.buildAuthority(t)||"","string"==typeof t.path&&("/"!==t.path[0]&&"string"==typeof t.hostname&&(e+="/"),e+=t.path),"string"==typeof t.query&&(e+="?"+t.query),"string"==typeof t.fragment&&(e+="#"+t.fragment),e},c.buildHost=function(t){var e="";return t.hostname?(c.ip6_expression.test(t.hostname)?e+=t.port?"["+t.hostname+"]:"+t.port:t.hostname:(e+=t.hostname,t.port&&(e+=":"+t.port)),e):""},c.buildAuthority=function(t){return c.buildUserinfo(t)+c.buildHost(t)},c.buildUserinfo=function(t){var e="";return t.username&&(e+=c.encode(t.username),t.password&&(e+=":"+c.encode(t.password)),e+="@"),e},c.buildQuery=function(e,r){var i="";for(var o in e)if(Object.hasOwnProperty.call(e,o)&&o)if(n(e[o]))for(var a={},s=0,u=e[o].length;u>s;s++)e[o][s]!==t&&a[e[o][s]+""]===t&&(i+="&"+c.buildQueryParameter(o,e[o][s]),r!==!0&&(a[e[o][s]+""]=!0));else e[o]!==t&&(i+="&"+c.buildQueryParameter(o,e[o]));return i.substring(1)},c.buildQueryParameter=function(t,e){return c.encodeQuery(t)+(null!==e?"="+c.encodeQuery(e):"")},c.addQuery=function(e,r,i){if("object"==typeof r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&c.addQuery(e,o,r[o]);else{if("string"!=typeof r)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(e[r]===t)return void(e[r]=i);"string"==typeof e[r]&&(e[r]=[e[r]]),n(i)||(i=[i]),e[r]=e[r].concat(i)}},c.removeQuery=function(e,i,o){if(n(i))for(var a=0,s=i.length;s>a;a++)e[i[a]]=t;else if("object"==typeof i)for(var u in i)Object.prototype.hasOwnProperty.call(i,u)&&c.removeQuery(e,u,i[u]);else{if("string"!=typeof i)throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");o!==t?e[i]===o?e[i]=t:n(e[i])&&(e[i]=r(e[i],o)):e[i]=t}},c.commonPath=function(t,e){var n,r=Math.min(t.length,e.length);for(n=0;r>n;n++)if(t[n]!==e[n]){n--;break}return 1>n?t[0]===e[0]&&"/"===t[0]?"/":"":("/"!==t[n]&&(n=t.substring(0,n).lastIndexOf("/")),t.substring(0,n+1))},c.withinString=function(t,e){return t.replace(c.find_uri_expression,e)},c.ensureValidHostname=function(t){if(t.match(c.invalid_hostname_characters)){if(!s)throw new TypeError("Hostname '"+t+"' contains characters other than [A-Z0-9.-] and Punycode.js is not available");if(s.toASCII(t).match(c.invalid_hostname_characters))throw new TypeError("Hostname '"+t+"' contains characters other than [A-Z0-9.-]")}},h.build=function(e){return e===!0?this._deferred_build=!0:(e===t||this._deferred_build)&&(this._string=c.build(this._parts),this._deferred_build=!1),this},h.clone=function(){return new c(this)},h.toString=function(){return this.build(!1)._string},h.valueOf=function(){return this.toString()},p={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"},f=function(e){return function(n,r){return n===t?this._parts[e]||"":(this._parts[e]=n,this.build(!r),this)}};for(d in p)h[d]=f(p[d]);p={query:"?",fragment:"#"},f=function(e,n){return function(r,i){return r===t?this._parts[e]||"":(null!==r&&(r+="",r[0]===n&&(r=r.substring(1))),this._parts[e]=r,this.build(!i),this)}};for(d in p)h[d]=f(d,p[d]);p={search:["?","query"],hash:["#","fragment"]},f=function(t,e){return function(n,r){var i=this[t](n,r);return"string"==typeof i&&i.length?e+i:i}};for(d in p)h[d]=f(p[d][1],p[d][0]);h.pathname=function(e,n){if(e===t||e===!0){var r=this._parts.path||(this._parts.urn?"":"/");return e?c.decodePath(r):r}return this._parts.path=e?c.recodePath(e):"/",this.build(!n),this},h.path=h.pathname,h.href=function(e,n){if(e===t)return this.toString();this._string="",this._parts={protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null};var r,i=e instanceof c,o="object"==typeof e&&(e.hostname||e.path);if("string"==typeof e)this._parts=c.parse(e);else{if(!i&&!o)throw new TypeError("invalid input");var a=i?e._parts:e;for(r in a)Object.hasOwnProperty.call(this._parts,r)&&(this._parts[r]=a[r])}return this.build(!n),this},h.is=function(t){var e=!1,n=!1,r=!1,i=!1,o=!1,a=!1,s=!1,u=!this._parts.urn;switch(this._parts.hostname&&(u=!1,n=c.ip4_expression.test(this._parts.hostname),r=c.ip6_expression.test(this._parts.hostname),e=n||r,i=!e,o=i&&l&&l.has(this._parts.hostname),a=i&&c.idn_expression.test(this._parts.hostname),s=i&&c.punycode_expression.test(this._parts.hostname)),t.toLowerCase()){case"relative":return u;case"absolute":return!u;case"domain":case"name":return i;case"sld":return o;case"ip":return e;case"ip4":case"ipv4":case"inet4":return n;case"ip6":case"ipv6":case"inet6":return r;case"idn":return a;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return s}return null};var m=h.protocol,g=h.port,b=h.hostname;h.protocol=function(e,n){if(e!==t&&e&&(e=e.replace(/:(\/\/)?$/,""),e.match(/[^a-zA-z0-9\.+-]/)))throw new TypeError("Protocol '"+e+"' contains characters other than [A-Z0-9.+-]");return m.call(this,e,n)},h.scheme=h.protocol,h.port=function(e,n){if(this._parts.urn)return e===t?"":this;if(e!==t&&(0===e&&(e=null),e&&(e+="",":"===e[0]&&(e=e.substring(1)),e.match(/[^0-9]/))))throw new TypeError("Port '"+e+"' contains characters other than [0-9]");return g.call(this,e,n)},h.hostname=function(e,n){if(this._parts.urn)return e===t?"":this;if(e!==t){var r={};c.parseHost(e,r),e=r.hostname}return b.call(this,e,n)},h.host=function(e,n){return this._parts.urn?e===t?"":this:e===t?this._parts.hostname?c.buildHost(this._parts):"":(c.parseHost(e,this._parts),this.build(!n),this)},h.authority=function(e,n){return this._parts.urn?e===t?"":this:e===t?this._parts.hostname?c.buildAuthority(this._parts):"":(c.parseAuthority(e,this._parts),this.build(!n),this)},h.userinfo=function(e,n){if(this._parts.urn)return e===t?"":this;if(e===t){if(!this._parts.username)return"";var r=c.buildUserinfo(this._parts);return r.substring(0,r.length-1)}return"@"!==e[e.length-1]&&(e+="@"),c.parseUserinfo(e,this._parts),this.build(!n),this},h.subdomain=function(n,r){if(this._parts.urn)return n===t?"":this;if(n===t){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,i)||""}var o=this._parts.hostname.length-this.domain().length,a=this._parts.hostname.substring(0,o),s=new RegExp("^"+e(a));return n&&"."!==n[n.length-1]&&(n+="."),n&&c.ensureValidHostname(n),this._parts.hostname=this._parts.hostname.replace(s,n),this.build(!r),this},h.domain=function(n,r){if(this._parts.urn)return n===t?"":this;if("boolean"==typeof n&&(r=n,n=t),n===t){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.match(/\./g);if(i&&i.length<2)return this._parts.hostname;var o=this._parts.hostname.length-this.tld(r).length-1;return o=this._parts.hostname.lastIndexOf(".",o-1)+1,this._parts.hostname.substring(o)||""}if(!n)throw new TypeError("cannot set domain empty");if(c.ensureValidHostname(n),!this._parts.hostname||this.is("IP"))this._parts.hostname=n;else{var a=new RegExp(e(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(a,n)}return this.build(!r),this},h.tld=function(n,r){if(this._parts.urn)return n===t?"":this;if("boolean"==typeof n&&(r=n,n=t),n===t){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.lastIndexOf("."),o=this._parts.hostname.substring(i+1);return r!==!0&&l&&l.list[o.toLowerCase()]?l.get(this._parts.hostname)||o:o}var a;if(!n)throw new TypeError("cannot set TLD empty");if(n.match(/[^a-zA-Z0-9-]/)){if(!l||!l.is(n))throw new TypeError("TLD '"+n+"' contains characters other than [A-Z0-9]");a=new RegExp(e(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(a,n)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");a=new RegExp(e(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(a,n)}return this.build(!r),this},h.directory=function(n,r){if(this._parts.urn)return n===t?"":this;if(n===t||n===!0){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var i=this._parts.path.length-this.filename().length-1,o=this._parts.path.substring(0,i)||(this._parts.hostname?"/":"");return n?c.decodePath(o):o}var a=this._parts.path.length-this.filename().length,s=this._parts.path.substring(0,a),u=new RegExp("^"+e(s));return this.is("relative")||(n||(n="/"),"/"!==n[0]&&(n="/"+n)),n&&"/"!==n[n.length-1]&&(n+="/"),n=c.recodePath(n),this._parts.path=this._parts.path.replace(u,n),this.build(!r),this},h.filename=function(n,r){if(this._parts.urn)return n===t?"":this;if(n===t||n===!0){if(!this._parts.path||"/"===this._parts.path)return"";var i=this._parts.path.lastIndexOf("/"),o=this._parts.path.substring(i+1);return n?c.decodePathSegment(o):o}var a=!1;"/"===n[0]&&(n=n.substring(1)),n.match(/\.?\//)&&(a=!0);var s=new RegExp(e(this.filename())+"$");return n=c.recodePath(n),this._parts.path=this._parts.path.replace(s,n),a?this.normalizePath(r):this.build(!r),this},h.suffix=function(n,r){if(this._parts.urn)return n===t?"":this;if(n===t||n===!0){if(!this._parts.path||"/"===this._parts.path)return"";var i,o,a=this.filename(),s=a.lastIndexOf(".");return-1===s?"":(i=a.substring(s+1),o=/^[a-z0-9%]+$/i.test(i)?i:"",n?c.decodePathSegment(o):o)}"."===n[0]&&(n=n.substring(1));var u,l=this.suffix();if(l)u=new RegExp(n?e(l)+"$":e("."+l)+"$");else{if(!n)return this;this._parts.path+="."+c.recodePath(n)}return u&&(n=c.recodePath(n),this._parts.path=this._parts.path.replace(u,n)),this.build(!r),this},h.segment=function(e,r,i){var o=this._parts.urn?":":"/",a=this.path(),s="/"===a.substring(0,1),u=a.split(o);if("number"!=typeof e&&(i=r,r=e,e=t),e!==t&&"number"!=typeof e)throw new Error("Bad segment '"+e+"', must be 0-based integer");return s&&u.shift(),0>e&&(e=Math.max(u.length+e,0)),r===t?e===t?u:u[e]:(null===e||u[e]===t?n(r)?u=r:(r||"string"==typeof r&&r.length)&&(""===u[u.length-1]?u[u.length-1]=r:u.push(r)):r||"string"==typeof r&&r.length?u[e]=r:u.splice(e,1),s&&u.unshift(""),this.path(u.join(o),i))};var v=h.query;h.query=function(e,n){return e===!0?c.parseQuery(this._parts.query):e!==t&&"string"!=typeof e?(this._parts.query=c.buildQuery(e),this.build(!n),this):v.call(this,e,n)},h.addQuery=function(t,e,n){var r=c.parseQuery(this._parts.query);return c.addQuery(r,t,e),this._parts.query=c.buildQuery(r),"string"!=typeof t&&(n=e),this.build(!n),this},h.removeQuery=function(t,e,n){var r=c.parseQuery(this._parts.query);return c.removeQuery(r,t,e),this._parts.query=c.buildQuery(r),"string"!=typeof t&&(n=e),this.build(!n),this},h.addSearch=h.addQuery,h.removeSearch=h.removeQuery,h.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},h.normalizeProtocol=function(t){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!t)),this},h.normalizeHostname=function(t){return this._parts.hostname&&(this.is("IDN")&&s?this._parts.hostname=s.toASCII(this._parts.hostname):this.is("IPv6")&&u&&(this._parts.hostname=u.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!t)),this},h.normalizePort=function(t){return"string"==typeof this._parts.protocol&&this._parts.port===c.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!t)),this},h.normalizePath=function(t){if(this._parts.urn)return this;if(!this._parts.path||"/"===this._parts.path)return this;var e,n,r,i,o=this._parts.path;for("/"!==o[0]&&("."===o[0]&&(n=o.substring(0,o.indexOf("/"))),e=!0,o="/"+o),o=o.replace(/(\/(\.\/)+)|\/{2,}/g,"/");;){if(r=o.indexOf("/../"),-1===r)break;if(0===r){o=o.substring(3);break}i=o.substring(0,r).lastIndexOf("/"),-1===i&&(i=r),o=o.substring(0,i)+o.substring(r+3)}return e&&this.is("relative")&&(o=n?n+o:o.substring(1)),o=c.recodePath(o),this._parts.path=o,this.build(!t),this},h.normalizePathname=h.normalizePath,h.normalizeQuery=function(t){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(c.parseQuery(this._parts.query)):this._parts.query=null,this.build(!t)),this},h.normalizeFragment=function(t){return this._parts.fragment||(this._parts.fragment=null,this.build(!t)),this},h.normalizeSearch=h.normalizeQuery,h.normalizeHash=h.normalizeFragment,h.iso8859=function(){var t=c.encode,e=c.decode;return c.encode=escape,c.decode=decodeURIComponent,this.normalize(),c.encode=t,c.decode=e,this},h.unicode=function(){var t=c.encode,e=c.decode;return c.encode=i,c.decode=unescape,this.normalize(),c.encode=t,c.decode=e,this},h.readable=function(){var e=this.clone();e.username("").password("").normalize();var n="";if(e._parts.protocol&&(n+=e._parts.protocol+"://"),e._parts.hostname&&(e.is("punycode")&&s?(n+=s.toUnicode(e._parts.hostname),e._parts.port&&(n+=":"+e._parts.port)):n+=e.host()),e._parts.hostname&&e._parts.path&&"/"!==e._parts.path[0]&&(n+="/"),n+=e.path(!0),e._parts.query){for(var r="",i=0,o=e._parts.query.split("&"),a=o.length;a>i;i++){var u=(o[i]||"").split("=");r+="&"+c.decodeQuery(u[0]).replace(/&/g,"%26"),u[1]!==t&&(r+="="+c.decodeQuery(u[1]).replace(/&/g,"%26"))}n+="?"+r.substring(1)}return n+=e.hash()},h.absoluteTo=function(t){var e,n,r,i=this.clone(),o=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierachical components");if(this._parts.hostname)return i;for(t instanceof c||(t=new c(t)),n=0,r;r=o[n];n++)i._parts[r]=t._parts[r];for(o=["query","path"],n=0,r;r=o[n];n++)!i._parts[r]&&t._parts[r]&&(i._parts[r]=t._parts[r]);return"/"!==i.path()[0]&&(e=t.directory(),i._parts.path=(e?e+"/":"")+i._parts.path,i.normalizePath()),i.build(),i},h.relativeTo=function(t){var n,r,i=this.clone(),o=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierachical components");if(t instanceof c||(t=new c(t)),"/"!==this.path()[0]||"/"!==t.path()[0])throw new Error("Cannot calculate common path from non-relative URLs");n=c.commonPath(i.path(),t.path()),r=t.directory();for(var a,s=0;a=o[s];s++)i._parts[a]=null;if(!n||"/"===n)return i;if(r+"/"===n)i._parts.path="./"+i.filename();else{for(var u="../",l=new RegExp("^"+e(n)),h=r.replace(l,"/").match(/\//g).length-1;h--;)u+="../";i._parts.path=i._parts.path.replace(l,u)}return i.build(),i},h.equals=function(t){var e,r,i,o=this.clone(),a=new c(t),s={},u={},l={};if(o.normalize(),a.normalize(),o.toString()===a.toString())return!0;if(e=o.query(),r=a.query(),o.query(""),a.query(""),o.toString()!==a.toString())return!1;if(e.length!==r.length)return!1;s=c.parseQuery(e),u=c.parseQuery(r);for(i in s)if(Object.prototype.hasOwnProperty.call(s,i)){if(n(s[i])){if(!n(u[i]))return!1;if(s[i].length!==u[i].length)return!1;s[i].sort(),u[i].sort();for(var h=0,d=s[i].length;d>h;h++)if(s[i][h]!==u[i][h])return!1}else if(s[i]!==u[i])return!1;l[i]=!0}for(i in u)if(Object.prototype.hasOwnProperty.call(u,i)&&!l[i])return!1;return!0},"undefined"!=typeof module&&module.exports?module.exports=c:window.URI=c}(),/*
 * jQuery Hotkeys Plugin
 * Copyright 2010, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Based upon the plugin by Tzury Bar Yochay:
 * http://github.com/tzuryby/hotkeys
 *
 * Original idea by:
 * Binny V A, http://www.openjs.com/scripts/events/keyboard_shortcuts/
 */
function(t){function e(e){if("string"==typeof e.data&&(e.data={keys:e.data}),e.data&&e.data.keys&&"string"==typeof e.data.keys){var n=e.handler,r=e.data.keys.toLowerCase().split(" ");e.handler=function(e){if(this===e.target||!(/textarea|select/i.test(e.target.nodeName)||t.hotkeys.options.filterTextInputs&&t.inArray(e.target.type,t.hotkeys.textAcceptingInputTypes)>-1)){var i="keypress"!==e.type&&t.hotkeys.specialKeys[e.which],o=String.fromCharCode(e.which).toLowerCase(),a="",s={};t.each(["alt","ctrl","shift"],function(t,n){e[n+"Key"]&&i!==n&&(a+=n+"+")}),e.metaKey&&!e.ctrlKey&&"meta"!==i&&(a+="meta+"),e.metaKey&&"meta"!==i&&a.indexOf("alt+ctrl+shift+")>-1&&(a=a.replace("alt+ctrl+shift+","hyper+")),i?s[a+i]=!0:(s[a+o]=!0,s[a+t.hotkeys.shiftNums[o]]=!0,"shift+"===a&&(s[t.hotkeys.shiftNums[o]]=!0));for(var u=0,l=r.length;l>u;u++)if(s[r[u]])return n.apply(this,arguments)}}}}t.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},textAcceptingInputTypes:["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color","tel"],options:{filterTextInputs:!0}},t.each(["keydown","keyup","keypress"],function(){t.event.special[this]={add:e}})}(jQuery||this.jQuery||window.jQuery),function(){}.call(this),function(){window.AuthorBook={init:function(){return $(function(t){return function(){return t.initBookCRUD()}}(this))},initBookCRUD:function(){var t;return t=function(t){return $(".j_"+t).click(function(){var e,n;return n=prompt("Enter new "+t+":"),e={},e[t]=n,n?$.ajax({url:"/books/1",data:{book:e},dataType:"JSON",type:"PUT",success:function(e){return $(".j_"+t).html(e[t])}}):alert("no text entered, cancelling")})},t("subtitle"),t("description")}}}.call(this),function(){window.BookManage={init:function(t,e){return this.book=t,this.discounts=e,$(".toggleButton").click(function(t){return function(e){var n,r,i;return r=$(e.target),r.toggleClass("on"),r.toggleClass("off"),i=r.hasClass("on")?"on":"off",r.html(r.html().replace(/: (on|off)/,": "+i)),n={book:{}},n.book[r.attr("id")]="on"===i,$.ajax({url:"/books/"+t.book.id,data:n,dataType:"JSON",type:"PUT",success:function(){}}),!1}}(this)),$(".j_editScreencastToggle").click(function(){return function(t){var e;return e=$(t.target).closest(".j_screencastItem"),$(e).hasClass("j_active")?($(e).removeClass("j_active"),t.preventDefault()):($(e).addClass("j_active"),t.preventDefault())}}(this)),$("#addDiscountBtn").click(function(t){return function(){return $("#manageDiscountAdd").toggle(),$(".j_discountFormCreate").show(),$("html,body").animate({scrollTop:$("#manageDiscountAdd").offset().top},1e3),$(".j_discountFormEdit").hide(),t.scrollToEdit()}}(this)),$("#discount_all_options").change(function(){return $(".j_discountOptionCheckboxes input").attr("disabled",this.checked).attr("checked",!1),$(".j_discountOptionCheckboxes .checkLabel").toggleClass("disabled")}),this.discountTmpl=$("#discountTmpl").html(),_.each(this.discounts,function(t){return function(e){return t.renderDiscount(e)}}(this)),$("#new_discount").submit(function(t){return function(){return $("#new_discount .errors").hide(),t.edittingDiscount?$.ajax({url:"/books/"+t.book.id+"/discounts/"+t.edittingDiscount.id,data:$("#new_discount").serialize(),type:"PUT",success:function(e){return e.errors?$("#new_discount .errors").show().html(e.errors.join("<br/>")):(t.cancelDiscount(),t.renderDiscount(e,!0))}}):$.post("/books/"+t.book.id+"/discounts",$("#new_discount").serialize(),function(e){return e.errors?$("#new_discount .errors").show().html(e.errors.join("<br/>")):($("#manageDiscountAdd").hide(),$("#new_discount")[0].reset(),t.renderDiscount(e,!0))}),!1}}(this))},scrollToEdit:function(){return $("html, body").animate({scrollTop:$("#manageDiscountAdd").offset().top},100),!1},cancelDiscount:function(){return this.edittingDiscount=!1,$("#manageDiscountAdd").hide(),$("#new_discount")[0].reset()},renderDiscount:function(t,e){var n,r,i;return null==e&&(e=!1),n=$("tr[data-id='"+t.id+"']"),r=!1,n.length>0?r=!0:0===n.length&&(n=$("<tr>",{"data-id":t.id})),i=n.html($.tmpl(this.discountTmpl,t)),i.find(".deleteDiscount").click(function(e){return function(){return confirm("Delete discount "+t.code)&&$.ajax({type:"delete",url:"/books/"+e.book.id+"/discounts/"+t.id,success:function(){return i.remove()}}),!1}}(this)),i.find(".editDiscount").click(function(e){return function(){var n,r,i,o,a,s,u,l,c,h,d,p,f,m,g;e.edittingDiscount=t;try{for($("#manageDiscountAdd, .j_discountFormEdit").show(),$(".j_discountFormCreate").hide(),a=$("#manageDiscountAdd form"),p=["code","amount_in_dollars","percent","limit"],s=0,c=p.length;c>s;s++)o=p[s],a.find("[name='discount["+o+"]']").val(t[o]);if(a.find("[name='discount[expires]']").prop("checked",t.expires),n=new Date(t.expiration),f=[n.getMonth()+1,n.getDate()+1,n.getFullYear()],d=f[0],r=f[1],g=f[2],a.find("#discount_expiration_2i option[value='"+d+"']").attr("selected",!0),a.find("#discount_expiration_3i option[value='"+r+"']").attr("selected",!0),a.find("#discount_expiration_3i option[value='"+g+"']").attr("selected",!0),$("#discount_all_options").attr("checked",t.all_options),!t.all_options)for($(".j_discountOptionCheckboxes .checkLabel").removeClass("disabled"),m=t.book_option_ids,l=0,h=m.length;h>l;l++)u=m[l],$(".j_discountOptionCheckboxes input[value="+u+"]").attr("checked",!0)}catch(b){i=b,log(i)}return e.scrollToEdit()}}(this)),r?void 0:e?i.prependTo("#discounts"):i.appendTo("#discounts")}}}.call(this),function(){window.Book={chapter:null,currentScrollTop:0,init:function(t){var e,n,r,i,o,a,s,u,l,c,h;return this.opts=t,this.custom_math=$.parseJSON("{"+this.opts.custom_math+"}"),(this.preview=this.opts.preview)&&($.ajaxSetup({cache:!1}),a=$("#buildStatus"),h=function(t){return $("#buildStatus").append(t),a.animate({scrollTop:a[0].scrollHeight-a.height()},{duration:100})},o=function(){return h("Listening...\n")},o(),c=new Pusher("a0ce4dc77c0a9f4d5f96"),n=c.subscribe(this.opts.channel),n.bind("status",function(t){return h(t.message)}),n.bind("finished",function(t){return function(e){return h(e.message),t.reload(),o()}}(this))),e=this.preview?Config.previewBucket:Config.bucket,this.host=e+".s3.amazonaws.com",this.base_url="https://"+this.host+"/"+this.opts.s3_path_prefix,$(function(t){return function(){return t.getChapter()}}(this)),$(window).on("popstate",function(t){return function(e){return t.popState(e)}}(this)),$(window).scroll(function(t){return function(){return t.currentScrollTop=$(window).scrollTop()}}(this)),this.slug=this.opts.slug,this.chapters=this.preview?_.compact(_.map(this.opts.chapters,function(t){return function(e,n){return e===t.slug?null:{title:e.replace(/_/g," "),number:n,s3_url:t.base_url+"/html/"+e+"_fragment.html",slug:e}}}(this))):this.opts.chapters,this.fullPageChapter={slug:"_single-page",title:"Single Page",s3_url:this.base_url+"/html/"+this.slug+".html",single_page:!0},this.chapters.push(this.fullPageChapter),this.path=this.opts.path,r=[],_.each(this.chapters,function(t){return function(e){var n;if(null==e.single_page)return n=$("<li>",{html:$("<a>",{html:e.title}),click:function(){return t.gotoChapter(e)}}),$("#j_chapterDropDown ul").append(n)}}(this)),u=function(t){return function(e){return 0>e?t.chapters.length-1:e>=t.chapters.length?0:e}}(this),$(".bookMenuArows .leftArrow").click(function(t){return function(){return t.gotoChapter(_.findWhere(t.chapters,{number:u(t.chapter.number-1)}))}}(this)),$(".bookMenuArows .upArrow").click(function(t){return function(){return t.scrollToHash(!0)}}(this)),$(".bookMenuArows .rightArrow").click(function(t){return function(){return t.gotoChapter(_.findWhere(t.chapters,{number:u(t.chapter.number+1)}))}}(this)),$("#j_singlePage").click(function(t){return function(){return t.gotoChapter(t.fullPageChapter)}}(this)),$("#sizeRegular").click(function(){return function(){return $("#book").removeClass(),$("#sizeRegular").addClass("current"),$("#sizeBig").removeClass("current"),$("#sizeBigger").removeClass("current")}}(this)),$("#sizeBig").click(function(){return function(){return $("#book").removeClass(),$("#book").addClass("big"),$("#sizeBig").addClass("current"),$("#sizeRegular").removeClass("current"),$("#sizeBigger").removeClass("current")}}(this)),$("#sizeBigger").click(function(){return function(){return $("#book").removeClass(),$("#book").addClass("bigger"),$("#sizeBigger").addClass("current"),$("#sizeRegular").removeClass("current"),$("#sizeBig").removeClass("current")}}(this)),s=!1,l=$("#bookMenu").offset().top,i=!1,$(window).scroll(function(t){return function(){if($(window).scrollTop()>$("#bookMenu").offset().top&&!s?($("#bookMenu").addClass("bookMenuFixed"),s=!0,t.opts.isArticle&&$(".articleFixedEmailLink").addClass("open")):$(window).scrollTop()<l&&s&&($("#bookMenu").removeClass("bookMenuFixed"),s=!1,t.opts.isArticle&&$(".articleFixedEmailLink").removeClass("open")),$(window).scrollTop()>.6*$(".container").outerHeight()&&("ruby_on_rails_tutorial"===t.slug||"ruby_on_rails_tutorial_3rd_edition"===t.slug)&&"frontmatter"!==t.chapter.slug){if("yes"===localStorage.getItem("emailClose"))return;i||(i=!0,$(".emailPitch").addClass("open"),$("#bookMenu").addClass("open"),$("#dropBG").addClass("open"),$("#dropBG").show())}if(t.opts.isArticle&&$(window).scrollTop()>.4*$(".container").outerHeight())if("yes"===localStorage.getItem("emailClose"));else if(!i)return i=!0,$(".emailPitch").addClass("open"),$("#dropBG").addClass("open"),$("#dropBG").show()}}(this))},loadingOn:function(){return $("#bookHtml").css({opacity:.5})},loadingOff:function(){return $("#bookHtml").css({opacity:1})},gotoChapter:function(t){return this.pushState(this.path+"/"+t.slug),this.getChapter(t.slug),hideDropMenu(),!1},reload:function(){var t;return t=this.chapter.slug,this.chapter=null,this.getChapter(t,this.currentScrollTop)},getChapter:function(t,e){var n,r,i;return null==t&&(t=null!=(i=window.location.pathname.match(RegExp(this.path+"\\/(.*?)$")))?i[1]:void 0),n=_.find(this.chapters,function(e){return t===e.slug})||this.chapters[0],n!==this.chapter?(this.chapter=n,$("#j_chapterDropDown #chapterTitle, .bookChapterTop").html(n.title),r=n.title.replace(/<(?:.|\n)*?>/gm,""),$("title").html("https://www.railstutorial.org/book"===window.location.href?"Learn Ruby on Rails with the Best Free Online Tutorial":r.toLowerCase().indexOf("frontmatter")>=0?this.opts.title+" | Softcover.io":r+" | "+this.opts.title+" | Softcover.io"),$(".bookScreenItem").hide(),$(".bookScreenItem[data-chapter-number="+this.chapter.number+"]").show(),this.loadingOn(),$.get(this.chapter.s3_url,function(t){return function(n){var r,i,o,a,s,u;if(t.loadingOff(),n="<?xml version='1.0' encoding='UTF-8'?> <!DOCTYPE html><html><div id='book'>"+n+"</div></html>",window.DOMParser)a=new DOMParser,u=a.parseFromString(n,"text/html");else{if(!window.ActiveXObject)return void alert("No suitible xml parser found!");u=new ActiveXObject("Microsoft.XMLDOM"),u.async=!1,u.loadXML(n)}return $.each(u.getElementsByTagName("img"),function(e,n){var r;return r=n.getAttribute("src"),r.match(/^\//)||(r="/"+r),n.setAttribute("src",t.base_url+r)}),$.each(u.getElementsByTagName("script"),function(t,e){return $(e).remove()}),$.each(u.getElementsByTagName("a"),function(e,n){var r,i,o;return(r=n.getAttribute("href"))&&""===URI(r).host()&&(null!=(i=n.getAttribute("class"))?i.match(/hyperref/):void 0)&&r.match(/_fragment/)?(o=t.opts.isArticle?r.replace(/.*?#/,"#"):t.path+"/"+r.replace(/\_fragment.html/,""),n.setAttribute("href",o)):void 0}),i=(new XMLSerializer).serializeToString(u),r=$("<div>").html(i),$("#bookHtml").html(r.find("[id=book]").last()),$("#book [data-tralics-id], .footnotes [id], .chapter-star[id], .footnote[id]").each(function(){return $(this).attr("id","_"+this.id)}),t.opts.isArticle&&articleSections(),t.scrollToHash(),o=$("#bookHtml img").length,$("#bookHtml img").on("load",function(){return 0===--o?t.scrollToHash():void 0}),$("#cha-0_footnotes").prepend($("#articleEmail").remove()),$("#bookHtml .hyperref, #bookHtml .footnote a, #bookHtml .arrow, #articleSections a").on("click",function(e){var n,r,i;return n=e.target,e.isDefaultPrevented()||e.metaKey||e.ctrlKey||!n.href?void 0:(i=URI(n.href),r=URI(window.location.href),i.host()===r.host()?(t.pushState(i.pathname()+i.hash()),i.pathname()===r.pathname()?t.scrollToHash():t.getChapter(i.filename()),!1):!0)}),s=function(){return t.opts.isArticle?void 0:e?($(window).scrollTop(e+1),setTimeout(function(){return $(window).scrollTop(e+1)},10)):t.scrollToHash()},s(),t.initMathJax(s)}}(this)).fail(function(t){return function(){return t.loadingOff(),$("#bookHtml").html($("#bookContentNotAvailable").clone().show())}}(this))):void 0},scrollOffsets:[],storeScrollOffset:function(){return this.scrollOffsets.push(this.currentScrollTop)},scrollToHash:function(t){var e,n,r,i,o;return n=window.location.hash,e=$("#_"+(null!=n?n.substr(1):void 0)),this.opts.isArticle||(0===e.length||t)&&(e=$("#book")),r=$("#bookMenu").hasClass("articleMenuWr")?0:$("#bookMenu").height(),o=((null!=(i=e.offset())?i.top:void 0)||0)-r-10,$(window).scrollTop(o),setTimeout(function(){return $(window).scrollTop(o)},100),!1},pushState:function(t){return this.storeScrollOffset(),history.pushState(null,{},t)},popState:function(t){var e;return t.preventDefault(),e=this.scrollOffsets.pop(),this.storeScrollOffset(),this.getChapter(null,e)},initMathJax:function(t){var e,n;return $("#mathJaxJS").remove(),delete MathJax,e=$(".chapter").attr("data-number"),n=document.createElement("script"),$("head").append(n),n.id="mathJaxJS",n.type="text/javascript",n.onload=function(n){return function(){return MathJax.Hub.Config({"HTML-CSS":{availableFonts:["TeX"]},TeX:{extensions:["AMSmath.js","AMSsymbols.js"],equationNumbers:{autoNumber:"AMS",formatNumber:function(t){return e+"."+t}},Macros:_.extend({PolyTeX:"Poly{\\\\TeX}",PolyTeXnic:"Poly{\\\\TeX}nic"},n.custom_math)},showProcessingMessages:!1,messageStyle:"none",imageFont:null}),t?MathJax.Hub.Register.StartupHook("End",t):void 0}}(this),n.src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"}}}.call(this),function(){window.CustomDomain={setup:function(t){return this.opts=t,$(function(t){return function(){return t.opts.header?($(".j_userHeader").html(t.opts.header),$("#bookMenu").hasClass("articleMenuWr")||$(".j_downloadLinks").html(t.opts.downloadLinks),$(".j_showPageHeader").html(t.opts.showPageHeader),$(".j_followBookForm").html(t.opts.followBookForm),t.opts.author&&!$("#bookMenu").hasClass("articleMenuWr")?$(".container").addClass("authorView"):t.opts.author&&$("#bookMenu").hasClass("articleMenuWr")&&$("body").addClass("authorView"),setupMenus()):void 0}}(this))}}}.call(this),function(){}.call(this),function(){window.Editor={init:function(t){var e;return e=$("#editorPane").width(),setInterval(function(){return e!==$("#editorPane").width()?(e=$("#editorPane").width(),$("#previewPane").width($(window).width()-e-81)):void 0},50),log("connecting..."),this.socket=io(t.socketServer),this.socket.on("welcome",function(){return function(){return log("connected")}}(this)),this.socket.on("html",function(t){return function(e){return log("took "+(new Date-t.previewStartedAt)/1e3+"s"),t.setContent(e.content)}}(this)),$("#content").bind("keydown","ctrl+s",function(t){return function(){return t.preview()}}(this)),$("#content").scroll(function(){return $("#content").scrollTop()>35?void 0:$("#content").css("paddingTop",50-2.5*$("#content").scrollTop())})},getContent:function(){return $("#content").val()},setContent:function(t){return $("#previewPane #book")[0].innerHTML=t},preview:function(){return this.setContent("previewing..."),this.previewStartedAt=new Date,this.socket.emit("preview",{content:this.getContent()})}},jQuery.fn.extend({insertAtCursor:function(t){return this.each(function(){var e,n,r,i;return document.selection?(this.focus(),r=document.selection.createRange(),r.text=t,this.focus()):this.selectionStart||"0"===this.selectionStart?(i=this.selectionStart,e=this.selectionEnd,n=this.scrollTop,this.value=this.value.substring(0,i)+t+this.value.substring(e,this.value.length),this.focus(),this.selectionStart=i+t.length,this.selectionEnd=i+t.length,this.scrollTop=n):(this.value+=t,this.focus())})},insertAroundCursor:function(t,e){return this.each(function(){var n,r,i,o;return document.selection?(this.focus(),i=document.selection.createRange(),i.text=t+i.text+e,this.focus()):this.selectionStart||"0"===this.selectionStart?(o=this.selectionStart,n=this.selectionEnd,r=this.scrollTop,this.value=this.value.substring(0,o)+t+this.value.substring(o,n)+e+this.value.substring(n,this.value.length),this.focus(),this.selectionStart=o+t.length,this.selectionEnd=n+t.length,this.scrollTop=r):(this.value+=t+e,this.focus())})},selectRange:function(t,e){return this.each(function(){var n;return this.setSelectionRange?(this.focus(),this.setSelectionRange(t,e)):this.createTextRange?(n=this.createTextRange(),n.collapse(!0),n.moveEnd("character",e),n.moveStart("character",t),n.select()):void 0})}})}.call(this),function(){}.call(this),function(){window.Purchase={quantity:1,discountPercent:0,getCurrentBookOption:function(){return this.optionId=$(".bundleItem.active").data("bookoption"),this.optionPrice=parseFloat($(".bundleItem.active").find(".j_optionPrice").data("price"))},calculatePrice:function(){var t;return this.subTotal=this.optionPrice*this.quantity,this.discountAmount=this.discountable()?(t=this.discount.amount?this.discount.amount/100:0,this.discount.percent?t+=this.discount.percent/100*this.subTotal:void 0,t>this.subTotal?this.subTotal:t):0,$(".j_discountApplicable").toggle(this.discountable()),$(".j_discountUnapplicable").toggle(!this.discountable()),this.total=this.subTotal-this.discountAmount,$(".j_subTotal").html("$"+this.subTotal.toFixed(2)),$(".j_promoTotal").html("-$"+this.discountAmount.toFixed(2)),$(".j_checkoutTotal").html("$"+this.total.toFixed(2)),$("#j_cc_form").toggle(this.total>0)},discountable:function(){return this.discount?this.discount.book_option_ids.indexOf(this.optionId)>-1||this.discount.all_options:!1},getQuantity:function(){var t;return t=$(".bundleItem.active").find(".j_quantity"),this.quantity=parseInt(t.val())||1,this.quantity<1&&(this.quantity=1,t.val(1)),this.quantity},updateQuantityFields:function(){return $(".j_bundleItem").not(".active").find(".j_quantity").val(this.quantity),$(".j_purchaseQuantity").val(this.quantity)},init:function(t){var e,n;return this.opts=null!=t?t:{},this.discount=this.opts.discount,$(".required").keyup(function(){return $(this).val()?$(this).removeClass("error"):void 0}),(this.useCardOnFile=this.opts.useCardOnFile)&&(e=$(".card-number, .card-expiry-month, .card-cvc, .card-expiry-year, .card-name"),e.change(function(t){return function(){return t.useCardOnFile=!_.any(e,function(t){return $(t).val()!==$(t).attr("original-value")})}}(this)).each(function(){return function(t,e){return $(e).attr("original-value",e.value)}}(this))),this.ccForm$=$(".j_checkoutForm"),this.getCurrentBookOption(),$("#j_bookOption").change(function(t){return function(){return t.getCurrentBookOption(),t.calculatePrice()}}(this)),this.getQuantity(),n=function(t){return function(){return t.getCurrentBookOption(),t.getQuantity(),t.updateQuantityFields(),t.calculatePrice()}}(this),$(".j_quantity").keyup(n),$(".j_quantity").change(n),this.calculatePrice(),this.updateQuantityFields(),$(".j_bundleItem.active").find(".j_quantity").val(this.quantity),$(".j_promoCode").keypress(function(t){return function(e){return log("promo"),13===e.keyCode?(t.ajaxPromoCode(),e.preventDefault(),e.stopPropagation()):void 0}}(this)),$("#bundleOptions .j_selectBundle").click(function(t){return function(e){return $(".j_bundleItem").removeClass("active"),$(e.currentTarget).closest(".j_bundleItem").addClass("active"),$(".j_bookOption").val($(e.currentTarget).closest(".j_bundleItem").data("bookoption")),$("#shippingInput").toggle(!!$(e.target).data("require-shipping-address")),t.getCurrentBookOption(),t.calculatePrice(),e.preventDefault(),e.stopPropagation()}}(this)),$(".j_updateCard").click(function(){return function(t){return $("#currentCardInfo").hide(),$(".creditCardInput").show(),$(".card-cvc").val(""),t.preventDefault(),t.stopPropagation()}}(this)),$("#isGift").click(function(){return $("#giftEmails").toggle($(this).is(":checked"))}),$("#purchaseFor").keypress(function(t){return function(e){return 13===e.keyCode?(t.submitForm(),e.stopPropagation(),e.preventDefault()):void 0}}(this)),this.bindForm()},bindForm:function(){var t;return t=function(t){return function(){return t.submitForm(),!1}}(this),$(".j_checkoutForm").on("submit",t),$(".j_submitButton").on("click",function(){return t(),!1}),$(".j_promoButton").click(function(t){return function(){return t.ajaxPromoCode()}}(this))},purchaseErrors:function(t){return $(".purchaseErrors").show().html("Error: "+t)},submitForm:function(){var t,e,n;return $("form .required:visible").each(function(){return function(t,e){return e=$(e),e.toggleClass("error",!e.val())}}(this)),$("form .required.error").length>0?this.purchaseErrors("missing fields are highlighted in red."):(null!=(t=$("#purchaseEmail").val())?t.trim():void 0)!==(null!=(e=$("#purchaseEmailConfirmation").val())?e.trim():void 0)?this.purchaseErrors("emails do not match"):$("#isGift").is(":checked")&&$("#giftEmail").val()!==$("#giftEmailConfirmation").val()?($("#giftEmail, #giftEmailConfirmation").addClass("error"),this.purchaseErrors("gift emails do not match")):(this.disableSubmit(),this.useCardOnFile||0===this.total?this.submitPurchase():(n={number:$(".card-number").val(),cvc:$(".card-cvc").val(),exp_month:$(".card-expiry-month").val(),exp_year:$(".card-expiry-year").val(),name:$(".card-name").val()},Stripe.createToken(n,function(t){return function(e,n){return t.stripeResponseHandler(e,n)}}(this))))},submitPurchase:function(){return $(".purchaseErrors").hide().html(""),$(".j_checkoutForm input, .j_checkoutForm select").removeClass("error"),$.post("/purchases",this.ccForm$.serialize(),function(t){return function(e){var n;return e.success?window.location=e.redirect:(t.enableSubmit(),n=e.errors,t.purchaseErrors(n),n.card&&($(".card-number").addClass("error"),t.purchaseErrors(n.card.join("<br/>"))),n.cvc&&($(".card-cvc").addClass("error"),t.purchaseErrors("CVV is "+n.cvc[0])),window.location.hash="#purchaseErrors")}}(this))},enableSubmit:function(){return $(".j_submitButton").html("Purchase").attr("disabled",!1)},disableSubmit:function(){return $(".j_submitButton").html("Processing...").attr("disabled",!0)},stripeResponseHandler:function(t,e){return e.error?(this.enableSubmit(),this.purchaseErrors(e.error.message)):(this.ccForm$.append("<input type=hidden name='purchase[stripe_token]' value='"+e.id+"'/>"),this.submitPurchase())},ajaxPromoCode:function(){var t,e,n,r;return n=$(".j_checkoutForm"),r=n.find(".j_promoCode").val(),e=n.find(".j_bookId").val(),t={promo_code:r},$.ajax({type:"GET",url:"/books/"+e+"/discounts/validate",data:t,success:function(t){return function(e){return $(".j_promoStatus").removeClass("invalidPromo"),e.valid?(t.discountPercent=e.percent,t.calculatePrice(),$(".j_promoStatus").html("Promotional code accepted!")):void 0}}(this),error:function(){return $(".j_promoStatus").addClass("invalidPromo"),$(".j_promoStatus").html("Sorry, the code '"+r+"' is not valid")}}),!1},dev:{setup:function(){return $(".card-number").change(),$(".card-name").val("Nick Merwin"),$(".card-cvc").val("123"),$(".card-expiry-month").val("12"),$(".card-expiry-year").val("2015")},valid:function(){return this.setup(),$(".card-number").val("4242424242424242")},error:function(){return this.setup(),$(".card-number").val("4000000000000002")},cvc:function(){return this.setup(),$(".card-number").val("4000000000000101")},declined:function(){return this.setup(),$(".card-number").val("4000000000000002")}}}}.call(this),function(){}.call(this),function(){}.call(this),function(){window.UserEdit={init:function(t){return this.user=t,$("#updateCardForm").submit(function(t){return function(){return $("#card-errors, #card-status").hide(),t.stripeParams={number:$(".card-number").val(),cvc:$(".card-cvc").val(),exp_month:$(".card-expiry-month").val(),exp_year:$(".card-expiry-year").val(),name:$(".card-name").val(),address_line1:$(".card-address-line1").val(),address_line2:$(".card-address-line2").val(),address_city:$(".card-address-city").val(),address_state:$(".card-address-state").val(),address_zip:$(".card-address-zip").val(),address_country:$(".card-address-country").val()},Stripe.createToken(t.stripeParams,function(e,n){return t.stripeResponseHandler(e,n)}),!1}}(this))},stripeResponseHandler:function(t,e){return e.error?$("#card-errors").show().html(e.error.message):($("#card-status").show().html("Payment info updated."),$.ajax({url:"/users/"+this.user.id,type:"PUT",dataType:"json",data:{user:{stripe_token:e.id}},success:function(){return function(t){return log(t)}}(this)}))}}}.call(this),function(){var t,e,n,r,i,o=[].slice;window.log=function(){return function(){var t,e;t=1<=arguments.length?o.call(arguments,0):[];try{return console.log.apply(console,t)}catch(n){e=n}}}(this),window.genericAjaxErrorCallback=function(t,e,n,r){return log("AJAX error with URL: \n		"+n.url+" \nerror:\n		"+r)},$(document).ajaxError(genericAjaxErrorCallback),window.setupMenus=function(){return $(".bookCover").click(function(){return $(this).parents(".yourBookItem").addClass("active")}),$(".bookControls").click(function(){return $(this).parents(".yourBookItem").removeClass("animated")}),$(".dropDown").click(function(){return $(".dropMenu",this).addClass("open"),$("#dropBG").show()}),$("#dropBG").click(function(){return hideDropMenu(),$("#dropBG").hide(),closeEmailPops()}),$(".dropMenu a").click(function(){return hideDropMenu(),$("#dropBG").hide()}),$("#mobileMenu").click(function(){return $(".j_userHeader").toggleClass("openLeft").toggleClass("closeLeft"),$(".container").toggleClass("openLeft").toggleClass("closeLeft")}),$(document).keyup(function(t){return 27===t.which&&$(".dropMenu").hasClass("open")?(hideDropMenu(),$("#dropBG").hide()):void 0})},window.hideDropMenu=function(){return $(".dropMenu").removeClass("open")},$(function(){return setupMenus()}),window.articleSections=function(){var t;return $("#articleSections").css("top",$("#book").offset().top),t=[],$("#book").find("h2:not(.author), h3").each(function(){return""!==$(this).html()?$("#articleSections").append($(this).html()).append("<br/>"):void 0})},window.marketingCTA=function(){var t,e,n,r,i,o;return $("#buy").length?(e=$("#buy").offset().top,t=$("#buy").offset().top+$("#buy").outerHeight()/2):e=$("#bookTestimonials").offset().top,o=$("#bookTestimonials").offset().top,$("#bookFAQ").length&&(n=$("#bookFAQ").offset().top),$("#bookFreeForm").length&&(r=$("#bookFreeForm").offset().top),i="#bookTestimonials",$(window).scroll(function(){return function(){if($(window).scrollTop()<e?$("#bookCTA").removeClass("show"):$(window).scrollTop()>=e&&($("#bookCTA").addClass("show"),i="#bookTestimonials",$("#ctaNext button").text("Next Section: About the Author")),$(window).scrollTop()>=t?$("#ctaBuy").addClass("show"):$(window).scrollTop()<t&&$("#ctaBuy").removeClass("show"),$(window).scrollTop()>=o-1&&($("#bookFAQ").length?(i="#bookFAQ",$("#ctaNext button").text("NEXT SECTION: FAQ")):$("#bookFreeForm").length&&(i="#bookFreeForm",$("#ctaNext button").text("NEXT SECTION: MORE INFO"))),$(window).scrollTop()>=n-1){if(!$("#bookFreeForm").length)return;i="#bookFreeForm",$("#ctaNext button").text("NEXT SECTION: MORE INFO")}return $(window).scrollTop()>=r-1?(i="#bookHeader",$("#ctaNext button").text("BACK TO TOP")):void 0}}(this)),$("#ctaNext").click(function(){return $("html,body").animate({scrollTop:$(i).offset().top},1e3)}),$("#ctaBuy").click(function(){return $("html,body").animate({scrollTop:$("#buy").offset().top},1e3)})},window.closeEmailPops=function(){return $(".emailPitch").removeClass("open").hide(),$("#bookMenu").removeClass("open"),$("#dropBG").removeClass("open").hide(),localStorage.setItem("emailClose","yes")},window.starRating=function(){return $(".starRating")},$(document).on("click",".starRatingSet a",function(){var t,e,n;for(t=$(this).parent(),$(".starRatingSet li").removeClass(),$("#review_rating").val(t.index()+1),e=0,n=[];e<t.index()+1;)$(".starRatingSet li").eq(e).addClass("lit"),n.push(e++);return n}),n=[],e=[],r=[],t=[],i=["#3366cc","#dc3912","#ff9900","#109618","#990099"],window.gchartAllOne=function(){var n,i;return $("#chartWr").append($("<div/>").attr("id","chart")),r=[],e=[],t=[],$(".chartTable thead").each(function(){return $(this).find("th").each(function(){return e.push($(this).html())}),e.shift(),e.unshift("x")}),$(".chartTable tbody").find("tr").each(function(){return $(this).find(".datum").each(function(e){return t.push(0===e?$(this).html():parseFloat($(this).html().match(/[0-9,.]+/)[0].replace(",","")))}),r.push(t),t=[]}),r.reverse(),r.unshift(e),log(r),i={chartArea:{width:880},backgroundColor:"transparent",fontName:"Open Sans Condensed",width:980,height:400,lineWidth:3,pointSize:5,legend:{position:"bottom",textStyle:{color:"#666"}},hAxis:{textStyle:{color:"#aaa",fontSize:"12"}},vAxis:{baselineColor:"#B9C6D3",gridlines:{color:"#dfe4ef"},textStyle:{color:"#aaa",fontSize:"12"}},tooltip:{textStyle:{fontName:"Open Sans",color:"#666",fontSize:"12",showColorCode:"true"}}},n=google.visualization.arrayToDataTable(r),new google.visualization.LineChart(document.getElementById("chart")).draw(n,i)},window.gchartMany=function(o){var a,s,u,l,c,h,d,p;for(c=n.lastIndexOf(o),c>-1?n.splice(c,1):void 0!==o&&n.push(o),t=[],a=[],t.push(["x"]),l=0;l<r.length;)t.push([]),l++;for($("#chartNav a").removeClass("on"),u=0;u<n.length;)p=n[u].valueOf(),t[0].push(e[p]),$("#chartNav"+n[u]).addClass("on"),a.push(i[p]),u++;for(l=0;l<r.length;){for(t[l+1].push(r[l][0]),u=0;u<n.length;)p=n[u].valueOf()+1,t[l+1].push(r[l][p]),u++;l++}return h=t.shift(),t.reverse(),t.unshift(h),d={chartArea:{width:880},backgroundColor:"transparent",colors:a,fontName:"Open Sans Condensed",width:980,height:400,lineWidth:3,pointSize:5,legend:{position:"none"},hAxis:{textStyle:{color:"#aaa",fontSize:"12"}},vAxis:{baselineColor:"#B9C6D3",gridlines:{color:"#dfe4ef"},textStyle:{color:"#aaa",fontSize:"12"}},tooltip:{textStyle:{fontName:"Open Sans",color:"#666",fontSize:"12",showColorCode:"true"}}},s=google.visualization.arrayToDataTable(t),new google.visualization.LineChart(document.getElementById("chart")).draw(s,d)},window.gchartInit=function(){var n;for($("#chartWr").append($("<div/>").attr("id","chart")),$("#chartWr").append($("<div/>").attr("id","chartNav")),$(".chartTable thead").each(function(){return $(this).find("th").each(function(){return e.push($(this).html())}),e.shift()}),n=0;n<e.length;)$("#chartNav").append($('<a href="javascript://" onClick="gchartMany('+n+')" id="chartNav'+n+'"><span style="background-color:'+i[n]+';"></span>'+e[n]+'</a>"')),n++;return $(".chartTable tbody").find("tr").each(function(){return $(this).find("td .datum").each(function(e){return t.push(0===e?$(this).html():parseFloat($(this).html().match(/[0-9,.]+/)[0].replace(",","")))}),r.push(t),t=[]}),gchartMany(2)}}.call(this),function(){window.Wizard={init:function(t,e){var n;return n=$(".authorWizardSetup input"),n.each(function(r,i){return $(i).change(function(){var e,r;return e=$(i).is(":checked"),$("."+i.id+"-yes").toggle(e),$("."+i.id+"-no").toggle(!e),r={},n.each(function(){return this.id&&(r[this.id]=$(this).is(":checked")),!0}),$.ajax({url:"/books/"+t,data:{book:{wizard_attrs:r}},dataType:"JSON",type:"PUT"})}),"true"===e[i.id]?$(i).click():void 0})}}}.call(this),function(){var t,e,n,r,i,o,a,s,u,l,c,h,d,p,f,m,g,b,v,y=[].slice,$=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t=jQuery,t.payment={},t.payment.fn={},t.fn.payment=function(){var e,n;return n=arguments[0],e=2<=arguments.length?y.call(arguments,1):[],t.payment.fn[n].apply(this,e)},i=/(\d{1,4})/g,r=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:i,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:i,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:i,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:i,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:i,length:[13,14,15,16],cvcLength:[3],luhn:!0}],e=function(t){var e,n,i;
for(t=(t+"").replace(/\D/g,""),n=0,i=r.length;i>n;n++)if(e=r[n],e.pattern.test(t))return e},n=function(t){var e,n,i;for(n=0,i=r.length;i>n;n++)if(e=r[n],e.type===t)return e},d=function(t){var e,n,r,i,o,a;for(r=!0,i=0,n=(t+"").split("").reverse(),o=0,a=n.length;a>o;o++)e=n[o],e=parseInt(e,10),(r=!r)&&(e*=2),e>9&&(e-=9),i+=e;return i%10===0},h=function(t){var e;return null!=t.prop("selectionStart")&&t.prop("selectionStart")!==t.prop("selectionEnd")?!0:("undefined"!=typeof document&&null!==document&&null!=(e=document.selection)&&"function"==typeof e.createRange?e.createRange().text:void 0)?!0:!1},p=function(e){return setTimeout(function(){var n,r;return n=t(e.currentTarget),r=n.val(),r=t.payment.formatCardNumber(r),n.val(r)})},s=function(n){var r,i,o,a,s,u,l;return o=String.fromCharCode(n.which),!/^\d+$/.test(o)||(r=t(n.currentTarget),l=r.val(),i=e(l+o),a=(l.replace(/\D/g,"")+o).length,u=16,i&&(u=i.length[i.length.length-1]),a>=u||null!=r.prop("selectionStart")&&r.prop("selectionStart")!==l.length)?void 0:(s=i&&"amex"===i.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,s.test(l)?(n.preventDefault(),r.val(l+" "+o)):s.test(l+o)?(n.preventDefault(),r.val(l+o+" ")):void 0)},o=function(e){var n,r;return n=t(e.currentTarget),r=n.val(),e.meta||null!=n.prop("selectionStart")&&n.prop("selectionStart")!==r.length?void 0:8===e.which&&/\s\d?$/.test(r)?(e.preventDefault(),n.val(r.replace(/\s\d?$/,""))):void 0},u=function(e){var n,r,i;return r=String.fromCharCode(e.which),/^\d+$/.test(r)?(n=t(e.currentTarget),i=n.val()+r,/^\d$/.test(i)&&"0"!==i&&"1"!==i?(e.preventDefault(),n.val("0"+i+" / ")):/^\d\d$/.test(i)?(e.preventDefault(),n.val(""+i+" / ")):void 0):void 0},l=function(e){var n,r,i;return r=String.fromCharCode(e.which),/^\d+$/.test(r)?(n=t(e.currentTarget),i=n.val(),/^\d\d$/.test(i)?n.val(""+i+" / "):void 0):void 0},c=function(e){var n,r,i;return r=String.fromCharCode(e.which),"/"===r?(n=t(e.currentTarget),i=n.val(),/^\d$/.test(i)&&"0"!==i?n.val("0"+i+" / "):void 0):void 0},a=function(e){var n,r;if(!e.meta&&(n=t(e.currentTarget),r=n.val(),8===e.which&&(null==n.prop("selectionStart")||n.prop("selectionStart")===r.length)))return/\s\/\s?\d?$/.test(r)?(e.preventDefault(),n.val(r.replace(/\s\/\s?\d?$/,""))):void 0},b=function(t){var e;return t.metaKey||t.ctrlKey?!0:32===t.which?!1:0===t.which?!0:t.which<33?!0:(e=String.fromCharCode(t.which),!!/[\d\s]/.test(e))},m=function(n){var r,i,o,a;return r=t(n.currentTarget),o=String.fromCharCode(n.which),/^\d+$/.test(o)&&!h(r)?(a=(r.val()+o).replace(/\D/g,""),i=e(a),i?a.length<=i.length[i.length.length-1]:a.length<=16):void 0},g=function(e){var n,r,i;return n=t(e.currentTarget),r=String.fromCharCode(e.which),/^\d+$/.test(r)&&!h(n)?(i=n.val()+r,i=i.replace(/\D/g,""),i.length>6?!1:void 0):void 0},f=function(e){var n,r,i;return n=t(e.currentTarget),r=String.fromCharCode(e.which),/^\d+$/.test(r)?(i=n.val()+r,i.length<=4):void 0},v=function(e){var n,i,o,a,s;return n=t(e.currentTarget),s=n.val(),a=t.payment.cardType(s)||"unknown",n.hasClass(a)?void 0:(i=function(){var t,e,n;for(n=[],t=0,e=r.length;e>t;t++)o=r[t],n.push(o.type);return n}(),n.removeClass("unknown"),n.removeClass(i.join(" ")),n.addClass(a),n.toggleClass("identified","unknown"!==a),n.trigger("payment.cardType",a))},t.payment.fn.formatCardCVC=function(){return this.payment("restrictNumeric"),this.on("keypress",f),this},t.payment.fn.formatCardExpiry=function(){return this.payment("restrictNumeric"),this.on("keypress",g),this.on("keypress",u),this.on("keypress",c),this.on("keypress",l),this.on("keydown",a),this},t.payment.fn.formatCardNumber=function(){return this.payment("restrictNumeric"),this.on("keypress",m),this.on("keypress",s),this.on("keydown",o),this.on("keyup",v),this.on("paste",p),this},t.payment.fn.restrictNumeric=function(){return this.on("keypress",b),this},t.payment.fn.cardExpiryVal=function(){return t.payment.cardExpiryVal(t(this).val())},t.payment.cardExpiryVal=function(t){var e,n,r,i;return t=t.replace(/\s/g,""),i=t.split("/",2),e=i[0],r=i[1],2===(null!=r?r.length:void 0)&&/^\d+$/.test(r)&&(n=(new Date).getFullYear(),n=n.toString().slice(0,2),r=n+r),e=parseInt(e,10),r=parseInt(r,10),{month:e,year:r}},t.payment.validateCardNumber=function(t){var n,r;return t=(t+"").replace(/\s+|-/g,""),/^\d+$/.test(t)?(n=e(t),n?(r=t.length,$.call(n.length,r)>=0&&(n.luhn===!1||d(t))):!1):!1},t.payment.validateCardExpiry=function(e,n){var r,i,o;return"object"==typeof e&&"month"in e&&(o=e,e=o.month,n=o.year),e&&n?(e=t.trim(e),n=t.trim(n),/^\d+$/.test(e)&&/^\d+$/.test(n)&&parseInt(e,10)<=12?(i=new Date(n,e),r=new Date,i.setMonth(i.getMonth()-1),i.setMonth(i.getMonth()+1,1),i>r):!1):!1},t.payment.validateCardCVC=function(e,r){var i,o;return e=t.trim(e),/^\d+$/.test(e)?r?(i=e.length,$.call(null!=(o=n(r))?o.cvcLength:void 0,i)>=0):e.length>=3&&e.length<=4:!1},t.payment.cardType=function(t){var n;return t?(null!=(n=e(t))?n.type:void 0)||null:null},t.payment.formatCardNumber=function(t){var n,r,i,o;return(n=e(t))?(i=n.length[n.length.length-1],t=t.replace(/\D/g,""),t=t.slice(0,+i+1||9e9),n.format.global?null!=(o=t.match(n.format))?o.join(" "):void 0:(r=n.format.exec(t),null!=r&&r.shift(),null!=r?r.join(" "):void 0)):t}}.call(this),function(t){t.fn.splitter=function(e){return e=e||{},this.each(function(){function n(e){l.outline&&(s=s||m.clone(!1).insertAfter(d)),h.css("-webkit-user-select","none"),m.addClass(l.activeClass),d._posSplit=d[0][l.pxSplit]-e[l.eventPos],t(document).bind("mousemove",r).bind("mouseup",i)}function r(t){var e=d._posSplit+t[l.eventPos];l.outline?(e=Math.max(0,Math.min(e,c._DA-m._DA)),m.css(l.origin,e)):o(e)}function i(e){m.removeClass(l.activeClass);var n=d._posSplit+e[l.eventPos];l.outline&&(s.remove(),s=null,o(n)),h.css("-webkit-user-select","text"),t(document).unbind("mousemove",r).unbind("mouseup",i)}function o(t){t=Math.max(d._min,c._DA-p._max,Math.min(t,d._max,c._DA-m._DA-p._min)),m._DA=m[0][l.pxSplit],m.css(l.origin,t).css(l.fixed,c._DF),d.css(l.origin,0).css(l.split,t).css(l.fixed,c._DF),p.css(l.origin,t+m._DA).css(l.split,c._DA-m._DA-t).css(l.fixed,c._DF)}function a(t){for(var e=0,n=1;n<arguments.length;n++)e+=Math.max(parseInt(t.css(arguments[n]))||0,0);return e}var s,u=(e.splitHorizontal?"h":e.splitVertical?"v":e.type)||"v",l=t.extend({activeClass:"active",pxPerKey:8,tabIndex:0,accessKey:""},{v:{keyLeft:39,keyRight:37,cursor:"e-resize",splitbarClass:"vsplitbar",outlineClass:"voutline",type:"v",eventPos:"pageX",origin:"left",split:"width",pxSplit:"offsetWidth",side1:"Left",side2:"Right",fixed:"height",pxFixed:"offsetHeight",side3:"Top",side4:"Bottom"},h:{keyTop:40,keyBottom:38,cursor:"n-resize",splitbarClass:"hsplitbar",outlineClass:"houtline",type:"h",eventPos:"pageY",origin:"top",split:"height",pxSplit:"offsetHeight",side1:"Top",side2:"Bottom",fixed:"width",pxFixed:"offsetWidth",side3:"Left",side4:"Right"}}[u],e),c=t(this).css({position:"relative"}),h=t(">*",c[0]).css({position:"absolute","z-index":"1","-moz-outline-style":"none"}),d=t(h[0]),p=t(h[1]),f=t('<a href="javascript:void(0)"></a>').attr({accessKey:l.accessKey,tabIndex:l.tabIndex,title:l.splitbarClass}).bind("keydown",function(t){var e=t.which||t.keyCode,n=e==l["key"+l.side1]?1:e==l["key"+l.side2]?-1:0;n&&o(d[0][l.pxSplit]+n*l.pxPerKey,!1)}).bind("blur",function(){m.removeClass(l.activeClass)}),m=t(h[2]||"<div></div>").insertAfter(d).css("z-index","10").append(f).attr({"class":l.splitbarClass,unselectable:"on"}).css({position:"absolute","user-select":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none"}).bind("mousedown",n);/^(auto|default|)$/.test(m.css("cursor"))&&m.css("cursor",l.cursor),m._DA=m[0][l.pxSplit],c._PBF=t.boxModel?a(c,"border"+l.side3+"Width","border"+l.side4+"Width"):0,c._PBA=t.boxModel?a(c,"border"+l.side1+"Width","border"+l.side2+"Width"):0,d._pane=l.side1,p._pane=l.side2,t.each([d,p],function(){this._min=l["min"+this._pane]||a(this,"min-"+l.split),this._max=l["max"+this._pane]||a(this,"max-"+l.split)||9999,this._init=l["size"+this._pane]===!0?parseInt(t.curCSS(this[0],l.split)):l["size"+this._pane]});var g=d._init;if(isNaN(p._init)||(g=c[0][l.pxSplit]-c._PBA-p._init-m._DA),l.cookie){t.cookie||alert("jQuery.splitter(): jQuery cookie plugin required");var b=parseInt(t.cookie(l.cookie));isNaN(b)||(g=b),t(window).bind("unload",function(){var e=String(m.css(l.origin));t.cookie(l.cookie,e,{expires:l.cookieExpires||365,path:l.cookiePath||document.location.pathname})})}isNaN(g)&&(g=Math.round((c[0][l.pxSplit]-c._PBA-m._DA)/2)),l.anchorToWindow?(c._hadjust=a(c,"borderTopWidth","borderBottomWidth","marginBottom"),c._hmin=Math.max(a(c,"minHeight"),20),t(window).bind("resize",function(){var e=c.offset().top,n=t(window).height();c.css("height",Math.max(n-e-c._hadjust,c._hmin)+"px")}).trigger("resize")):l.resizeToWidth&&t(window).bind("resize",function(){c.trigger("resize")}),c.bind("resize",function(t,e){t.target==this&&(c._DF=c[0][l.pxFixed]-c._PBF,c._DA=c[0][l.pxSplit]-c._PBA,c._DF<=0||c._DA<=0||o(isNaN(e)?l.sizeRight||l.sizeBottom?c._DA-p[0][l.pxSplit]-m._DA:d[0][l.pxSplit]:e))}).trigger("resize",[g])})}}(jQuery);