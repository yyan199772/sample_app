var RP_NONE=-1;var RP_OFF=0;var RP_RIGHT=1;var RP_BOTTOM=2;var LVT_MSG=0;var LVT_CTM=1;var LVT_CTL=2;var LVT_CTP=3;var LVT_TSK=4;var LVT_DRL=5;var LVT_DRP=6;var LVT_RML=7;var LVT_RMP=8;var LVT_DOC=9;var LVT_DMP=10;var JES_NJNK=0;var JES_JNK=1;var JES_UNK=2;var MSG_MARKED_UNREAD=-1;var MSG_UNREAD=0;var MSG_READ=1;var PONT_IGNCNV=128;var PONT_CANIGNCNV=256;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/notificationdialog.js".toLowerCase()])(function(){Type.createNamespace("Owa.UIControls");var _rgNotificationDialogs={};var _iNotificationDialogsCount=0;Owa.UIControls.NotificationDialog=function Owa$UIControls$NotificationDialog(oNotificationDialog,sContentId,sBodyId,rgButtons,sTitlebarButtonId){Owa.UIControls.NotificationDialog.constructBase(this,[oNotificationDialog.get_Id(),0,1,0,0,1,1]);this._isOpened=0;this._sSelectionClass="ntfyItmHL";this._oContent=$(sContentId);this._oBody=$(sBodyId);this._oClearIcon=this._oBody.getDescendantById("imgNtfyInfo").clone(true);this._sMultiItemsSelected=this._getAttribute("sMultiItemsSelected");this._fButtonAdjusted=0;this._fAllowMultiSelect=0;this._fSelectFirstItemOnShow=1;this._sTitlebarButtonId=sTitlebarButtonId;this._rgButtons=rgButtons;this._attachEvent(this._get_Element(),"mousedown",this._onMouseDown);this._attachEvent(this._get_Element(),"click",this._onClick);this._attachEvent(this._get_Element(),"dblclick",this._onDoubleClick);this._attachEvent(this._get_Element(),"contextmenu",new Function("return (0)"));var oActionTable=new Owa.Components.ClientActionTable(Owa.Utility.createDelegate(this,this._onAction));this._oHotKeyManager=new Owa.Components.HotKeyManagerPage(oActionTable,Owa.Components.Application.get_RootSubPage());this._oHotKeyManager.addHotKey(L_HkSel,"selectall").addHotKey("esc","hide").addHotKey("tab","tab").addHotKey("shift+tab","shifttab").addHotKey("enter","enter").addHotKey("down","down").addHotKey("up","up").addHotKey("end","end").addHotKey("home","home");this.get_OnClose().add(this._createCallback(this._onClose));this.get_OnShow().add(this._createCallback(this._onShow))};Owa.UIControls.NotificationDialog.getDialog=function Owa$UIControls$NotificationDialog$getDialog(sId){if(!_rgNotificationDialogs){return null}else{return _rgNotificationDialogs[sId]}};Owa.UIControls.NotificationDialog.addDialog=function Owa$UIControls$NotificationDialog$addDialog(sId,oDialog){if(_rgNotificationDialogs[sId]==null){_rgNotificationDialogs[sId]=oDialog;_iNotificationDialogsCount++}return _rgNotificationDialogs[sId]};Owa.UIControls.NotificationDialog.hideAllDialogs=function Owa$UIControls$NotificationDialog$hideAllDialogs(){var oRootWindow=Owa.Utility.getRootOwaWindow();var oCurrentWindow=Owa.Dom.Window.get_Current();if(!oCurrentWindow.equals(oRootWindow)){if(oRootWindow._domWindow.Owa&&oRootWindow._domWindow.Owa.UIControls&&oRootWindow._domWindow.Owa.UIControls.NotificationDialog){oRootWindow._domWindow.Owa.UIControls.NotificationDialog.hideAllDialogs()}}else{for(var sId in _rgNotificationDialogs){_rgNotificationDialogs[sId].hide()}}};Owa.UIControls.NotificationDialog.anyDialogsOpen=function Owa$UIControls$NotificationDialog$anyDialogsOpen(){for(var sId in _rgNotificationDialogs){if(_rgNotificationDialogs[sId].isOpened()){return true}}return false};Owa.UIControls.NotificationDialog.disposeAll=function Owa$UIControls$NotificationDialog$disposeAll(){for(var sId in _rgNotificationDialogs){_rgNotificationDialogs[sId].dispose()}};Owa.UIControls.NotificationDialog.prototype.dispose=function Owa$UIControls$NotificationDialog$dispose(){if(!this._disped){this._get_Element().detachAllEvents();this._detachEvent(this._get_Element().get_OwnerDocument(),"keydown",this._onKeyDown);this._rgButtons=null;this._disped=1;removeDialogFromList(this.get_Id());this._oHotKeyManager.dispose();Owa.UIControls.NotificationDialog.callBase(this,'dispose')}};Owa.UIControls.NotificationDialog.prototype.isOpened=function Owa$UIControls$NotificationDialog$isOpened(){return this._isOpened};Owa.UIControls.NotificationDialog.prototype.selectFirstItem=function Owa$UIControls$NotificationDialog$selectFirstItem(fFcs){var rg=this.getItems();if(!rg.length)return;this.unselectAllItems();this.selectItem(rg[0],1,fFcs)};Owa.UIControls.NotificationDialog.prototype.getItemById=function Owa$UIControls$NotificationDialog$getItemById(sId){var oItem=null;this._oContent.forEachChild(function(oChild){if(oChild.getAttribute("_lnk")=="1"&&oChild.get_IsShown()&&sId==oChild.get_Id())oItem=oChild});return oItem};Owa.UIControls.NotificationDialog.prototype.getItems=function Owa$UIControls$NotificationDialog$getItems(fIncludeHidden){var rg=[];this._oContent.forEachChild(function(oChild){if(oChild.getAttribute("_lnk")=="1"&&(fIncludeHidden||oChild.get_IsShown()))rg.push(oChild)});return rg};Owa.UIControls.NotificationDialog.prototype.getSelectedItem=function Owa$UIControls$NotificationDialog$getSelectedItem(){var rg=this.getItems();var rgS=[];for(var i=0;i<rg.length;i++)if(rg[i].getExpando("_sel"))rgS.push(rg[i]);return rgS};Owa.UIControls.NotificationDialog.prototype.unselectAllItems=function Owa$UIControls$NotificationDialog$unselectAllItems(){var rg=this.getItems();for(var i=0;i<rg.length;i++)this.selectItem(rg[i],0)};Owa.UIControls.NotificationDialog.prototype.selectItem=function Owa$UIControls$NotificationDialog$selectItem(o,f,fF){if(f)o.addCssClass(this._sSelectionClass);else o.removeCssClass(this._sSelectionClass);o.setExpando("_sel",f);var rgS=this.getSelectedItem();this._updateInfo(rgS);this._enableButtons(rgS.length);if(f&&fF){o.focus()}return rgS};Owa.UIControls.NotificationDialog.prototype.removeItems=function Owa$UIControls$NotificationDialog$removeItems(rgR){var iL=rgR.length;for(var i=0;i<iL;++i){rgR[i].remove(true)}this.updateTitlebarButton()};Owa.UIControls.NotificationDialog.prototype.hide=function Owa$UIControls$NotificationDialog$hide(){if(this.isOpened()){this._oHotKeyManager.set_Enabled(false);Owa.UIControls.NotificationDialog.callBase(this,"hide")}};Owa.UIControls.NotificationDialog.prototype.show=function Owa$UIControls$NotificationDialog$show(fR){if(!this.getItems().length||this.isOpened())return;this._prepareToShowDialog(fR);if(!this._get_Element().get_IsShown()){this._get_Element().set_IsShown(true)}if(!this._fButtonAdjusted){this._adjustButtons();this._fButtonAdjusted=1}var oB=this._getTitlebarButton();var iX=rmGtNBX(oB,this._get_Element());var iY=getNBY(oB);this._oHotKeyManager.set_Enabled(true);Owa.UIControls.NotificationDialog.callBase(this,"show",[iX,iY])};Owa.UIControls.NotificationDialog.prototype.toggleDialog=function Owa$UIControls$NotificationDialog$toggleDialog(){if(this.isOpened()){this.hide()}else{this.show()}};Owa.UIControls.NotificationDialog.prototype.setItemsHtml=function Owa$UIControls$NotificationDialog$setItemsHtml(sHTML){this._oContent.set_InnerHtml(sHTML)};Owa.UIControls.NotificationDialog.prototype.updateTitlebarButton=function Owa$UIControls$NotificationDialog$updateTitlebarButton(fForceHideTitlebarButton){var oB=this._getTitlebarButton();if(!oB){return}var iCnt=this.getItems().length;var isVis=oB.get_IsShown();oB.getDescendantById("spnRmT").set_TextContent(iCnt.toString());if((!iCnt&&isVis)||fForceHideTitlebarButton){showNotificationButton(this._sTitlebarButtonId,false)}else if(iCnt){if(isVis)showNotificationButton(this._sTitlebarButtonId,false);showNotificationButton(this._sTitlebarButtonId,true)}};Owa.UIControls.NotificationDialog.prototype._onMouseDown=function Owa$UIControls$NotificationDialog$_onMouseDown(e){var o=this._findItem(e.get_Target());if(!o)return;if(e.isCtrlKeyDown()&&this._fAllowMultiSelect){if(o.getExpando("_sel"))this.selectItem(o,0);else this.selectItem(o,1)}else{this.unselectAllItems();this.selectItem(o,1,1)}};Owa.UIControls.NotificationDialog.prototype._onClick=function Owa$UIControls$NotificationDialog$_onClick(e){var sC=e.get_Target().get_Id();var rgS=this.getSelectedItem();this._handleButtonPress(sC,rgS);e.preventDefault();e.cancelBubble()};Owa.UIControls.NotificationDialog.prototype._onDoubleClick=function Owa$UIControls$NotificationDialog$_onDoubleClick(e){};Owa.UIControls.NotificationDialog.prototype._onAction=function Owa$UIControls$NotificationDialog$_onAction(sAction,oContext){var rg=this.getItems();var iIdx=-1;var fIsShiftDown=false;for(var i=0;i<rg.length&&iIdx<0;i++)if(rg[i].getExpando("_sel"))iIdx=i;var fSel=(iIdx!=-1);var o=oContext;switch(sAction){case"selectall":this._selectAll();break;case"hide":this.hide();break;case"shifttab":fIsShiftDown=true;case"tab":if(!this._rgButtons||this._rgButtons.length==0){return}var iButton=0;var fIsFocusOnButton=false;for(var i=0;i<this._rgButtons.length;i++){if(o.get_Id()==this._rgButtons[i].get_Id()){iButton=i;fIsFocusOnButton=true;break}}if(fIsFocusOnButton){if((iButton==this._rgButtons.length-1&&!fIsShiftDown)||(iButton==0&&fIsShiftDown)){if(fSel)rg[iIdx].focus();else this.selectItem(rg[0],1,1)}else{var iNextButton=iButton+(fIsShiftDown?-1:1);if(iNextButton>=0&&iNextButton<this._rgButtons.length){this._rgButtons[iNextButton].focus()}}}break;case"enter":if(o.get_TagName().toLowerCase()=="button")return;if(this._onEnterPressed(o))return;break;case"down":if(iIdx==(rg.length-1))break;if(fSel){this.selectItem(rg[iIdx],0);this.selectItem(rg[iIdx+1],1,1)}else{this.selectItem(rg[0],1)}break;case"up":if(fSel&&(iIdx!=0)){this.selectItem(rg[iIdx],0);this.selectItem(rg[iIdx-1],1,1)}break;case"end":if(iIdx==(rg.length-1))break;if(fSel)this.selectItem(rg[iIdx],0);this.selectItem(rg[rg.length-1],1,1);break;case"home":if(iIdx==0)break;if(fSel)this.selectItem(rg[iIdx],0);this.selectItem(rg[0],1,1);break}};Owa.UIControls.NotificationDialog.prototype._selectAll=function Owa$UIControls$NotificationDialog$_selectAll(){if(this._fAllowMultiSelect){this.unselectAllItems();var rg=this.getItems();for(var i=0;i<rg.length;i++)this.selectItem(rg[i],1)}};Owa.UIControls.NotificationDialog.prototype._updateInfo=function Owa$UIControls$NotificationDialog$_updateInfo(rgS){var rS=0,rD=0,rL=0,rId=0,sTitle=0;var rI=this._oClearIcon;if(rgS.length==1){var o=rgS[0];if(this._itemId==o.get_Id())return;rI=o.getChildById("imgNtfyEnt").clone();rS=o.getChildById("divNtfyEntCol1").get_InnerHtml();rD=o.getAttribute("tf");if(!rD){rD=sTitle=o.getChildById("divNtfyEntCol2").get_TextContent()}rL=o.getAttribute("l");rId=o.get_Id()}else if(rgS.length){rS=this._sMultiItemsSelected}var oImageTag=this._oBody.getDescendantById("imgNtfyInfo");var oInfoArea=oImageTag.get_ParentElement();rI.set_Id(oImageTag.get_Id());oImageTag.remove(true);oInfoArea.insertAdjacentElement(Owa.ElementInsertionPoint.AfterBegin,rI);this._oBody.getDescendantById("divNtfyItmSb").set_InnerHtml(rS||"&nbsp;");this._oBody.getDescendantById("divNtfyItmTm").set_TextContent(rD||" ");this._oBody.getDescendantById("divNtfyItmLc").set_TextContent(rL||" ");if(sTitle){this._oBody.getDescendantById("divNtfyItmTm").setAttribute("title",sTitle)}this._itemId=rId};Owa.UIControls.NotificationDialog.prototype._findItem=function Owa$UIControls$NotificationDialog$_findItem(o){if(!this._oContent.contains(o))return 0;while(o&&o instanceof Owa.Dom.Element){if(o.getAttribute("_lnk")=="1")return o;o=o.get_ParentElement()}return 0};Owa.UIControls.NotificationDialog.prototype._enableButtons=function Owa$UIControls$NotificationDialog$_enableButtons(f){for(var i=0;i<this._rgButtons.length;i++){var oButton=this._rgButtons[i];if(oButton.getAttribute("preventDisable")&&oButton.getIntAttribute("preventDisable")){continue}if(f){oButton.addCssClass("cpt");if(!Owa.Utility.isIE())oButton.removeCssClass("dsbl")}else{oButton.removeCssClass("cpt");if(!Owa.Utility.isIE())oButton.addCssClass("dsbl")}oButton.set_IsDisabled(!f)}};Owa.UIControls.NotificationDialog.prototype._handleButtonPress=function Owa$UIControls$NotificationDialog$_handleButtonPress(sButtonId){};Owa.UIControls.NotificationDialog.prototype._prepareToShowDialog=function Owa$UIControls$NotificationDialog$_prepareToShowDialog(fR){var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(!oSubPageController)return;var oOwa=oSubPageController.getVariable("Owa");var oSubPage=Owa.PageHierarchy.getFolderViewSubPageFromSubPageController(oSubPageController);var oFilterContextMenu=oSubPage?oSubPage.get_FilterContextMenu():null;if(!oFilterContextMenu){return}if(oFilterContextMenu.get_FromMenu()&&oFilterContextMenu.get_FromMenu().fIsOpen){oFilterContextMenu.get_FromMenu()._suppressClose();this._fRestoreFocusToFilterMenu=true}else if(oFilterContextMenu.fIsOpen){oFilterContextMenu._suppressClose();this._fRestoreFocusToFilterMenu=true}};Owa.UIControls.NotificationDialog.prototype._onEnterPressed=function Owa$UIControls$NotificationDialog$_onEnterPressed(o){};Owa.UIControls.NotificationDialog.prototype._getTitlebarButton=function Owa$UIControls$NotificationDialog$_getTitlebarButton(){return $(this._sTitlebarButtonId)};Owa.UIControls.NotificationDialog.prototype._adjustButtons=function Owa$UIControls$NotificationDialog$_adjustButtons(){if(!Owa.Utility.isIE())return;for(var i=0;i<this._rgButtons.length;++i){var iW=this._rgButtons[i].get_OffsetWidth();if(100<iW)this._rgButtons[i].set_Width(iW*0.8)}};Owa.UIControls.NotificationDialog.prototype._onClose=function Owa$UIControls$NotificationDialog$_onClose(){this._isOpened=0;applyNotificationButtonStyle(0,this._sTitlebarButtonId);if(this._fRestoreFocusToFilterMenu){var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(!oSubPageController)return;var oSubPage=Owa.PageHierarchy.getFolderViewSubPageFromSubPageController(oSubPageController);var oFilterContextMenu=oSubPage?oSubPage.get_FilterContextMenu():null;if(oFilterContextMenu.get_FromMenu()&&oFilterContextMenu.get_FromMenu().fIsOpen)oFilterContextMenu.get_FromMenu()._enableClose();else if(oFilterContextMenu.fIsOpen)oFilterContextMenu._enableClose();this._fRestoreFocusToFilterMenu=false}};Owa.UIControls.NotificationDialog.prototype._onShow=function Owa$UIControls$NotificationDialog$_onShow(){applyNotificationButtonStyle(1,this._sTitlebarButtonId);if(this._fSelectFirstItemOnShow){this.selectFirstItem(0)}else{var rgSelectedItems=this.getSelectedItem();if(rgSelectedItems.length==1){rgSelectedItems[0].focus()}}this._isOpened=1};function removeDialogFromList(sId){if(_rgNotificationDialogs[sId]!=null){_rgNotificationDialogs[sId]=null;_iNotificationDialogsCount--}if(_iNotificationDialogsCount==0){_rgNotificationDialogs=null;_iNotificationDialogsCount=null}}Owa.UIControls.NotificationDialog.createClass("Owa.UIControls.NotificationDialog",Owa.UIControls.Dialog)})();g_fModuleLoaded[".\\uicontrols/notificationdialog.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/remindersnoozetimecombobox.js".toLowerCase()])(function(){Owa.UIControls.ReminderSnoozeTimeComboBox=function Owa$UIControls$ReminderSnoozeTimeComboBox(oElement,oParent){Owa.UIControls.ReminderSnoozeTimeComboBox.constructBase(this,[oElement,oParent])};Owa.UIControls.ReminderSnoozeTimeComboBox.prototype.updateSnoozeTime=function Owa$UIControls$ReminderSnoozeTimeComboBox$prototype$updateSnoozeTime(iMaxSnoozeTime){var oValueToSelect=null;if(iMaxSnoozeTime>=0)oValueToSelect=(iMaxSnoozeTime>5?"-5":"0");for(var i=0;i<this._oDropDownList.getItemCount();i++){var iValue=getInt(this._oDropDownList.getValueByIndex(i));var oDomItem=this._oDropDownList.getDomItemByIndex(i);if(iValue<=0){oDomItem.set_IsShown(iMaxSnoozeTime+iValue>0||(iMaxSnoozeTime==0&&iValue==0))}else if(oValueToSelect==null){oValueToSelect=iValue.toString()}}this._selectValue(oValueToSelect)};Owa.UIControls.ReminderSnoozeTimeComboBox.createClass("Owa.UIControls.ReminderSnoozeTimeComboBox",Owa.UIControls.ComboBox)})();g_fModuleLoaded[".\\uicontrols/remindersnoozetimecombobox.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/ReminderDialog.js".toLowerCase()])(function(){var DIALOG_ID="divRmdDlg";var CONST_MS_IN_1MIN=60000;Owa.UIControls.ReminderDialog=function Owa$UIControls$ReminderDialog(oRmdDlg){Owa.UIControls.ReminderDialog.constructBase(this,[oRmdDlg,"divRmdDtCnt","divRmdDlgBdy",new Array($("divBtnDismissall"),$("divBtnDismiss"),$("divBtnOpenReminder"),$("divBtnSnooze")),Owa.Strings.Ids.ReminderNotificationButtonId]);this._oRmdSnzDD=new Owa.UIControls.ReminderSnoozeTimeComboBox($("divRmdSnzDD"),null);this._oRmdSnzDD.set_SubPage(this.get_SubPage());this._oRmdSnzDD.initialize();this.dtLastReminderTime=0;this.iTimeDifference=0;this.fSoundEnabled=getInt(this._getAttribute("fSoundEnabled"));this.iTimeOffset=this._getAttribute("iTimeOffset");this._dtNextReminderTime=0;this._oNextReminderItem=0;this._dtLastRefreshTime=0;this._rgTimeUnits=this._getAttribute("rgTU").split(",");this._rgTimeUniteRegExp=new Array(/\{0\}/g,/\{1\}/g,/\{2\}/g,/\{3\}/g);this._iReminderTimer=0;this._iReminderDueInTimer=0;this._sNow=this._getAttribute("sNow");this._sTimeUnitDue=this._getAttribute("sTimeUnitDue");this._sTimeUnitOverdue=this._getAttribute("sTimeUnitOverdue");this._fAllowMultiSelect=1;this.get_OnShow().add(this._createCallback(this._adjustWidth))};Owa.UIControls.ReminderDialog.getDialog=function Owa$UIControls$ReminderDialog$getDialog(){var oDialog=Owa.UIControls.NotificationDialog.getDialog(DIALOG_ID);if(oDialog==null){var oDialogDiv=$(DIALOG_ID);if(!oDialogDiv){return null}oDialog=Owa.UIControls.NotificationDialog.addDialog(DIALOG_ID,new Owa.UIControls.ReminderDialog(oDialogDiv))}return oDialog};Owa.UIControls.ReminderDialog.prototype.dispose=function Owa$UIControls$ReminderDialog$dispose(){Owa.UIControls.ReminderDialog.callBase(this,'dispose');if(!this._disped||this._disped<=1){this._clearTimer();this._clearDueInTimer();this._oRmdSnzDD.dispose();this._disped++}};Owa.UIControls.ReminderDialog.prototype.setItemsHtml=function Owa$UIControls$ReminderDialog$setItemsHtml(sHTML){Owa.UIControls.ReminderDialog.callBase(this,'setItemsHtml',[sHTML]);var oRmdDlg=this;this._oContent.forEachChild(function(oChild){oChild.getChildById("divNtfyEntCol2").set_InnerHtml(oRmdDlg._getReminderItemDueIn(oChild))})};Owa.UIControls.ReminderDialog.prototype.removeItems=function Owa$UIControls$ReminderDialog$removeItems(rgR,iOp,rgU){if(!iOp)iOp=OP_DIS;var iL=rgR.length-1;for(var i=0;i<rgR.length;++i){if(i==iL){var rgItems=this.getItems();this.nxtSelId=null;if(rgItems.length>1)for(var j=0;j<rgItems.length;j++)if(rgItems[j].get_Id()==rgR[i].get_Id())this.nxtSelId=(j==rgItems.length-1)?rgItems[j-1].get_Id():rgItems[j+1].get_Id()}var fD=rgU&&rgU[i].fD;this._removeReminderItem(rgR[i],iOp,fD);if(rgU&&!fD){rgR[i].setAttribute("ck",rgU[i].ck);rgR[i].setAttribute("r",rgU[i].r)}}this.setReminderTimer();this.updateTitlebarButton()};Owa.UIControls.ReminderDialog.prototype.selectItem=function Owa$UIControls$ReminderDialog$selectItem(o,f,fF){var rgS=Owa.UIControls.ReminderDialog.callBase(this,'selectItem',[o,f,fF]);this._oRmdSnzDD.updateSnoozeTime(this.getMaxSnoozeTime());this._oRmdSnzDD.set_IsEnabled(rgS.length>0)};Owa.UIControls.ReminderDialog.prototype.showError=function Owa$UIControls$ReminderDialog$showError(s){this._getDescendant("divRmdErrTxt").set_TextContent(s);this._getDescendant("divRmdErr").set_IsShown(!!s)};Owa.UIControls.ReminderDialog.prototype.setReminderTimer=function Owa$UIControls$ReminderDialog$setReminderTimer(){this._clearTimer();this._updateReminderItemsRNT()};Owa.UIControls.ReminderDialog.prototype.getUTCDifference=function Owa$UIControls$ReminderDialog$getUTCDifference(){var browserNow=new Date();var clientNow=new Date();var browserTZoffset=browserNow.getTimezoneOffset();var browserUTCNow=new Date(Date.UTC(browserNow.getFullYear(),browserNow.getMonth(),browserNow.getDate(),browserNow.getHours(),browserNow.getMinutes(),browserNow.getSeconds()));clientNow.setTime(browserUTCNow.getTime()+((browserTZoffset+this.iTimeOffset)*60000)+this.iTimeDifference);return clientNow};Owa.UIControls.ReminderDialog.prototype.getMaxSnoozeTime=function Owa$UIControls$ReminderDialog$getMaxSnoozeTime(){var rgSelectedItems=this.getSelectedItem();var now=this.getUTCDifference();var dtStartTime=0;var fNotStart=0;if(rgSelectedItems.length==1){var o=rgSelectedItems[0];dtStartTime=new Date(o.getAttribute("t"));if(dtStartTime>now&&isCal(o.getAttribute("c")))fNotStart=1}if(fNotStart)return Math.round((dtStartTime-now)/CONST_MS_IN_1MIN);else return -1};Owa.UIControls.ReminderDialog.prototype.refresh=function Owa$UIControls$ReminderDialog$refresh(f){var rg=this.getItems();if(!rg.length)return;var dt=this.getUTCDifference();var nDiff=dt-this._dtLastRefreshTime;if(nDiff>=20000||f){for(var i=0;i<rg.length;i++)rg[i].getChildById("divNtfyEntCol2").set_InnerHtml(this._getReminderItemDueIn(rg[i]));this._dtLastRefreshTime=dt}};Owa.UIControls.ReminderDialog.prototype._onDoubleClick=function Owa$UIControls$ReminderDialog$_onDoubleClick(e){var o=this._findItem(e.get_Target());if(!o)return;this._openReminderItems(new Array(o))};Owa.UIControls.ReminderDialog.prototype._adjustWidth=function Owa$UIControls$ReminderDialog$_adjustWidth(){var iWidth=this._getDescendant("divBtnDismissall").get_ClientWidth()+this._getDescendant("divBtnDismiss").get_ClientWidth()+this._getDescendant("divBtnOpenReminder").get_ClientWidth();var iPaddingAndMargin=86;iWidth+=iPaddingAndMargin;if(iWidth>this._get_Element().get_Width()){this._get_Element().set_Width(iWidth);var oB=this._getTitlebarButton();var iX=rmGtNBX(oB,this._get_Element());var iY=getNBY(oB);this._get_Element().set_Left(iX);this._get_Element().set_Top(iY)}};Owa.UIControls.ReminderDialog.prototype._handleButtonPress=function Owa$UIControls$ReminderDialog$_handleButtonPress(sButtonId,rgSelectedItems){switch(sButtonId){case"divBtnSnooze":procRm(OP_SNZ,"Snooze",rgSelectedItems,this.dtLastReminderTime,this._oRmdSnzDD.get_SelectedValue());break;case"divBtnDismiss":procRm(OP_DIS,"Dismiss",rgSelectedItems,this.dtLastReminderTime);break;case"divBtnDismissall":procRm(OP_DIS,"Dismiss",this.getItems());break;case"divBtnOpenReminder":this._openReminderItems(rgSelectedItems);break}};Owa.UIControls.ReminderDialog.prototype._prepareToShowDialog=function Owa$UIControls$ReminderDialog$_prepareToShowDialog(fR){this.refresh(fR);this._setDueInReminderTimer();Owa.UIControls.ReminderDialog.callBase(this,"_prepareToShowDialog")};Owa.UIControls.ReminderDialog.prototype._onEnterPressed=function Owa$UIControls$ReminderDialog$_onEnterPressed(o){if(o.getAncestorById("divRmdSnzDD",DIALOG_ID))return true;this._openReminderItems(this.getSelectedItem())};Owa.UIControls.ReminderDialog.prototype._removeReminderItem=function Owa$UIControls$ReminderDialog$_removeReminderItem(o,iOp,fD){if(this._oNextReminderItem==o)this._clearTimer();if(iOp==OP_DIS||fD){o.remove(true)}else{o.set_IsShown(false);this.selectItem(o,0)}};Owa.UIControls.ReminderDialog.prototype._clearDueInTimer=function Owa$UIControls$ReminderDialog$_clearDueInTimer(){if(this._iReminderDueInTimer){this._clearInterval(this._iReminderDueInTimer);this._iReminderDueInTimer=0}};Owa.UIControls.ReminderDialog.prototype._clearTimer=function Owa$UIControls$ReminderDialog$_clearTimer(){if(this._iReminderTimer){this._clearTimeout(this._iReminderTimer);this._iReminderTimer=0}};Owa.UIControls.ReminderDialog.prototype._setDueInReminderTimer=function Owa$UIControls$ReminderDialog$_setDueInReminderTimer(){this._clearDueInTimer();this._iReminderDueInTimer=this._setInterval(this._updateReminderItemsDueIn,30000)};Owa.UIControls.ReminderDialog.prototype._updateReminderItemsDueIn=function Owa$UIControls$ReminderDialog$_updateReminderItemsDueIn(){if(this.isOpened())this.refresh()};Owa.UIControls.ReminderDialog.prototype._updateReminderItemsRNT=function Owa$UIControls$ReminderDialog$_updateReminderItemsRNT(){var rg=this.getItems(true);var nowUTC=this.getUTCDifference();var maxY=4501;var nextRm=0;for(var i=0;i<rg.length;i++){var o=rg[i];var rnt=new Date(o.getAttribute("r"));var dueBy=new Date(o.getAttribute("t"));if(rnt.getYear()==maxY)continue;if(nowUTC<rnt){nextRm=o;o.setExpando("_sel",0);o.set_IsShown(false)}else{if(!o.get_IsShown()){if(nowUTC<dueBy&&!o.getExpando("fired"))this._showActiveReminder(o);else o.set_IsShown(true)}}}if(nextRm){this._dtNextReminderTime=new Date(nextRm.getAttribute("r"));this._iReminderTimer=this._setTimeout(this._fireReminders,this._dtNextReminderTime-nowUTC)}this.updateTitlebarButton();this._oNextReminderItem=nextRm};Owa.UIControls.ReminderDialog.prototype._fireReminders=function Owa$UIControls$ReminderDialog$_fireReminders(){this._iReminderTimer=0;this._showActiveReminder(this._oNextReminderItem);this.setReminderTimer()};Owa.UIControls.ReminderDialog.prototype._showActiveReminder=function Owa$UIControls$ReminderDialog$_showActiveReminder(o){this.selectItem(o,1,1);o.getChildById("divNtfyEntCol2").set_InnerHtml(this._getReminderItemDueIn(o));o.set_IsShown(true);this.updateTitlebarButton();if(!this.isOpened())this.show(1);if(this.fSoundEnabled)plySnd();o.setExpando("fired")};Owa.UIControls.ReminderDialog.prototype._getReminderItemDueIn=function Owa$UIControls$ReminderDialog$_getReminderItemDueIn(o){var dtNow=this.getUTCDifference();var dtDue=new Date(o.getAttribute("t"));var sDue="";var iM=(dtDue-dtNow)/CONST_MS_IN_1MIN;if(0<iM){iM=Math.floor(iM);sDue=this._sTimeUnitDue}else{iM=Math.ceil(iM);iM=-iM;sDue=this._sTimeUnitOverdue}if(iM==0){return this._sNow}else{var rgD=new Array(4);rgD[3]=rgD[2]=rgD[1]=0;rgD[0]=Math.floor(iM/(7*24*60));if(2>rgD[0]){rgD[1]=Math.floor(iM/(24*60))%7;if(2>rgD[1]&&0==rgD[0]){rgD[2]=Math.floor(iM/60)%24;if(8>=rgD[2]&&0==rgD[1])rgD[3]=Math.floor(iM)%60}}var f=1;var u=0;for(var i=0;i<4;i++,u+=3){var s="";if(0!=rgD[i]){if(!f)sDue+=" ";else f=0;var re1=new RegExp(this._getAttribute("re1"),"gi");var re2=new RegExp(this._getAttribute("re2"),"gi");var idx=(re1.test(rgD[i]))?0:re2.test(rgD[i])?1:2;s=(this._rgTimeUnits[u+idx].replace(/\{0\}/,rgD[i]))}sDue=sDue.replace(this._rgTimeUniteRegExp[i],s)}}return sDue};Owa.UIControls.ReminderDialog.prototype._openReminderItems=function Owa$UIControls$ReminderDialog$_openReminderItems(rgS){for(var i=0;i<rgS.length;i++){var sAe="Item";var t=rgS[i].getAttribute("c");if(isCal(t))sAe="PreFormAction";var sUrl="?ae="+sAe;sUrl+="&a=Open";sUrl+="&t="+urlEnc(t);var id=getReminderItemId(rgS[i]);if(rgS[i].getAttribute("oid"))id=rgS[i].getAttribute("oid");sUrl+="&id="+urlEnc(id);openItm(sUrl,null,null,null,null,this.get_SubPage())}};Owa.UIControls.ReminderDialog.prototype._onClose=function Owa$UIControls$ReminderDialog$_onClose(){Owa.UIControls.ReminderDialog.callBase(this,"_onClose");this._clearDueInTimer();this._oRmdSnzDD.hideDropDown()};Owa.UIControls.ReminderDialog.createClass("Owa.UIControls.ReminderDialog",Owa.UIControls.NotificationDialog)})();g_fModuleLoaded[".\\uicontrols/ReminderDialog.js".toLowerCase()]=1;Type.createNamespace("Owa.Components");if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\components/FilterCriteria.js".toLowerCase()])(function(){Owa.Components.FilterCriteria=function Owa$Components$FilterCriteria(){this._isSendToMe=false;this._isCcToMe=false;this._isUnread=false;this._isFlagged=false;this._isHighImportant=false;this._hasAttachments=false;this._recipient="";this._recipientName="";this._recipientWellInnerHtml="";this._categories=[]};Owa.Components.FilterCriteria.prototype.clone=function Owa$Components$FilterCriteria$clone(){var oNew=new Owa.Components.FilterCriteria();oNew._isSendToMe=this._isSendToMe;oNew._isCcToMe=this._isCcToMe;oNew._isUnread=this._isUnread;oNew._isFlagged=this._isFlagged;oNew._isHighImportant=this._isHighImportant;oNew._hasAttachments=this._hasAttachments;oNew._recipient=this._recipient;oNew._recipientName=this._recipientName;oNew._recipientWellInnerHtml=this._recipientWellInnerHtml;oNew._categories=[];for(var iIndex=0;iIndex<this._categories.length;iIndex++)oNew._categories.push(this._categories[iIndex]);return oNew};Owa.Components.FilterCriteria.prototype.get_isValid=function Owa$Components$FilterCriteria$get_isValid(){return(this._isSendToMe||this._isCcToMe||this._isUnread||this._isFlagged||this._isHighImportant||this._hasAttachments||this._recipient||this._categories.length)};Owa.Components.FilterCriteria.prototype.get_IsSendToMe=function Owa$Components$FilterCriteria$get_IsSendToMe(){return this._isSendToMe};Owa.Components.FilterCriteria.prototype.set_IsSendToMe=function Owa$Components$FilterCriteria$set_IsSendToMe(oValue){this._isSendToMe=oValue};Owa.Components.FilterCriteria.prototype.get_IsCcToMe=function Owa$Components$FilterCriteria$get_IsCcToMe(){return this._isCcToMe};Owa.Components.FilterCriteria.prototype.set_IsCcToMe=function Owa$Components$FilterCriteria$set_IsCcToMe(oValue){this._isCcToMe=oValue};Owa.Components.FilterCriteria.prototype.get_IsUnread=function Owa$Components$FilterCriteria$get_IsUnread(){return this._isUnread};Owa.Components.FilterCriteria.prototype.set_IsUnread=function Owa$Components$FilterCriteria$set_IsUnread(oValue){this._isUnread=oValue};Owa.Components.FilterCriteria.prototype.get_IsFlagged=function Owa$Components$FilterCriteria$get_IsFlagged(){return this._isFlagged};Owa.Components.FilterCriteria.prototype.set_IsFlagged=function Owa$Components$FilterCriteria$set_IsFlagged(oValue){this._isFlagged=oValue};Owa.Components.FilterCriteria.prototype.get_IsHighImportant=function Owa$Components$FilterCriteria$get_IsHighImportant(){return this._isHighImportant};Owa.Components.FilterCriteria.prototype.set_IsHighImportant=function Owa$Components$FilterCriteria$set_IsHighImportant(oValue){this._isHighImportant=oValue};Owa.Components.FilterCriteria.prototype.get_HasAttachments=function Owa$Components$FilterCriteria$get_HasAttachments(){return this._hasAttachments};Owa.Components.FilterCriteria.prototype.set_HasAttachments=function Owa$Components$FilterCriteria$set_HasAttachments(oValue){this._hasAttachments=oValue};Owa.Components.FilterCriteria.prototype.get_Recipient=function Owa$Components$FilterCriteria$get_Recipient(){return this._recipient};Owa.Components.FilterCriteria.prototype.set_Recipient=function Owa$Components$FilterCriteria$set_Recipient(oValue){this._recipient=oValue};Owa.Components.FilterCriteria.prototype.get_RecipientName=function Owa$Components$FilterCriteria$get_RecipientName(){return this._recipientName};Owa.Components.FilterCriteria.prototype.set_RecipientName=function Owa$Components$FilterCriteria$set_RecipientName(oValue){this._recipientName=oValue};Owa.Components.FilterCriteria.prototype.get_RecipientWellInnerHtml=function Owa$Components$FilterCriteria$get_RecipientWellInnerHtml(){return this._recipientWellInnerHtml};Owa.Components.FilterCriteria.prototype.set_RecipientWellInnerHtml=function Owa$Components$FilterCriteria$set_RecipientWellInnerHtml(oValue){this._recipientWellInnerHtml=oValue};Owa.Components.FilterCriteria.prototype.add_Category=function Owa$Components$FilterCriteria$add_Category(sName,sHtml){var oValue={};oValue.name=sName;oValue.html=sHtml;this._categories.push(oValue)};Owa.Components.FilterCriteria.prototype.remove_Category=function Owa$Components$FilterCriteria$remove_Category(sName){for(var iIndex=0;iIndex<this._categories.length;iIndex++){if(this._categories[iIndex].name==sName){if(iIndex<this._categories.length)this._categories.splice(iIndex,1);return true}}return false};Owa.Components.FilterCriteria.prototype.clear_Categories=function Owa$Components$FilterCriteria$clear_Categories(){this._categories=[]};Owa.Components.FilterCriteria.prototype.get_Category=function Owa$Components$FilterCriteria$get_Category(iIndex){return this._categories[iIndex]};Owa.Components.FilterCriteria.prototype.get_CategoryCount=function Owa$Components$FilterCriteria$get_CategoryCount(){return this._categories.length};Owa.Components.FilterCriteria.prototype.get_CategoryNames=function Owa$Components$FilterCriteria$get_CategoryNames(){var rgNames=[];for(var iIndex=0;iIndex<this._categories.length;iIndex++)rgNames.push(this._categories[iIndex].name);return rgNames};Owa.Components.FilterCriteria.prototype.get_HasCategories=function Owa$Components$FilterCriteria$get_HasCategories(iIndex){return !!this._categories.length};Owa.Components.FilterCriteria.prototype.addStatement=function Owa$Components$FilterCriteria$addStatement(oRequest,sFolderId){if(!this.get_isValid())return;var oStatement=new oeSt(oRequest,"FVLVF");oStatement.add("fId",sFolderId);this.addOneStatement(oStatement,"fStm",this.get_IsSendToMe()?1:0);this.addOneStatement(oStatement,"fCtm",this.get_IsCcToMe()?1:0);this.addOneStatement(oStatement,"fUR",this.get_IsUnread()?1:0);this.addOneStatement(oStatement,"fFlg",this.get_IsFlagged()?1:0);this.addOneStatement(oStatement,"fHI",this.get_IsHighImportant()?1:0);this.addOneStatement(oStatement,"fAttch",this.get_HasAttachments()?1:0);if(this.get_HasCategories())this.addOneStatement(oStatement,"sCat",this.get_CategoryNames().join(","));this.addOneStatement(oStatement,this.get_RecipientName(),this.get_Recipient());oRequest.addSt("fldrfltr",oStatement)};Owa.Components.FilterCriteria.prototype.addOneStatement=function Owa$Components$FilterCriteria$addOneStatement(oStatement,sName,oValue){if(oValue)oStatement.add(sName,oValue)};Owa.Components.FilterCriteria.createClass("Owa.Components.FilterCriteria")})();g_fModuleLoaded[".\\components/FilterCriteria.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/FilterRecipientContextMenu.js".toLowerCase()])(function(){Type.createNamespace("Owa.UIControls");var RECIPIENT_WELL_ID="divFltrRw";var ADDRESS_BOOK_TARGET_ID="divTo";var DEFAULT_WIDTH=200;Owa.UIControls.FilterRecipientContextMenu=function Owa$UIControls$FilterRecipientContextMenu(oElement,oParent,oSubPage){Owa.UIControls.FilterRecipientContextMenu.constructBase(this,arguments);this.get_OnPreShow().add(this._createCallback(this._onPreShow));this.get_OnClose().add(this._createCallback(this._onClose))};Owa.UIControls.FilterRecipientContextMenu.create=function Owa$UIControls$FilterRecipientContextMenu$create(oElement,oParent,oSubPage){var oContextMenu=new Owa.UIControls.FilterRecipientContextMenu(oElement,oParent,oSubPage);oContextMenu.initialize();return oContextMenu};var _oPrototype=Owa.UIControls.FilterRecipientContextMenu.prototype;_oPrototype._get_DivRecipientWell=function Owa$UIControls$FilterRecipientContextMenu$_get_DivRecipientWell(){return this._getDescendant(RECIPIENT_WELL_ID)};_oPrototype._get_RecipientWell=function Owa$UIControls$FilterRecipientContextMenu$_get_RecipientWell(){return Owa.Components.RecipientWellManager.get_Instance().get_RecipientWell(this.sConsumerId,this._get_DivRecipientWell())};_oPrototype._onClose=function Owa$UIControls$FilterRecipientContextMenu$_onClose(){Owa.UIControls.RecipientAnrContextMenu.get_Instance().close()};_oPrototype.initialize=function Owa$UIControls$FilterRecipientContextMenu$initialize(){Owa.UIControls.FilterRecipientContextMenu.callBase(this,"initialize");this._get_Element().set_Width(DEFAULT_WIDTH);var oDivRecipientWell=this._get_DivRecipientWell();var oRecipientWell=this.addResource(new Owa.UIControls.SingleEditRecipientWell.create(oDivRecipientWell));oRecipientWell.set_SubPage(this.get_SubPage());oRecipientWell.set_AutoCompleteContainer(this._get_Element());oRecipientWell.set_OnAutoResolveCallback(this._createCallback(this._resolveRecipientWell));oRecipientWell.set_OnUpdateFromCacheCallback(this._createCallback(this._onUpdateFromCache));oRecipientWell.set_IsADRecipientOnly(true);oRecipientWell.set_IsRecipientMenuEnabled(false);oRecipientWell.addHandler("blur",this._createCallback(this._recipientWellBlur));oRecipientWell.addHandler("keydown",this._createCallback(this._recipientWellKeyDown));oRecipientWell.addHandler("contextmenu",this._createCallback(this._recipientWellContextMenu));oRecipientWell.addHandler("mousedown",this._createCallback(this._recipientWellClick));oRecipientWell.addHandler("click",this._createCallback(this._recipientWellClick));oRecipientWell.initialize();this.oAnrOptions=getAnrOptions(false,false,RBT_PDL);this.sConsumerId=Owa.Components.RecipientWellManager.get_Instance().registerWells([oRecipientWell],this.oAnrOptions);this._attachEvent(this._getDescendant("imgAddrBook"),"click",this._buttonOpenAddressBookClick)};_oPrototype._tShow=function Owa$UIControls$FilterRecipientContextMenu$_tShow(oContext){Owa.UIControls.FilterRecipientContextMenu.callBase(this,"_tShow",arguments);if(!this._fOffsetTopCalced){this._fOffsetTopCalced=true;this._OffsetTop=this._get_Element().get_Top()-this._get_Element().get_FirstChild().get_OffsetHeight()-4}this._get_Element().set_Top(this._OffsetTop);this._get_RecipientWell().setFocus(1)};_oPrototype._onUpdateFromCache=function Owa$UIControls$FilterRecipientContextMenu$_onUpdateFromCache(oEventArgs){this._oFilterMenu._updateRecipient(oEventArgs.oRecipient);this._oFilterMenu._toggleApplyButton()};_oPrototype._onPreShow=function Owa$UIControls$FilterRecipientContextMenu$_onPreShow(){this._fStick=false};_oPrototype._recipientWellContextMenu=function Owa$UIControls$FilterRecipientContextMenu$_recipientWellContextMenu(oEvent){this._fSuppressClose=false;this._oFilterMenu._fSuppressClose=false;if(!oEvent.get_Target().equals(this._get_DivRecipientWell())){this._get_RecipientWell().setFocus(0)}oEvent.cancelBubble();oEvent.preventDefault()};_oPrototype._recipientWellKeyDown=function Owa$UIControls$FilterRecipientContextMenu$_recipientWellKeyDown(oEvent){this._oFilterMenu._updateRecipient(null);this._oFilterMenu._toggleApplyButton()};_oPrototype._recipientWellClick=function Owa$UIControls$FilterRecipientContextMenu$_recipientWellClick(oEvent){this._fSuppressClose=false;this._oFilterMenu._fSuppressClose=false;if(!oEvent.get_Target().equals(this._get_DivRecipientWell())){this._get_RecipientWell().setFocus(0)}};_oPrototype._resolveRecipientWell=function Owa$UIControls$FilterRecipientContextMenu$_resolveRecipientWell(){this._fStick=true;Owa.Components.RecipientWellManager.get_Instance().resolveWells(this.sConsumerId,this._createCallback(this._onCompleteResolveNames))};_oPrototype._onCompleteResolveNames=function Owa$UIControls$FilterRecipientContextMenu$_onCompleteResolveNames(){var oRecipient=this._get_RecipientWell().get_Recipient();this._oFilterMenu._updateRecipient(oRecipient);this._oFilterMenu._toggleApplyButton();this._get_RecipientWell().setFocus(0);this._fStick=false};_oPrototype._enableClose=function Owa$UIControls$FilterRecipientContextMenu$_enableClose(){this._fSuppressClose=0;this._fAutomaticEnableClose=1;this._oFilterMenu._fSuppressClose=0;this._oFilterMenu._fAutomaticEnableClose=1;this._oFilterMenu._removeTextBoxEventHandlers();this._get_RecipientWell().setFocus()};_oPrototype._removeTextBoxEventHandlers=function Owa$UIControls$FilterRecipientContextMenu$_removeTextBoxEventHandlers(){this._fRemovedEventHandler=true};_oPrototype._addTextBoxEventHandlers=function Owa$UIControls$FilterRecipientContextMenu$_addTextBoxEventHandlers(){this._fRemovedEventHandler=false};_oPrototype._recipientWellBlur=function Owa$UIControls$FilterRecipientContextMenu$_recipientWellBlur(oEvent){if(!this.fIsOpen){return}else if(this._fStick||this._fRemovedEventHandler||this._fSuppressClose){return}var oRecipient=this._get_RecipientWell().get_Recipient();this._oFilterMenu._updateRecipient(oRecipient);this._oFilterMenu._toggleApplyButton();this._oFilterMenu._addTextBoxEventHandlers();this._oFilterMenu._closeOnBlur()};_oPrototype._buttonOpenAddressBookClick=function Owa$UIControls$FilterRecipientContextMenu$_buttonOpenAddressBookClick(){var oParameter=new Object();oParameter.sTgt=ADDRESS_BOOK_TARGET_ID;oParameter.sTo=this._get_RecipientWell().get_Html();this._enableClose();this._fStick=true;shwDlg("AddressBook",a_iABW,a_iABH,DLG_MOD|DLG_CTR|DLG_RSZ,oParameter,"&a=PickFilter");this._get_RecipientWell().set_Html(oParameter.sTo);var oRecipient=this._get_RecipientWell().get_Recipient();this._oFilterMenu._updateRecipient(oRecipient);this._oFilterMenu._toggleApplyButton();this._get_RecipientWell().setFocus(1);this._fStick=false};_oPrototype.set_FilterMenu=function Owa$UIControls$FilterRecipientContextMenu$set_FilterMenu(oValue){this._oFilterMenu=oValue};Owa.UIControls.FilterRecipientContextMenu.createClass("Owa.UIControls.FilterRecipientContextMenu",Owa.UIControls.ContextMenu)})();g_fModuleLoaded[".\\uicontrols/FilterRecipientContextMenu.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/FilterInfobar.js".toLowerCase()])(function(){Type.createNamespace("Owa.UIControls");Owa.UIControls.FilterInfobar=function Owa$UIControls$FilterInfobar(oSubPage){Owa.UIControls.FilterInfobar.constructBase(this);this.set_SubPage(oSubPage)};Owa.UIControls.FilterInfobar.prototype.get_VirtualListView=function Owa$UIControls$FilterInfobar$get_VirtualListView(){return this.get_SubPage().get_VirtualListView()};Owa.UIControls.FilterInfobar.prototype.get_SearchControl=function Owa$UIControls$FilterInfobar$get_SearchControl(){return this.get_SubPage().get_SearchControl()};Owa.UIControls.FilterInfobar.prototype.get_FolderId=function Owa$UIControls$FilterInfobar$get_FolderId(){return this.get_SubPage().get_FolderId()};Owa.UIControls.FilterInfobar.prototype.get_FilterInFavorites=function Owa$UIControls$FilterInfobar$get_FilterInFavorites(){return this.get_SubPage().getSubPageVariable("a_fNFvrFltr")};Owa.UIControls.FilterInfobar.prototype._createElement=function Owa$UIControls$FilterInfobar$_createElement(){var oFilterInfoBar=Owa.Dom.Document.get_Current().createElement("DIV");oFilterInfoBar.set_Id("divFltrIB");var sFIBHtml;var fSaveFilter=!this.get_FilterInFavorites();var sClearSrc=getThmF("clear1x1.gif");sFIBHtml="<div class=\"fltrIBM\"><div id=\"fltrDesc\"><span></span></div><div id=\"divFltrIBImg\">";if(fSaveFilter)sFIBHtml+="<img class=\"vaM\" src=\""+sClearSrc+"\" id=\"saveFltr\">";sFIBHtml+="<img class=\"vaM\" src=\""+sClearSrc+"\" id=\"cnclFltr\"></div>";sFIBHtml+="<div class=\"fltrCvr\"></div></div><div class=\"fltrIBS\"></div>";oFilterInfoBar.set_InnerHtml(sFIBHtml);this.get_SubPage()._get_Element().appendChild(oFilterInfoBar);this.get_SubPage().get_SizeChanged(this._createCallback(this._windowResize));var oMain=oFilterInfoBar.get_FirstChild();var oDescription=oMain.get_FirstChild();var oImageArea=oDescription.get_NextSibling();var oCancelFilter=oFilterInfoBar.getDescendantById("cnclFltr");Owa.Components.CssSprites.updateImage(oCancelFilter,"fltr-clr.gif");oCancelFilter.set_Title(L_CnclFltrTltps);this._attachEvent(oCancelFilter,"click",this._buttonCancelClick);if(fSaveFilter){var oSaveFilter=oFilterInfoBar.getDescendantById("saveFltr");Owa.Components.CssSprites.updateImage(oSaveFilter,"fltr-addfav.png");oSaveFilter.set_Title(L_SvFltrTltps);this._attachEvent(oSaveFilter,"click",this._buttonSaveClick)}else{var iDescriptionFar=26;var iImageAreaWidth=22;if(oFilterInfoBar.get_OwnerDocument().get_IsRtl()){oDescription.set_Left(iDescriptionFar);oImageArea.set_Width(iImageAreaWidth)}else{oDescription.set_Right(iDescriptionFar);oImageArea.set_Width(iImageAreaWidth)}}this._initializeDomElement(oFilterInfoBar)};Owa.UIControls.FilterInfobar.prototype.get_FilterDescription=function Owa$UIControls$FilterInfobar$get_FilterDescription(){return this._filterDescription?this._filterDescription:""};Owa.UIControls.FilterInfobar.prototype.set_FilterDescription=function Owa$UIControls$FilterInfobar$set_FilterDescription(oValue){this._filterDescription=oValue};Owa.UIControls.FilterInfobar.prototype._buttonCancelClick=function Owa$UIControls$FilterInfobar$_buttonCancelClick(){if(this.get_SearchControl())this.get_SearchControl().clearSearch(1);this.get_VirtualListView().dsblFltrVw()};Owa.UIControls.FilterInfobar.prototype._buttonSaveClick=function Owa$UIControls$FilterInfobar$_buttonSaveClick(){if(this.get_FilterInFavorites())return;this._showSaveDialog()};Owa.UIControls.FilterInfobar.prototype._showSaveDialog=function Owa$UIControls$FilterInfobar$_showSaveDialog(){var oSaveDialog=new Owa.UIControls.ButtonDialog("svFltDlg",L_SvFltrDlgPmt+"<br><br>"+"<span id=\"spnFltrNm\">"+L_SvAs+"&nbsp;</span><input id=fltrNm maxLength=256></input>",L_SvFltrDlgTtl,new Array(L_OK,L_Cncl),null,null,this._createCallback(this._closeSaveDialog));var oInput=Owa.PageHierarchy.getElementByIdFromTop("fltrNm");oInput.set_Value(this.get_FilterDescription().substring(0,255));oSaveDialog.show();var iClientWidth=oSaveDialog._get_Element().get_ClientWidth();var iNear;var oFilterName=Owa.PageHierarchy.getElementByIdFromTop("spnFltrNm");if(oSaveDialog._get_Element().get_OwnerDocument().get_IsRtl()){iNear=oSaveDialog._get_Element().get_OffsetWidth()-oFilterName.get_RelativeLeft(oSaveDialog._get_Element())}else{iNear=oFilterName.get_RelativeLeft(oSaveDialog._get_Element())+oFilterName.get_OffsetWidth()}oInput.set_Width(iClientWidth-iNear-40);oInput.focus(1)};Owa.UIControls.FilterInfobar.prototype._closeSaveDialog=function Owa$UIControls$FilterInfobar$_closeSaveDialog(iButtonIndex){if(iButtonIndex==0){var oName=Owa.PageHierarchy.getElementByIdFromTop("fltrNm");g_oEd.attachEvent("AddFilterToFavorites",this,"_callbackAddFilterToFavorites");g_oNvNdMgr.addFltrToFav(null,this.get_FolderId(),oName.get_Value(),this.get_VirtualListView())}};Owa.UIControls.FilterInfobar.prototype._callbackAddFilterToFavorites=function Owa$UIControls$FilterInfobar$_callbackAddFilterToFavorites(oResponse,oSender,sFolderId,sName){cbOeh(oResponse,this._createCallback(this._addFilterError),sName);g_oEd.detachEvent("AddFilterToFavorites",this,"_callbackAddFilterToFavorites")};Owa.UIControls.FilterInfobar.prototype._addFilterError=function Owa$UIControls$FilterInfobar$_addFilterError(oResponse,sName){if(oResponse.iErr==27)this._showSaveDialog(sName)};Owa.UIControls.FilterInfobar.prototype.get_IsEnabled=function Owa$UIControls$FilterInfobar$get_IsEnabled(){return this._isEnabled};Owa.UIControls.FilterInfobar.prototype._set_IsEnabled=function Owa$UIControls$FilterInfobar$_set_IsEnabled(oValue){this._isEnabled=oValue};Owa.UIControls.FilterInfobar.prototype.show=function Owa$UIControls$FilterInfobar$show(){if(!this._get_Element())this._createElement();var oMain=this._get_Element().get_FirstChild();var oDescription=oMain.get_FirstChild();var oSearchBox=this.get_SubPage()._getDescendant("divSearchBox");var oListView=this.get_SubPage()._getDescendant("divLV");Owa.Components.ToolbarCollection.get(this.get_SubPage()).getButton("fltrc").set_IsPushed(true,true);Owa.Components.ToolbarCollection.get(this.get_SubPage()).getButton("fltrc")._get_Element().set_Title(this.get_FilterDescription());oDescription.get_FirstChild().set_TextContent(this.get_FilterDescription());if(this.get_SearchControl()){this.get_SearchControl()._setSearchScopeIconStyle();this.get_SearchControl()._updateScopeText()}this._originalSearchBoxMarginTop=oSearchBox._getEffectiveMargin(Owa.Style.Side.Top);this._iMarginTop=0;this._set_IsEnabled(true);this._get_Element().set_IsShown(true);this._reposition();this.resize()};Owa.UIControls.FilterInfobar.prototype.hide=function Owa$UIControls$FilterInfobar$hide(){if(!this._get_Element())return;var oFilterInfoBar=this._get_Element();var oSearchBox=this.get_SubPage()._getDescendant("divSearchBox");var oListView=this.get_SubPage()._getDescendant("divLV");if(this.get_SearchControl()){this.get_SearchControl()._setSearchScopeIconStyle();this.get_SearchControl()._updateScopeText()}oFilterInfoBar.set_IsShown(false);Owa.Components.ToolbarCollection.get(this.get_SubPage()).getButton("fltrc").set_IsPushed(false);oSearchBox.set_Margin(Owa.Style.Side.Top,this._originalSearchBoxMarginTop);oListView.set_Top(oSearchBox._get_OffsetTop()+oSearchBox.get_OffsetHeight());this._set_IsEnabled(false)};Owa.UIControls.FilterInfobar.prototype._windowResize=function Owa$UIControls$FilterInfobar$_windowResize(){this._reposition()};Owa.UIControls.FilterInfobar.prototype._reposition=function Owa$UIControls$FilterInfobar$_reposition(){if(!this._get_Element()||!this.get_IsEnabled())return;var oFilterInfoBar=this._get_Element();oFilterInfoBar.set_IsShown(false);var oSearchInputBox=this.get_SubPage()._getDescendant("txtS");var oFilterButton=this.get_SubPage()._getDescendant("fltrc").get_ParentElement();var oParentElement=this._get_Element().get_ParentElement();var iNear=oSearchInputBox.get_DocumentLeft()-oParentElement.get_DocumentLeft();var iTop=oFilterButton.get_DocumentTop()+oFilterButton.get_OffsetHeight()-oParentElement.get_DocumentTop()-1;if(this._get_Element().get_OwnerDocument().get_IsRtl()){iNear+=oSearchInputBox.get_OffsetWidth();iNear=oParentElement.get_OffsetWidth()-iNear;oFilterInfoBar.set_Right(iNear)}else{oFilterInfoBar.set_Left(iNear)}oFilterInfoBar.set_Top(iTop);oFilterInfoBar.set_IsShown(true)};Owa.UIControls.FilterInfobar.prototype.resize=function Owa$UIControls$FilterInfobar$resize(){if(!this._get_Element()||!this.get_IsEnabled())return;var oFilterInfoBar=this._get_Element();var oFilterButton=this.get_SubPage()._getDescendant("fltrc").get_ParentElement();var oFilterDropDownButton=this.get_SubPage()._getDescendant("fltrcd").get_ParentElement();var oSearchBox=this.get_SubPage()._getDescendant("divSearchBox");var oSearchInputBox=this.get_SubPage()._getDescendant("txtS");var oMain=oFilterInfoBar.get_FirstChild();var oDescription=oMain.get_FirstChild();var oCover=oDescription.get_NextSibling().get_NextSibling();var iMarginTop=this._iMarginTop?this._iMarginTop:oFilterInfoBar.get_OffsetHeight()+oFilterInfoBar.get_RelativeTop(oSearchBox)+2+this._originalSearchBoxMarginTop;var iCoverWidth=oFilterButton.get_OffsetWidth()-2;var iFilterInfoBarWidth=oSearchBox.get_OffsetWidth()-4;var oListView=this.get_SubPage()._getDescendant("divLV");if(oFilterInfoBar.get_OwnerDocument().get_IsRtl()){iFilterInfoBarWidth-=oSearchBox.get_DocumentLeft()+oSearchBox.get_OffsetWidth()-oSearchInputBox.get_DocumentLeft()-oSearchInputBox.get_OffsetWidth()}else{iFilterInfoBarWidth-=oSearchInputBox.get_RelativeLeft(oSearchBox)}oFilterInfoBar.set_Width(iFilterInfoBarWidth);if(oFilterInfoBar.get_OwnerDocument().get_IsRtl()){var iCoverNear=oFilterButton.get_RelativeLeft(oFilterInfoBar)+oFilterButton.get_OffsetWidth();iCoverNear=oFilterInfoBar.get_OffsetWidth()-iCoverNear;oCover.set_Right(iCoverNear)}else{var iCoverNear=oFilterButton.get_RelativeLeft(oFilterInfoBar);oCover.set_Left(iCoverNear)}oCover.set_Width(iCoverWidth);oSearchBox.set_Margin(Owa.Style.Side.Top,iMarginTop);this._iMarginTop=iMarginTop;oListView.set_Top(oSearchBox._get_OffsetTop()+oSearchBox.get_OffsetHeight())};Owa.UIControls.FilterInfobar.createClass("Owa.UIControls.FilterInfobar",Owa.UIControls.UIControl)})();g_fModuleLoaded[".\\uicontrols/FilterInfobar.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/FilterContextMenu.js".toLowerCase()])(function(){Type.createNamespace("Owa.UIControls");var CHECKED_IMAGE="mtg-accept.png";var UNCHECKED_IMAGE="clear.gif";var RECIPIENT_WELL_ID="divFltrRw";var MIN_NOWRAP_WIDTH=30;Owa.UIControls.FilterContextMenu=function Owa$UIControls$FilterContextMenu(oSubPage){Owa.UIControls.FilterContextMenu.constructBase(this);this.set_SubPage(oSubPage);this.get_OnSelect().add(this._createCallback(this._onSelectMenuItem));this.get_OnClose().add(this._createCallback(this._onClose));this.get_OnPreShow().add(this._createCallback(this._onPreShow));this._oFilterCriteria=new Owa.Components.FilterCriteria()};Owa.UIControls.FilterContextMenu.prototype._onSelectMenuItem=function Owa$UIControls$FilterContextMenu$_onSelectMenuItem(oEventArgs){var sCommand=oEventArgs.sCommand;var oMenuItem=oEventArgs.oMenuItem;var oHashtable={};oHashtable.tome="_IsSendToMe";oHashtable.ccme="_IsCcToMe";oHashtable.unread="_IsUnread";oHashtable.flagged="_IsFlagged";oHashtable.highimp="_IsHighImportant";oHashtable.attachments="_HasAttachments";switch(sCommand){case"tome":case"ccme":case"unread":case"flagged":case"highimp":case"attachments":var sSuffix=oHashtable[sCommand];this._oFilterCriteria["set"+sSuffix](!this._oFilterCriteria["get"+sSuffix]());this.replaceMenuItemIcon(oMenuItem.get_Id(),this._oFilterCriteria["get"+sSuffix]()?CHECKED_IMAGE:UNCHECKED_IMAGE);break;default:if(sCommand.startsW("fltrrcp")){var oRecipient=crtRecipObjectFromDomObject(oMenuItem);var oRecipientWell=this._get_RecipientWell();oRecipientWell.set_Recipients([oRecipient]);Owa.UIControls.AutoCompleteCache.hide();this._updateRecipient(oRecipient)}else if(sCommand.startsW("cat:")){var fChecked=!oMenuItem.getExpando("_chkd");oMenuItem.setExpando("_chkd",fChecked);this.replaceMenuItemIcon(oMenuItem.get_Id(),fChecked?"chk-chkd.gif":"chk-unchk.gif");if(fChecked){var sName=sCommand.substring(4);var oSpnT=oMenuItem.getDescendantById("spnT");if(oSpnT.get_FirstChild().get_Title())this._oFilterCriteria.add_Category(sName,oSpnT.get_FirstChild().get_FirstChild().get_OuterHtml());else this._oFilterCriteria.add_Category(sName,oSpnT.get_FirstChild().get_OuterHtml())}else{var sName=sCommand.substring(4);this._oFilterCriteria.remove_Category(sName)}this._updateCategoryMenuItem()}break}this._toggleApplyButton();return 1};Owa.UIControls.FilterContextMenu.prototype._get_RecipientWell=function Owa$UIControls$FilterContextMenu$_get_RecipientWell(){return this.get_FromMenu()._getDescendant(RECIPIENT_WELL_ID).getExpando("_oControl")};Owa.UIControls.FilterContextMenu.prototype._updateRecipient=function Owa$UIControls$FilterContextMenu$_updateRecipient(oRecipient){var sName=oRecipient?(oRecipient._ao==AO_D?oRecipient._dn:oRecipient._em):"";if(sName){this._oFilterCriteria.set_Recipient(sName);this._oFilterCriteria.set_RecipientWellInnerHtml(this._get_RecipientWell().get_Html())}else{this._oFilterCriteria.set_Recipient("");this._oFilterCriteria.set_RecipientWellInnerHtml(" ")}this._updateRecipientMenuItem(false)};Owa.UIControls.FilterContextMenu.prototype._updateMenu=function Owa$UIControls$FilterContextMenu$_updateMenu(){this.replaceMenuItemIcon("_divToMe",this._oFilterCriteria.get_IsSendToMe()?CHECKED_IMAGE:UNCHECKED_IMAGE);this.replaceMenuItemIcon("_divCCMe",this._oFilterCriteria.get_IsCcToMe()?CHECKED_IMAGE:UNCHECKED_IMAGE);this.replaceMenuItemIcon("_divUnread",this._oFilterCriteria.get_IsUnread()?CHECKED_IMAGE:UNCHECKED_IMAGE);this.replaceMenuItemIcon("_divFlg",this._oFilterCriteria.get_IsFlagged()?CHECKED_IMAGE:UNCHECKED_IMAGE);this.replaceMenuItemIcon("_divHI",this._oFilterCriteria.get_IsHighImportant()?CHECKED_IMAGE:UNCHECKED_IMAGE);this.replaceMenuItemIcon("_divAtt",this._oFilterCriteria.get_HasAttachments()?CHECKED_IMAGE:UNCHECKED_IMAGE);this._updateRecipientMenuItem(true);this._updateCategoryMenuItem();this._updateCategorySubMenu();this._resizeContainer()};Owa.UIControls.FilterContextMenu.prototype._updateRecipientMenuItem=function Owa$UIControls$FilterContextMenu$_updateRecipientMenuItem(fUpdateRecipientWell){var sName=this._oFilterCriteria.get_Recipient();var oMenuItem=this._getDescendant("_divRp");var oSpnT=oMenuItem.getDescendantById("spnT");this.replaceMenuItemIcon(oMenuItem.get_Id(),sName?CHECKED_IMAGE:UNCHECKED_IMAGE);oSpnT.addCssClass("fltrRpMI");var fShowTo=this.get_SubPage().get_FilterRecipientName()=="sTo";var sText=fShowTo?L_ToColonWithParam:L_FromColonWithParam;oSpnT.set_TextContent(sText.format(sName));if(oSpnT.get_OffsetWidth()>this._width-54)oSpnT.set_Width(this._width-54);this._adjustSpacerWidth(oMenuItem);if(fUpdateRecipientWell){var oRecipientWell=this._get_RecipientWell();oRecipientWell.set_Html(this._oFilterCriteria.get_RecipientWellInnerHtml())}};Owa.UIControls.FilterContextMenu.prototype._updateCategoryMenuItem=function Owa$UIControls$FilterContextMenu$_updateCategoryMenuItem(){var oMenu=this._get_Element();var oMenuItem=oMenu.getDescendantById("_divCat");var oSpnT=oMenuItem.getDescendantById("spnT");oSpnT.set_TextContent(L_CatWith);oSpnT.insertAdjacentHtml(Owa.ElementInsertionPoint.BeforeEnd,"&nbsp;");for(var iIndex=0;iIndex<this._oFilterCriteria.get_CategoryCount()&&iIndex<3;iIndex++)oSpnT.insertAdjacentHtml(Owa.ElementInsertionPoint.BeforeEnd,this._oFilterCriteria.get_Category(iIndex).html);this._adjustSpacerWidth(oMenuItem);this.replaceMenuItemIcon(oMenuItem.get_Id(),this._oFilterCriteria.get_HasCategories()?CHECKED_IMAGE:UNCHECKED_IMAGE)};Owa.UIControls.FilterContextMenu.prototype._updateCategorySubMenu=function Owa$UIControls$FilterContextMenu$_updateCategorySubMenu(){var rgNames=this._oFilterCriteria.get_CategoryNames();var oCategoryMenu=this.get_CategoryMenu();var oFilterMenu=this;this._oFilterCriteria.clear_Categories();oCategoryMenu._get_Element().forEachChild(function(oElement){var sCommand=oElement.getAttribute("cmd");if(!sCommand)return;if(oElement.getAttribute("_lnk")&&sCommand&&sCommand.startsW("cat:")){var sName=sCommand.substring(4);var iIndex=rgNames.indexOf(sName);if(iIndex>=0){var oSpnT=oElement.getDescendantById("spnT");if(oSpnT.get_FirstChild().get_Title())oFilterMenu._oFilterCriteria.add_Category(sName,oSpnT.get_FirstChild().get_FirstChild().get_OuterHtml());else oFilterMenu._oFilterCriteria.add_Category(sName,oSpnT.get_FirstChild().get_OuterHtml())}oElement.setExpando("_chkd",iIndex>=0);oFilterMenu.replaceMenuItemIcon(oElement.get_Id(),iIndex>=0?"chk-chkd.gif":"chk-unchk.gif")}});var oOtherCategoryMenu=this.get_OtherCategoryMenu();if(oOtherCategoryMenu){oOtherCategoryMenu._get_Element().forEachChild(function(oElement){var sCommand=oElement.getAttribute("cmd");if(!sCommand)return;if(oElement.getAttribute("_lnk")&&sCommand&&sCommand.startsW("cat:")){var sName=sCommand.substring(4);var iIndex=rgNames.indexOf(sName);if(iIndex>=0){var oSpnT=oElement.getDescendantById("spnT");if(oSpnT.get_FirstChild().get_Title())oFilterMenu._oFilterCriteria.add_Category(sName,oSpnT.get_FirstChild().get_FirstChild().get_OuterHtml());else oFilterMenu._oFilterCriteria.add_Category(sName,oSpnT.get_FirstChild().get_OuterHtml())}oElement.setExpando("_chkd",iIndex>=0);oFilterMenu.replaceMenuItemIcon(oElement.get_Id(),iIndex>=0?"chk-chkd.gif":"chk-unchk.gif")}})}};Owa.UIControls.FilterContextMenu.prototype.set_FilterButton=function Owa$UIControls$FilterContextMenu$set_FilterButton(oFilterButton){this._oFilterButton=oFilterButton};Owa.UIControls.FilterContextMenu.prototype.set_FilterCriteria=function Owa$UIControls$FilterContextMenu$set_FilterCriteria(oValue){this._oFilterCriteria=oValue.clone()};Owa.UIControls.FilterContextMenu.prototype.get_FilterCriteria=function Owa$UIControls$FilterContextMenu$get_FilterCriteria(){return this._oFilterCriteria.clone()};Owa.UIControls.FilterContextMenu.prototype.get_FromMenu=function Owa$UIControls$FilterContextMenu$get_FromMenu(){return this._oSubmenus["divFltrFrmMnu"]};Owa.UIControls.FilterContextMenu.prototype.get_CategoryMenu=function Owa$UIControls$FilterContextMenu$get_CategoryMenu(){return this._oSubmenus["divFltrCat"]};Owa.UIControls.FilterContextMenu.prototype.close=function Owa$UIControls$FilterContextMenu$close(){if(this._get_Element())Owa.UIControls.FilterContextMenu.callBase(this,"close",arguments)};Owa.UIControls.FilterContextMenu.prototype.get_OtherCategoryMenu=function Owa$UIControls$FilterContextMenu$get_OtherCategoryMenu(){return this._oSubmenus["divFltrCat"]._oSubmenus["divFltrCatO"]};Owa.UIControls.FilterContextMenu.prototype._onClose=function Owa$UIControls$FilterContextMenu$_onClose(){if(this._oFilterButton){if(!this.get_SubPage()._oFilterInfobar.get_IsEnabled()){this._oFilterButton.set_IsPushed(false)}else{this._oFilterButton.set_IsPushed(false);this._oFilterButton.set_IsPushed(true,true)}}this.dispose()};Owa.UIControls.FilterContextMenu.prototype._width=200;Owa.UIControls.FilterContextMenu.prototype._enableClose=function Owa$UIControls$FilterContextMenu$_enableClose(){if(this.get_FromMenu().fIsOpen)this.get_FromMenu()._enableClose();else Owa.UIControls.FilterContextMenu.callBase(this,"_enableClose",arguments)};Owa.UIControls.FilterContextMenu.prototype.get_VirtualListView=function Owa$UIControls$FilterContextMenu$get_VirtualListView(){return this.get_SubPage().get_VirtualListView()};Owa.UIControls.FilterContextMenu.prototype.get_SearchControl=function Owa$UIControls$FilterContextMenu$get_SearchControl(){return this.get_SubPage().get_SearchControl()};Owa.UIControls.FilterContextMenu.prototype._hideSubmenu=function Owa$UIControls$FilterContextMenu$_hideSubmenu(){var fHideFromMenu=this._oCurrentSubmenu==this.get_FromMenu();if(fHideFromMenu)this.get_FromMenu()._fStick=true;Owa.UIControls.FilterContextMenu.callBase(this,"_hideSubmenu",arguments);this._toggleApplyButton();if(fHideFromMenu){this._addTextBoxEventHandlers();this._enableClose();this.get_FromMenu()._fStick=false}};Owa.UIControls.FilterContextMenu.prototype._initializeDomElement=function Owa$UIControls$FilterContextMenu$_initializeDomElement(){Owa.UIControls.FilterContextMenu.callBase(this,"_initializeDomElement",arguments);var oCategoryMenuItem=this._getDescendant("_divCat");var oRecipientWellMenuItem=this._getDescendant("_divRp");this._get_Element().set_Width(this._width);this._attachEvent(oRecipientWellMenuItem,"click",this._menuItemRecipientClick);this._attachEvent(oCategoryMenuItem,"click",this._menuItemCategoryClick);this._attachEvent(this._getDescendant("btnFltrApp"),"click",this._buttonApplyClick);this._attachEvent(this._getDescendant("btnFltrCcl"),"click",this._buttonCancelClick)};Owa.UIControls.FilterContextMenu.prototype._toggleApplyButton=function Owa$UIControls$FilterContextMenu$_toggleApplyButton(){var fDisable=!this._oFilterCriteria.get_isValid();var oButton=this._getDescendant("btnFltrApp");oButton.set_IsDisabled(fDisable);if(!fDisable){if(!Owa.Utility.isIE())oButton.removeCssClass("dsbl")}else{oButton.removeCssClass("btnHvr");if(!Owa.Utility.isIE())oButton.addCssClass("dsbl")}};Owa.UIControls.FilterContextMenu.prototype._onPreShow=function Owa$UIControls$FilterContextMenu$_onPreShow(){var oCategoryMenuItem=this._getDescendant("_divCat");this._updateMenu();this._toggleApplyButton();if(this._oFilterButton)this._oFilterButton.set_IsPushed(true)};Owa.UIControls.FilterContextMenu.prototype._menuItemRecipientClick=function Owa$UIControls$FilterContextMenu$_menuItemRecipientClick(){if(this._oFilterCriteria.get_Recipient()){this._oFilterCriteria.set_Recipient("");this._oFilterCriteria.set_RecipientWellInnerHtml(" ");this._updateRecipientMenuItem(true);this._toggleApplyButton()}this._enableClose()};Owa.UIControls.FilterContextMenu.prototype._resizeContainer=function Owa$UIControls$FilterContextMenu$_resizeContainer(){var ictxMnuWidth=this._get_Element().get_Width();var ibtnAppWidth=this._getDescendant("btnFltrApp").get_OffsetWidth();var ibtnCclWidth=this._getDescendant("btnFltrCcl").get_OffsetWidth();var imaxButtonWidth=Math.max(ibtnAppWidth,ibtnCclWidth);if((ictxMnuWidth-MIN_NOWRAP_WIDTH)-(2*imaxButtonWidth)<0){ictxMnuWidth=MIN_NOWRAP_WIDTH+2*imaxButtonWidth;this._get_Element().set_Width(ictxMnuWidth)}};Owa.UIControls.FilterContextMenu.prototype._menuItemCategoryClick=function Owa$UIControls$FilterContextMenu$_menuItemCategoryClick(){this._oFilterCriteria.clear_Categories();this._updateCategorySubMenu();this._updateCategoryMenuItem();this._toggleApplyButton()};Owa.UIControls.FilterContextMenu.prototype._buttonCancelClick=function Owa$UIControls$FilterContextMenu$_buttonCancelClick(){this.close()};Owa.UIControls.FilterContextMenu.prototype._buttonApplyClick=function Owa$UIControls$FilterContextMenu$_buttonApplyClick(){if(this.get_SearchControl()){this._suppressClose(true);this.get_SearchControl().clearSearch(1)}this.get_VirtualListView().fltrVw(this.get_FilterCriteria(),_callbackFilterView);this.close()};function _callbackFilterView(oListView,oResponse){if(oListView.isInFltrdVw()){if(oResponse){if(oListView.get_SearchControl())oListView.get_SearchControl().clearSearch(1);var oDiv=Owa.Dom.Document.get_Current().createElement("DIV");oDiv.set_InnerHtml(oResponse.sBody);var oDescriptionDiv=oDiv.getDescendantById("fltrDesc");if(oDescriptionDiv){var sFilterInfo=oDescriptionDiv.get_TextContent();oListView.get_SubPage()._oFilterInfobar.set_FilterDescription(sFilterInfo)}}oListView.get_SubPage()._oFilterInfobar.hide();oListView.get_SubPage()._oFilterInfobar.show()}else{oListView.get_SubPage()._oFilterInfobar.hide()}}Owa.UIControls.FilterContextMenu.prototype._createLoadHtmlContentRequest=function Owa$UIControls$FilterContextMenu$_createLoadHtmlContentRequest(fnCallback){return new oeReq("MsgVLV2","GetFilterMenu",0,fnCallback)};Owa.UIControls.FilterContextMenu.prototype._createSubmenu=function Owa$UIControls$FilterContextMenu$_createSubmenu(oSubmenuElement){if(oSubmenuElement.get_Id()=="divFltrFrmMnu"){var oContextMenu=Owa.UIControls.FilterRecipientContextMenu.create(oSubmenuElement,this,this.get_SubPage());oContextMenu.set_FilterMenu(this);return oContextMenu}else{return Owa.UIControls.FilterContextMenu.callBase(this,"_createSubmenu",arguments)}};Owa.UIControls.FilterContextMenu.createClass("Owa.UIControls.FilterContextMenu",Owa.UIControls.LazyLoadContextMenu)})();g_fModuleLoaded[".\\uicontrols/FilterContextMenu.js".toLowerCase()]=1;var SearchScope={SS_FLD:0,SS_FLDSUB:1,SS_FLDMOD:2,SS_FLDALL:3};if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/searchcontrol.js".toLowerCase()])(function(){var SearchState={SI_IA:0,SI_A:1,SI_H:2,SI_D:3};var _rgSIC=new Array("iactv","actv","hvr","iactv dsbl");Owa.UIControls.SearchControl=function Owa$UIControls$SearchControl(oSubPage,oElement){Owa.UIControls.SearchControl.constructBase(this,[oElement]);this.set_SubPage(oSubPage);this._oSearchControl=this._getDescendant("divSearch");this._clearControls(false);this.iDftSS;this.iScope;this.sSearchText;this.iResultsIn;this.iRecipientField;this.sRecipient;this.sCategory;this.fReExecuteSearch=true;this._fFirstShowAdvancedSearch=true;this.fAsyncSearchEnabled=oSubPage.get_VirtualListView().isAsyncSrchEnabled()};Owa.UIControls.SearchControl.prototype.initialize=function Owa$UIControls$SearchControl$initialize(){if(this._oSearchControl){this._oSearchInputBox=this._getDescendant("divSearch");this._oSearchTextBox=this._getDescendant("txtS");this._attachEvent(this._oSearchTextBox,"keyup",this._onKeyUpHandler);this._attachEvent(this._oSearchTextBox,"click",this._onClickHandler);this._attachEvent(this._oSearchTextBox,"focus",this._onClickHandler);this._attachEvent(this._oSearchTextBox,"blur",this._onFocusOutHandler);this._oSearchIcon=this._getDescendant("divSIcon");this._attachEvent(this._oSearchIcon,"click",this._onClickSearchIcon);this._attachEvent(this._oSearchIcon,"mouseover",this._onMouseOverSearchIcon);this._attachEvent(this._oSearchIcon,"mouseout",this._onMouseOutSearchIcon);this._oSearchDropDown=this._getDescendant("divSScp");if(this._oSearchDropDown){this._attachEvent(this._oSearchDropDown,"click",this._showSearchScopeMenu);this._attachEvent(this._oSearchDropDown,"mouseover",this._onMouseOverScope);this._attachEvent(this._oSearchDropDown,"mouseout",this._onMouseOutScopeMenu)}if(this._isAdvancedSearchPresent()){this._oAdvancedSearch=this._getDescendant("divASChevron");this._oShowAdvancedSearch=this._getDescendant("imgSAS");this._oHideAdvancedSearch=this._getDescendant("imgHAS");this._attachEvent(this._oAdvancedSearch,"click",this._onClickAdvancedSearch);this._oAdvancedSearch.setExpando("fE",0)}this.fixSearchControlStyles()}};Owa.UIControls.SearchControl.prototype.dispose=function Owa$UIControls$SearchControl$dispose(){this._clearControls(true);Owa.UIControls.SearchControl.callBase(this,"dispose")};Owa.UIControls.SearchControl.prototype.get_VirtualListView=function Owa$UIControls$SearchControl$get_VirtualListView(){return this.get_SubPage().get_VirtualListView()};Owa.UIControls.SearchControl.prototype._clearControls=function Owa$UIControls$SearchControl$_clearControls(fDispose){this._oSearchTextBox=null;this._oSearchIcon=null;this._oSearchDropDown=null;this._oContentIndexingDisabled=null;this._oShowAdvancedSearch=null;this._oHideAdvancedSearch=null;if(fDispose&&this._oSearchScopeMenu)this._oSearchScopeMenu.dispose();this._oSearchScopeMenu=null;this._oAdvancedSearch=null;this._oAdvancedSearchDiv=null;this._oResultsInCheckBox=null;if(fDispose&&this._oResultsInComboBox)this._oResultsInComboBox.dispose();this._oResultsInComboBox=null;this._oRecipientCheckBox=null;if(fDispose&&this._oRecipientComboBox)this._oRecipientComboBox.dispose();this._oRecipientComboBox=null;this._oRecipientTextBox=null;this._oSubjectCheckBox=null;this._oSubjectTextBox=null;this._oCategoryCheckBox=null;if(fDispose&&this._oCategoryComboBox)this._oCategoryComboBox.dispose();this._oCategoryComboBox=null;this._oAdvancedSearchButton=null};Owa.UIControls.SearchControl.prototype._isAdvancedSearchPresent=function Owa$UIControls$SearchControl$_isAdvancedSearchPresent(){if(!this._oAdvancedSearch)this._oAdvancedSearch=this._getDescendant("divASChevron");return(this._oAdvancedSearch!=null)};Owa.UIControls.SearchControl.prototype._isAdvancedSearchPresentAndExpanded=function Owa$UIControls$SearchControl$_isAdvancedSearchPresentAndExpanded(){if(!this._oAdvancedSearch)this._oAdvancedSearch=this._getDescendant("divASChevron");if(!this.oCategoryCheckBox)this.oCategoryCheckBox=this._getDescendant("chkCat");return(this._oAdvancedSearch&&this._oAdvancedSearch.getExpando("fE")&&this.oCategoryCheckBox)};Owa.UIControls.SearchControl.prototype._onKeyUpHandler=function Owa$UIControls$SearchControl$_onKeyUpHandler(e){var iK=e.get_KeyCodeForKeyUpDown();if(iK==13){this._search()}else{this._setSearchScopeIconStyle()}};Owa.UIControls.SearchControl.prototype._onClickHandler=function Owa$UIControls$SearchControl$_onClickHandler(e){if(this._oSearchTextBox.getAttribute("fScp")=="1"){this._oSearchTextBox.setAttribute("fScp","0");this._oSearchTextBox.set_Value("");this._oSearchTextBox.set_CssClasses([""])}this._oSearchTextBox.focus()};Owa.UIControls.SearchControl.prototype._onFocusOutHandler=function Owa$UIControls$SearchControl$_onFocusOutHandler(e){var sValue=this._oSearchTextBox.get_Value();if(!sValue||!sValue.trim().length)this._updateScopeText();this._setSearchScopeIconStyle()};Owa.UIControls.SearchControl.prototype._updateScopeText=function Owa$UIControls$SearchControl$_updateScopeText(){if(!this._oSearchControl.getAttribute("L_Fld")){this._oSearchTextBox.set_Value("");return}var s;var sFolderName=this._oSearchControl.getAttribute("sFldNm");if(this.get_SubPage().IsFilterInFavorites()){s=this._oSearchControl.getAttribute("L_Fld").format(sFolderName)}else{switch(this._oSearchControl.getIntAttribute("iScp")){case SearchScope.SS_FLD:s=this._oSearchControl.getAttribute("L_Fld").format(sFolderName);break;case SearchScope.SS_FLDSUB:s=this._oSearchControl.getAttribute("L_FldSub").format(sFolderName);break;case SearchScope.SS_FLDMOD:s=this._oSearchControl.getAttribute("L_Mod");break;case SearchScope.SS_FLDALL:s=this._oSearchControl.getAttribute("L_FldAll");break}}this._oSearchTextBox.set_Value(s);this._oSearchTextBox.setAttribute("fScp","1");this._oSearchTextBox.set_CssClasses(["inactv"])};Owa.UIControls.SearchControl.prototype._onMouseOverScope=function Owa$UIControls$SearchControl$_onMouseOverScope(){if(this.get_SubPage().IsFilterInFavorites())return;this._setSearchScopeIconState(SearchState.SI_H)};Owa.UIControls.SearchControl.prototype._onMouseOutScopeMenu=function Owa$UIControls$SearchControl$_onMouseOutScopeMenu(){if(this.get_SubPage().IsFilterInFavorites())return;if(this._oSearchScopeMenu&&this._oSearchScopeMenu.get_IsShown())return;this._setSearchScopeIconState(this._isSearchCriterionSet()||this.get_VirtualListView().isFltrd()?SearchState.SI_A:SearchState.SI_IA)};Owa.UIControls.SearchControl.prototype._onMouseOverSearchIcon=function Owa$UIControls$SearchControl$_onMouseOverSearchIcon(){if(this._isSearchCriterionSet())this._setSearchIconState(SearchState.SI_H)};Owa.UIControls.SearchControl.prototype._onMouseOutSearchIcon=function Owa$UIControls$SearchControl$_onMouseOutSearchIcon(){if(this._isSearchCriterionSet())this._setSearchIconState(SearchState.SI_A)};Owa.UIControls.SearchControl.prototype._setSearchIconState=function Owa$UIControls$SearchControl$_setSearchIconState(iS){var sClassName=this._oSearchIcon.get_CssClasses()[0]+" "+_rgSIC[iS];this._oSearchIcon.set_CssClasses([sClassName]);if(this._oAdvancedSearchButton){if(iS==0){btnOnMsOutBtn(this._oAdvancedSearchButton._get_DomNode());this._oAdvancedSearchButton.set_IsDisabled(true);this._oAdvancedSearchButton.set_CssClasses(["dsbl"])}else{this._oAdvancedSearchButton.set_IsDisabled(false);this._oAdvancedSearchButton.set_CssClasses([""])}}};Owa.UIControls.SearchControl.prototype._setSearchScopeIconState=function Owa$UIControls$SearchControl$_setSearchScopeIconState(iS){if(!this._oSearchDropDown)this._oSearchDropDown=this._getDescendant("divSScp");this._oSearchDropDown.set_CssClasses(["scp "+_rgSIC[iS]])};Owa.UIControls.SearchControl.prototype._setSearchScopeIconStyle=function Owa$UIControls$SearchControl$_setSearchScopeIconStyle(){this._setSearchActions(!this.get_VirtualListView().isFltrd()||(this._isSearchCriterionSet()&&this._isSearchCriterionDifferent()));var iS=this._isSearchCriterionSet()||this.get_VirtualListView().isFltrd()?SearchState.SI_A:SearchState.SI_IA;this._setSearchIconState(iS);if(this._oSearchDropDown){if(this.get_SubPage().IsFilterInFavorites())this._setSearchScopeIconState(SearchState.SI_D);else this._setSearchScopeIconState(iS)}if(!this._oContentIndexingDisabled)this._oContentIndexingDisabled=this._getDescendant("divDsblCI");if(this._oContentIndexingDisabled)this._oContentIndexingDisabled.set_IsShown(iS==SearchState.SI_IA)};Owa.UIControls.SearchControl.prototype._showSearchScopeMenu=function Owa$UIControls$SearchControl$_showSearchScopeMenu(){if(this.get_SubPage().IsFilterInFavorites())return;if(!this._oSearchScopeMenu){var oR=new oeReq(this.get_VirtualListView().sEvtNS,"GetSearchScopeMenu",null,Owa.Utility.createDelegate(this,this._cbGetSearchScopeMenu),GET);oR.add("fId",this.get_VirtualListView().sSid);oR.send()}else{var iMenuWidth=this._oSearchScopeMenu.get_Width();this._oSearchScopeMenu.show(this._oSearchDropDown.get_DocumentLeft()+(g_fRtl?iMenuWidth:(this._oSearchDropDown.get_OffsetWidth()-iMenuWidth)),this._oSearchDropDown.get_DocumentTop()+this._oSearchDropDown.get_ClientHeight()+2);this._oSearchScopeMenu.selectMenuItemByAttribute("cmd",this._oSearchControl.getAttribute("iScp"))}};Owa.UIControls.SearchControl.prototype._cbGetSearchScopeMenu=function Owa$UIControls$SearchControl$_cbGetSearchScopeMenu(oR){if(!cbOeh(oR))return;if(!this._oSearchScopeMenu){eval(oR.sBody);this._oSearchScopeMenu=Owa.UIControls.ContextMenu.createFromHtml(sSM,true,this.get_SubPage());this._oSearchScopeMenu.get_OnSelect().add(Owa.Utility.createDelegate(this,this._onSelectSearchScopeMenu));this.iDftSS=g_iDftSS}this._showSearchScopeMenu()};Owa.UIControls.SearchControl.prototype._onSelectSearchScopeMenu=function Owa$UIControls$SearchControl$_onSelectSearchScopeMenu(sC){sC=sC.sCommand;var iS=sC;if(sC.startsW('d')){iS=getInt(sC.substring(1));if(iS==this.iDftSS)return;this._saveDefaultSearchScope(iS);var oSearchImage=this._oSearchScopeMenu._oSubmenus.divDftScpMnu._getDescendant("divFS"+this.iDftSS).getDescendantById("imgI");var oClearImage=this._oSearchScopeMenu._oSubmenus.divDftScpMnu._getDescendant("divFS"+iS).getDescendantById("imgI");oClearImage.swap(oSearchImage);this.iDftSS=iS}this._oSearchControl.setIntAttribute("iScp",parseInt(iS));if(this._oSearchTextBox.getAttribute("fScp")=="1")this._updateScopeText();if(this.get_VirtualListView().isFltrd())this._search()};Owa.UIControls.SearchControl.prototype._onHideSearchScopeMenu=function Owa$UIControls$SearchControl$_onHideSearchScopeMenu(){this._onMouseOutScopeMenu()};Owa.UIControls.SearchControl.prototype._saveDefaultSearchScope=function Owa$UIControls$SearchControl$_saveDefaultSearchScope(iS){var oR=new oeReq(this.get_VirtualListView().sEvtNS,"PSS",0,cbOeh);oR.add("scp",iS);oR.add("fId",this.get_VirtualListView().sSid);oR.send()};Owa.UIControls.SearchControl.prototype._onClickSearchIcon=function Owa$UIControls$SearchControl$_onClickSearchIcon(){if(this.get_VirtualListView().isFltrd()&&this._oSearchIcon.getExpando("fClr")){this.clearSearch()}else{this._search()}};Owa.UIControls.SearchControl.prototype._search=function Owa$UIControls$SearchControl$_search(){if(!this._isSearchCriterionSet())return;this.fReExecuteSearch=true;this.iScope=this.sSearchText=this.iResultsIn=this.iRecipientField=this.sRecipient=this.sCategory=null;var sValue=this._oSearchTextBox.get_Value();var sScope=this._oSearchTextBox.getAttribute("fScp");if(sValue&&sValue.trim().length&&(sScope=="0"||!sScope))this.sSearchText=sValue;if(this.get_VirtualListView().isFldr()){this.iScope=this._oSearchControl.getIntAttribute("iScp");if(this._isAdvancedSearchPresentAndExpanded()){if(this._oCategoryCheckBox.get_IsChecked())this.sCategory=this._oCategoryComboBox.get_SelectedValue();if(this.get_VirtualListView().iT==LVT_MSG){if(this._oResultsInCheckBox&&this._oResultsInCheckBox.get_IsChecked()){this.iResultsIn=this._oResultsInComboBox.get_SelectedValue()}var sValue=this._oRecipientTextBox.get_Value();if(this._oRecipientCheckBox.get_IsChecked()&&this._oRecipientTextBox&&sValue&&sValue.trim().length){this.iRecipientField=this._oRecipientComboBox.get_SelectedValue();this.sRecipient=sValue}}if(this._oSubjectCheckBox&&this._oSubjectCheckBox.get_IsChecked()){var sValue=this._oSubjectTextBox?this._oSubjectTextBox.get_Value():null;if(sValue&&sValue.trim().length){this.sSearchText=this._oSubjectTextBox.get_Value();this._oSearchTextBox.set_Value(this.sSearchText);this._oSearchTextBox.setAttribute("fScp","0");this.iResultsIn="1"}}}}this.get_VirtualListView().find();this._get_Element().set_CssClasses([_rgSIC[SearchState.SI_A]]);this._setSearchActions(0);if(!this._oContentIndexingDisabled)this._oContentIndexingDisabled=this._getDescendant("divDsblCI");if(this._oContentIndexingDisabled)this._oContentIndexingDisabled.set_IsShown(true)};Owa.UIControls.SearchControl.prototype.clearSearch=function Owa$UIControls$SearchControl$clearSearch(fSR){if(!this.get_VirtualListView().isFltrd())return;this.get_VirtualListView().clrFind(fSR);if(!this._oContentIndexingDisabled)this._oContentIndexingDisabled=this._getDescendant("divDsblCI");if(this._oContentIndexingDisabled)this._oContentIndexingDisabled.set_IsShown(false);this._get_Element().set_CssClasses([_rgSIC[SearchState.SI_IA]]);if(this._isAdvancedSearchPresentAndExpanded()){this._oCategoryCheckBox.set_IsChecked(false);if(this.get_VirtualListView().iT==LVT_MSG){if(this._oResultsInCheckBox)this._oResultsInCheckBox.set_IsChecked(false);this._oRecipientCheckBox.set_IsChecked(false);this._oRecipientTextBox.set_Value("")}if(this._oSubjectCheckBox){this._oSubjectCheckBox.set_IsChecked(false);this._oSubjectTextBox.set_Value("")}}this._updateScopeText();this._setSearchScopeIconStyle();this.get_VirtualListView().makeFocused()};Owa.UIControls.SearchControl.prototype._setSearchActions=function Owa$UIControls$SearchControl$_setSearchActions(f){this._oSearchIcon.setExpando("fClr",!f);var oSearchImage=this._getDescendant("imgS");if(f)Owa.Components.CssSprites.updateImage(oSearchImage,"search.png");else Owa.Components.CssSprites.updateImage(oSearchImage,"cnclsrch.gif");if(this._oAdvancedSearchButton){var oAdvancedSearchClearLabel=this._getDescendant("spnAFClr");var oAdvancedSearchSearchLabel=this._getDescendant("spnAFSch");oAdvancedSearchClearLabel.set_IsShown(!f);oAdvancedSearchSearchLabel.set_IsShown(f)}};Owa.UIControls.SearchControl.prototype.fixSearchControlStyles=function Owa$UIControls$SearchControl$fixSearchControlStyles(){this._setSearchBoxHeight();var iOffset=10;var rgoTextBoxes=[this._oSearchTextBox,this._oRecipientTextBox,this._oSubjectTextBox];var oTextBox;for(var i=0;i<rgoTextBoxes.length;i++){oTextBox=rgoTextBoxes[i];var iParentWidth;if(oTextBox){iParentWidth=oTextBox.get_ParentElement().get_OffsetWidth();if(iParentWidth>iOffset){oTextBox.set_Width(iParentWidth-iOffset)}}}};Owa.UIControls.SearchControl.prototype._setSearchBoxHeight=function Owa$UIControls$SearchControl$_setSearchBoxHeight(){this._get_Element().set_Height(this._oSearchControl.get_OffsetHeight()+8+(this._isAdvancedSearchPresentAndExpanded()?this._getAdvancedSearchHeight():0))};Owa.UIControls.SearchControl.prototype._isSearchCriterionSet=function Owa$UIControls$SearchControl$_isSearchCriterionSet(){var f=0;var sValue=this._oSearchTextBox.get_Value();var sScope=this._oSearchTextBox.getAttribute("fScp");f|=sValue&&sValue.trim().length&&(!sScope||sScope=="0");if(this._isAdvancedSearchPresentAndExpanded()){f|=this._oCategoryCheckBox.get_IsChecked();if(this.get_VirtualListView().iT==LVT_MSG&&!f){sValue=this._oRecipientTextBox.get_Value();f|=this._oRecipientCheckBox.get_IsChecked()&&sValue&&sValue.trim().length}if(this._oSubjectTextBox){sValue=this._oSubjectTextBox.get_Value();f|=this._oSubjectCheckBox.get_IsChecked()&&sValue&&sValue.trim().length}}return f};Owa.UIControls.SearchControl.prototype._isSearchCriterionDifferent=function Owa$UIControls$SearchControl$_isSearchCriterionDifferent(){var f=0;f|=(this._oSearchTextBox.getAttribute("fScp")=="1")!=(this.sSearchText==null);if(this._oSearchTextBox.getAttribute("fScp")=="0")f|=this._oSearchTextBox.get_Value()!=this.sSearchText;if(this.get_VirtualListView().isFldr()&&this._isAdvancedSearchPresentAndExpanded()){f|=this._oCategoryCheckBox.get_IsChecked()!=(this.sCategory!=null);if(this._oCategoryCheckBox.get_IsChecked())f|=this.sCategory!=this._oCategoryComboBox.get_SelectedValue();if(this.get_VirtualListView().iT==LVT_MSG){if(this._oResultsInCheckBox){f|=this._oResultsInCheckBox.get_IsChecked()!=(this.iResultsIn!=null);if(this._oResultsInCheckBox.get_IsChecked())f|=this.iResultsIn!=this._oResultsInComboBox.get_SelectedValue()}f|=this._oRecipientCheckBox.get_IsChecked()!=(this.iRecipientField!=null);if(this._oRecipientCheckBox.get_IsChecked()){f|=this.iRecipientField!=this._oRecipientComboBox.get_SelectedValue();f|=this.sRecipient!=this._oRecipientTextBox.get_Value()}}if(this._oSubjectCheckBox){f|=this._oSubjectCheckBox.get_IsChecked()!=(this.iResultsIn=="1");if(this._oSubjectCheckBox.get_IsChecked())f|=(this.sSearchText!=this._oSubjectTextBox.get_Value())}}return f};Owa.UIControls.SearchControl.prototype.togglePublicFolderAdvancedSearch=function Owa$UIControls$SearchControl$togglePublicFolderAdvancedSearch(){var oListView=this.get_SubPage()._getDescendant("divLV");if(getInt(this._oAdvancedSearch.getExpando("fE"))){this.clearSearch();this._oAdvancedSearch.setExpando("fE",0);oListView.set_Top(oListView.get_Top()-this._getAdvancedSearchHeight());this._oAdvancedSearchDiv.set_IsShown(false);this._setSearchButtonStyle("brwsfld.gif")}else{if(!getInt(this._oAdvancedSearch.getExpando("fLd"))){this._oAdvancedSearch.setExpando("fLd",1);var oR=new oeReq(this.get_VirtualListView().sEvtNS,"gtSIPF",0,Owa.Utility.createDelegate(this,this._cbGetAdvancedSearchPublicFolder),GET);oR.send();this.fixSearchControlStyles()}else{this._oAdvancedSearchButton=this._getDescendant("btnAF");if(!this._oAdvancedSearchDiv.get_FirstChild()){this._oAdvancedSearch.setExpando("fLD",0);return}this._oAdvancedSearchDiv.set_IsShown(true);this._adjustAdvancedSearch();oListView.set_Top(oListView.get_Top()+this._getAdvancedSearchHeight());this._setSearchButtonStyle("chvrnup.gif");this._oAdvancedSearch.setExpando("fE",1);this.fixSearchControlStyles()}}this._setSearchBoxHeight()};Owa.UIControls.SearchControl.prototype._adjustAdvancedSearch=function Owa$UIControls$SearchControl$_adjustAdvancedSearch(){if(!this._fFirstShowAdvancedSearch){return}this._fFirstShowAdvancedSearch=false;var rgASCol2=this._oAdvancedSearchDiv.getAllDescendantsById("divASCol2");var iMaxWidth=0;for(var iIndex=0;iIndex<rgASCol2.length;iIndex++){var iWidth=rgASCol2[iIndex]._get_OffsetLeft();if(g_fRtl){iWidth=this._oAdvancedSearchDiv.get_OffsetWidth()-iWidth}else{iWidth+=rgASCol2[iIndex].get_OffsetWidth()}iMaxWidth=Math.max(iWidth,iMaxWidth)}iMaxWidth+=3;var rgASCol3=this._oAdvancedSearchDiv.getAllDescendantsById("divASCol3");if(g_fRtl){var iRight=rgASCol3[0].get_Right();if(iMaxWidth>iRight){for(var iIndex=0;iIndex<rgASCol3.length;iIndex++){rgASCol3[iIndex].set_Right(iMaxWidth)}}}else{var iLeft=rgASCol3[0].get_Left();if(iMaxWidth>iLeft){for(var iIndex=0;iIndex<rgASCol3.length;iIndex++){rgASCol3[iIndex].set_Left(iMaxWidth)}}}};Owa.UIControls.SearchControl.prototype._getAdvancedSearchHeight=function Owa$UIControls$SearchControl$_getAdvancedSearchHeight(){var iH=10;this._oAdvancedSearchDiv.get_FirstChild().forEachChild(function(oChild){iH+=oChild.get_OffsetHeight()});return iH};Owa.UIControls.SearchControl.prototype._setSearchButtonStyle=function Owa$UIControls$SearchControl$_setSearchButtonStyle(sF){var oButton=Owa.Components.ToolbarCollection.get(this.get_SubPage()).getButton("searchpf");var oImg=oButton._get_Element().getDescendantsByTagName("img")[0];Owa.Components.CssSprites.updateImage(oImg,sF)};Owa.UIControls.SearchControl.prototype._cbGetAdvancedSearchPublicFolder=function Owa$UIControls$SearchControl$_cbGetAdvancedSearchPublicFolder(oR){if(!cbOeh(oR)){this._oAdvancedSearch.setExpando("fLd",0);return}this._initAdvancedSearchControls(oR.sBody,true);this.togglePublicFolderAdvancedSearch()};Owa.UIControls.SearchControl.prototype._onClickAdvancedSearch=function Owa$UIControls$SearchControl$_onClickAdvancedSearch(){var oListView=this.get_SubPage()._getDescendant("divLV");if(this._oAdvancedSearch.getExpando("fE")){this._oAdvancedSearch.setExpando("fE",0);oListView.set_Top(oListView.get_Top()-this._getAdvancedSearchHeight());this._oAdvancedSearchDiv.set_IsShown(false);this._oShowAdvancedSearch.set_IsShown(true);this._oHideAdvancedSearch.set_IsShown(false)}else{if(!this._oAdvancedSearch.getExpando("fLD")){this._oAdvancedSearch.setExpando("fLD",1);var oR=new oeReq(this.get_VirtualListView().sEvtNS,"gtAF",0,Owa.Utility.createDelegate(this,this._cbGetAdvancedSearch),GET);oR.add("fId",this.get_VirtualListView().sSid);oR.send()}else{if(!this._oAdvancedSearchDiv)this._oAdvancedSearchDiv=this._getDescendant("divAS");if(!this._oAdvancedSearchDiv.get_FirstChild()){this._oAdvancedSearch.setExpando("fLD",0);return}this._oAdvancedSearchDiv.set_IsShown(true);this._adjustAdvancedSearch();this._oShowAdvancedSearch.set_IsShown(false);this._oHideAdvancedSearch.set_IsShown(true);oListView.set_Top(oListView.get_Top()+this._getAdvancedSearchHeight());this._oAdvancedSearch.setExpando("fE",1);this.fixSearchControlStyles()}}this._setSearchBoxHeight()};Owa.UIControls.SearchControl.prototype._cbGetAdvancedSearch=function Owa$UIControls$SearchControl$_cbGetAdvancedSearch(oR){if(!cbOeh(oR)){if(!this._oAdvancedSearch){this._oAdvancedSearch=this._getDescendant("divASChevron")}if(this._oAdvancedSearch){this._oAdvancedSearch.setExpando("fLD",0)}return}this._initAdvancedSearchControls(oR.sBody,false);this._onClickAdvancedSearch()};Owa.UIControls.SearchControl.prototype._initAdvancedSearchControls=function Owa$UIControls$SearchControl$_initAdvancedSearchControls(sHtml,fIsPublicFolder){this._oAdvancedSearchDiv=this._getDescendant("divAS");this._oAdvancedSearchDiv.set_InnerHtml(sHtml);var oBasicSearch=this._getDescendant("divBasicSearch");if(oBasicSearch.get_IsShown()){this._oAdvancedSearchDiv.getDescendantById("divASExpanded").set_Top(oBasicSearch.get_OffsetHeight()+3)}this._oCategoryComboBox=new Owa.UIControls.ComboBox(this._getDescendant("divCDd"),null);this._oCategoryComboBox.set_SubPage(this.get_SubPage());this._oCategoryComboBox.initialize();this._oCategoryComboBox.get_OnChange().add(Owa.Utility.createDelegate(this,this._onSelectCategory));this._oCategoryCheckBox=this._getDescendant("chkCat");this._attachEvent(this._oCategoryCheckBox,"click",this._setSearchScopeIconStyle);if(this._oCategoryComboBox.get_DropDownList().getItemCount()==0){this._oCategoryComboBox.set_IsEnabled(false);this._oCategoryCheckBox.set_IsDisabled(true)}if(this.get_VirtualListView().iT==LVT_MSG){if(!fIsPublicFolder){this._oResultsInComboBox=new Owa.UIControls.ComboBox(this._getDescendant("divRI"),null);this._oResultsInComboBox.set_SubPage(this.get_SubPage());this._oResultsInComboBox.initialize();this._oResultsInComboBox.get_OnChange().add(Owa.Utility.createDelegate(this,this._onSelectResultsIn));this._oResultsInCheckBox=this._getDescendant("chkRI");this._attachEvent(this._oResultsInCheckBox,"click",this._setSearchScopeIconStyle)}this._oRecipientTextBox=this._getDescendant("txtRcp");this._attachEvent(this._oRecipientTextBox,"click",this._onClickRecipientTextBox);this._attachEvent(this._oRecipientTextBox,"keyup",this._onKeyUpRecipient);this._attachEvent(this._oRecipientTextBox,"blur",this._onFocusOutRecipient);this._oRecipientComboBox=new Owa.UIControls.ComboBox(this._getDescendant("divRcp"),null);this._oRecipientComboBox.set_SubPage(this.get_SubPage());this._oRecipientComboBox.initialize();this._oRecipientComboBox.get_OnChange().add(Owa.Utility.createDelegate(this,this._setSearchScopeIconStyle));this._oRecipientCheckBox=this._getDescendant("chkRcp");this._attachEvent(this._oRecipientCheckBox,"click",this._setSearchScopeIconStyle)}if(fIsPublicFolder){if(!this._oSubjectTextBox)this._oSubjectTextBox=this._getDescendant("txtSS");if(this._oSubjectTextBox){this._attachEvent(this._oSubjectTextBox,"click",this._onClickSubjectTextBox);this._attachEvent(this._oSubjectTextBox,"keyup",this._onKeyUpSubject);this._attachEvent(this._oSubjectTextBox,"blur",this._onFocusOutSubject);this._oSubjectCheckBox=this._getDescendant("chkSS");this._attachEvent(this._oSubjectCheckBox,"click",this._onClickSubjectCheckBox)}this._attachEvent(this._oAdvancedSearchDiv.getDescendantById("btnAF"),"click",this._onClickSearchIcon)}};Owa.UIControls.SearchControl.prototype._onSelectCategory=function Owa$UIControls$SearchControl$_onSelectCategory(){this._oCategoryCheckBox.set_IsChecked(true);this._setSearchScopeIconStyle()};Owa.UIControls.SearchControl.prototype._onClickSubjectCheckBox=function Owa$UIControls$SearchControl$_onClickSubjectCheckBox(){if(!this._oSubjectCheckBox.get_IsChecked()){this._oSearchTextBox.set_Value("");this._oSearchTextBox.setAttribute("fScp","1")}else{this._oSearchTextBox.set_Value(this._oSubjectTextBox.get_Value());this._oSearchTextBox.setAttribute("fScp","0")}this._setSearchScopeIconStyle()};Owa.UIControls.SearchControl.prototype._onClickSubjectTextBox=function Owa$UIControls$SearchControl$_onClickSubjectTextBox(){this._oSubjectTextBox.focus()};Owa.UIControls.SearchControl.prototype._onKeyUpSubject=function Owa$UIControls$SearchControl$_onKeyUpSubject(e){var sValue=this._oSubjectTextBox.get_Value();this._oSearchTextBox.set_Value(sValue);if(sValue&&sValue.length){this._oSubjectCheckBox.set_IsChecked(true);if(e.get_KeyCodeForKeyUpDown()==13)this._search()}else{this._oSubjectCheckBox.set_IsChecked(false)}this._setSearchScopeIconStyle()};Owa.UIControls.SearchControl.prototype._onClickRecipientTextBox=function Owa$UIControls$SearchControl$_onClickRecipientTextBox(){this._oRecipientTextBox.focus()};Owa.UIControls.SearchControl.prototype._onKeyUpRecipient=function Owa$UIControls$SearchControl$_onKeyUpRecipient(e){if(this._oRecipientTextBox.get_Value().length){this._oRecipientCheckBox.set_IsChecked(true);if(e.get_KeyCodeForKeyUpDown()==13){this._search()}}else{this._oRecipientCheckBox.set_IsChecked(false)}this._setSearchScopeIconStyle()};Owa.UIControls.SearchControl.prototype._onFocusOutSubject=function Owa$UIControls$SearchControl$_onFocusOutSubject(){if(this._oSubjectTextBox){var sValue=this._oSubjectTextBox.get_Value();this._oSubjectCheckBox.set_IsChecked((sValue&&sValue.length))}this._setSearchScopeIconStyle()};Owa.UIControls.SearchControl.prototype._onFocusOutRecipient=function Owa$UIControls$SearchControl$_onFocusOutRecipient(){var sValue=this._oRecipientTextBox.get_Value();this._oRecipientCheckBox.set_IsChecked((sValue&&sValue.length));this._setSearchScopeIconStyle()};Owa.UIControls.SearchControl.prototype._onSelectResultsIn=function Owa$UIControls$SearchControl$_onSelectResultsIn(){this._oResultsInCheckBox.set_IsChecked(true);this._setSearchScopeIconStyle()};Owa.UIControls.SearchControl.createClass("Owa.UIControls.SearchControl",Owa.UIControls.UIControl)})();g_fModuleLoaded[".\\uicontrols/searchcontrol.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/resizer.js".toLowerCase()])(function(){Owa.UIControls.Resizer=function Owa$UIControls$Resizer(oSubPage,oElement){Owa.UIControls.Resizer.constructBase(this,[oElement]);this.set_SubPage(oSubPage);this._fResizing=false};Owa.UIControls.Resizer.DIRECTION={VERTICAL:1,HORIZONTAL:2};var _oPrototype=Owa.UIControls.Resizer.prototype;_oPrototype.set_Direction=function Owa$UIControls$Resizer$set_Direction(oValue){this._iDirection=oValue};_oPrototype.get_Direction=function Owa$UIControls$Resizer$get_Direction(){return this._iDirection};_oPrototype.set_MinMarginBefore=function Owa$UIControls$Resizer$set_MinMarginBefore(oValue){this._iMinMarginBefore=oValue};_oPrototype.get_MinMarginBefore=function Owa$UIControls$Resizer$get_MinMarginBefore(){return this._iMinMarginBefore};_oPrototype.set_MinMarginAfter=function Owa$UIControls$Resizer$set_MinMarginAfter(oValue){this._iMinMarginAfter=oValue};_oPrototype.get_MinMarginAfter=function Owa$UIControls$Resizer$get_MinMarginAfter(){return this._iMinMarginAfter};_oPrototype.initialize=function Owa$UIControls$Resizer$initialize(){this._attachEvent(this._get_Element(),"mousedown",this._resizeStart);this._cancelEvent(this._get_Element(),"dragstart")};_oPrototype.dispose=function Owa$UIControls$Resizer$dispose(){if(this._fResizing)this._resizeEnd();Owa.UIControls.Resizer.callBase(this,"dispose")};_oPrototype._isHorizontal=function Owa$UIControls$Resizer$_isHorizontal(){return this.get_Direction()==Owa.UIControls.Resizer.DIRECTION.HORIZONTAL};_oPrototype._resizeStart=function Owa$UIControls$Resizer$_resizeStart(oEvent){if(!oEvent.isLeftButtonDown())return;var oElement=this._get_Element();var oImg=oElement.get_FirstChild();oImg.removeCssClass("dividerImgNotDragging");oImg.addCssClass("dividerImgDragging");oElement.moveToTop();oElement.set_OverflowX(Owa.Style.Overflow.Visible);oElement.set_OverflowY(Owa.Style.Overflow.Visible);this._oMask=new Owa.UIControls.TransparentMask(UniqueIdGenerator.get_Instance().get_Next(),"",Owa.Dom.Document.get_Current());this._oMask.set_SubPage(this.get_SubPage());this._oMask._get_Element().moveToTop();this._oMask.setHandler("mouseup",this._createCallback(this._onResizeUp));this._oMask.setHandler("mousemove",this._createCallback(this._onResizeMove));this._oMask.setHandler("mouseout",this._createCallback(this._onResizeOut));if(this._isHorizontal){this._iClient=oEvent.get_ClientX();this._oMask._get_Element()._get_DomNode().style.cursor="col-resize";if(g_fRtl){this._iOriginalNear=oElement.get_Right();this._iNearMin=this.get_MinMarginBefore()-oElement.get_Right();this._iNearMax=oElement._get_OffsetParent().get_OffsetWidth()-this.get_MinMarginAfter()-oElement.get_OffsetWidth()-oElement.get_Right()}else{this._iOriginalNear=oElement.get_Left();this._iNearMin=this.get_MinMarginBefore()-oElement.get_Left();this._iNearMax=oElement._get_OffsetParent().get_OffsetWidth()-this.get_MinMarginAfter()-oElement.get_OffsetWidth()-oElement.get_Left()}}oEvent.preventDefault();oEvent.cancelBubble();this._fResizing=true};_oPrototype._onResizeOut=function Owa$UIControls$Resizer$_onResizeOut(oEvent){var oToElement=oEvent.get_ToElementForMouseOut();if(!oToElement||!oToElement.equals(this._oMask._get_Element())){this._onResizeUp(oEvent)}};_oPrototype._onResizeUp=function Owa$UIControls$Resizer$_onResizeUp(oEvent){this._fResizing=false;var iNewValue;if(this._isHorizontal()){if(g_fRtl)iNewValue=this._get_Element().get_Right()+this._get_Element().get_FirstChild().get_Right();else iNewValue=this._get_Element().get_Left()+this._get_Element().get_FirstChild().get_Left()}this._dispatchEvent(ON_RESIZE_END,iNewValue);this._resizeEnd()};_oPrototype._onResizeMove=function Owa$UIControls$Resizer$_onResizeMove(oEvent){if(!oEvent.isLeftButtonDown()){this._onResizeUp(oEvent);return}if(this._isHorizontal()){if(g_fRtl)this._get_Element().get_FirstChild().set_Right(Math.min(Math.max(this._iClient-oEvent.get_ClientX(),this._iNearMin),this._iNearMax));else this._get_Element().get_FirstChild().set_Left(Math.min(Math.max(oEvent.get_ClientX()-this._iClient,this._iNearMin),this._iNearMax))}};_oPrototype._resizeEnd=function Owa$UIControls$_resizeEnd(){this._oMask.dispose();this._oMask=null;var oElement=this._get_Element();var oImg=oElement.get_FirstChild();if(this._isHorizontal()){if(g_fRtl)oImg.set_Right(0);else oImg.set_Left(0)}oImg.removeCssClass("dividerImgDragging");oImg.addCssClass("dividerImgNotDragging");oElement._get_DomNode().style.zIndex="";oElement.set_OverflowX(Owa.Style.Overflow.Hidden);oElement.set_OverflowY(Owa.Style.Overflow.Hidden)};var ON_RESIZE_END="ResizeEnd";_oPrototype.get_ResizeEnd=function Owa$UIControls$Resizer$get_ResizeEnd(){return this._getEventHandlerCollection(ON_RESIZE_END)};Owa.UIControls.Resizer.createClass("Owa.UIControls.Resizer",Owa.UIControls.UIControl)})();g_fModuleLoaded[".\\uicontrols/resizer.js".toLowerCase()]=1;var g_iUdRpDl=500;var g_fDeleteInProgress=0;var FOLDER_COUNT_SYNC_DURATION=15*1000;(function(){Type.createNamespace("Owa.Pages");Owa.Pages.ListViewSubPage=function Owa$Pages$ListViewSubPage(oElement){Owa.Pages.ListViewSubPage.constructBase(this,[oElement]);this._oFilterInfobar=null;this._oFolderCountTimer=null;this._dtLastUpdateRP=new Date();this._fFolderSizeFlag=0;this._iTempReadingPaneItemId=null;this._iTempConversationItemPartId=null;this.enblFwd_dsbld=0;this.udRP_toID=null;this.enblRpl_dsbld=0;this.setItmRead_toID=null;this.oLastUnSelectionState=null;this.fErrorOnViewLoad=0};var _oPrototype=Owa.Pages.ListViewSubPage.prototype;_oPrototype.fIsFolderListViewSubPage=true;_oPrototype.initialize=function Owa$Pages$ListViewSubPage$initialize(){Owa.Pages.ListViewSubPage.callBase(this,"initialize");this.addResource(Owa.Components.ToolbarCollection.create(this.get_SubPage()));this.initVw();addPerfMarker("MessageView.Init.End")};_oPrototype.dispose=function Owa$Pages$ListViewSubPage$dispose(){this.dispVw();Owa.Pages.ListViewSubPage.callBase(this,"dispose")};_oPrototype.onIsVisibleChanged=function Owa$Pages$ListViewSubPage$onIsVisibleChanged(fIsVisible){var oListView=this.get_VirtualListView();if(oListView&&oListView.onShowHide){if(fIsVisible&&this.fErrorOnViewLoad){this._initializeVLV();if(this._tryUpdateConversationActionUI){this._tryUpdateConversationActionUI()}this.fErrorOnViewLoad=0}oListView.onShowHide(fIsVisible)}if(fIsVisible){this.activate()}};_oPrototype.onFirstShow=function Owa$Pages$ListViewSubPage$onFirstShow(){if(Owa.Utility.isDefined(typeof(this.get_VlvMinWidth()))){this.setVW(this.get_ViewWidth(),1,1)}this.activate()};_oPrototype.onResize=function Owa$Pages$ListViewSubPage$onResize(oEvent){var oVLV=this.get_VirtualListView();try{this.hideDialogs()}catch(e){}this.adjustLvRpContainerTop();this.adjustRPWidth();if(oVLV&&(Owa.Utility.isFirefox()||Owa.Utility.isSafari())){oVLV.onRsz(oEvent)}this._oFilterInfobar.resize()};_oPrototype.onLoadReadingPane=function Owa$Pages$ListViewSubPage$onLoadReadingPane(){var oVLV=this.get_VirtualListView();if(oVLV&&oVLV.isTskVw()){this.udTskTB();if(oVLV.oCM){this.cmPreShwTsk(oVLV.oCM)}}};_oPrototype._onUserAction=function Owa$Pages$ListViewSubPage$_onUserAction(sAction,oContext){var oVLV=this.get_VirtualListView();switch(sAction){case"newmsg":case"newmsgc":newMail(this.isOMF(),this);return;case"newappt":newItm("IPM.Appointment",null,null,null,null,this.get_SubPage());return;case"newmtng":newItm("IPM.Appointment",null,"&mr=1",null,null,this.get_SubPage());return;case"newc":case"newcc":newCnt(null,this.get_SubPage());return;case"newcdl":newPdl(null,this.get_SubPage());return;case"newtsk":case"newtc":newItm("IPM.Task",null,null,null,this.get_SubPage());return;case"newpst":if(!this.hasEROnFld(ER_CC))return;newItm(IT_PST,this.get_FolderId(),null,null,null,this.get_SubPage());return;case BID_CM:this.ref(1);oVLV.makeFocused();break;case BID_PDLT:case BID_DL:case BID_DLDD:case BID_DLIGNDD:var fPermanent=(sAction==BID_PDLT);if(oVLV.isTskVw()){oVLV.delTsks(fPermanent||this.getSubPageVariable("a_fInDelItms")||this.isPF())}else if(oVLV.isDumpsterVw()){oVLV.purgeItems()}else{var rgS=null;var oRP=this.gtCnvRP();if(oRP&&oRP.get_IsContextActionProcessing()){rgS=oRP.gtSel()}this.del(fPermanent||this.getSubPageVariable("a_fInDelItms")||this.isPF(),rgS,null,this.isPF());oVLV.makeFocused()}break;case BID_IGNCNV:var rg;if(oVLV.isSelExp()){rg=[];rg.push(oVLV.gtExpCnvId())}else{rg=oVLV.gtSel()}this.del(0,rg,0,0,1);oVLV.makeFocused();break;case BID_MV:var oCallerSubPage=this.get_SubPage();shwCMMnu(oCallerSubPage,Owa.Utility.createDelegate(this,this.vwCpMv));break;case"fltrc":if(oVLV._oPrevFilterCriteria||oVLV.isInFltrdVw()){if(this.get_SearchControl())this.get_SearchControl().clearSearch(1);if(oVLV.isInFltrdVw())oVLV.dsblFltrVw();else oVLV.enblFltrVw()}else{this.showFilterMenu()}break;case"fltrcd":this.showFilterMenu();break;case"recover":if(oVLV.gtSel().length>0){var oFolderPickerDialog=Owa.UIControls.FolderPickerDialog.get_Default();oFolderPickerDialog.set_IsShowPublicFolder(true);oFolderPickerDialog.set_ButtonCaptions([L_Recover]);oFolderPickerDialog.set_Title(L_RecoverToFld);oFolderPickerDialog.onCheckCustomButtons=updateFolderPickerCopyMoveItemButton;oFolderPickerDialog.onButtonClick=cbCopyMoveItem;cbCopyMoveItem.fnCallback=Owa.Utility.createDelegate(this,this.vwCpMv);oFolderPickerDialog.show()}break;case"MvToF":var oFolderPickerDialog=Owa.UIControls.FolderPickerDialog.get_Default();oFolderPickerDialog.set_IsShowPublicFolder(true);oFolderPickerDialog.set_ButtonCaptions([L_Mv]);oFolderPickerDialog.set_Title(L_MvToFld);oFolderPickerDialog.onCheckCustomButtons=updateFolderPickerCopyMoveItemButton;oFolderPickerDialog.onButtonClick=cbCopyMoveItem;cbCopyMoveItem.fnCallback=Owa.Utility.createDelegate(this,this.vwCpMv);oFolderPickerDialog.show();break;case"CpToF":var oFolderPickerDialog=Owa.UIControls.FolderPickerDialog.get_Default();oFolderPickerDialog.set_IsShowPublicFolder(true);oFolderPickerDialog.set_ButtonCaptions([L_Cp]);oFolderPickerDialog.set_Title(L_CpToFld);oFolderPickerDialog.onCheckCustomButtons=updateFolderPickerCopyMoveItemButton;oFolderPickerDialog.onButtonClick=cbCopyMoveItem;cbCopyMoveItem.fnCallback=Owa.Utility.createDelegate(this,this.vwCpMv);oFolderPickerDialog.show();break;case"rpo":this.tglRP(RP_OFF);break;case"rpr":this.tglRP(RP_RIGHT);break;case"rpb":this.tglRP(RP_BOTTOM);break;case"sl":oVLV.stML(0);oVLV.makeFocused();break;case"ml":oVLV.stML(1);oVLV.makeFocused();break;case"newestOnTop":this.updateReadingPaneSortOrder(0);break;case"oldestOnTop":this.updateReadingPaneSortOrder(1);break;case"showTree":this.updateListViewExpansion(1);break;case"showFlatList":this.updateListViewExpansion(0);break;case"nmsgct":var oCallerSubPage=this.get_SubPage();newMsgToCt(oCallerSubPage,oVLV.gtSel(),1);break;case"nmrgct":var oCallerSubPage=this.get_SubPage();newMsgToCt(oCallerSubPage,oVLV.gtSel(),0);break;case"markread":this.cnclMkRd();var rgS=oVLV.gtSel();var oRP=this.gtCnvRP();if(oRP&&oRP.get_IsContextActionProcessing()){rgS=oRP.gtSel()}this.setRdSt(rgS,MSG_READ);break;case"markunread":this.cnclMkRd();var rgS=oVLV.gtSel();var oRP=this.gtCnvRP();if(oRP&&oRP.get_IsContextActionProcessing()){rgS=oRP.gtSel()}this.setRdSt(rgS,MSG_UNREAD);break;case BID_RA:this.repFwItmNwWnd("ReplyAll");break;case BID_RE:case BID_RED:case BID_RECMB:this.repFwItmNwWnd("Reply");break;case BID_FWCMB:if(this.gtSelItms().length>1)this.fwIA();else this.repFwItmNwWnd("Forward");break;case BID_FW:case BID_FWD:this.repFwItmNwWnd("Forward");break;case BID_RES:this.repFwItmNwWnd("Reply",0,IT_SMS);break;case BID_REP:break;case BID_REC:case BID_CHT:if(oVLV.iT==LVT_MSG||oVLV.iT==LVT_TSK)this.nwChtFrmMsg();else if(this.isCntVw()){nwChtFrmRcp(this.getRecipientObject(oVLV.gtSel()[0]))}break;case BID_ABLST:var oCallerSubPage=this.get_SubPage();addBdyLstReq(oCallerSubPage,this.getRecipientObject(oVLV.gtSel()[0]));break;case BID_RMBLST:var oCallerSubPage=this.get_SubPage();rmBdyLstReq(oCallerSubPage,this.getRecipientObject(oVLV.gtSel()[0]));break;case BID_PR:if(!this.hasEROnFld(ER_CC)||!this.selsAreAllPsts())return;this.repFwItmNwWnd("PostReply",(this.get_FolderId()?"&fId="+urlEnc(this.get_FolderId()):""));break;case"up":opnDocFldr(a_sParUri,0);break;case"opndlinnew":opnDocLstItm(1);break;case"opndc":opnDocLstItm();break;case"opnwp":opnAWP();break;case"senddc":sndDocLibsReq("SendByEmail",cbSndDoc,getSelDocLibs());break;case"copyuri":window.clipboardData.setData("Text",getDocItmUri());break;case"copyuribcb":window.clipboardData.setData("Text",wda("divDbcbm").docLib.uri);break;case"addfav":sndDocLibsReq("AddFav",cbAddFavDocFldr,getSelDocLibs());break;case"addFvTb":var o=new Object();o.sU=a_sCurUri;sndDocLibsReq("AddFav",cbAddFavDocFldr,new Array(o));break;case"addfavbcb":var o=new Object();o.sU=wda("divDbcbm").docLib.uri;sndDocLibsReq("AddFav",cbAddFavDocFldr,new Array(o));break;case"infomb":clkInfAbt(wda("divIMB"));break;case"infocot":clkInfAbt(wda("divICOT"));break;case"help":opnHlp(oContext.getAttribute("href"));break;case"open":case BID_EDT:this.openItms();break;case"addconts":this.addABCts();break;case"searchpf":this.get_SearchControl().togglePublicFolderAdvancedSearch();break;case"sndbsl":this.gtSndSmtp(ACTN_ADDBSL,oContext.get_TextContent(),this.gtSelItms()[0]);break;case"sndssl":addSndToJnkLst(this.get_SubPage(),SSL,this.gtSelItms()[0],0,oContext.get_TextContent());this.refreshConversationRP();break;case"snddmssl":addSndToJnkLst(this.get_SubPage(),SSL,this.gtSelItms()[0],1,oContext.get_TextContent());this.refreshConversationRP();break;case"ntjnk":if(this.gtSelItms().length==1){this.gtSndSmtp(ACTN_NTJNK,null,this.gtSelItms()[0])}break;case"markcomplete":if(oVLV.isTskVw())oVLV.mkSelCmp();break;case"crrul":{var sId=this.gtSelItms()[0];if(this.isCnvId(sId)){var oRow=oVLV.gtRwById(sId);if(oRow){var oData=oVLV.getData(oRow);var sMessageId=oData.getAttribute("sMID");if(sMessageId){sId=sMessageId}}}opnEcpNewRul(this.get_SubPage(),"id="+urlEnc(sId))}break;case"opdlvrp":this.gtDlvRp();break;case"nwCstm":newCstm(oContext,this.get_FolderId(),this.get_SubPage());break;case"cstmCM":var sUrl=oContext.getAttribute("_sUrl");var rgItms=oVLV.gtSel();sUrl+="&fId="+urlEnc(this.get_FolderId());sUrl+="&n="+rgItms.length;for(var i=0;i<rgItms.length;i++)sUrl+="&id"+i+"="+urlEnc(rgItms[i]);sfWinOpn(sUrl);break;case"copy":var oDraggableObject=oVLV.crtDC();if(oDraggableObject)oDraggableObject.save(new Owa.Components.Storage.Clipboard());else canEvt();break;case BID_FWA:case BID_FWAD:this.fwIA();break;case"newsms":newSms(this.get_SubPage());break;case BID_SHCAL:case BID_SHTSK:case BID_SHCNT:break;case BID_OPNCNT:case BID_OPNTSK:opnShrDlgInVw(this.get_SubPage(),sAction);break;case BID_CHP:break;case"emptyfolder":this.emptyFolder();break;default:if(sAction.startsW("mir")){this.rspMI(sAction.substring(3,4),sAction.substring(4,5))}else{Owa.Pages.ListViewSubPage.callBase(this,"_onUserAction",[sAction,oContext])}break}};_oPrototype.get_VirtualListView=function Owa$Pages$ListViewSubPage$get_VirtualListView(){return this._oVirtualListView};_oPrototype.get_SearchControl=function Owa$Pages$ListViewSubPage$get_SearchControl(){return this._oSearchControl};_oPrototype.get_FolderId=function Owa$Pages$ListViewSubPage$get_FolderId(){return this.getSubPageVariable("a_sFId")};_oPrototype.get_VlvMinWidth=function Owa$Pages$ListViewSubPage$get_VlvMinWidth(){return this.getSubPageVariable("a_iVlvMinWidth")};_oPrototype.set_VlvMinWidth=function Owa$Pages$ListViewSubPage$set_VlvMinWidth(iVlvMinWidth){this.setSubPageVariable("a_iVlvMinWidth",iVlvMinWidth)};_oPrototype.get_ViewWidth=function Owa$Pages$ListViewSubPage$get_ViewWidth(){return this.getSubPageVariable("a_iVW")};_oPrototype.set_ViewWidth=function Owa$Pages$ListViewSubPage$set_ViewWidth(iViewWidth){this.setSubPageVariable("a_iVW",iViewWidth)};_oPrototype.get_ViewHeight=function Owa$Pages$ListViewSubPage$get_ViewHeight(){return this.getSubPageVariable("a_iVH")};_oPrototype.set_ViewHeight=function Owa$Pages$ListViewSubPage$set_ViewHeight(iViewHeight){this.setSubPageVariable("a_iVH",iViewHeight)};_oPrototype._get_ReadingPaneMinWidth=function Owa$Pages$ListViewSubPage$_get_ReadingPaneMinWidth(){return this._iReadingPaneMinWidth};_oPrototype._set_ReadingPaneMinWidth=function Owa$Pages$ListViewSubPage$_set_ReadingPaneMinWidth(iReadingPaneMinWidth){this._iReadingPaneMinWidth=iReadingPaneMinWidth};_oPrototype.get_ItemIdInReadingPane=function Owa$Pages$ListViewSubPage$get_ItemIdInReadingPane(){return this._sItemIdInReadingPane};_oPrototype.set_ItemIdInReadingPane=function Owa$Pages$ListViewSubPage$set_ItemIdInReadingPane(sItemIdInReadingPane){this._sItemIdInReadingPane=sItemIdInReadingPane};_oPrototype.get_ItemIdInConversation=function Owa$Pages$ListViewSubPage$get_ItemIdInConversation(){return this._iItemIdInConversation};_oPrototype.set_ItemIdInConversation=function Owa$Pages$ListViewSubPage$set_ItemIdInConversation(iItemIdInConversation){this._iItemIdInConversation=iItemIdInConversation};_oPrototype.get_ReadingPanePosition=function Owa$Pages$ListViewSubPage$get_ReadingPanePosition(){return this.getSubPageVariable("a_iRP")};_oPrototype.set_ReadingPanePosition=function Owa$Pages$ListViewSubPage$set_ReadingPanePosition(iReadingPanePosition){this.setSubPageVariable("a_iRP",iReadingPanePosition)};_oPrototype.get_FilterContextMenu=function Owa$Pages$ListViewSubPage$get_FilterContextMenu(){return this._oFilterContextMenu};_oPrototype.set_FilterContextMenu=function Owa$Pages$ListViewSubPage$set_FilterContextMenu(oFilterContextMenu){this._oFilterContextMenu=oFilterContextMenu};_oPrototype.get_NewestOnTop=function Owa$Pages$ListViewSubPage$get_NewestOnTop(){return this.getSubPageVariable("a_fNwOnTop")};_oPrototype.set_NewestOnTop=function Owa$Pages$ListViewSubPage$set_NewestOnTop(fNewesetOnTop){this.setSubPageVariable("a_fNwOnTop",fNewesetOnTop)};_oPrototype.get_EffectiveRights=function Owa$Pages$ListViewSubPage$get_EffectiveRights(){return this.getSubPageVariable("a_iER")};_oPrototype.get_ELCFolderWithQuota=function Owa$Pages$ListViewSubPage$get_ELCFolderWithQuota(){return this.getSubPageVariable("a_fELCFldWtQt")};_oPrototype.get_ELCFolderQuota=function Owa$Pages$ListViewSubPage$get_ELCFolderQuota(){return this.getSubPageVariable("a_iELCFldQt")};_oPrototype.get_ELCFolderId=function Owa$Pages$ListViewSubPage$get_ELCFolderId(){return this.getSubPageVariable("a_sELCId")};_oPrototype.get_FilterRecipientName=function Owa$Pages$ListViewSubPage$get_FilterRecipientName(){return this.getSubPageVariable("a_sFltrRpNm")};_oPrototype.get_IsFilterInFavorite=function Owa$Pages$ListViewSubPage$get_IsFilterInFavorite(){return this.getSubPageVariable("a_fFltrInFav")};_oPrototype.get_OOF=function Owa$Pages$ListViewSubPage$get_OOF(){return this.getSubPageVariable("a_fOof")};_oPrototype.crtLV=function Owa$Pages$ListViewSubPage$crtLV(){var oDivVLV=this._getDescendant("divVLV");switch(oDivVLV.getIntAttribute("iT")){case LVT_MSG:return new Owa.UIControls.MsgVLV(this,oDivVLV);case LVT_TSK:return new Owa.UIControls.TskVLV(this,oDivVLV);case LVT_CTL:case LVT_CTM:case LVT_CTP:return new Owa.UIControls.ContactsVLV(this,oDivVLV);case LVT_DRL:case LVT_DRP:case LVT_RML:case LVT_RMP:return new Owa.UIControls.AddressBookVLV(this,oDivVLV);case LVT_DMP:return new Owa.UIControls.DumpsterVLV(this,oDivVLV)}};_oPrototype.adjustLvRpContainerTop=function Owa$Pages$ListViewSubPage$adjustLvRpContainerTop(oEvent){var oVLV=this.get_VirtualListView();if((!oVLV)||(oVLV.iT!=LVT_MSG))return;var oInfobar=new Owa.UIControls.Infobar(this._getDescendant("divInfobar"));var iTopPos=a_iViewHeaderHeight;var infobarsHeight=oInfobar.getOffsetHeight();if(infobarsHeight){iTopPos+=infobarsHeight+1}var oLvRpContainer=this._getDescendant("divLVRPContainer");oLvRpContainer.set_Top(iTopPos)};_oPrototype.initCnvVw=function Owa$Pages$ListViewSubPage$initCnvVw(fCV){var oVLV=this.get_VirtualListView();if(fCV)oVLV.stOnRfExp(this._createCallback(this.udCnvLV));else oVLV.stOnRfExp(0);var fNwOnTop=this.get_NewestOnTop();Owa.Components.ToolbarCollection.get(this).getButton("newestOnTop").set_IsShown(fNwOnTop);Owa.Components.ToolbarCollection.get(this).getButton("oldestOnTop").set_IsShown(!fNwOnTop);this._getDescendant("divConversationToolbar").set_IsShown(fCV);this.adjustVLVToolbars()};_oPrototype.isCntVw=function Owa$Pages$ListViewSubPage$isCntVw(){var oVLV=this.get_VirtualListView();var iT=oVLV.iT;return(iT==LVT_CTM||iT==LVT_CTL||iT==LVT_CTP||iT==LVT_DRL||iT==LVT_DRP||iT==LVT_RML||iT==LVT_RMP)};_oPrototype.onNavigatePkr=function Owa$Pages$ListViewSubPage$onNavigatePkr(){var oW=wt();if(oW!=window&&oW.onNavigatePkr)oW.onNavigatePkr()};_oPrototype._initializeVLV=function Owa$Pages$ListViewSubPage$_initializeVLV(){var oListView=this.get_VirtualListView();this.oDivViewMenu=this._getDescendant("divVwm");if(this.oDivViewMenu)oListView.stCM(this.oDivViewMenu._get_DomNode(),this.get_ActionHandler(),this._createCallback(this.cmPreShw));this.oDivAbm=this._getDescendant("divAbm");if(this.oDivAbm)oListView.stABM(this.oDivAbm._get_DomNode());oListView.initialize()};_oPrototype.initVw=function Owa$Pages$ListViewSubPage$initVw(){var oVLV=this.get_VirtualListView();this._iReadingPaneMinWidth=g_iMinRPW;var oIfRP=this._getDescendant("ifRP");if(oIfRP){var oSubPageController=Owa.Components.SubPageControllerFactory.getControllerByElement(oIfRP);this.get_SubPageController().addChildController(oSubPageController)}this._attachEvent(this._get_Element(),"selectstart",cancelSelectStart);var oLnkHdELC=this._getDescendant("lnkHdELC");var oLnkShwELC=this._getDescendant("lnkShwELC");var oLnkRmvOofIB=this._getDescendant("lnkRmvOofIB");var oLnkChgPwd=this._getDescendant("lnkChgPwd");var oLnkRmvPwdIB=this._getDescendant("lnkRmvPwdIB");this._oDivRPddm=this._getDescendant("divRPddm");if(oLnkHdELC)this._attachEvent(oLnkHdELC,"click",this.shwELCCmnt);if(oLnkShwELC)this._attachEvent(oLnkShwELC,"click",this.shwELCCmnt);if(oLnkRmvOofIB)this._attachEvent(oLnkRmvOofIB,"click",this.removeIb);if(oLnkChgPwd)this._attachEvent(oLnkChgPwd,"click",this.onNavigateChgPwd);if(oLnkRmvPwdIB)this._attachEvent(oLnkRmvPwdIB,"click",this.removeIb);if(this._oDivRPddm){var oContext={};oContext.oCallerSubPage=this.get_SubPage();this._attachEvent(this._oDivRPddm,"click",onrpddmclk,oContext)}g_iLgn=2;if(!this._oViewResizer){var oDivResizer=this._getDescendant("divLVDivider");if(oDivResizer){this._oViewResizer=new Owa.UIControls.Resizer(this.get_SubPage(),oDivResizer);this._oViewResizer.set_Direction(Owa.UIControls.Resizer.DIRECTION.HORIZONTAL);this._oViewResizer.set_MinMarginBefore(this.get_VlvMinWidth());this._oViewResizer.set_MinMarginAfter(this._get_ReadingPaneMinWidth());this._oViewResizer.initialize();this._oViewResizer.get_ResizeEnd().add(this._createCallback(this._setViewSizeAfterResize))}}initIM();this.initRmTb();if(!this.get_VirtualListView()){oVLV=this.addResource(this.crtLV());this._oVirtualListView=oVLV}oVLV.stOnErr(this._createCallback(this.onErrorVw));oVLV.stOnNav(this._createCallback(this.isPkrVw()?this.onNavigatePkr:this.onNavigateVw));oVLV.stOnBRfrsh(this._createCallback(this.onBRfrshVw));oVLV.stOnERfrsh(this._createCallback(this.onERfrshVw));oVLV.stOnSelChg(this._createCallback(this.onSelChngVw));oVLV.stOnRmvRws(this._createCallback(this.onRmvItmsVw));oVLV.stReadingPaneOn(this._createCallback(this.isReadingPaneOn));oVLV.stGtSF(this._createCallback(this.lvGtSF));if(this.get_IsShown(true)){this._initializeVLV()}else{this.fErrorOnViewLoad=1}if(!this._oFilterInfobar)this._oFilterInfobar=new Owa.UIControls.FilterInfobar(this);if(this.isCntVw()&&(0>=oVLV.gtTC()))this.udCntFnc();if(!this.get_SearchControl()){var oSearchControl=new Owa.UIControls.SearchControl(this,this._getDescendant("divSearchBox"));this.addResource(oSearchControl);oSearchControl.initialize();this._oSearchControl=oSearchControl}if(this.isPkrVw()){Owa.Dom.Window.get_Current().get_ParentWindow()._domWindow.chgAbLvSt(1)}updRPNLVddm(this.get_SubPage());if(this.get_IsShown()){oVLV.makeFocused()}this.get_HotKeyManager().addHotKey(L_HkCpy,"copy",true)};_oPrototype.getVwOfSt=function Owa$Pages$ListViewSubPage$getVwOfSt(iNewSize){var oRPB=this._getDescendant("tblRPB");var oLV=oRPB.getDescendantById("tdLV");return oLV.get_OffsetTop()+this._getDescendant("tdC").get_OffsetTop()};_oPrototype._setViewSizeAfterResize=function Owa$Pages$ListViewSubPage$_setViewSizeAfterResize(iNewSize){this.setVW(iNewSize,1)};_oPrototype.fireUpdCnt=function Owa$Pages$ListViewSubPage$fireUpdCnt(){var oVLV=this.get_VirtualListView();var oVirtualListView=oVLV;if(oVirtualListView.iT==LVT_MSG&&(!oVirtualListView.isFltrd()&&!(oVirtualListView.isInFltrdVw&&oVirtualListView.isInFltrdVw())))g_oEd.fire("UpdateCount",oVirtualListView.sSid,oVirtualListView.iTIC,oVirtualListView.iUC)};_oPrototype.isPF=function Owa$Pages$ListViewSubPage$isPF(){if(Owa.Utility.isDefined(typeof(this.getSubPageVariable("a_fPF"))))return this.getSubPageVariable("a_fPF");return 0};_oPrototype.isOMF=function Owa$Pages$ListViewSubPage$isOMF(){if(Owa.Utility.isDefined(typeof(this.getSubPageVariable("a_fOMF"))))return this.getSubPageVariable("a_fOMF");return 0};_oPrototype.chkDlgtPrms=function Owa$Pages$ListViewSubPage$chkDlgtPrms(iR){if(!this.hasEROnFld(iR)){alrt(L_ErrNoPsm,0,Owa.BUTTON_DIALOG_ICON.WARNING,L_Wrng);return 0}return 1};_oPrototype.dispVw=function Owa$Pages$ListViewSubPage$dispVw(){var oVLV=this.get_VirtualListView();Owa.Components.ToolbarCollection.get(this).dispose();oVLV.dispose();var oIfRP=this._getDescendant("ifRP");if(oIfRP){var oController=Owa.Components.SubPageControllerFactory.getControllerByElement(oIfRP);if(oController){oController.dispose()}}if(this._oDivRPddm){this._oDivRPddm.remove(true);this._oDivRPddm=null}this._oVirtualListView=null;this._oSearchControl=null;this._oFilterInfobar=null;this._oFilterContextMenu=null;this._oViewResizer=null};_oPrototype.getItemToolbarId=function Owa$Pages$ListViewSubPage$getItemToolbarId(){return"divTBL"};_oPrototype.getViewToolbarId=function Owa$Pages$ListViewSubPage$getViewToolbarId(){return""};_oPrototype.adjustVLVToolbars=function Owa$Pages$ListViewSubPage$adjustVLVToolbars(fAdjustOnlyRpToolbars){if(!this._get_Element().get_IsShown()){return}if(!fAdjustOnlyRpToolbars){var iMinWidth=this.adjustToolbarWidths(this.getItemToolbarId(),this.getViewToolbarId());if(iMinWidth>this.get_VlvMinWidth()){this.set_VlvMinWidth(iMinWidth)}var iViewWidth=this._getDescendant("divLVContainer").get_ClientWidth();if(iViewWidth<this.get_VlvMinWidth()){this.setVW(this.get_VlvMinWidth(),0)}}if(this.get_ReadingPanePosition()==RP_RIGHT){var iMinWidth=this.adjustToolbarWidths("divActionToolbar","divConversationToolbar");if(iMinWidth>this._get_ReadingPaneMinWidth()){this._set_ReadingPaneMinWidth(iMinWidth)}this.adjustRPWidth()}};_oPrototype.adjustRPWidth=function Owa$Pages$ListViewSubPage$adjustRPWidth(){var oRPContainer=this._getDescendant("divRPContainer");if(oRPContainer){oRPContainer.set_Width(null);var iReadingPaneWidth=oRPContainer.get_ClientWidth();if(iReadingPaneWidth<this._get_ReadingPaneMinWidth()){oRPContainer.set_Width(this._get_ReadingPaneMinWidth())}}};_oPrototype.adjustToolbarWidths=function Owa$Pages$ListViewSubPage$adjustToolbarWidths(sLeftId,sRightId){var iMinSpaceBetweenToolbar=0;var oLeft=this._getDescendant(sLeftId);var oRight=this._getDescendant(sRightId);var iLeftWidth=0;var iRightWidth=0;if(oLeft){var oLeftMeasure=oLeft.getDescendantById("divMeasure");if(oLeftMeasure){oLeft.set_Width(2000,Owa.Style.Unit.Pixels);if(g_fRtl){iLeftWidth=oLeft.get_DocumentLeft()+oLeft.get_OffsetWidth()-oLeftMeasure.get_DocumentLeft()}else{iLeftWidth=oLeftMeasure.get_DocumentLeft()-oLeft.get_DocumentLeft()+oLeftMeasure.get_OffsetWidth()}iLeftWidth+=2;iMinSpaceBetweenToolbar=8;oLeft.set_Width(iLeftWidth)}}if(oRight){var oRightMeasure=oRight.getDescendantById("divMeasure");if(oRightMeasure){oRight.set_Width(2000,Owa.Style.Unit.Pixels);if(g_fRtl){iRightWidth=oRightMeasure.get_DocumentLeft()-oRight.get_DocumentLeft()+oRightMeasure.get_OffsetWidth()}else{iRightWidth=oRight.get_DocumentLeft()+oRight.get_OffsetWidth()-oRightMeasure.get_DocumentLeft()}iRightWidth+=3;iMinSpaceBetweenToolbar=8;oRight.set_Width(iRightWidth)}}return(iLeftWidth+iRightWidth+iMinSpaceBetweenToolbar)};_oPrototype.isPkrVw=function Owa$Pages$ListViewSubPage$isPkrVw(){var oVLV=this.get_VirtualListView();var iT=oVLV.iT;return iT==LVT_CTP||iT==LVT_DRP||iT==LVT_RMP};_oPrototype.initRmTb=function Owa$Pages$ListViewSubPage$initRmTb(){Owa.Components.ToolbarCollection.get(this).addToolbars(["divMsgItemTB","divMsgViewTB","divTBL","divTBR","divCnvTB"],this.get_ActionTable());this.initTbED();var oTopWin=Owa.Utility.getRootOwaWindow();var fnRegNotf=oTopWin.getGlobalVariable("regNotfs");if(fnRegNotf)fnRegNotf()};_oPrototype.initTbED=function Owa$Pages$ListViewSubPage$initTbED(){if(!Owa.Utility.isDefined(typeof(this.get_EffectiveRights())))return;var iR=this.get_EffectiveRights();var fOMF=this.isOMF();if(this.isOMF())return;var oSubPageActionTable=this.get_SubPage().get_ActionTable();if(!hasER(iR,ER_CC)){oSubPageActionTable.getAction(BID_NP).disable();oSubPageActionTable.getAction(BID_PR).disable();oSubPageActionTable.getAction(BID_NT).disable();oSubPageActionTable.getAction("newcc").disable();oSubPageActionTable.getAction("newccd").disable()}if(!hasER(iR,ER_RD))oSubPageActionTable.getAction(BID_CM).enable()};_oPrototype.shPRoRA=function Owa$Pages$ListViewSubPage$shPRoRA(){var fAP=this.selsAreAllPsts();var f=!fAP;Owa.Components.ToolbarCollection.get(this).set_IsButtonShown(BID_PR,!f);Owa.Components.ToolbarCollection.get(this).set_IsButtonShown(BID_RA,f)};_oPrototype.selsAreAllPsts=function Owa$Pages$ListViewSubPage$selsAreAllPsts(){var oVLV=this.get_VirtualListView();var rg=oVLV.gtSel();if(!rg.length)return 0;for(var i=0;i<rg.length;i++){if(!this.isItmOfType(rg[i],IT_PST))return 0}return 1};_oPrototype.cmPreShw=function Owa$Pages$ListViewSubPage$cmPreShw(oContextMenu){var oVLV=this.get_VirtualListView();var iT=getInt(oVLV.iT);switch(iT){case LVT_MSG:this.cmPreShwMsg(oContextMenu);break;case LVT_DOC:cmPreShwDoc();break;case LVT_CTM:case LVT_CTL:case LVT_CTP:case LVT_DRL:case LVT_DRP:case LVT_RML:case LVT_RMP:this.cmPreShwCnt(oContextMenu,iT);break;case LVT_TSK:this.cmPreShwTsk(oContextMenu);break}};_oPrototype.cmPreShwMsg=function Owa$Pages$ListViewSubPage$cmPreShwMsg(oContextMenu){var oVLV=this.get_VirtualListView();var sId=oVLV.gtSel()[0];if(!sId){return}if(this.isReadingPaneOn()&&oVLV.isCnvVw&&oVLV.isCnvVw()&&(this._iTempReadingPaneItemId!=this.get_ItemIdInReadingPane())){return}if(oVLV.gtSelCnt()==0){return}var fShowDeliveryReport=true;if(oVLV.gtSelCnt()>1){var rgItms=["divR","divRA","divPR","divF","divMIA","divMIT","divMID","divS1","divS2"];if(oContextMenu._getDescendant("divCR"))rgItms.push("divCR");if(oContextMenu._getDescendant("divCht"))rgItms.push("divCht");oContextMenu.showMenuItems(["divMR","divMU"],1);oContextMenu.showMenuItems(rgItms,0);if(isJnkEnbl()){oContextMenu.showMenuItems(["divJnk","divS5"],0)}fShowDeliveryReport=false}else{var iR=oVLV.gtRwPrp(sId,"read");var fR=(!iR||iR==MSG_READ);var fPhsh=this.isPhsh(sId);var fPst=this.isItmOfType(sId,IT_PST);var fCRpl=canItmRpl(oVLV.gtRwPrp(sId,"t"));oContextMenu.showMenuItem("divMU",fR);oContextMenu.showMenuItem("divMR",!fR);if(fPst||oVLV.gtRwPrp(sId,"s")=="Draft"||oVLV.gtRwPrp(sId,"sMS")=="Draft"){fShowDeliveryReport=false}if(oVLV.isCnvVw&&oVLV.isCnvVw()){var oRP=this.gtCnvRP();if(oRP){var oIP=oRP.oItemParts[this.gtSelItms()[0]];if(oIP&&oIP.fDraft){fShowDeliveryReport=false}}}var oCallerSubPage=this.get_SubPage();var fJnkItem=oVLV.gtRwPrp(sId,"fJnk")=="1";var fJnkFolder=isJnkFld(oCallerSubPage);if(fJnkFolder||fPhsh||fJnkItem){oContextMenu.showMenuItems(["divR","divRA","divPR","divMIA","divMIT","divMID","divS2"],0);if(oContextMenu._getDescendant("divCht"))oContextMenu.showMenuItem("divCht",0)}else{if(fCRpl){oContextMenu.showMenuItem("divR",1);if(oContextMenu._getDescendant("divCht")){oContextMenu.showMenuItem("divCht",1);if(!g_fIsIMEnab||!gtMstr()||!gtMstr().g_fSignedIn||(isMSNPrv()&&(!this.isReadingPaneOn()||(this._iTempReadingPaneItemId!=sId)||!(oRdPn=this.gtCnvRP())||!(oSpn=oRdPn._getDescendant("spnFrom"))||!isBuddy(oSpn.getAttribute("_uri"))))){oContextMenu.enableMenuItem("divCht",0)}else{oContextMenu.enableMenuItem("divCht",1)}}oContextMenu.showMenuItem("divRA",!fPst);oContextMenu.showMenuItem("divPR",fPst)}else{oContextMenu.showMenuItems(["divR","divRA","divPR"],0);if(oContextMenu._getDescendant("divCht"))oContextMenu.showMenuItem("divCht",0)}var fInDelItems=oVLV.gtRwPrp(sId,"fInDelItms")=="1";var fSmr=oVLV.gtRwPrp(sId,"fMR")=="1"&&oVLV.gtRwPrp(sId,"fRR")=="1"&&oVLV.gtRwPrp(sId,"fDoR")!="1"&&!this.isPF()&&!fPhsh&&!fInDelItems;oContextMenu.showMenuItems(["divMIA","divMIT","divMID","divS2"],fSmr)}oContextMenu.showMenuItems(["divF","divS1"],1);if(oContextMenu._getDescendant("divCR")){oContextMenu.showMenuItem("divCR",fCRpl);oContextMenu.enableMenuItem("divCR",!isWP()&&!this.isPF()&&!fPst&&!this.isOMF())}if(isJnkEnbl()){oContextMenu.showMenuItems(["divJnk","divS5"],!this.isPF()&&!this.isOMF());if(fJnkFolder||fJnkItem){oContextMenu.showMenuItems(["divNtJnk","divS11"],!fPhsh)}else{oContextMenu.showMenuItems(["divNtJnk","divS11"],0)}}}if(oContextMenu._getDescendant("divDelPtg")){if(g_oFldrMgr.isMyFId(this.get_FolderId())||g_oFldrMgr.gtFL(this.get_FolderId())==FL_AMB){oContextMenu.showMenuItem("divDelPtg",1);var rgS=oVLV.gtSel();var delCM=Owa.UIControls.DeletePolicyContextMenu.get_Instance(this.get_SubPage());delCM.set_SelectedIds(rgS);delCM.set_LocalFolderId(this.get_FolderId())}else{oContextMenu.showMenuItem("divDelPtg",0)}}if(oContextMenu._getDescendant("divMvPtg")){if(isJnkFld(this.get_SubPage())||!g_oFldrMgr.isMyFId(this.get_FolderId())){oContextMenu.showMenuItem("divMvPtg",0)}else{oContextMenu.showMenuItem("divMvPtg",1);var rgS=oVLV.gtSel();var mvCM=Owa.UIControls.MovePolicyContextMenu.get_Instance(this.get_SubPage());mvCM.set_SelectedIds(rgS);mvCM.set_LocalFolderId(this.get_FolderId())}}oContextMenu.enableMenuItem("divPR",this.hasEROnFld(ER_CC));if(isSWP())oContextMenu.showMenuItems(["divS6","divMvToF","divCpToF"],0);var fAR=0;var rg=oVLV.gtSel();for(var i=0;i<rg.length&&!fAR;i++)fAR|=isApprovalRequest(this.getItemType(rg[i],oVLV));oContextMenu.showMenuItems(["divFIA","divF","divS3"],!fAR);var fReplyRestricted=this.isRightRestricted(oVLV,"fReplyRestricted","fRplR");var fReplyAllRestricted=this.isRightRestricted(oVLV,"fReplyAllRestricted","fRAR");var fForwardRestricted=this.isRightRestricted(oVLV,"fForwardRestricted","fFR");var fSharingItem=isFtEnab(FT_CAL)&&this.isSharingItemSelected(oVLV);oContextMenu.enableMenuItem("divF",!fSharingItem&&!fForwardRestricted);oContextMenu.enableMenuItem("divFIA",!fForwardRestricted);oContextMenu.enableMenuItem("divR",!fReplyRestricted);oContextMenu.enableMenuItem("divRA",!fReplyAllRestricted);if(oVLV.isCnvVw&&oVLV.isCnvVw()&&!oVLV.isSelExp()){var iRCnv=oVLV.gtCnvRS(rg[0]);for(var i=1;i<rg.length&&iRCnv!=0;i++){if(oVLV.gtCnvRS(rg[i])!=iRCnv){iRCnv=0;break}}oContextMenu.showMenuItem("divMR",(iRCnv<=0));oContextMenu.showMenuItem("divMU",(iRCnv>=0))}if(this.isCnvSelected()){if(oContextMenu._getDescendant("divJnk")){oContextMenu.showMenuItems(["divJnk","divS5"],0)}if(oContextMenu._getDescendant("divCht"))oContextMenu.showMenuItem("divCht",0);var oData=oVLV.getData(oVLV.gtRwById(rg[0]));if(oContextMenu._getDescendant("divCR")&&oData&&!oData.getAttribute("sMID")){oContextMenu.showMenuItem("divCR",0)}if(!this.isReadingPaneOn()||rg.length>1){oContextMenu.showMenuItems(["divPR","divR","divRA","divF","divFIA","divS1","divS2","divS3"],0)}if(!oData||oData.getAttribute("iGC")>1){fShowDeliveryReport=false}}if(this.isOMF()){fShowDeliveryReport=false}if(g_oFldrMgr.gtFL(this.get_FolderId())==FL_AMB){fShowDeliveryReport=false}if(oContextMenu._getDescendant("divOpDlvRp")){oContextMenu.showMenuItems(["divSODL","divOpDlvRp"],fShowDeliveryReport)}var oDivSep=oContextMenu._getDescendant("divCustomSep");if(!oDivSep)return;var nMaxCustomMenuItemCount=10;var rgSelItemIds=oVLV.gtSel();var sItemType=null;var fSameType=true;for(var j=0;j<rgSelItemIds.length;j++){var sT=oVLV.gtPrpV(oVLV.gtRwById(rgSelItemIds[j]),"t");if(sItemType&&sT!=sItemType){fSameType=false;break}else if(!sItemType){sItemType=sT}}var rgCustomIds=oContextMenu.get_CustomMenuIds();var rgIdToShow=new Array();var rgIdToHide=new Array();for(var i=0;i<rgCustomIds.length;i++){var sItemId=rgCustomIds[i];var fShw=true;var sTypeOfMenu=oContextMenu.getMenuItemAttribute(sItemId,"_sT");if(sTypeOfMenu){var rgTypesOfMenu=sTypeOfMenu.split(";");if(fSameType){fShw=false;for(var j=0;j<rgTypesOfMenu.length;j++){var s=rgTypesOfMenu[j].trim();if(s.length>2&&s.substr(s.length-2)==".*"){s=s.substr(0,s.length-2);if(isOfClss(sItemType,s))fShw=true}else{if(s==sItemType)fShw=true}if(fShw)break}}else{fShw=false}}if(fShw&&rgIdToShow.length<nMaxCustomMenuItemCount)rgIdToShow.push(sItemId);else rgIdToHide.push(sItemId)}oContextMenu.showMenuItems(rgIdToShow,true);oContextMenu.showMenuItems(rgIdToHide,false);oDivSep.set_IsShown(rgIdToShow.length>0)};_oPrototype.cmPreShwCnt=function Owa$Pages$ListViewSubPage$cmPreShwCnt(oContextMenu,iT){var oVLV=this.get_VirtualListView();var f=canEml(oVLV);var rgo=["divNM","divS1"];if(oContextMenu._getDescendant("divNMR"))rgo.push("divNMR");oContextMenu.showMenuItems(rgo,f);if(g_fIsIMEnab){var fIM=this.canIM(oVLV);var divCht=this.oDivViewMenu.getDescendantById("divCht");var divS4=this.oDivViewMenu.getDescendantById("divS4");var divAdBdyLst=this.oDivViewMenu.getDescendantById("divAdBdyLst");var divRmBdyLst=this.oDivViewMenu.getDescendantById("divRmBdyLst");oContextMenu.showMenuItem("divCht",fIM);oContextMenu.enableMenuItem("divCht",!(gtMstr()&&gtMstr().g_iIM_SI));if(fIM){var fBdy=0;if(gtIMMgr())fBdy=gtIMMgr().bdyLst.IsBdy(oVLV.gtRwPrp(oVLV.gtSel()[0],"uri"));oContextMenu.showMenuItem("divAdBdyLst",!fBdy);oContextMenu.showMenuItem("divRmBdyLst",fBdy);if(isMSNPrv()){oContextMenu.enableMenuItem("divCht",fBdy)}}else{oContextMenu.showMenuItems(["divS4","divAdBdyLst","divRmBdyLst"],0)}}if((iT!=LVT_CTM)&&(iT!=LVT_CTL)&&(iT!=LVT_CTP)&&oContextMenu._getDescendant("divS2")){oContextMenu.showMenuItems(["divS2","divACT"],1)}};_oPrototype.refresh=function Owa$Pages$ListViewSubPage$refresh(sSelId,fForceRefresh){var oVLV=this.get_VirtualListView();if(oVLV)oVLV.rfrsh(1,null,fForceRefresh)};_oPrototype.unselect=function Owa$Pages$ListViewSubPage$unselect(){var fTimerExpired=(this.setItmRead_toID==null);var oVLV=this.get_VirtualListView();this.cnclMkRd();var iMR=this.get_MarkAsReadBehaviour();if((iMR==MR_SELCHANGE||(iMR==MR_DELAYED&&fTimerExpired))&&this.get_ItemIdInReadingPane()!=null&&this.isUnrd(this.get_ItemIdInReadingPane(),1)){this.setItmRead()}if(oVLV&&oVLV.iT==LVT_MSG){var oInfobar=new Owa.UIControls.Infobar(this._getDescendant("divInfobar"));var fNeedRefresh=0;var oMessage=oInfobar.getMessageById("divOofIB");if(oMessage){oInfobar.removeMessage(oMessage);fNeedRefresh=1}oMessage=oInfobar.getMessageById("divPwdIB");if(oMessage){oInfobar.removeMessage(oMessage);fNeedRefresh=1}if(fNeedRefresh){this.adjustLvRpContainerTop()}}if(oVLV&&oVLV.isTskVw())this.clearQuickTask();var oMediaPlayer=Owa.UIControls.MediaPlayer.get_Instance();if(oMediaPlayer&&oMediaPlayer.get_Controller()==oVLV)oMediaPlayer.set_Controller(null)};_oPrototype.select=function Owa$Pages$ListViewSubPage$select(oCtx){var oVLV=this.get_VirtualListView();var oSearchControl=this.get_SearchControl();if(!oVLV)return;oVLV.makeFocused();var fR=oCtx.fR||oVLV.isFltrd();if(fR){if(oVLV.isFltrd()&&oSearchControl)oSearchControl.clearSearch(1);if(oCtx.sFltr)oVLV.stFltr(oCtx.sFltr);var sMId=oCtx.mId;if(sMId)oVLV.seekRw(sMId);else this.ref()}else{this.udRP()}if(!fR)this.gtFldSz();if(oVLV.isCnvVw&&oVLV.isCnvVw()){var oRP=this.gtCnvRP();if(oRP&&!oRP.get_IsRefreshing()){this.refreshConversationRP(true)}}this.adjustLvRpContainerTop();this.adjustVLVToolbars()};_oPrototype.hideDialogs=function Owa$Pages$ListViewSubPage$hideDialogs(){setTitleWidth(this.get_SubPage());Owa.UIControls.NotificationDialog.hideAllDialogs();hideOpenMailboxDialog()};_oPrototype.onErrorVw=function Owa$Pages$ListViewSubPage$onErrorVw(oE){if(oE.iEC==440)rplLgn();else alrt(oE.sMsg)};_oPrototype.onNavigateVw=function Owa$Pages$ListViewSubPage$onNavigateVw(oE){var oVLV=this.get_VirtualListView();var ctx=oE.oCtx;var fClW=oE.fCl;if(oVLV.iT!=LVT_DOC)this.openItms(null,ctx,fClW);else opnDocLstItm()};_oPrototype.del=function Owa$Pages$ListViewSubPage$del(fP,rgId,rgRTOcc,fRf,fIgnoreConversations){if(g_fDeleteInProgress){return}var oVLV=this.get_VirtualListView();if(!rgId)rgId=oVLV.gtSel(1);var iC=rgId.length+(rgRTOcc?rgRTOcc.length:0);if(!iC)return;if(iC>MAX_REQ_ITMS){alrt(L_ErrMaxItms);return}if(oVLV.fROLv)return;if(fP&&!confirm(L_PrDelPrp)){return}else if(this.checkCnvHasPermanentDeleteItems(rgId)&&!confirm(L_PrParDelPrp)){return}g_fDeleteInProgress=1;fRf|=oVLV.isFltrd();this.cnclMkRd();var fnNextStep=Owa.Utility.createDelegate(this,this.sndDel);if(fIgnoreConversations&&(PONT_IGNCNV&a_iEnblPnt)){fnNextStep=Owa.Utility.createDelegate(this,this.showIgnorePont)}var oMM=new Object();if(!this.isCnvId(rgId[0])){var oRP=this.gtCnvRP();for(var i=0;i<rgId.length;i++){var sT=oVLV.gtRwPrp(rgId[i],"t");if(!sT){var oIP=oRP.oItemParts[rgId[i]];if(oIP){sT=oIP.get_ItemType()}}if(isOfClss(sT,IT_MTR)||isOfClss(sT,IT_MTC)){oMM[rgId[i]]=true}}}if(oVLV.isCnvVw&&oVLV.isCnvVw()&&(!oRP||!oRP.get_IsContextActionProcessing())){oVLV.cnvDel(rgId,oMM,fP,fRf,fnNextStep,fIgnoreConversations)}else{fnNextStep(fP,rgId,oMM,rgRTOcc,fRf||(oRP&&oRP.get_IsContextActionProcessing()),oRP&&oRP.get_IsContextActionProcessing(),fIgnoreConversations)}};_oPrototype.showIgnorePont=function Owa$Pages$ListViewSubPage$showIgnorePont(fP,rgId,oMM,rgRTOcc,fRf,fCnv){var oC={};oC.fP=fP;oC.rgId=rgId;oC.oMM=oMM;oC.rgRTOcc=rgRTOcc;oC.fRf=fRf;oC.fCnv=fCnv;shwPont(PONT_IGNCNV,L_IgnCnvWrn,L_IgnCnv,[L_OK,L_Cncl],0,Owa.Utility.createDelegate(this,this.cbShowIgnorePont),oC)};_oPrototype.cbShowIgnorePont=function Owa$Pages$ListViewSubPage$cbShowIgnorePont(iB,oC){var fAbort=(iB==-1||iB==1);this.sndDel(oC.fP,oC.rgId,oC.oMM,oC.rgRTOcc,oC.fRf,oC.fCnv,1,fAbort)};_oPrototype.checkCnvHasPermanentDeleteItems=function Owa$Pages$ListViewSubPage$checkCnvHasPermanentDeleteItems(rgIds){var oVLV=this.get_VirtualListView();if(oVLV.isCnvVw){var oRP=this.gtCnvRP();for(var iId=0;iId<rgIds.length;++iId){if(!this.isCnvId(rgIds[iId])){var fInDelItms=oVLV.gtRwPrp(rgIds[iId],"fInDelItms");if(fInDelItms){if(fInDelItms=="1"){return true}}else if(oRP&&oRP.isDeletedItem(rgIds[iId])){return true}}}}return false};_oPrototype.sndDel=function Owa$Pages$ListViewSubPage$sndDel(fP,rgId,oMM,rgRTOcc,fRf,fCnv,fIgnoreConversations,fAbortDelete){if(fAbortDelete){g_fDeleteInProgress=0;return}var oVLV=this.get_VirtualListView();var oCtx=new Object();oCtx.rgId=rgId;oCtx.fRf=fRf;oCtx.fP=fP;oCtx.fCnv=fCnv;oCtx.fIgnoreConversations=fIgnoreConversations;var sC;if(fIgnoreConversations){sC="IgnoreConversations"}else{sC=fP?"PermanentDelete":"Delete"}var oR=new oeReq(oVLV.sEvtNS,sC,oCtx,this._createCallback(this.cbDel));var oSt;var rgItms=new Array();if(this.isCnvId(rgId[0])){oR.addRg("Cnvs",rgId)}else{for(var i=0;i<rgId.length;i++){oSt=new oeSt(oR,"ItmInf");oSt.add("ID",rgId[i]);if(oMM[rgId[i]]){oSt.add("MM",1)}rgItms.push(oSt)}oR.addRgSt("Itms",rgItms);if(rgRTOcc&&rgRTOcc.length){oR.addRg("RTOcc",rgRTOcc)}}oR.add("fId",oVLV.get_DataFolderId());if(fP)this.adJnkSt(oR);oVLV.onBeforeRemoveRows(rgId);oR.send()};_oPrototype.adJnkSt=function Owa$Pages$ListViewSubPage$adJnkSt(oR){oR.add("JS",this.gtJnkSt())};_oPrototype.gtJnkSt=function Owa$Pages$ListViewSubPage$gtJnkSt(){var oVLV=this.get_VirtualListView();if(oVLV.fJnk){if(oVLV.isFltrd())return JES_UNK;else return JES_JNK}return JES_NJNK};_oPrototype.cbDel=function Owa$Pages$ListViewSubPage$cbDel(oR){try{var oVLV=this.get_VirtualListView();if(!cbOeh(oR))return;var fF=0;if(this.isPF()||this.isOMF())fF=shwRspWrn(oR,"errDel");if(oR.oCtx.fRf||fF){if(this.get_SearchControl())this.get_SearchControl().fReExecuteSearch=true;oVLV.rfrsh()}else{oVLV.updCnts(oR);oVLV.rmvRws(oR.oCtx.rgId)}if(oR.oCtx.fCnv){var oRP=this.gtCnvRP();if(oRP){oRP.rmvIPs(oR.oCtx.rgId)}}if(oR.oCtx.fP&&!this.isPF()&&!this.isOMF()){if(oVLV.iT==LVT_MSG){var oParentSubPage=this.get_ParentSubPage();if(oParentSubPage)oParentSubPage.invokeSubPageFunction("getMailboxUsage")}}}finally{g_fDeleteInProgress=0}};_oPrototype.tglRP=function Owa$Pages$ListViewSubPage$tglRP(newState){var oVLV=this.get_VirtualListView();if(newState==this.get_ReadingPanePosition()){return}if(newState==RP_OFF){this.cnclMkRd()}this._getDescendant("divLVDivider").set_IsShown(newState!=RP_OFF);this._getDescendant("divRPContainer").set_IsShown(newState!=RP_OFF);if(newState==RP_OFF){this._getDescendant("divLVContainer").set_Width(100,Owa.Style.Unit.Percent)}else if(newState==RP_RIGHT){this._getDescendant("divLVContainer").set_Width(this.get_ViewWidth(),Owa.Style.Unit.Pixels)}if(this.get_SearchControl())this.get_SearchControl().fixSearchControlStyles();var t=oVLV.iT;if(!this.isPkrVw()){var oR=new oeReq(oVLV.sEvtNS,"PersistReadingPane",null,this._createCallback(this.cbTglRP));oR.add("s",newState);if(t!=LVT_CTL&&t!=LVT_DRL&&t!=LVT_RML){oR.add("fId",oVLV.sSid)}oR.send()}this.set_ReadingPanePosition(newState);if(this.isReadingPaneOn())this.udRP();this._oFilterInfobar.resize();this.adjustVLVToolbars();oVLV.makeFocused()};_oPrototype.cbTglRP=function Owa$Pages$ListViewSubPage$cbTglRP(oR){if(oR.fST)rplLgn()};_oPrototype.updateReadingPaneSortOrder=function Owa$Pages$ListViewSubPage$updateReadingPaneSortOrder(fNewestOnTop){var oVLV=this.get_VirtualListView();var oR=new oeReq(oVLV.sEvtNS,"PersistReadingPaneSortOrder",0,this._createCallback(this.updateReadingPaneSortOrderCallback),POST);oR.add("isNewestOnTop",fNewestOnTop?1:0);oR.send();this.set_NewestOnTop(fNewestOnTop);this.adjustVLVToolbars()};_oPrototype.updateReadingPaneSortOrderCallback=function Owa$Pages$ListViewSubPage$updateReadingPaneSortOrderCallback(oR){var oVLV=this.get_VirtualListView();if(!cbOeh(oR))return;var oRP=this.gtCnvRP();if(oRP){oRP.rfrsh(0,1);if(oVLV.gtRws(1).length>0){var sExpId=oVLV.sExpId;oVLV.exp(sExpId)}}};_oPrototype.updateListViewExpansion=function Owa$Pages$ListViewSubPage$updateListViewExpansion(fShowTree){var oVLV=this.get_VirtualListView();var oR=new oeReq(oVLV.sEvtNS,"PersistShowTreeInListView",0,this._createCallback(this.updateListViewExpansionCallback),POST);oR.add("showTreeInListView",fShowTree?1:0);oR.send()};_oPrototype.updateListViewExpansionCallback=function Owa$Pages$ListViewSubPage$updateListViewExpansionCallback(oR){var oVLV=this.get_VirtualListView();if(!cbOeh(oR))return;if(oVLV.gtRws(1).length>0){var sExpId=oVLV.sExpId;oVLV.exp(sExpId)}};_oPrototype.vwCpMv=function Owa$Pages$ListViewSubPage$vwCpMv(sDstFId,fD,sFT,fC){var oVLV=this.get_VirtualListView();var oDraggableObject=oVLV.crtDC();if(!oDraggableObject)return;var oRootElement=oDraggableObject.get_RootElement();if(!isValidDropFolder(oDraggableObject,sFT)){alrt(L_MvUnmtchTyp);return}var oListView=oVLV;if(checkLimit(oDraggableObject,oListView))return;var rgIds=[];oRootElement.foreach_Item(function(oItemElement){rgIds.push(oItemElement.get_ItemId())});g_oFldrMgr.cpMvItms(wt(),this.get_SubPage(),oVLV.get_DataFolderId(),rgIds,sDstFId,fC);this.refreshConversationRP()};_oPrototype.onBRfrshVw=function Owa$Pages$ListViewSubPage$onBRfrshVw(fA){if(!fA)this.cnclMkRd();this.clearDirtyFlagOnView()};_oPrototype.clearDirtyFlagOnView=function Owa$Pages$ListViewSubPage$clearDirtyFlagOnView(){var oVLV=this.get_VirtualListView();var oParentSubPage=this.get_ParentSubPage();if(oParentSubPage)oParentSubPage.invokeSubPageFunction("stDrty",[oVLV.sSid,1])};_oPrototype.renameFolderName=function Owa$Pages$ListViewSubPage$renameFolderName(sName){this._getDescendant("spnFolderName").set_TextContent(sName)};_oPrototype.onERfrshVw=function Owa$Pages$ListViewSubPage$onERfrshVw(oSpnSR){var oVLV=this.get_VirtualListView();this.updateFolderItemCounts(oSpnSR);if(oVLV.isDumpsterVw()){oVLV.updCnts()}var oParentSubPage=this.get_ParentSubPage();if(oParentSubPage){this.fireUpdCnt();var sId=oParentSubPage.getNewMessageId();if(sId)oVLV.selRwById(sId)}if(oVLV.iT==LVT_MSG){this.gtFldSz()}if(oVLV.isCnvVw&&oVLV.isCnvVw()&&!oVLV.isEmpty()){this._setTimeout(this.refreshConversationRP,1)}};_oPrototype.updateFolderItemCounts=function Owa$Pages$ListViewSubPage$updateFolderItemCounts(oSpnSR,oContext){var oVLV=this.get_VirtualListView();var oFolderCount=this._getDescendant("spnFC");if(oFolderCount){if(oVLV.isFltrd()){if(oSpnSR){var oSearchResults=this._getDescendant("divVwFN").getDescendantById("spnSR");if(oSearchResults){oSearchResults.remove(true)}oFolderCount.set_IsShown(false);this._getDescendant("spnFC").insertAdjacentElement(Owa.ElementInsertionPoint.AfterEnd,oSpnSR)}}else{var oSearchResults=this._getDescendant("divVwFN").getDescendantById("spnSR");if(oSearchResults){oSearchResults.remove(true)}oFolderCount.set_IsShown(true);var iTotalCount,iUnreadCount;if(!oContext){iTotalCount=oVLV.gtTIC();if(oVLV.iT==LVT_MSG){iUnreadCount=oVLV.gtUC()}}else{iTotalCount=oContext.iTotalCount;iUnreadCount=oContext.iUnreadCount}this._getDescendant("spnIC").set_TextContent(iTotalCount.toString());if(oVLV.iT==LVT_MSG){var oUnreadCount=this._getDescendant("spnUC");oUnreadCount.set_TextContent(iUnreadCount.toString());var fHU=(iUnreadCount!=0);this._getDescendant("spnUCC").set_IsShown(fHU);this._getDescendant("spnCD").set_IsShown(fHU)}}}if(oVLV.iT==LVT_MSG&&!oVLV.isFltrd()&&oContext){if(this._oFolderCountTimer){clearTimeout(this._oFolderCountTimer)}this._oFolderCountTimer=this._setTimeout(this.synchronizeFolderCounts,FOLDER_COUNT_SYNC_DURATION,oContext)}};_oPrototype.synchronizeFolderCounts=function Owa$Pages$ListViewSubPage$synchronizeFolderCounts(oContext){var oVLV=this.get_VirtualListView();if(oVLV.gtTIC()!=oContext.iTotalCount||oVLV.gtUC()!=oContext.iUnreadCount){oVLV.rfrsh(1)}this._oFolderCountTimer=null};_oPrototype.refreshConversationRP=function Owa$Pages$ListViewSubPage$refreshConversationRP(f,iDelay){var oVLV=this.get_VirtualListView();var oRP=this.gtCnvRP();if(oRP){var rgCnv=new Array(oRP.get_Id());oRP.rfrsh(iDelay,f,oVLV.gtCnvGC(rgCnv),oVLV.gtCnvTC(rgCnv),oVLV.gtCnvUC(rgCnv))}};_oPrototype.onRmvItmsVw=function Owa$Pages$ListViewSubPage$onRmvItmsVw(){if(this.get_SearchControl())this.get_SearchControl().fReExecuteSearch=true};_oPrototype.updMlddm=function Owa$Pages$ListViewSubPage$updMlddm(){var oVLV=this.get_VirtualListView();if(oVLV.isCnvVw&&oVLV.isCnvVw()){var oN=this._getDescendant("divLVddm");if(oN)oN.set_IsShown(false)}else{var oN=this._getDescendant("divLVddm");if(oN)oN.set_IsShown(true);var sCmd=oVLV.isML()?"ml":"sl";updRd(this._getDescendant("divLVddm"),sCmd)}};_oPrototype.gtFldSz=function Owa$Pages$ListViewSubPage$gtFldSz(){var oVLV=this.get_VirtualListView();if((this._fFolderSizeFlag==0)&&this.get_ELCFolderWithQuota()&&(this.get_ELCFolderQuota()>0)&&!this.isPF()&&!this.isOMF()){this._fFolderSizeFlag=1;var oR=new oeReq(oVLV.sEvtNS,"GetELCFolderSize",0,this._createCallback(this.cbGtFldSz));oR.add("fId",(this.get_ELCFolderId()!=""?this.get_ELCFolderId():this.get_FolderId()));oR.send()}};_oPrototype.cbGtFldSz=function Owa$Pages$ListViewSubPage$cbGtFldSz(oR){if(oR.sErr){if(oR.fST)popLgn();shwErrDlg(oR)}else{var sFolderSize=Owa.DomUtility.getTextFromHtml(oR.sBody,"fldSz");if(sFolderSize){var iFldSz=parseInt(sFolderSize);var iPrcntUsd=0;iPrcntUsd=Math.round(iFldSz/this.get_ELCFolderQuota()*100);var oELCQuota=this._getDescendant("divElcQuota");if(!oELCQuota)return;var oSpnFldPrcntUsd=oELCQuota.getDescendantById("spnFldPrcntUsd");oSpnFldPrcntUsd.set_TextContent(""+iPrcntUsd);var oDivFldUsg=oELCQuota.getDescendantById("divFldUsg");var oDivFldExcd=oELCQuota.getDescendantById("divFldExcd");if(iPrcntUsd>=100){oDivFldUsg.set_IsShown(0);oDivFldExcd.set_IsShown(1)}else{oDivFldUsg.set_IsShown(1);oDivFldExcd.set_IsShown(0)}var oQB=oELCQuota.getDescendantById("elcQuotaBar");var iQtLvl;if(iPrcntUsd>=100)iQtLvl=QT_EXCD;else if(iPrcntUsd>=75)iQtLvl=QT_AW;else iQtLvl=QT_NRM;updQB(oQB,iPrcntUsd,iQtLvl)}}this._fFolderSizeFlag=0};_oPrototype.shwELCCmnt=function Owa$Pages$ListViewSubPage$shwELCCmnt(oEvent){var oVLV=this.get_VirtualListView();var fShw=oEvent.get_Target().getBoolAttribute("_fShow");var oInfobar=new Owa.UIControls.Infobar(this._getDescendant("divInfobar"));var oDvELC=oInfobar.getMessageById("divElcIB");if(oDvELC!=null){if(fShw){oDvELC.set_IsShown(1);oInfobar.set_IsShown(1)}else{oInfobar.hideMessage(oDvELC)}oDvELC.setBoolAttribute("isVisible",fShw);var oLnkShwELC=this._getDescendant("lnkShwELC");if(oLnkShwELC!=null)oLnkShwELC.set_IsShown(!fShw);this.adjustLvRpContainerTop();var oR=new oeReq(oVLV.sEvtNS,"PersistELCCommentState");oR.add("fId",oVLV.sSid);oR.add("fShwELC",fShw?1:0);oR.send()}};_oPrototype.openItms=function Owa$Pages$ListViewSubPage$openItms(sUrl,ctx,fCl,sT){var oVLV=this.get_VirtualListView();var rg=oVLV.gtSel();var sItemType=oVLV.gtRwPrp(rg[0],"sMT");if((rg.length==1)&&this.isCnvId(rg[0])&&sItemType){var oR=oVLV.gtRwById(rg[0]);var oData=oVLV.getData(oR);var sAction="Open";var sApplicationElement=getApplicationElementForItem("Item",sAction,sItemType,false,false);var sUrl="?ae="+sApplicationElement+"&a="+sAction+"&t="+urlEnc(sItemType)+"&id="+urlEnc(oData.getAttribute("sMID"));var sState=oData.getAttribute("sMS");if(sState){sUrl+="&s="+urlEnc(sState)}openItm(sUrl,null,null,null,null,this.get_SubPage());return}for(var iRg=rg.length-1;iRg>=0;--iRg){if(this.isCnvId(rg[iRg])){rg.removeAt(iRg)}}if(rg.length>0){this.openItmIds(rg,sUrl,ctx,fCl,sT)}};_oPrototype.openItmIds=function Owa$Pages$ListViewSubPage$openItmIds(rgS,sUrl,ctx,fCl,sT){var oVLV=this.get_VirtualListView();this.cnclMkRd();for(var i=0;i<rgS.length;++i){var id=rgS[i];var fPhsh=this.isPhsh(id);var t=sT?sT:this.gtItmType(id);var oCallerSubPage=this.get_SubPage();if((oVLV.iT==LVT_MSG)&&(isJnkFld(oCallerSubPage)||fPhsh)){if(!(isOfClss(t,IT_PST)&&sUrl&&sUrl.lc().indexOf("&a=postreply")!=-1))t=""}var iW=0;var iH=0;var fCnt=0;if((!(sUrl&&sUrl.lc().indexOf("&a=forward")>=0))&&(isOfClss(t,IT_CNT)||isOfClss(t,"AD.RecipientType"))){iW=RF_W;iH=RF_H}else if(isOfClss(t,IT_SMS)){if((oVLV.gtRwPrp(id,"s")=="Draft")||(sUrl&&sUrl.lc().indexOf("&a=reply")>=0)||(sUrl&&sUrl.lc().indexOf("&a=replyall")>=0)||(sUrl&&sUrl.lc().indexOf("&a=forward")>=0)){iW=SMS_W;iH=SMS_H}}if(isOfClss(t,IT_CNT)||isOfClss(t,IT_PDL)||this.isCntVw()){fCnt=1}if(sUrl){if((sUrl.lc().indexOf("&a=reply")>=0)&&fPhsh)continue;openItm(sUrl+"&t="+urlEnc(t)+"&id="+urlEnc(id)+(fCnt?"&s=Draft":""),0,0,iW,iH,this.get_SubPage())}else if(ctx!=null){openItm(this.getIUrl(id,"Open"),ctx,fCl,iW,iH,this.get_SubPage())}else{openItm(this.getIUrl(id,"Open"),0,0,iW,iH,this.get_SubPage())}if(this.isUnrd(id)){oVLV.mkRd(id)}}};_oPrototype.getLastUnselectedItemIdForMarkRead=function Owa$Pages$ListViewSubPage$getLastUnselectedItemIdForMarkRead(){var oMarkAsReadResult=null;var tmpLastUnSelectionState=this.oLastUnSelectionState;this.set_ItemIdInReadingPane(this._iTempReadingPaneItemId);this.set_ItemIdInConversation(this._iTempConversationItemPartId);this.oLastUnSelectionState=null;if(this.isReadingPaneOn()&&tmpLastUnSelectionState!=null&&tmpLastUnSelectionState.iCnvItmSts==MSG_MARKED_UNREAD){var oVLV=this.get_VirtualListView();oVLV.stRwPrp(tmpLastUnSelectionState.sMessageId,"read",MSG_UNREAD);oVLV.stRwPrp(tmpLastUnSelectionState.sRPItemId,"read",MSG_MARKED_UNREAD);return oMarkAsReadResult}var iMR=this.get_MarkAsReadBehaviour();if(this.isReadingPaneOn()&&tmpLastUnSelectionState!=null&&(iMR==MR_SELCHANGE||(iMR==MR_DELAYED&&tmpLastUnSelectionState.fTimerExpired))){if(tmpLastUnSelectionState.sRPItemId!=null&&tmpLastUnSelectionState.sRPItemId!=this._iTempConversationItemPartId){if(tmpLastUnSelectionState.fRPItemUnRead){oMarkAsReadResult=new Object();oMarkAsReadResult.sRPItemId=tmpLastUnSelectionState.sRPItemId;oMarkAsReadResult.sMessageId=tmpLastUnSelectionState.sMessageId;oMarkAsReadResult.sRPItemFId=tmpLastUnSelectionState.sRPItemFId}}else if(tmpLastUnSelectionState.sMessageId!=null&&tmpLastUnSelectionState.sMessageId!=this._iTempReadingPaneItemId&&tmpLastUnSelectionState.fMessageUnRead){oMarkAsReadResult=new Object();oMarkAsReadResult.sMessageId=tmpLastUnSelectionState.sMessageId}}return oMarkAsReadResult};_oPrototype.onSelChngVw=function Owa$Pages$ListViewSubPage$onSelChngVw(oE){var oVLV=this.get_VirtualListView();if(!oE.sMid){if(oVLV.isCnvVw&&oVLV.isCnvVw()){this.refreshConversationRP()}else{this.udRP(1)}return}if(this.isPkrVw()){var oParentSubPage=this.get_ParentSubPage();if(oParentSubPage){oParentSubPage.invokeSubPageFunction("updPkrBtns")}}if(this.isCntVw(oVLV.iT))this.udCntFnc();if(oVLV.isTskVw())this.udTskTB();if((!oE.fSel&&oE.sMid==this.get_ItemIdInReadingPane()&&oE.sIid==this.get_ItemIdInConversation())||oVLV.gtSelCnt()<1){this.oLastUnSelectionState=new Object();this.oLastUnSelectionState.fRPItemUnRead=this.isUnrd(this.get_ItemIdInConversation(),1);this.oLastUnSelectionState.fMessageUnRead=this.isUnrd(this.get_ItemIdInReadingPane(),1);this.oLastUnSelectionState.sMessageId=this.get_ItemIdInReadingPane();this.oLastUnSelectionState.sRPItemId=this.get_ItemIdInConversation();this.oLastUnSelectionState.sRPItemFId=oVLV.gtRwPrp(this.get_ItemIdInConversation(),"fId");this.oLastUnSelectionState.fExp=oE.fExp;this.oLastUnSelectionState.fTimerExpired=this.setItmRead_toID==null;this.oLastUnSelectionState.iCnvItmSts=oVLV.gtRwPrp(this.get_ItemIdInReadingPane(),"read")}if(oVLV.gtSelCnt()<1){this._setTimeout(this._onSelChngVwClrCallback,10);return}var sMid=oE.sMid;var sIid=oE.sIid;var fSel=oE.fSel;if(oE.fExp){if(!oE.fDontUdRP){if(oE.fSel&&oVLV.gtSelCnt()==1){this._iTempConversationItemPartId=oE.sIid;this.cnclMkRd();if(this.isReadingPaneOn()&&this.isUnrd(oE.sIid,true)&&this.get_MarkAsReadBehaviour()==MR_DELAYED){this.setItmRead_toID=this._setTimeout(this.setItmRead,a_iMRDelay*1000,true)}}this.setLastSelectionRead();this.udCnvRP()}else{this.udMsgTB()}if(this.isReadingPaneOn())this.shRP(1);return}if(!fSel){if(this.get_ItemIdInReadingPane()==sMid){var rgS=oVLV.gtSel();sMid=rgS[0]}else{this.oLastUnSelectionState=null;return}}else if(fSel&&oVLV.gtSelCnt(1)>1&&!oE.fForceRpUd){return}if(this.isReadingPaneOn())this.shRP(1);this._iTempReadingPaneItemId=sMid;this._iTempConversationItemPartId=sIid;if(this.isReadingPaneOn()&&!oE.fDontUdRP){this.cnclURP();var now=new Date();var lst=(now-this._dtLastUpdateRP);this._dtLastUpdateRP=now;if(lst<g_iUdRpDl){this.udRP_toID=this._setTimeout(this.udRP,g_iUdRpDl-lst)}else{this.udRP(oE.fForceRpUd)}}};_oPrototype._onSelChngVwClrCallback=function Owa$Pages$ListViewSubPage$_onSelChngVwClrCallback(){var oVLV=this.get_VirtualListView();if(oVLV.gtSelCnt()<1){this.cnclMkRd();if(this.isReadingPaneOn())this.shRP(0);this.setLastSelectionRead()}};_oPrototype.udMsgTB=function Owa$Pages$ListViewSubPage$udMsgTB(){var oSubPageActionTable=this.get_SubPage().get_ActionTable();oSubPageActionTable.getAction(BID_DL).enable();oSubPageActionTable.getAction(BID_MV).enable();this.udMsgRplFwdTB()};_oPrototype.setReplyByChatAvailability=function Owa$Pages$ListViewSubPage$setReplyByChatAvailability(btn){var oCallerSubPage=btn.get_SubPage();var sId=oCallerSubPage.gtSelItms()[0];var fChatEnabled=g_fIsIMEnab&&gtMstr()&&gtMstr().g_fSignedIn&&(!isJnkFld(oCallerSubPage))&&(!oCallerSubPage.isPhsh(sId));var oButton=Owa.Components.ToolbarCollection.get(oCallerSubPage).getButton(BID_REC);if(!oButton){return}if(fChatEnabled&&isMSNPrv()){try{var ifRP=oButton.get_SubPage()._getDescendant("ifRP");var oReadingPaneSubPage=Owa.Components.SubPageControllerFactory.getControllerByElement(ifRP).get_SubPage();var sUri=oReadingPaneSubPage._getDescendant("spnFrom").getAttribute("_uri");fChatEnabled=isBuddy(sUri)}catch(e){fChatEnabled=0}}oButton.set_IsDisabled(!fChatEnabled)};_oPrototype.udMsgRplFwdTB=function Owa$Pages$ListViewSubPage$udMsgRplFwdTB(){var oVLV=this.get_VirtualListView();var oCallerSubPage=this.get_SubPage();var rg=this.gtSelItms();var iSC=rg.length;if(this.isCnvSelected()||iSC==0){if(!isJnkFld(oCallerSubPage)){this.enblRpl(1);this.enblRplAll(1);this.enblFwd(1)}this.get_SubPage().get_ActionTable().getAction("ntjnk").enable();return}var fSItmSl=(iSC==1);var fPhsh=0;var fReplyRestricted=0;var fReplyAllRestricted=0;if(fSItmSl){fPhsh=this.isPhsh(rg[0]);fReplyRestricted=this.isRightRestricted(oVLV,"fReplyRestricted","fRplR");fReplyAllRestricted=this.isRightRestricted(oVLV,"fReplyAllRestricted","fRAR")}if(!isJnkFld(oCallerSubPage)&&iSC>0){var fDsbl=fPhsh||iSC>1;if(!fDsbl){fDsbl=this.isJunkItemSelected()||!canItmRpl(this.gtItmType(rg[0]))}fReplyRestricted=fReplyRestricted||fDsbl;fReplyAllRestricted=fReplyAllRestricted||fDsbl;this.enblRpl(fReplyRestricted);this.enblRplAll(fReplyAllRestricted);with(Owa.Components.ToolbarCollection.get(oCallerSubPage)){if((oButton=getButton(BID_RECMB))&&(oButton._oComboDropDownTwisty)&&(getButton(BID_REC))){oButton._oComboDropDownTwisty.get_OnBeforePopup().add(this.setReplyByChatAvailability)}}}if(!isJnkFld(oCallerSubPage))this.shPRoRA();var oRP=this.gtCnvRP();if(isJnkEnbl()&&isJnkFld(oCallerSubPage)){if(!fSItmSl)this.get_SubPage().get_ActionTable().getAction("ntjnk").disable();else if(fPhsh)this.get_SubPage().get_ActionTable().getAction("ntjnk").disable();else{if(oRP!=null){if(oRP.isJunkItem(rg[0])){this.get_SubPage().get_ActionTable().getAction("ntjnk").enable()}else{this.get_SubPage().get_ActionTable().getAction("ntjnk").disable()}}else{this.get_SubPage().get_ActionTable().getAction("ntjnk").enable()}}if(fSItmSl&&fPhsh){this.get_SubPage().get_ActionTable().getAction(BID_RE).disable();this.get_SubPage().get_ActionTable().getAction(BID_RA).disable()}}if(!isJnkFld(oCallerSubPage)){var fApprovalRequestOrSharingMessage=0;for(var i=0;(i<rg.length)&&!fApprovalRequestOrSharingMessage;i++){var sType=this.getItemType(rg[i],oVLV,oRP);fApprovalRequestOrSharingMessage|=isApprovalRequest(sType)||(isFtEnab(FT_CAL)&&this.isSharingMessage(sType))}this.enblFwd(fApprovalRequestOrSharingMessage||this.isRightRestricted(oVLV,"fForwardRestricted","fFR"))}};_oPrototype.isJunkItemSelected=function Owa$Pages$ListViewSubPage$isJunkItemSelected(){var oVLV=this.get_VirtualListView();var sId=this.gtSelItms()[0];var fJnkItem;if(this.isReadingPaneOn()){var oRP=this.gtCnvRP();if(oRP!=null){if(oRP.isJunkItem(sId)){fJnkItem=true}}}else{fJnkItem=oVLV.gtRwPrp(sId,"fJnk")=="1"}return fJnkItem};_oPrototype.isCnvRowSelected=function Owa$Pages$ListViewSubPage$isCnvRowSelected(){var oVLV=this.get_VirtualListView();return oVLV.isCnvVw&&oVLV.isCnvVw()&&!oVLV.isSelExp()};_oPrototype.udTskTB=function Owa$Pages$ListViewSubPage$udTskTB(){var oVLV=this.get_VirtualListView();var rg=oVLV.gtSel();var fSItmSl=(rg.length==1);var fReplyRestricted=0;var fReplyAllRestricted=0;var fDsbl=0;if(fSItmSl){fDsbl=!canItmRpl(oVLV.gtRwPrp(rg[0],"t"));fReplyRestricted=this.isRightRestricted(oVLV,"fReplyRestricted","fRplR");fReplyAllRestricted=this.isRightRestricted(oVLV,"fReplyAllRestricted","fRAR")}this.enblRpl(!fSItmSl||fDsbl||fReplyRestricted);this.enblRplAll(!fSItmSl||fDsbl||fReplyAllRestricted);var fAllMailItm=1;for(var i=0;i<rg.length;i++){fAllMailItm&=canItmRpl(oVLV.gtRwPrp(rg[i],"t"))}Owa.Components.ToolbarCollection.get(this).set_IsButtonShown(BID_FWCMB,fAllMailItm);Owa.Components.ToolbarCollection.get(this).set_IsButtonShown(BID_FWA,!fAllMailItm);var fForwardRestricted=this.isRightRestricted(oVLV,"fForwardRestricted","fFR");Owa.Components.ToolbarCollection.get(this).set_IsButtonDisabled(BID_FWCMB,fForwardRestricted);Owa.Components.ToolbarCollection.get(this).set_IsButtonDisabled(BID_FWA,fForwardRestricted)};_oPrototype.get_IsFlaggedMailAndTasks=function Owa$Pages$ListViewSubPage$get_IsFlaggedMailAndTasks(){return this.getSubPageVariable("a_fFMT")};_oPrototype.isRightRestricted=function Owa$Pages$ListViewSubPage$isRightRestricted(oLV,itemPartProperty,listViewProperty){try{if(oLV.isCnvVw&&oLV.isCnvVw()){var oRP=this.gtCnvRP();if(oRP){var rg=oRP.gtSel();for(var i=0;i<rg.length;i++){var itemPart=oRP.oItemParts[rg[i]];if(itemPart&&itemPart[itemPartProperty]){return 1}}}return 0}var rg=oLV.gtSel();for(var i=0;i<rg.length;i++){if(getInt(oLV.gtRwPrp(rg[i],listViewProperty,0))==1){return 1}}}catch(e){}return 0};_oPrototype.isPhsh=function Owa$Pages$ListViewSubPage$isPhsh(sId){var oVLV=this.get_VirtualListView();var fPhsh=0;if(this.isCnvRowSelected()){var oRP=this.gtCnvRP();if(oRP&&oRP.oSel&&oRP.gtSel()&&oRP.oSel[oRP.gtSel()])fPhsh=getInt(oVLV.gtRwPrp(sId,"fPhsh",0))||oRP.oSel[oRP.gtSel()].fPhishing}else{fPhsh=getInt(oVLV.gtRwPrp(sId,"fPhsh",0))}var fPhshIgn=getInt(oVLV.gtRwPrp(sId,"fPhshIgn",0));return(fPhsh&&!fPhshIgn)};_oPrototype.isIgnPhsh=function Owa$Pages$ListViewSubPage$isIgnPhsh(sId){var oVLV=this.get_VirtualListView();var fPhsh=0;if(this.isCnvRowSelected()){var oRP=this.gtCnvRP();if(oRP&&oRP.oSel&&oRP.gtSel()&&oRP.oSel[oRP.gtSel()])fPhsh=getInt(oVLV.gtRwPrp(sId,"fPhsh",0))||oRP.oSel[oRP.gtSel()].fPhishing}else{fPhsh=getInt(oVLV.gtRwPrp(sId,"fPhsh",0))}var fPhshIgn=getInt(oVLV.gtRwPrp(sId,"fPhshIgn",0));return fPhsh&&fPhshIgn};_oPrototype.isItmOfType=function Owa$Pages$ListViewSubPage$isItmOfType(sId,msgType){var oVLV=this.get_VirtualListView();var fSameType=0;if(this.isCnvRowSelected()){var oRP=this.gtCnvRP();fSameType=(oVLV.gtRwPrp(sId,"sMT")==msgType);if(!fSameType&&oRP&&oRP.gtSel()){var rg=oRP.gtSel();for(var i=0;i<rg.length;i++){var itemPart=oRP.oItemParts[rg[i]];fSameType=itemPart&&(itemPart.get_ItemType()==msgType);if(!fSameType){break}}}}else{fSameType=isOfClss(oVLV.gtRwPrp(sId,"t"),msgType)}return fSameType};_oPrototype.stPhshIgn=function Owa$Pages$ListViewSubPage$stPhshIgn(sId){var oVLV=this.get_VirtualListView();if(oVLV.iT!=LVT_MSG)return;oVLV.stRwPrp(sId,"fPhshIgn","1");this.udMsgTB()};_oPrototype.rfVwPhsh=function Owa$Pages$ListViewSubPage$rfVwPhsh(oContext){var oVLV=this.get_VirtualListView();var sId=oContext.sId;var fUdRP=oContext.fUdRP;if(oVLV){if(this.isPF())this.stPhshIgn(sId);else oVLV.rfrsh(0);if(fUdRP){this.udRP(1)}}};_oPrototype.rfVwRemoveIrm=function Owa$Pages$ListViewSubPage$rfVwRemoveIrm(oContext){var oVLV=this.get_VirtualListView();var fUdRP=oContext.fUdRP;if(oVLV){oVLV.rfrsh(0)}if(fUdRP){this.udRP(1)}};_oPrototype.rfVwRemoveWB=function Owa$Pages$ListViewSubPage$rfVwRemoveWB(oContext){this.rfVwRemoveIrm(oContext)};_oPrototype.shRP=function Owa$Pages$ListViewSubPage$shRP(fS){showReadingPane("ifRP",fS,this.get_SubPage())};_oPrototype.udRP=function Owa$Pages$ListViewSubPage$udRP(f){var oVLV=this.get_VirtualListView();if(null==this._iTempReadingPaneItemId||!this.isReadingPaneOn())return;var fDoUd=f||(this._iTempReadingPaneItemId!=this.get_ItemIdInReadingPane());var sPggyBckMr=0;var fTimerExpired=this.setItmRead_toID==null;if(fDoUd){var oMarkAsReadResult=this.getLastUnselectedItemIdForMarkRead();if(oMarkAsReadResult){if(oMarkAsReadResult.sRPItemId){oVLV.mkRdIP(oMarkAsReadResult.sRPItemId,oMarkAsReadResult.sRPItemFId,oMarkAsReadResult.sMessageId);sPggyBckMr=oMarkAsReadResult.sRPItemId}else{var fRefreshCallback=this.isPF();oVLV.mkRd(oMarkAsReadResult.sMessageId,fRefreshCallback);sPggyBckMr=oMarkAsReadResult.sMessageId}}}this.cnclURP();this.cnclMkRd();if(this.isUnrd(this._iTempReadingPaneItemId,false)&&this.get_MarkAsReadBehaviour()==MR_DELAYED){this.setItmRead_toID=this._setTimeout(this.setItmRead,a_iMRDelay*1000)}if(fDoUd){var sMrQry=sPggyBckMr?("&mrd="+urlEnc(sPggyBckMr)+"&js="+this.gtJnkSt()):null;var sId=this.get_ItemIdInReadingPane();var sUrl=this.getIUrl(sId,"Preview",sMrQry);if(!sUrl)return;var oVLV=this.get_VirtualListView();var sType=oVLV.gtRwPrp(sId,"t");if(isSMime(sType))sUrl+=gtMmPar();var oRPContentWindow=this._getDescendant("ifRP").get_ContentWindow();if(!oRPContentWindow)return;var sCurrentLocation=null;try{sCurrentLocation=oRPContentWindow._domWindow.location.search}catch(e){}if(f||sUrl!=sCurrentLocation){if(oVLV&&oVLV.isFltrd()&&oVLV.isCnvVw&&oVLV.isCnvVw()){var oSearchControl=this.get_SearchControl();if(oSearchControl&&oSearchControl.sSearchText!=null&&oSearchControl.sSearchText.trim().length){sUrl=sUrl+"&sw="+urlEnc(oSearchControl.sSearchText)}}oRPContentWindow._domWindow.location=sUrl}if(this._oRPRefreshDelayTimer)this._clearTimeout(this._oRPRefreshDelayTimer);if(oVLV.gtRwPrp(this.get_ItemIdInReadingPane(),"read")==MSG_MARKED_UNREAD)oVLV.mkUnrd(this.get_ItemIdInReadingPane(),MSG_UNREAD)}updCmp(window)};_oPrototype.cnclURP=function Owa$Pages$ListViewSubPage$cnclURP(){if(this.udRP_toID){this._clearTimeout(this.udRP_toID)}this.udRP_toID=null};_oPrototype.getRPmid=function Owa$Pages$ListViewSubPage$getRPmid(){return this.get_ItemIdInReadingPane()};_oPrototype.getIUrl=function Owa$Pages$ListViewSubPage$getIUrl(sMid,sA,sOthr){var oVLV=this.get_VirtualListView();var sAe="Item";var t=oVLV.gtRwPrp(sMid,"t");if(!t)return;var fPhsh=this.isPhsh(sMid);var oCallerSubPage=this.get_SubPage();var fJnk=(oVLV.iT==LVT_MSG&&isJnkFld(oCallerSubPage));if(sA&&(sA=="Open")&&!fPhsh){if((!fJnk&&isCal(t))||((this.isPF()||this.isOMF())&&(isOfClss(t,IT_CNT)||isOfClss(t,IT_PDL)))||((this.isPF()||this.isOMF())&&isOfClss(t,IT_TSK)&&!oVLV.gtRwPrp(sMid,"fAT")))sAe="PreFormAction"}sAe=getApplicationElementForItem(sAe,sA,t,fJnk,fPhsh);var sUrl="?ae="+sAe;if(Owa.Utility.isSafari()){sUrl=getOwaVdir()+sUrl}if(sA)sUrl+="&a="+sA;if(!(fJnk||fPhsh)||t=="IPM.Conversation"){sUrl+="&t="+urlEnc(t);var sS=0;if(isOfClss(t,IT_CNT)||isOfClss(t,IT_PDL)){sS="Draft"}else if(isOfClss(t,IT_TSK)&&oVLV.gtRwPrp(sMid,"fAT")){sS="Assigned"}else if(!this.isPF()){sS=oVLV.gtRwPrp(sMid,"s")}if(sS)sUrl+="&s="+sS}sUrl+="&id="+urlEnc(sMid);if(this.isIgnPhsh(sMid))sUrl+="&ph=0";if(sOthr)sUrl+=sOthr;return sUrl};_oPrototype.getItemType=function Owa$Pages$ListViewSubPage$getItemType(sId,oVirtualListView,oConversationReadingPane){var sType=oVirtualListView.gtRwPrp(sId,"t");if(!sType&&oConversationReadingPane){var oItemPart=oConversationReadingPane.oItemParts[sId];if(oItemPart!=null)sType=oItemPart.get_ItemType()}return sType};_oPrototype.isSharingMessage=function Owa$Pages$ListViewSubPage$isSharingMessage(sItemType){return sItemType==IT_SHR};_oPrototype.isSharingItemSelected=function Owa$Pages$ListViewSubPage$isSharingItemSelected(oLV){var rg=oLV.gtSel();var fSharing=0;if(oLV.isCnvVw&&oLV.isCnvVw()&&!oLV.isSelExp()){for(var i=0;i<rg.length&&!fSharing;i++){var oR=oLV.gtRwById(rg[i]);var oData=oLV.getData(oR);if(oData)fSharing|=this.isSharingMessage(oData.getAttribute("sMT"))}}else{for(var i=0;i<rg.length&&!fSharing;i++)fSharing|=this.isSharingMessage(oLV.gtRwPrp(rg[i],"t"))}return fSharing};_oPrototype.enblRpl=function Owa$Pages$ListViewSubPage$enblRpl(f){f=f?1:0;if(this.enblRpl_dsbld==f)return;var oSubPageActionTable=this.get_SubPage().get_ActionTable();if(f){var oCallerSubPage=this.get_SubPage();if(!isJnkFld(oCallerSubPage)){oSubPageActionTable.getAction(BID_RE).disable();oSubPageActionTable.getAction(BID_RECMB).disable()}}else{var oCallerSubPage=this.get_SubPage();if(!isJnkFld(oCallerSubPage)){oSubPageActionTable.getAction(BID_RE).enable();oSubPageActionTable.getAction(BID_RECMB).enable()}}this.enblRpl_dsbld=f};_oPrototype.enblRplAll=function Owa$Pages$ListViewSubPage$enblRplAll(f){f=f?1:0;if(this.enblRplAll_dsbld==f)return;var oCallerSubPage=this.get_SubPage();var oPageWiseActionTable=this.get_SubPage().get_ActionTable();if(f){if(!isJnkFld(oCallerSubPage)){oPageWiseActionTable.getAction(BID_RA).disable()}}else{if(!isJnkFld(oCallerSubPage)){oPageWiseActionTable.getAction(BID_RA).enable()}}this.enblRplAll_dsbld=f};_oPrototype.enblFwd=function Owa$Pages$ListViewSubPage$enblFwd(f){f=f?1:0;if(this.enblFwd_dsbld==f)return;var oPageActionTable=this.get_SubPage().get_ActionTable();oPageActionTable.getAction(BID_FWCMB).set_Enabled(!f);oPageActionTable.getAction(BID_FW).set_Enabled(!f);this.enblFwd_dsbld=f};_oPrototype.initCnvRP=function Owa$Pages$ListViewSubPage$initCnvRP(){var oVLV=this.get_VirtualListView();var oRP=this.gtCnvRP();if(!oRP)return;oRP.onContextAction=this.get_ActionHandler();oRP.onPreContextMenuShow=this._createCallback(this.cmPreShw);oRP.set_ContextMenuEnabled(true);oRP.get_OnSelectionChanged().add(this._createCallback(this.udCnvLV));var oThis=this;oRP.get_OnMarkAsRead().add(function OnMarkAsReadCallBack(oEventArg){oThis.onMkRdItmPrt(oEventArg.sId,oEventArg.sFId,oEventArg.sCnvId)});oRP.get_OnConversationOutOfScope().add(function OnConversationOutOfScope(sCnvId){if(sCnvId==oVLV.get_SelectionAnchorId()||sCnvId==oVLV.sExpId){oVLV.removeSelectionAnchoredRow()}});oRP.get_OnConversationRefreshed().add(function OnConversationRefreshed(){oThis.updateConversationSortButton();oThis.udMsgTB()});oRP.get_OnExpandCollapse().add(function OnExpandCollapse(){oThis.updateExpandAllButton();oThis.udMsgTB();if(oVLV&&oVLV.oCM){oThis.cmPreShwMsg(oVLV.oCM)}});this.udCnvRP();this.udCnvLV();this.updateExpandAllButton()};_oPrototype.gtCnvRP=function Owa$Pages$ListViewSubPage$gtCnvRP(){if(this.isReadingPaneOn()){var oIfRP=this._getDescendant("ifRP");if(oIfRP){var oSubPageController=Owa.Components.SubPageControllerFactory.getControllerByElement(oIfRP);if(oSubPageController)return oSubPageController.getExpando("oRdCnv")}}};_oPrototype.isReadingPaneOn=function Owa$Pages$ListViewSubPage$isReadingPaneOn(){return(this.get_ReadingPanePosition()!=RP_OFF&&this.get_ReadingPanePosition()!=RP_NONE)};_oPrototype.udCnvRP=function Owa$Pages$ListViewSubPage$udCnvRP(){var oVLV=this.get_VirtualListView();var oRP=this.gtCnvRP();if(oVLV&&oRP&&oVLV.isCnvVw&&oVLV.isCnvVw()){var rgSel=oVLV.gtSel();var fCnv=this.isCnvId(rgSel[0]);if(!fCnv){oRP.setSel(rgSel);this.udMsgTB();if(oVLV&&oVLV.oCM){this.cmPreShwMsg(oVLV.oCM)}}}};_oPrototype.onMkRdItmPrt=function Owa$Pages$ListViewSubPage$onMkRdItmPrt(sId,sFId,sCnvId){var oVLV=this.get_VirtualListView();oVLV.mkRdIP(sId,sFId,sCnvId)};_oPrototype.udCnvLV=function Owa$Pages$ListViewSubPage$udCnvLV(){var oVLV=this.get_VirtualListView();if(!(oVLV&&oVLV.isCnvVw&&oVLV.isCnvVw()))return;var rg;var oRP=this.gtCnvRP();if(oRP)rg=oRP.gtSel();oVLV.setSel(rg);this.udMsgTB();if(oVLV&&oVLV.oCM){this.cmPreShwMsg(oVLV.oCM)}};_oPrototype.updateConversationSortButton=function Owa$Pages$ListViewSubPage$updateConversationSortButton(){var oRP=this.gtCnvRP();var fNwOnTop=oRP.get_IsNewestOnTop();if(fNwOnTop!=this.get_NewestOnTop()){this.set_NewestOnTop(fNwOnTop);Owa.Components.ToolbarCollection.get(this).getButton("newestOnTop").set_IsShown(fNwOnTop);Owa.Components.ToolbarCollection.get(this).getButton("oldestOnTop").set_IsShown(!fNwOnTop)}};_oPrototype.updateExpandAllButton=function Owa$Pages$ListViewSubPage$updateExpandAllButton(){var oRP=this.gtCnvRP();var fAllExpanded=oRP.get_AreAllItemPartsExpanded();Owa.Components.ToolbarCollection.get(this).getButton("expandAll").set_IsShown(!fAllExpanded);Owa.Components.ToolbarCollection.get(this).getButton("collapseAll").set_IsShown(fAllExpanded);this.adjustVLVToolbars(true)};_oPrototype.isCnvId=function Owa$Pages$ListViewSubPage$isCnvId(sId){if(sId)return sId.indexOf("CID.")==0||sId.indexOf("ACI.")==0};_oPrototype.gtSelItms=function Owa$Pages$ListViewSubPage$gtSelItms(){var oVLV=this.get_VirtualListView();if(oVLV.isCnvVw&&oVLV.isCnvVw()){var oRP=this.gtCnvRP();var rgRetVal=new Array();if(oRP){rgRetVal=oRP.gtSel()}else if(oVLV.isSelExp()){var rgS=oVLV.gtSel();for(var iRgs=0;iRgs<rgS.length;++iRgs){if(!this.isCnvId(rgS[iRgs])){rgRetVal.push(rgS[iRgs])}}}return rgRetVal}else{return oVLV.gtSel()}};_oPrototype.isCnvSelected=function Owa$Pages$ListViewSubPage$isCnvSelected(){var oVLV=this.get_VirtualListView();if(oVLV.isCnvVw&&oVLV.isCnvVw()){var rgS=oVLV.gtSel();if(rgS.length==1){return this.gtSelItms().length==0}else if(oVLV.isSelExp()){for(var iRgs=0;iRgs<rgS.length;++iRgs){if(this.isCnvId(rgS[iRgs])){return 1}}return 0}else{return rgS.length!=0}}else{return 0}};_oPrototype.gtItmType=function Owa$Pages$ListViewSubPage$gtItmType(id){var oVLV=this.get_VirtualListView();var oRP=this.gtCnvRP();if(oRP&&oRP.oItemParts[id]){return oRP.oItemParts[id].get_ItemType()}else{return oVLV.gtRwPrp(id,"t")}};_oPrototype.isUnrd=function Owa$Pages$ListViewSubPage$isUnrd(sMid,f){var oVLV=this.get_VirtualListView();var s=oVLV.gtRwPrp(sMid,"read");return(s==MSG_UNREAD||!f&&(s==MSG_MARKED_UNREAD))};_oPrototype.setLastSelectionRead=function Owa$Pages$ListViewSubPage$setLastSelectionRead(){var oMarkAsReadResult=this.getLastUnselectedItemIdForMarkRead();if(oMarkAsReadResult){if(oMarkAsReadResult.sRPItemId){this.setRdSt(new Array(oMarkAsReadResult.sRPItemId),MSG_READ)}else if(oMarkAsReadResult.sMessageId){this.setRdSt(new Array(oMarkAsReadResult.sMessageId),MSG_READ)}}};_oPrototype.setItmRead=function Owa$Pages$ListViewSubPage$setItmRead(fUseItemPartSelection){this.cnclMkRd();if(fUseItemPartSelection){this.setRdSt(new Array(this.get_ItemIdInConversation()),MSG_READ)}else{this.setRdSt(new Array(this.get_ItemIdInReadingPane()),MSG_READ)}};_oPrototype.cnclMkRd=function Owa$Pages$ListViewSubPage$cnclMkRd(){if(this.setItmRead_toID){this._clearTimeout(this.setItmRead_toID)}this.setItmRead_toID=null};_oPrototype.setRdSt=function Owa$Pages$ListViewSubPage$setRdSt(rgI,fR){var oVLV=this.get_VirtualListView();var fCnv=this.isCnvId(rgI[0]);var oRP=this.gtCnvRP();var iT;iT=rgI.length;if(iT>MAX_REQ_ITMS){alrt(L_ErrMaxItms);return}var sC=fR?"MarkAsRead":"MarkAsUnread";if(oVLV){var iR=fR?MSG_READ:MSG_MARKED_UNREAD;for(var i=0;i<rgI.length;++i){var fRefreshCallback=this.isPF();oVLV.mkUnrd(rgI[i],iR,fRefreshCallback)}}if(oRP){if(fCnv){for(var i=0;i<rgI.length;++i){if(this.get_ItemIdInReadingPane()==rgI[i]&&this.get_FolderId())oRP.stRSAll(fR,a_sSntId)}}else{oRP.stRS(rgI,fR)}}var oR=new oeReq(oVLV.sEvtNS,sC,null,cbSetRdSt);oR.addRg("id",rgI);if(fCnv&&this.get_FolderId())oR.add("fId",this.get_FolderId());this.adJnkSt(oR);oR.send()};function cbSetRdSt(oR){if(oR.fST)rplLgn()}_oPrototype.get_MarkAsReadBehaviour=function Owa$Pages$ListViewSubPage$get_MarkAsReadBehaviour(){if(!Owa.Utility.isDefined(typeof(a_iMR))){return MR_NEVER}var oVLV=this.get_VirtualListView();if(oVLV.isFilteredByUnread&&oVLV.isFilteredByUnread()){return MR_NEVER}return a_iMR};_oPrototype.setVW=function Owa$Pages$ListViewSubPage$setVW(iW,fSave,fFirstLoad){var iMW=Math.max(0,this._get_Element().get_OffsetWidth()-this._get_ReadingPaneMinWidth());if(iW>iMW){iW=iMW;if(fFirstLoad)this.udRP(1)}if(iW<this.get_VlvMinWidth())iW=this.get_VlvMinWidth();if(fSave&&this.get_ViewWidth()!=iW){this.set_ViewWidth(iW);this.svRpWH("PersistWidth","w",this.get_ViewWidth());this._getDescendant("divLVContainer").set_Width(iW);if(g_fRtl){this._getDescendant("divLVDivider").set_Right(iW);this._getDescendant("divRPContainer").set_Right(iW+4)}else{this._getDescendant("divLVDivider").set_Left(iW);this._getDescendant("divRPContainer").set_Left(iW+4)}if(this.get_SearchControl())this.get_SearchControl().fixSearchControlStyles()}this._oFilterInfobar.resize()};_oPrototype.svRpWH=function Owa$Pages$ListViewSubPage$svRpWH(sC,sP,iV){var oVLV=this.get_VirtualListView();var t=oVLV.iT;if(t!=LVT_MSG&&t!=LVT_CTM&&t!=LVT_TSK)return;var oR=new oeReq(oVLV.sEvtNS,sC,null,this._createCallback(this.cbSvRpWH));oR.add(sP,iV);oR.add("fId",oVLV.sSid);oR.send()};_oPrototype.cbSvRpWH=function Owa$Pages$ListViewSubPage$cbSvRpWH(oR){if(oR.fST)rplLgn()};_oPrototype.emptyFolder=function Owa$Pages$ListViewSubPage$emptyFolder(){var fIsJunkFolder=this.getSubPageVariable("a_fJnkFld");new BtnDlg("divDlt",htmlEnc(fIsJunkFolder?L_WrnEmptJnk:L_WrnEmpt),(fIsJunkFolder?L_EmptJnk:L_EmptFdrTtl),new Array(L_Yes,L_No),null,Owa.BUTTON_DIALOG_ICON.QUESTION,this._createCallback(this.cbEmptyFolder)).show()};_oPrototype.cbEmptyFolder=function Owa$Pages$ListViewSubPage$cbEmptyFolder(i){var oVLV=this.get_VirtualListView();if(i==0){oVLV.emptyFolder()}};_oPrototype.rspMI=function Owa$Pages$ListViewSubPage$rspMI(iR,sRA){var oVLV=this.get_VirtualListView();var sC;switch(sRA){case'e':sC="ER";break;case's':sC="SR";break;case'd':sC="DR";break}var oCtx=new Object();oCtx.sC=sC;oCtx.sId=this.gtSelItms()[0];if(!oCtx.sId){oCtx.sId=oVLV.gtRwPrp(oVLV.gtSel()[0],"sMID")}var oR=new oeReq(oVLV.sEvtNS,sC,oCtx,this._createCallback(this.cbRspMI));oR.add("id",oCtx.sId);oR.add("Rsp",iR);oR.send()};_oPrototype.cbRspMI=function Owa$Pages$ListViewSubPage$cbRspMI(oR){var oVLV=this.get_VirtualListView();if(!cbOeh(oR))return;var sC=oR.oCtx.sC;if(sC=="ER")opnWin(oR.sBody,null,null,null,null,null,null,this.get_SubPage());else oVLV.rmvRws(new Array(oR.oCtx.sId))};_oPrototype.addABCts=function Owa$Pages$ListViewSubPage$addABCts(){var oVLV=this.get_VirtualListView();this.addSelectedIdsToContacts(oVLV.gtSel())};_oPrototype.addSelectedIdsToContacts=function Owa$Pages$ListViewSubPage$addSelectedIdsToContacts(rgIds){if(rgIds.length&&rgIds.length>50){alrt(L_TooManyContacts.format(rgIds.length),null,Owa.BUTTON_DIALOG_ICON.WARNING);return}if(rgIds.length){var oContext={};oContext.oCallerSubPage=this.get_SubPage();var oR=new oeReq("ABDA","AddToContacts",oContext,cbaddToCt);oR.addRg("id",rgIds);oR.send()}};_oPrototype.repFwItmNwWnd=function Owa$Pages$ListViewSubPage$repFwItmNwWnd(sRepFw,sReqs,sT){this.openItmIds(this.gtSelItms(),"?ae=PreFormAction&a="+sRepFw+((sReqs)?sReqs:""),0,0,sT,this.get_SubPage())};_oPrototype.nwChtFrmMsg=function Owa$Pages$ListViewSubPage$nwChtFrmMsg(){var oVLV=this.get_VirtualListView();var rgItms=this.gtSelItms();if(!rgItms||!rgItms.length||rgItms.length<=0)return;var oInfo=this.gtMsgInfo(this.get_FolderId(),rgItms[0]);try{gtIMMgr().NwChtSsnMw(oInfo.sSub,oInfo.oRcp,this.get_FolderId(),rgItms[0],(oVLV.isCnvVw()?1:0))}catch(e){}};_oPrototype.gtMsgInfo=function Owa$Pages$ListViewSubPage$gtMsgInfo(sFId,sItmId){var oVLV=this.get_VirtualListView();var oInfo=new Object();oInfo.sSub=0;oInfo.oRcp=0;var sSub,oRcp,o;try{var oRP,oReadingPaneSubPage;oReadingPaneSubPage=Owa.Components.SubPageControllerFactory.getControllerByElement(this._getDescendant("ifRP")).get_SubPage();if(oVLV.isCnvVw()){oRP=this.gtCnvRP();if(oRP&&oRP.oItemParts[sItmId]){var oIP=oRP.oItemParts[sItmId];if(!oIP.get_IsExpanded())return oInfo;sSub=oReadingPaneSubPage._getDescendant("txtSubj").get_TextContent();o=oIP.getSender()}}else{if(oReadingPaneSubPage.get_FolderId()==sFId&&oReadingPaneSubPage.getSubPageVariable("a_sId")==sItmId){sSub=oReadingPaneSubPage._getDescendant("divSubj").get_TextContent();o=oReadingPaneSubPage._getDescendant("spnFrom")}}oInfo.sSub=sSub;oInfo.oRcp=new Recip(o.get_TextContent(),o.getAttribute("_em"),o.getAttribute("_sa"),o.getAttribute("_al"),o.getAttribute("_rt"),o.getAttribute("_ao"),o.getAttribute("_id"),o.getAttribute("_rf"),o.getAttribute("_ei"),o.getAttribute("_uri"))}catch(e){oInfo.sSub=0;oInfo.oRcp=0}return oInfo};_oPrototype.seekNPItm=function Owa$Pages$ListViewSubPage$seekNPItm(sCId,sN,fNI){var oVLV=this.get_VirtualListView();oVLV.selNPRw(sCId,sN,fNI)};_oPrototype.ref=function Owa$Pages$ListViewSubPage$ref(fManual){var oVLV=this.get_VirtualListView();if(!oVLV)return;var oParentSubPage=this.get_ParentSubPage();if(oParentSubPage&&oVLV.sSid==oParentSubPage.getSubPageVariable("a_sInbx")){oParentSubPage.invokeSubPageFunction("clearNwMB")}oVLV.rfrsh(0,fManual?"manualrefresh":null);this.refreshConversationRP()};_oPrototype.udCntFnc=function Owa$Pages$ListViewSubPage$udCntFnc(){var oVLV=this.get_VirtualListView();var f=!canEml(oVLV);Owa.Components.ToolbarCollection.get(this).set_IsButtonDisabled("nmsgct",f);Owa.Components.ToolbarCollection.get(this).set_IsButtonDisabled("nmrgct",f);if(g_fIsIMEnab){var fIM=this.canIM(oVLV);var fBdy=0;if(fIM&&gtIMMgr()){var oRcpSel=this.getRecipientObject(oVLV.gtSel()[0]);if(oRcpSel){var sUri=oRcpSel._uri;if(!sUri||sUri==""||sUri=="&nbsp;"||isSlfUri(sUri)){fIM=0}else{fBdy=isBuddy(sUri)}}}enbIMBtns(this.get_SubPage(),fIM,fBdy)}};_oPrototype.canIM=function Owa$Pages$ListViewSubPage$canIM(oLV){var oVLV=this.get_VirtualListView();if(!gtIMMgr())return 0;if(gtMstr()&&!gtMstr().g_fSignedIn){return false}if(!oLV)oLV=oVLV;var rgS=oLV.gtSel();if(rgS.length!=1){return false}var t=oLV.gtRwPrp(rgS[0],"t");if(t&&isOfClss(t,IT_PDL)){return false}if(isOCSPrv()&&(oVLV.iT==LVT_DRL||oVLV.iT==LVT_DRP||oVLV.iT==LVT_RMP||oVLV.iT==LVT_RML)){var sSipUri=oLV.gtRwPrp(rgS[0],"sipUri");if(sSipUri&&!isSlfUri(sSipUri)){return true}}else{var sUri=oLV.gtRwPrp(rgS[0],"uri");if(sUri&&!isSlfUri(sUri)){return true}}return false};_oPrototype.onNavigateChgPwd=function Owa$Pages$ListViewSubPage$onNavigateChgPwd(){var oTopWindow=wt();oTopWindow.document.location.href=getEcpVdir()+"?p=PersonalSettings/Password.aspx"};_oPrototype.gtSndSmtp=function Owa$Pages$ListViewSubPage$gtSndSmtp(iActn,sTtl,sId){if(!sId||sId==""){throw new Error("Tried to get sender's SMTP address without supplying an item ID")}var oCtx=new Object();oCtx.iActn=iActn;oCtx.sTtl=sTtl;oCtx.sId=sId;var oR=new oeReq("MsgVLV2","GetSenderSmtp",oCtx,this._createCallback(this.cbGtSndSmtp));oR.add("id",sId);oR.send()};_oPrototype.getRecipientObject=function Owa$Pages$ListViewSubPage$getRecipientObject(sId){if(!sId||sId==""){throw new Error("Tried to get sender's recipient object without supplying an item ID")}var oVLV=this.get_VirtualListView();var oRecip=oVLV.gtRwPrp(sId,"ea");if(oRecip){if(!oRecip._id){oRecip._id=sId}return oRecip}var sUri=oVLV.gtRwPrp(sId,"uri");var sSMTP=Owa.IM.IMUtils.NrmSipUri(sUri);return new Recip(sSMTP,sSMTP,0,0,0,AO_O,0,0,0,sUri)};_oPrototype.cbGtSndSmtp=function Owa$Pages$ListViewSubPage$cbGtSndSmtp(oR){if(oR.sErr){if(oR.fST)popLgn();shwErrDlg(oR)}else{var sSSA=Owa.DomUtility.getTextFromHtml(oR.sBody,"sSSA");if(oR.oCtx.iActn==ACTN_NTJNK){shwNtJnkDlg(this.get_SubPage(),oR.oCtx.sId,1,((sSSA!=null)?sSSA:null))}else if(oR.oCtx.iActn==ACTN_ADDBSL){if(a_sJnkId==this.get_FolderId())addSndToJnkLst(this.get_SubPage(),BSL,oR.oCtx.sId,0,oR.oCtx.sTtl);else addToJnkLst(this.get_SubPage(),BSL,sSSA,0,oR.oCtx.sTtl,0,oR.oCtx.sId,ACTN_ADDBSL)}this.refreshConversationRP()}};_oPrototype.gtDlvRp=function Owa$Pages$ListViewSubPage$gtDlvRp(){var sId;var rgItms=this.gtSelItms();if(!rgItms||!rgItms.length||rgItms.length<=0){var oVLV=this.get_VirtualListView();sId=oVLV.gtRwPrp(oVLV.gtSel()[0],"sMID")}else{sId=rgItms[0]}if(!sId||sId==""){throw new Error("Tried to get delivery report without supplying an item ID")}var oR=new oeReq("MsgVLV2","GetDeliveryReportUrlParameters",null,this._createCallback(this.cbGtDlvRp));oR.add("id",sId);oR.send()};_oPrototype.cbGtDlvRp=function Owa$Pages$ListViewSubPage$cbGtDlvRp(oR){if(!cbOeh(oR))return;var sUrl=getEcpVdir()+"PersonalSettings/DeliveryReport.aspx?exsvurl=1&IsOWA=Y";sUrl+="&Mbx="+urlEnc(Owa.DomUtility.getTextFromHtml(oR.sBody,"sMBX"));sUrl+="&MsgID="+urlEnc(Owa.DomUtility.getTextFromHtml(oR.sBody,"sEID"));opnWin(sUrl,580,660,1,0,0,1)};_oPrototype.lvGtSF=function Owa$Pages$ListViewSubPage$lvGtSF(oR){var oVLV=this.get_VirtualListView();if(oVLV.fAD){oR.add("fltr",this.get_SearchControl().sSearchText)}else{var oST=new oeSt(oR,"FVLVSF");if(this.IsFilterInFavorites())oST.add("scp",SearchScope.SS_FLD);else oST.add("scp",this.get_SearchControl().iScope);if(this.get_SearchControl().sSearchText)oST.add("srch",this.get_SearchControl().sSearchText);if(this.get_SearchControl().sCategory)oST.add("cat",this.get_SearchControl().sCategory);if(this.get_SearchControl().iResultsIn!=null)oST.add("ri",this.get_SearchControl().iResultsIn);if(this.get_SearchControl().iRecipientField!=null){oST.add("rcp",this.get_SearchControl().iRecipientField);oST.add("rcps",this.get_SearchControl().sRecipient)}oST.add("res",(this.get_SearchControl().fReExecuteSearch?"1":"0"));this.get_SearchControl().fReExecuteSearch=false;oST.add("asrchsup",(this.get_SearchControl().fAsyncSearchEnabled?"1":"0"));oR.addSt("srchf",oST)}};_oPrototype.hasEROnFld=function Owa$Pages$ListViewSubPage$hasEROnFld(iER){if(!Owa.Utility.isDefined(typeof(this.get_EffectiveRights())))return 1;return hasER(this.get_EffectiveRights(),iER)};_oPrototype.fwIA=function Owa$Pages$ListViewSubPage$fwIA(){var oVLV=this.get_VirtualListView();var oDraggableObject;if(!Owa.Utility.isDefined(typeof(oVLV.crtItmsDC))){oDraggableObject=oVLV.crtDC()}else{oDraggableObject=oVLV.crtItmsDC(this.gtSelItms())}if(oDraggableObject)sndIAReq(this.get_SubPage(),oDraggableObject,a_IT_MSG,cbFwIA);else alrt(L_ErrFwIA)};_oPrototype.showFilterMenu=function Owa$Pages$ListViewSubPage$showFilterMenu(){var oVLV=this.get_VirtualListView();var oFilterButton=Owa.Components.ToolbarCollection.get(this).getButton("fltrc");var oPosition=oFilterButton.get_MenuReferencePosition(g_fRtl);var oContextMenu=null;var oFilterCriteria;this.set_FilterContextMenu(new Owa.UIControls.FilterContextMenu(this));oContextMenu=this.get_FilterContextMenu();if(oVLV.isInFltrdVw()){oFilterCriteria=oVLV.get_FilterViewCriteria()}else{oFilterCriteria=new Owa.Components.FilterCriteria();oFilterCriteria.set_RecipientName(this.get_FilterRecipientName())}oContextMenu.set_FilterCriteria(oFilterCriteria);oContextMenu.set_FilterButton(oFilterButton);oContextMenu.show(oPosition.iX,oPosition.iY)};_oPrototype.IsFilterInFavorites=function Owa$Pages$ListViewSubPage$IsFilterInFavorites(){var oVLV=this.get_VirtualListView();return this.get_IsFilterInFavorite()?1:oVLV.isInFltrdVw&&oVLV.isInFltrdVw()};_oPrototype.removeIb=function Owa$Pages$ListViewSubPage$removeIb(oEvent){var sId=oEvent.get_Target().getAttribute("_sRmvId");var oInfobar=new Owa.UIControls.Infobar(this._getDescendant("divInfobar"));oInfobar.checkRemoveMessageAndRefresh(sId);this.adjustLvRpContainerTop()};;_oPrototype.throttledRefresh=throttledRefresh;Owa.Pages.ListViewSubPage.createClass("Owa.Pages.ListViewSubPage",Owa.UIControls.SubPage)}());(function(){Type.createNamespace("Owa.Pages");Owa.Pages.DirectoryView=function Owa$Pages$DirectoryView(oElement){Owa.Pages.DirectoryView.constructBase(this,[oElement])};Owa.Pages.DirectoryView.createClass("Owa.Pages.DirectoryView",Owa.Pages.ListViewSubPage)}());(function(){Type.createNamespace("Owa.Pages");Owa.Pages.FolderListViewSubPage=function Owa$Pages$FolderListViewSubPage(oElement){Owa.Pages.FolderListViewSubPage.constructBase(this,[oElement])};var _oPrototype=Owa.Pages.FolderListViewSubPage.prototype;_oPrototype._initializeHotkeys=function Owa$Pages$FolderListViewSubPage$_initializeHotkeys(){Owa.Pages.FolderListViewSubPage.callBase(this,"_initializeHotkeys");this._oHotKeyManager.addHotKey(L_HkDlt,BID_DL);this._oHotKeyManager.addHotKey(Owa.KeyCodes.DELETE.toString(),BID_DL,true);this._oHotKeyManager.addHotKey("SHIFT+"+Owa.KeyCodes.DELETE,BID_PDLT,true);if(Owa.Utility.isMac()){this._oHotKeyManager.addHotKey(Owa.KeyCodes.BACK_SPACE.toString(),BID_DL,true);this._oHotKeyManager.addHotKey("SHIFT+"+Owa.KeyCodes.BACK_SPACE,BID_PDLT,true)}};Owa.Pages.FolderListViewSubPage.createClass("Owa.Pages.FolderListViewSubPage",Owa.Pages.ListViewSubPage)}());if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded["uview.js".toLowerCase()])(function(){Type.createNamespace("Owa.Pages");Owa.Pages.MessageViewSubPage=function Owa$Pages$MessageViewSubPage(oElement){Owa.Pages.MessageViewSubPage.constructBase(this,[oElement]);this._sLastConversationActionId=null;this._fLastConversationActionValue=null;this._clearRefreshConversationRPDelayFlags()};var _oPrototype=Owa.Pages.MessageViewSubPage.prototype;_oPrototype._fSupportHostedInSubPage=true;_oPrototype.initialize=function Owa$Pages$MessageViewSubPage$initialize(){Owa.Pages.MessageViewSubPage.callBase(this,"initialize");var oVLV=this.get_VirtualListView();g_oEd.attachEvent("CopyItems",null,"cbCpMvItms");g_oEd.attachEvent("MoveItems",null,"cbCpMvItms");oVLV.stOnCnvVwChg(this._createCallback(this.initCnvVw));oVLV.stOnRowNotification(this._createCallback(this.onRowNotificationVw));this.initCnvVw(oVLV.isCnvVw());this.fireUpdCnt();if(this.get_OOF())wrnOof();if(this.IsFilterInFavorites()){this.get_SearchControl()._setSearchScopeIconStyle();this.get_SearchControl()._updateScopeText()}var oInfobar=new Owa.UIControls.Infobar(this._getDescendant("divInfobar"));var oMessage=oInfobar.getMessageById("divSMimeIB");if(oMessage){if(isSSL()&&isFlgSt(gtMmSt(),MM_MstUpd)){oMessage.set_IsShown(1);oInfobar.set_IsShown(1,1)}else{oInfobar.removeMessage(oMessage,1)}}this.adjustLvRpContainerTop();addPerfMarker("MessageViewSubPage.Initialize.End.TimeStamp")};_oPrototype.dispose=function Owa$Pages$MessageViewSubPage$dispose(){g_oEd.detachEvent("CopyItems",null,"cbCpMvItms");g_oEd.detachEvent("MoveItems",null,"cbCpMvItms");Owa.Pages.MessageViewSubPage.callBase(this,"dispose")};_oPrototype._initializeHotkeys=function Owa$Pages$MessageViewSubPage$_initializeHotkeys(){Owa.Pages.MessageViewSubPage.callBase(this,"_initializeHotkeys");if(Owa.Utility.isMac()){this.addHk(L_HkMkRdMac,"markread")}else{this.addHk(L_HkMkRd,"markread")}this.addHk(L_HkMkUnrd,"markunread");if(!isJnkFld(this)){this.addHk(L_HkRpl,BID_RE);this.addHk(L_HkRplAll,BID_RA);this.addHk(L_HkCht,BID_CHT);this.addHk(L_HkFwd,BID_FW)}};_oPrototype._onUserAction=function Owa$Pages$MessageViewSubPage$_onUserAction(sAction,oContext){switch(sAction){case BID_CANIGNCNV:case BID_CANIGNCNVDD:this._cancelIgnoreConversation();break;case BID_EXPALL:this._expandAll();break;case BID_CLPSALL:this._expandAll(true);break;default:Owa.Pages.MessageViewSubPage.callBase(this,"_onUserAction",[sAction,oContext]);break}};_oPrototype._onNewItem=function Owa$Pages$MessageViewSubPage$_onNewItem(){var sAction=this.isPF()?"newpst":"newmsg";this.get_ActionTable().getAction(sAction).triggerAction()};_oPrototype.repFwItmNwWnd=function Owa$Pages$MessageViewSubPage$repFwItmNwWnd(sRepFw,sReqs,sT){this.setRPRefreshDelayFlag();Owa.Pages.MessageViewSubPage.callBase(this,"repFwItmNwWnd",[sRepFw,sReqs,sT])};_oPrototype.onLoadReadingPane=function Owa$Pages$MessageViewSubPage$onLoadReadingPane(){Owa.Pages.MessageViewSubPage.callBase(this,"onLoadReadingPane");this.initCnvRP();var sRowId=this.get_ItemIdInReadingPane();var fIsIgnored=false;var oLV=this.get_VirtualListView();if(oLV.isCnvVw()){var oRP=this.gtCnvRP();fIsIgnored=oRP.get_IsConversationIgnored()}else{var oIfRP=this._getDescendant("ifRP");var oSubPageController=Owa.Components.SubPageControllerFactory.getControllerByElement(oIfRP);fIsIgnored=oSubPageController.getVariable("a_fInIgnCnv");this.udMsgTB();if(oLV&&oLV.oCM){this.cmPreShwMsg(oLV.oCM)}}this._sLastConversationActionId=sRowId;this._fLastConversationActionValue=fIsIgnored;this._tryUpdateConversationActionUI()};_oPrototype.onSelChngVw=function Owa$Pages$MessageViewSubPage$onSelChngVw(oE){this.udMsgTB();this._tryUpdateConversationActionUI();Owa.Pages.MessageViewSubPage.callBase(this,"onSelChngVw",[oE])};var RP_REFRESH_DELAY_TIMEOUT=5*1000;_oPrototype.cbDel=function Owa$Pages$MessageViewSubPage$cbDel(oR){if(this.getSubPageVariable("a_fInDelItms")&&oR.oCtx.fIgnoreConversations){this._updateConversationActionUI(true,true);return}Owa.Pages.MessageViewSubPage.callBase(this,"cbDel",[oR])};_oPrototype.onRowNotificationVw=function Owa$Pages$MessageViewSubPage$onRowNotificationVw(sId){var oVLV=this.get_VirtualListView();if(sId==this.get_ItemIdInReadingPane()){if(this._fRPRefreshDelayFlag&&sId==this._sRPRefreshDelayID){if(this._oRPRefreshDelayTimer==null){this._oRPRefreshDelayTimer=this._setTimeout(this._refreshConversationRPDelayed,RP_REFRESH_DELAY_TIMEOUT,{fForceRefresh:true,sId:sId})}}else{if(this._oRPRefreshDelayTimer)this._clearTimeout(this._oRPRefreshDelayTimer);this._clearRefreshConversationRPDelayFlags();this.refreshConversationRP(true)}}};_oPrototype.setRPRefreshDelayFlag=function Owa$Pages$MessageViewSubPage$setRPRefreshDelayFlag(){this._sRPRefreshDelayID=this.get_ItemIdInReadingPane();this._fRPRefreshDelayFlag=true};_oPrototype._refreshConversationRPDelayed=function Owa$Pages$MessageViewSubPage$_refreshConversationRPDelayed(oContext){var fForceRefresh=oContext.fForceRefresh;var sId=oContext.sId;this._clearRefreshConversationRPDelayFlags();if(sId==this.get_ItemIdInReadingPane()){this.refreshConversationRP(fForceRefresh)}};_oPrototype._clearRefreshConversationRPDelayFlags=function Owa$Pages$MessageViewSubPage$_clearRefreshConversationRPDelayFlags(){this._oRPRefreshDelayTimer=null;this._sRPRefreshDelayID=null;this._fRPRefreshDelayFlag=false};_oPrototype._cancelIgnoreConversation=function Owa$Pages$MessageViewSubPage$_cancelIgnoreConversation(){if(PONT_CANIGNCNV&a_iEnblPnt){shwPont(PONT_CANIGNCNV,L_CanIgnCnv,L_CanIgnCnvTtl,[L_OK,L_Cncl],0,this._createCallback(this._cbCancelIgnoreConversationPont))}else{this._cbCancelIgnoreConversationPont()}};_oPrototype._cbCancelIgnoreConversationPont=function Owa$Pages$MessageViewSubPage$_cbCancelIgnoreConversationPont(iB){if(iB==-1||iB==1){return}var sId;var oLV=this.get_VirtualListView();if(oLV.isSelExp()){sId=oLV.gtExpCnvId()}else{sId=oLV.gtSel()[0]}var oR=new oeReq(oLV.sEvtNS,"CancelIgnoreConversation",0,this._createCallback(this._cbCancelIgnoreConversation));oR.add("id",sId);oR.send();this._updateConversationActionUI(true,false);oLV.makeFocused()};_oPrototype._cbCancelIgnoreConversation=function Owa$Pages$MessageViewSubPage$_cbCancelIgnoreConversation(oR){if(!cbOeh(oR))return};_oPrototype._tryUpdateConversationActionUI=function Owa$Pages$MessageViewSubPage$_tryUpdateConversationActionUI(){var oLV=this.get_VirtualListView();if(!oLV.isCnvVw()){var rgSelection=oLV.gtSel();for(var i=0;i<rgSelection.length;i++){if(oLV.gtRwPrp(rgSelection[i],"fExclCnv")=="1"){this._updateConversationActionUI(false);return}}}var sRowId=null;if(oLV.isCnvVw()&&oLV.isSelExp()){sRowId=oLV.gtExpCnvId()}else if(oLV.gtSelCnt()==1){sRowId=oLV.gtSel()[0]}var fCancelIgnore=false;if(sRowId){if(sRowId==this._sLastConversationActionId){fCancelIgnore=this._fLastConversationActionValue}else if(!this.isReadingPaneOn()){this._getConversationActionData(sRowId)}}this._updateConversationActionUI(true,fCancelIgnore)};_oPrototype._getConversationActionData=function Owa$Pages$MessageViewSubPage$_getConversationActionData(sId){var oLV=this.get_VirtualListView();var oR=new oeReq(oLV.sEvtNS,"GetConversationAction",sId,this._createCallback(this._cbGetConversationActionData));oR.add("id",sId);oR.send()};_oPrototype._cbGetConversationActionData=function Owa$Pages$MessageViewSubPage$_cbGetConversationActionData(oR){if(!cbOeh(oR))return;var fIsIgnored=parseInt(oR.sBody,10);this._sLastConversationActionId=oR.oCtx;this._fLastConversationActionValue=fIsIgnored;this._tryUpdateConversationActionUI()};_oPrototype._updateConversationActionUI=function Owa$Pages$MessageViewSubPage$_updateConversationActionUI(fEnable,fCancelIgnore){var oToolbars=Owa.Components.ToolbarCollection.get(this);oToolbars.set_IsButtonShown(BID_DL,!fCancelIgnore||!fEnable);oToolbars.set_IsButtonShown(BID_CANIGNCNV,fCancelIgnore&&fEnable);oToolbars.set_IsButtonPushed(BID_CANIGNCNV,fCancelIgnore&&fEnable);var oDeleteButton=oToolbars.getButton(BID_DL);if(Owa.UIControls.ComboButton.isInstance(oDeleteButton)){oDeleteButton.set_ComboEnabled(fEnable)}var oLV=this.get_VirtualListView();if(oLV.get_ContextMenu()){oLV.get_ContextMenu().showMenuItem("divIgnCnv",!fCancelIgnore&&fEnable);oLV.get_ContextMenu().showMenuItem("divCanIgnCnv",fCancelIgnore&&fEnable)}};_oPrototype._expandAll=function Owa$Pages$MessageViewSubPage$_expandAll(fCollapse){var oRP=this.gtCnvRP();if(oRP){if(fCollapse){oRP.collapseAll()}else{oRP.expandAll()}this.adjustVLVToolbars()}};_oPrototype.getItemToolbarId=function Owa$Pages$MessageViewSubPage$getItemToolbarId(){return"divItemToolbar"};_oPrototype.getViewToolbarId=function Owa$Pages$MessageViewSubPage$getViewToolbarId(){return"divViewToolbar"};Owa.Pages.MessageViewSubPage.createClass("Owa.Pages.MessageViewSubPage",Owa.Pages.FolderListViewSubPage)})();g_fModuleLoaded["uview.js".toLowerCase()]=1;function canEml(oLV){var rgS=oLV.gtSel();var f=(rgS.length>0);for(var i=0;i<rgS.length;++i){var oEA=oLV.gtRwPrp(rgS[i],"ea");f&=(isDf(typeof(oEA))&&oEA!=null&&oEA._em!="0")||(oLV.gtRwPrp(rgS[i],"_em")!="0")}return f}stJS("uview.js");