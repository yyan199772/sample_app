!function(a,b,c){"use strict";function y(a){w.popUp("cf_directory/cp.cfm?tab="+a,620,600,"profileWindow")}function z(a,b,c){w.popUp("cf_directory/dirprofile.cfm?id="+a+(b?"&groupID="+b:"")+(c?"&p="+c:""),520,600,"profileWindow")}function A(a,c){function d(){b("body").one("click",function(){a.removeClass(h)})}a.hasClass(h)||(b("body").click(),c||setTimeout(d,100)),a.toggleClass(h)}function B(){var a=b("#fsGroupSpaceThemeMenu"),c="fsGroupSpaceThemeMenu",d=c+"ItemContainer",e=c+"ScrollButtons",f=' class="'+e+'"',g=' class="'+c+'ActionButtons"';if(0==a.length){var j,h=[];b.ajax("cf_group/endpoints/themes.cfm",{cache:!1,data:{groupID:k},dataType:"json",error:function(){alert("There was an error loading the themes. Please refresh the page and try again.")},success:function(a){var e,f,g,k;h=a;var l=b(),m=0;for(e=0;e<h.length;e++){for(g='<div data-tID="'+h[e].id+'" class="'+c+"Item"+(h[e].selected?" "+i:"")+'">',f=0;3>f;f++)2>f?k="#"+h[e].c[f]:3==h[e].c.length?(k="#"+h[e].c[2],h[e].bgImage&&(k+="; background-image: url('"+h[e].bgImage+"')")):h[e].bgImage&&(k="url('"+h[e].bgImage+"')"),g+='<div class="fsGroupSpaceThemeMenuItemColumn" style="background :'+k+';"></div>';l=l.add(g+"</div>"),h[e].selected&&(m=e,j=h[e].id)}b("#"+d).removeClass("fsStyleLoadingBar").css({left:Math.min(0,-124*(m-1))}).append(l)}}),a=b('<div id="'+c+'"><div id="'+c+'Viewport"><div id="'+c+'Header"><span id="'+c+'HeaderTitle">Themes</span> Choose a theme for your group space.<button id="'+c+'CancelButton"'+g+'><span class="fsIconXWhite"></span>Cancel</button><button id="'+c+'SaveButton"'+g+'><span class="fsIconSave"></span>Save</button></div><button id="'+c+'Left"'+f+'><span class="fsIconArrowLeftWhite"></span></button><div id="'+d+'" class="fsStyleLoadingBar"></div><button id="'+c+'Right"'+f+'><span class="fsIconArrowRightWhite"></span></button></div></div>'),a.prependTo("body"),b("."+e).click(function(a){var e=b("#"+d),f=e.width(),g=e.position().left,h=b("#"+c+"Viewport").width();b(a.currentTarget).attr("id")==c+"Right"?(g-=h/4,h>f+g&&(g=Math.min(0,h-f))):(g=Math.min(0,g+h/4),g=-10>g?g:0),e.stop(),e.animate({left:g},500)}),b("#"+d).on("click","."+c+"Item",function(){var c=b(this),d=c.index(),e=b("#fsGroupSpaceThemeStyle");e.length?e.attr("href",h[d].path):b("head").appendTo('<link id="fsGroupSpaceThemeStyle" rel="stylesheet" href="'+h[d].path+'">'),c.addClass(i).siblings().removeClass(i)}),b("#"+c+"CancelButton").click(function(){var e=b("."+c+"Item[data-tID="+j+"]"),f=e.position().left;A(a),b("#"+d).css({left:Math.min(0,124-f)}),e.click()}),b("#"+c+"SaveButton").click(function(){var c=a.find("."+i);j=c.attr("data-tID"),b.ajax("cf_group/endpoints/themes.cfm",{cache:!1,data:{groupID:k,themeID:j},type:"post",error:function(){alert("There was an error saving the theme. Please try again.")},success:function(){}}),A(a)})}return a}function C(){S&&(b("#"+O).toggleClass(g,0==S.prev().length),b("#"+P).toggleClass(g,0==S.next().length),b("#"+Q).toggleClass(g,0==S.parent().prev(".fsGroupSpaceDashboardCustomizeColumn").length),b("#"+R).toggleClass(g,0==S.parent().next(".fsGroupSpaceDashboardCustomizeColumn:visible").length))}function D(){S&&S.removeClass(i),S=null,T.removeClass(h),b(document).off("click",E)}function E(a){var c=b(a.target);a.target.id.match(/^fsGroupSpaceDashboardCustomizeDPad/)||c.hasClass(j)||c.hasClass(d)||D()}function F(){b(document).off("click",E),b(document).on("click",E)}function G(a,b){var c=a.height(),d=a.scrollTop(),e=a.position().top,f=b.position().top,g=b.height();e>f?a.scrollTop(d-(e-f+6)):f+g>e+c&&a.scrollTop(d+(f+g+8-(e+c)))}function H(a,c){for(var d=a.toArray(),e=d.length-1;e+1>c;e--)b(d[e]).children().appendTo(d[e-1])}function I(a){a.removeClass(d+" ui-draggable").addClass(j).attr("style","");var b=a.find("."+e);if(b.length){for(var c=1,f=a.attr("data-type");6>=c&&0!=U.find("."+j+"[data-type^="+f+"-"+c+"]").length;c++);b.remove(),a.html(a.html()+" "+c),a.attr("data-type",f+"-"+c)}a.prepend(V)}function J(a){var b=a.find("."+e);if(b.length){var c=parseInt(b.text(),10)-1;b.text(c)}b.length&&0!=c||a.addClass(g)}function K(a){var c;a?(b("#fsGroupSpaceDashboardCopyDialog").dialog("option","title","Copy Dashboard From Another Group"),c="Copy the selected group's home page settings to this group. Any customizations on this group will be overwritten."):(b("#fsGroupSpaceDashboardCopyDialog").dialog("option","title","Copy Dashboard To Other Groups"),c="Copy this group's home page settings to the selected groups. The groups being copied to will have all customizations overwritten."),b(".fsGroupSpaceDialogInstructions").html(c),b.ajax("cf_group/endpoints/dashboard.cfm",{cache:!1,data:{archiveOnly:a,currentGroupID:b("#currentGroupID").val(),currentTLG:b("#currentTLG").val()},type:"get",error:function(){alert("There was an error loading the groups. Please try again.")},success:function(a){b("#copyDialogGroups").html(a)}})}function W(c){var f,h,d=b(this),e=b(c.target),g=!1;return e.hasClass(o)||e.closest(".fsSocialPostAttachOption").length?(f=d.find("."+n+"ments").show(),h='<div class="'+n+'FileEntry"><input type="text" name="attachmentLabel_@i" placeholder="Display Name"><input type="hidden" name="attachmentType_@i" value="',h+=e.hasClass(n+"URL")?'url"><input type="text" placeholder="url"':e.hasClass(n+"Selected")?'selectedfile"><button class="'+n+'SelectFile">My Files</button><input class="'+n+'SelectFileName" type="text" name="attachmentFileName_@i" value="No file selected" readonly><input type="hidden"':e.hasClass(n+"GoogleDrive")||e.hasClass("fsGlyphDrive")?'googledrive"><button class="'+n+'GoogleDriveFile">Google Drive</button><input class="'+n+'GoogleDriveFileName" type="text" name="attachmentOriginalFileName_@i" value="No file selected" readonly><input type="hidden" id="attachmentFileName_@i" name="attachmentFileName_@i"><input type="hidden" id="attachmentFileMetadata_@i" name="attachmentFileMetadata_@i"><input type="hidden"':'upload"><input type="hidden" name="attachmentOriginalFileName_@i" value=""><input type="file"',h+=' name="attachment_@i"><a href="#" title="Remove Attachment" class="'+p+'"></a></div>',b(h.replace(/@i/g,++l)).appendTo(f).find("input").placeholder()):e.hasClass(n+"SelectFile")?(q=e,w.popUp("cf_filemanager/adminfiles.cfm?do=refresh&opener=social",750,550,"pickFile")):e.hasClass(n+"GoogleDriveFile")?(Y(a.filePickerURL+"/cf_googledrive"),a.addEventListener("message",$,!1),q=e):e.hasClass(p)?(e.parent().remove(),f=d.find("."+n+"ments"),0==f.children().length&&(f.hide(),l=0)):g=!0,g}function X(){$j.ajax({type:"POST",url:"cf_academics/ajax/_integrations.cfm",data:"do=getFilePickerURL",success:function(b){var c=$j.parseJSON(b);a.filePickerURL=c.result}})}function Y(b){var d="toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=750,height=550",e=a.open(b,"pickFile",d);a.popUrl=b,a.pickerIsReady=!1,e==c?alert("It appears that your browser has popup blocking enabled.\nPlease modify this setting to allow for full functionality."):(a.popupObj=e,e.addEventListener("load",Z,!1),e.focus())}function Z(){a.popupObj.postMessage("send",a.filePickerURL+"/cf_googledrive")}function $(b){var c=parseInt($j(".profileLink").attr("data-pid"),10),d={source:"resources",personID:c,fileMetadata:b.data};if(!(a.filePickerURL.indexOf(b.origin)<0&&b.origin!=a.filePickerURL+"/cf_googledrive"&&b.origin!=a.filePickerURL)){if("ready"==b.data)return a.pickerIsReady=!0,void 0;a.googleData=b.data,$j.ajax({type:"POST",url:"cf_group/googledrive.cfm?action=downloadFile",data:d,dataType:"json",success:function(a){$j('input[name="attachmentFileName_'+l+'"]').val(a.result.uniqueFileName),$j('input[name="attachmentOriginalFileName_'+l+'"]').val(a.result.originalFileName),$j('input[name="attachment_'+l+'"]').val("googledrive")},error:function(a){this.driveError=a.error,$j('input[name="attachmentFileName_'+l+'"]').val(a.error)}})}}function _(){r?b.ajax({data:{method:"getUnreadMessageCount"},dataType:"json",error:function(){r=!1},success:function(d){r=!1,d.count!==c&&b(".fsUnreadMessageCount").trigger("updateMessageCount",[d.count]),setTimeout(_,t),b(a).one("mousemove",function(){r=!0})},type:"post",url:"cf_social/endpoints/messaging.cfm"}):b(a).one("mousemove",function(){r=!0,setTimeout(_,2e3)})}function ab(){r?b.ajax({data:{method:"getUnreadActivityCount"},dataType:"json",error:function(){r=!1},success:function(d){r=!1,d.count!==c&&(b(".fsUnreadActivityCount").trigger("updateActivityCount",[d.count]),d.count>0?b("#fsGroupsDashboardActivityStream").find(".markAllAsReadBtn").show():b("#fsGroupsDashboardActivityStream").find(".markAllAsReadBtn").hide()),setTimeout(ab,u),b(a).one("mousemove",function(){r=!0})},type:"post",url:"cf_social/endpoints/activity.cfm"}):b(a).one("mousemove",function(){r=!0,setTimeout(ab,2e3)})}function bb(){b.ajax({data:{method:"markAllActivityRead"},dataType:"json",error:function(){v.util.hideLoadingPrompt(),v.util.dialog("An error occurred while updating events.")},success:function(a){v.util.hideLoadingPrompt(),a.success!==c&&1==a.success&&(b("#fsGroupsDashboardActivityStream").find(".markAllAsReadBtn").hide(),ab())},type:"post",url:"cf_social/endpoints/activity.cfm"})}var q,v,d="fsGroupSpaceDashboardCustomizeAvailableItem",e="fsGroupSpaceDashboardCustomizeCounter",f="fsGroupSpaceDashboardCustomizeColumn",g="fsStateDisabled",h="fsStyleDisplayBlock",i="fsStateSelected",j="fsGroupSpaceDashboardCustomizeSelectedItem",k=parseInt(b("#fsGroupSpaceHeader").attr("data-gID"),10),l=0,m="fsSocial",n=m+"PostAttach",o=n+"Option",p="fsGlyphRedX",r=!0,t=15e3,u=15e3;a.FS?(v=a.FS,v.util||(v.util={}),v.social||(v.social={}),v.calendar||(v.calendar={}),v.athletics||(v.athletics={}),v.gradebook||(v.gradebook={}),v.groupElements={}):v=a.FS={util:{},groupElements:{},social:{},calendar:{},athletics:{},gradebook:{}};var w=v.util;w.popUp=function(b,d,e,f){var g;f=f||"name",g=a.open(b,f,"toolbar=no,location=no,directories=no,status=no,menubar=yes,scrollbars=yes,resizable=yes,width="+d+",height="+e),g==c?alert("It appears that your browser has popup blocking enabled.\nPlease modify this setting to allow for full functionality."):g.focus()},w.trackLMSEvent=function(b,d,e,f){var g=["lmsTracker._trackEvent","LMS/"+b,d];e!=c&&(g.push(e),"number"==typeof f&&g.push(f)),a._gaq.push(g)},w.trackLMSPageView=function(b,c){a._gaq.push(["lmsTracker._trackPageview","/LMS/"+b.toLowerCase()+"/"+c])},w.embedFlash=function(a,c,d,e,f,g,h,i,j){b(function(){var k=0,l=0,m=b("#"+a).parent().width();b("#"+a).parent().height(),isNaN(parseInt(d))||isNaN(parseInt(e))?(isNaN(parseInt(d))||(m=parseInt(d)),(isNaN(m)||0==m)&&(m=100),k=m,l=m*Math.pow(f,-1)):(k=parseInt(d),l=parseInt(e)),null==g&&(g={}),null==h&&(h={wmode:"transparent"}),null==i&&(i={}),""==j&&(j="9.0.0");var o=null;"boolean"!=typeof g.mini||g.mini||(o="string"==typeof g.siteurl?g.siteurl+"/cf_media/scripts/expressInstall.swf":"../cf_media/scripts/expressInstall.swf"),swfobject.hasFlashPlayerVersion(j)||swfobject.hasFlashPlayerVersion("6.0.65")&&"boolean"==typeof g.mini&&!g.mini?swfobject.embedSWF(c,a,k,l,j,o,g,h,i):b("#"+i.id+"_flash_requirement").show()})},w.displayLoadingPrompt=function(a,c){var d=b("#fsLoadingPrompt");a=a||"Loading",c=c||90,0===d.length&&(d=b('<div id="fsLoadingPrompt"><p><span>Loading</span>, please wait&hellip;<br><img src="images/loadingbar.gif" border="0"></p></div>'),b("body").append(d)),d.find("span").html(a),d.dialog({autoOpen:!1,modal:!0,resizable:!1,stack:!0,buttons:{},closeOnEscape:!1,dialogClass:"noDialogTitlebar",height:c}).dialog("open")},w.hideLoadingPrompt=function(){b("#fsLoadingPrompt").dialog("close")},w.dialog=function(a,c,d){var e=b("#fsDialogWindow");0===e.length&&(e=b('<div id="fsDialogWindow"></div>'),b("body").append(e),e.dialog({autoOpen:!1,closeOnEscape:!1,modal:!0,resizable:!1,stack:!0}));var f="";f="undefined"==typeof d?{OK:function(){b("#fsDialogWindow").dialog("close")}}:d;var g="";g="undefined"==typeof c?"System Message":c,e.html("<p>"+a+"</p>").dialog({title:g,width:400,buttons:f}).dialog("open")};var x=v.groupElements;if(X(),x.facebook=function(a){var d=0,e="https://graph.facebook.com/";return this.name="facebook",a.p&&(d=a.i,""==a.at&&b("#"+d).html('<div style="margin:5px;">Unable to connect to facebook at this time. Please try refreshing in a couple of minutes.</div>'),b.ajax({dataType:"jsonp",error:function(){b("#"+d).html('<div style="margin:5px;">Error loading facebook feed</div>')},success:function(f){var g="http://www.facebook.com/"+a.p;f.error?b("#"+d).html('<div style="margin:5px;">The page specified is not available</div>'):(f.link&&(g=f.link),b.ajax({data:{limit:a.m},dataType:"jsonp",error:function(){b("#"+d).html('<div style="margin:5px;">Error loading facebook feed</div>')},success:function(a){var f,h,i,j,e=0,k=b("<ul>",{"class":"fsGroupSpaceElementFacebookElement"}),l=b('<li class="fsGroupSpaceElementFacebookElement"></li>');for(a=a.data;e<a.length;e++){if(l.html('<span class="fsGroupSpaceElementFacebookElement_from">'+a[e].from.name+"</span>"),a[e].to&&a[e].to.name&&l.append(' <strong>to</strong> <span class="fsGroupSpaceElementFacebookElement_to">'+a[e].to.name+"</span>"),a[e].message){i=a[e].message.match(/https?:\/\/[^\s|"|'|>]*/i),h=a[e].message.replace("<","&lt;"),h=h.replace(">","&gt;");for(f in i)"index"!=f&&"input"!=f&&"lastIndex"!=f&&(h=h.replace(i[f],'<a href="'+i[f]+'" target="_blank">'+i[f]+"</a>"));l.append("&nbsp;"+h)}switch(h=b("<div>",{"class":"fsGroupSpaceElementFacebookElement_extras"}),a[e].picture&&h.append('<img class="fsGroupSpaceElementFacebookElement_thumb" src="'+a[e].picture+'">'),a[e].type){case"link":case"photo":case"video":a[e].name?h.append('<a target="_blank" class="fsGroupSpaceElementFacebookElement_title" href="'+a[e].link+'">'+a[e].name+"</a>"):a[e].link&&h.append('<a target="_blank" class="fsGroupSpaceElementFacebookElement_title" href="'+a[e].link+'">'+a[e].link+"</a>")}a[e].caption&&h.append('<div class="fsGroupSpaceElementFacebookElement_caption">'+a[e].caption+"</div>"),a[e].description&&h.append('<div class="fsGroupSpaceElementFacebookElement_desc">'+a[e].description+"</div>"),a[e].likes==c?l.append(h.append('<div class="floatfix"></div>')):a[e].likes.count!=c?l.append(h.append('<div class="fsGroupSpaceElementFacebookElement_likes floatfix">'+a[e].likes.count+" likes</div>")):a[e].likes.data!=c&&"object"==typeof a[e].likes.data?l.append(h.append('<div class="fsGroupSpaceElementFacebookElement_likes floatfix">'+a[e].likes.data.length+" likes</div>")):l.append(h.append('<div class="floatfix"></div>')),l.clone().appendTo(k)}b('<li class="fsGroupSpaceElementFacebookElement_follow"><a href="'+g+'" target="_blank">View facebook page</a></li>').appendTo(k),j=b("#"+d),j.find("div.data_fs_link_color").each(function(){k.find("a").css("color",b(this).text())}),j.html(k),j=c},url:e+a.p+"/"+a.t+"?access_token="+a.at}))},url:e+a.p+"?access_token="+a.at})),this},x.vimeo=function(d){var f,e=0,g=function(b){var c=f.width();f.find(".fsGroupSpaceElementVimeoFrame,#vimeo_"+e).remove(),f.prepend('<iframe src="'+a.location.protocol+"//player.vimeo.com/video/"+b+'?byline=0&api=1" width="'+c+'" height="'+Math.round(2*c/3)+'" frameborder="0" class="fsGroupSpaceElementVimeoFrame" webkitAllowFullScreen mozallowfullscreen allowFullScreen>')},h=function(h){b.ajax({dataType:"jsonp",error:function(){f.html('<div style="margin:5px;">Error connecting to vimeo</div>')},success:function(a){var j,k,i=0;if(a.length){if(g(a[0].id),!d.l){for(j=b("<ul>",{"class":"fsGroupSpaceElementVimeoElement"}),k=b('<li class="fsGroupSpaceElementVimeoElement"><img class="fsGroupSpaceElementVimeoElement_thumb"><div class="fsGroupSpaceElementVimeoElement_title"></div><div class="fsGroupSpaceElementVimeoElement_views"></div><div class="fsGroupSpaceElementVimeoElement_desc"></div><div class="floatfix"></div></li>');i<a.length&&(k.find("img").attr({src:a[i].thumbnail_medium,alt:a[i].title,title:a[i].title}),k.find("div.vimeo_title").html(a[i].title),k.find("div.vimeo_views").html(a[i].stats_number_of_plays+" views"),k.find("div.vimeo_desc").html(a[i].description),k.clone().click(function(){f=b("#"+e),g(a[b(this).index()].id),f=c}).appendTo(j),i!=d.m-1);i++);b('<li class="fsGroupSpaceElementVimeoElement_view_link"><a href="http://www.vimeo.com/'+h.replace(/(channel|group)/,"$1s")+d.o+'" target="_blank">View on vimeo</a></li>').appendTo(j),f.find("div.data_fs_link_color").each(function(){j.find("a").css("color",b(this).text())}),f.append(j),f=c}}else f.html('<div style="margin:5px;">No videos found</div>')},url:a.location.protocol+"//vimeo.com/api/v2/"+h+d.o+"/videos.json"})};if(this.name="vimeo",d.o&&d.t)switch(e=d.i,f=b("#"+e),d.t){case"album":h.apply(this,["album/"]);break;case"channel":h.apply(this,["channel/"]);break;case"group":h.apply(this,["group/"]);break;case"user":h.apply(this,[""]);break;case"video":"none"==f.css("display")?f.bind("elementOpened",function(){g(d.o),f.unbind("elementOpened"),f=c}):f.parent().is(":hidden")?(setTimeout(function(){g(d.o),d.o=null},10),f=c):(g(d.o),f=c)}return this},x.youtube=function(d){var f,e=0,g=function(c){var d=b("#"+e);b(d).length>0&&b(d).html('<div class="fsGroupSpaceYouTubePlayerResponsiveContainer"><iframe id="'+e+'_player" class="fsGroupSpaceYouTubePlayer" type="text/html" frameborder="0" width="100%" height="100%" src="'+a.location.protocol+"//www.youtube.com/embed/"+c+"?enablejsapi=1&origin="+a.location.protocol+a.location.hostname+'"></iframe></div>')},h=function(){var a=0,k=d.d.items||[],l=b("<ul>",{"class":"fsGroupSpaceDashboardYouTube"}),m=b('<li class="fsGroupSpaceDashboardYouTube"><img class="fsGroupSpaceDashboardYouTube_thumb"><div class="fsGroupSpaceDashboardYouTube_title"></div><div class="fsGroupSpaceDashboardYouTube_views"></div><div class="fsGroupSpaceDashboardYouTube_desc"></div><div class="floatfix"></div></li>');if(k.length)if(d.l)g(k[0].id.videoId||k[0].snippet.resourceId.videoId);else{for(g(k[0].id.videoId||k[0].snippet.resourceId.videoId);a<k.length;a++)k[a].snippet.thumbnails?m.find("img").attr({src:k[a].snippet.thumbnails.default.url,alt:k[a].snippet.title,title:k[a].snippet.title}):m.find("img").attr({src:"",alt:"",title:""}),m.find("div.fsGroupSpaceDashboardYouTube_title").html(k[a].snippet.title),m.find("div.fsGroupSpaceDashboardYouTube_desc").html(k[a].snippet.description),m.clone().click(function(){g(k[$j(this).index()].id.videoId||k[$j(this).index()].snippet.resourceId.videoId)}).appendTo(l);f.find("div.data_fs_link_color").each(function(){l.find("a").css("color",b(this).text())}),b("#"+e).after(l),f=c}else f.html('<div style="margin:5px;">No videos found</div>')};if(this.name="youtube",d.o)switch(e=d.i,f=b("#"+e),d.t){case"channel":case"user":h.apply(this);break;case"playlist":h.apply(this);break;case"video":g(d.o)}return this},b.support.inputPlaceholder="placeholder"in document.createElement("input"),b.support.textareaPlaceholder="placeholder"in document.createElement("textarea"),b.fn.extend({placeholder:function(){return this.each(function(){var a=b(this),c=this.nodeName.toLowerCase();("input"==c&&!b.support.inputPlaceholder&&"hidden"!=this.type.toLowerCase()||"textarea"==c&&!b.support.textareaPlaceholder)&&a.focus(function(){var a=b(this);a.val()==a.attr("placeholder")&&a.removeClass("fsHasPlaceholder").val("")}).blur(function(){var a=b(this);""==a.val()&&a.val(a.attr("placeholder"))}).addClass("fsHasPlaceholder").val(a.attr("placeholder"))})}}),b("#fsGroupsAccountMenuButton").click(function(){return A(b("#fsGroupsAccountMenu")),!1}),b("#fsGroupsAccountMenu").on("click",function(a){var c=b(a.target),d=b.trim(c.text());switch(d){case"Profile":y("profile");break;case"Subscriptions":y("subscr");break;case"Change Password":y("account");break;case"Files":w.popUp("cf_filemanager/adminfiles.cfm?opener=personal",750,550,"files");break;case"My Quizzes":w.popUp("cf_quiz/admin.cfm",990,700,"quizzes");break;case"My Groups":w.popUp("cf_group/admingrouppop.cfm?classmanager=my",810,600,"classes");break;case"Admin Login":top.document.location.href="admin.cfm?username="+c.attr("data-un");break;case"Link Google Drive":top.document.location.href="cf_group/googledrive.cfm?action=link";break;case"Unlink Google Drive":top.document.location.href="cf_group/googledrive.cfm?action=unlink"}}),b("#fsGroupsDashboardActivityStream").on("click",".markAllAsReadBtn",function(){v.util.displayLoadingPrompt("updating events"),bb()}),b(".fsGroupsNavTab").click(function(){var a=b(this);A(a.children(".fsGroupsNavMenu"))}),b(".fsGroupsNavMenuAttendee").click(function(){return b(this).parent().toggleClass("fsStateOpen").siblings().removeClass("fsStateOpen"),!1}),isNaN(k))b("#fsGroupsDashboardWelcomeMessageText").on("messageCountUpdated",".fsUnreadMessageCount",function(){var c=b(this),d=parseInt(c.attr("data-unreadmessagecount"),10),e=c.parents("#fsGroupsDashboardWelcomeMessageText");1==d?e.attr("class","fsStateOneMessage"):0==d?e.attr("class","fsStateNoMessages"):e.attr("class","")});else{b(".fsGroupSpaceAdminName").click(function(){var a=b(this);return a.parent().siblings().children("div").removeClass(h),A(a.next()),!1}),b("#fsGroupSpaceAdminShowHide").click(function(){b(this).hide().nextAll().removeClass("fsStyleHidden")}),b(".fsGroupSpaceAdminActions").on("click",".fsGroupSpaceAdminAction",function(a){var c=b(a.currentTarget),d=b.trim(c.text());return"Profile"==d?(z(c.attr("data-pid"),k,pageid),!1):void 0}),b("#fsGroupSpaceQuickAddMenuButton").click(function(){return A(b("#fsGroupSpaceQuickAddMenu")),!1}),b("#fsGroupSpaceQuickAddMenu").on("click",".fsGroupSpaceQuickAddMenuItem",function(){var a=b(this);if("#"==a.attr("href"))switch(a.text()){case"Media":w.popUp("cf_media/addclasschannel.cfm?groupid="+k,1e3,660,"media");break;case"Gradebook Entry":v.gradebook.getGradebookEntryForm(0,"entry")}}),b("#fsGroupSpaceSettingsMenuButton").click(function(){return w.popUp("cf_group/admingrouppop.cfm?classmanager=my&grouptab=groupspacesettings&id="+k,810,600),!1}),b("#fsGroupSpaceDashboardEditOverviewLink").click(function(){return w.popUp("cf_group/admingroupoverview.cfm?groupID="+k,420,380,"grouppop"),!1}),b("#fsGroupSpaceThemeMenuButton").click(function(){return A(B(),!0),!1}),b("#fsGroupSpaceEditPageButton").click(function(){b("#fsGroupSpaceDashboardCustomizeDialog").dialog("open").find("*").blur()}),b("#fsGroupSpaceDashboardCopyButton").click(function(){b("#fsGroupSpaceDashboardCopyDialog").dialog("open").find("*").blur(),K(!1)}),b("#fsGroupSpaceDashboardCopyFromButton").click(function(){b("#fsGroupSpaceDashboardCopyDialog").dialog("open").find("*").blur(),K(!0)}),b("#fsGroupSpaceDashboardCopyDialog").on("click",".archivedGroupsToggle",function(){0==b(this).val()?(b("#activeGroupsOutput").show(),b("#archivedGroupsOutput").hide()):(b("#activeGroupsOutput").hide(),b("#archivedGroupsOutput").show())}),b("#fsGroupSpaceDashboardCopyDialog").dialog({autoOpen:!1,buttons:[{text:"Cancel",click:function(){b(this).dialog("close"),b("#fsGroupSpaceDashboardCopyForm").find("input:checked[disabled!=disabled]").attr("checked",!1)}},{text:"Copy",click:function(){var e,f,c=b("#fsGroupSpaceDashboardCopyForm").find("input:checked[disabled!=disabled]:not(.archivedGroupsToggle)"),d=b("#copyDirection").val();if("to"==d?(e='This action will replace all dashboard settings for the specified groups. Press "Ok" to continue.',f="You must select at least one group to receive this group's dashboard settings"):(e='This action will replace all dashboard settings for the current group. Press "Ok" to continue.',f="You must select the group from which you want to copy the dashboard settings"),c.length){if(confirm(e)){var g=b(this),h=b("#fsGroupSpaceDashboardCopySavingDialog"),i=[],d=b("#copyDirection").val(),j=b(".archivedGroupsToggle").val()||0;g.dialog("close"),h.html('<img src="images/loading_large_circle.gif" alt="saving">').dialog("open"),c.each(function(){i.push(b(this).val())}),b.ajax("cf_group/endpoints/dashboard.cfm",{cache:!1,data:{groupID:k,groupIDs:i.join(","),direction:d,archived:j},type:"post",error:function(){alert("There was an error copying the settings. Please try again."),h.dialog("close"),g.dialog("open")},success:function(){alert("The settings have been copied successfully."),h.dialog("close"),c.attr("checked",!1),"from"==d&&location.reload()}})}}else alert(f)}}],close:function(){b("#copyDialogGroups").html("Loading...")},modal:!0,resizable:!1,title:"Copy Dashboard To Other Groups",width:620}).show(),b("#fsGroupSpaceDashboardCopyForm").on("click",".fsGroupSpaceDashboardCopyTLG",function(a){b(a.target).hasClass("fsGroupSpaceDashboardCopyTLG")&&b(this).toggleClass("fsStateOpen")}),b("#fsGroupSpaceDashboardCopySavingDialog").dialog({autoOpen:!1,buttons:[],closeOnEscape:!1,height:115,modal:!0,resizable:!1,title:"Copying Settings",width:146}).show().prev().find("a").remove();var L=b("#fsGroupSpaceDashboardCustomizeColumnOne");if(L.length){var M=b('<div id="fsGroupSpaceDashboardCustomizeColumnSelectContainer">Layout: <select name="dashboardCustomizeSelect"><option value="1">1 Column</option><option value="2">2 Columns</option><option value="3">3 Columns</option></select></div>'),N=M.find("select");N.change(function(){var a=U.find("."+f);switch(b(this).val()){case"1":a.addClass("fsStyleOneColumn").removeClass("fsStyleTwoColumn fsStyleThreeColumn"),H(a,1);break;case"2":a.addClass("fsStyleTwoColumn").removeClass("fsStyleOneColumn fsStyleThreeColumn"),H(a,2);break;case"3":a.addClass("fsStyleThreeColumn").removeClass("fsStyleOneColumn fsStyleTwoColumn")}C()}),L.hasClass("fsStyleTwoColumn")?N.val(2):L.hasClass("fsStyleThreeColumn")&&N.val(3);var O="fsGroupSpaceDashboardCustomizeDPadUp",P="fsGroupSpaceDashboardCustomizeDPadDown",Q="fsGroupSpaceDashboardCustomizeDPadLeft",R="fsGroupSpaceDashboardCustomizeDPadRight",S=null,T=b('<div id="fsGroupSpaceDashboardCustomizeDPad" class="fsStyleBorderBoxSizing"><div id="'+O+'"></div><div id="'+Q+'"></div><div id="'+R+'"></div><div id="'+P+'"></div></div>');T.on("click","div:not(."+g+")",function(){var a=b(this);if(S){switch(a.attr("id")){case"fsGroupSpaceDashboardCustomizeDPadUp":S.prev().before(S);break;case"fsGroupSpaceDashboardCustomizeDPadLeft":S.appendTo(S.parent().prev());break;case"fsGroupSpaceDashboardCustomizeDPadRight":S.appendTo(S.parent().next());break;case"fsGroupSpaceDashboardCustomizeDPadDown":S.next().after(S)}G(S.parent(),S),C()}else T.removeClass("fsStyleDisplayBlock")});var U=b("#fsGroupSpaceDashboardCustomizeDialog"),V='<a href="##" class="fsGroupSpaceDashboardCustomizeDeleteItem fsIconBlackX"  title="Remove Element"></a>';U.dialog({autoOpen:!1,buttons:[{text:"Close",click:function(){b(this).dialog("close")}},{text:"Apply",click:function(){var a="";b("."+f).each(function(){var c=b(this).sortable("toArray",{attribute:"data-type"}).join(",");c.length&&(a.length&&(a+=",column_end,"),a+=c)}),b("#fsGroupSpaceDashboardCustomizeOverview").hasClass(g)||(a="overview,"+a),b("#fsGroupSpaceDashboardCustomizeElementsInput").val(a).parent().submit()}}],modal:!0,resizable:!1,title:"Customize Group Space Home Page",width:620}).show().dialog("widget").find(".ui-dialog-buttonpane").attr("id","fsGroupSpaceDashboardCustomizeButtonPane").prepend(T).prepend(M),b("#fsGroupSpaceDashboardCustomizeOverviewShowHide").click(function(){return b(this).toggleClass("fsIconAdd fsIconBlackX").parent().toggleClass(g),!1}),b("."+f).sortable({connectWith:"."+f,distance:3,helper:"clone",items:"div",tolerance:"pointer",start:function(a,b){b.helper.css({height:"25px","background-color":"#FFF"}),D()},stop:function(a,b){b.item.hasClass(d)&&I(b.item),b.item.attr("style","")}}).on("click",".fsGroupSpaceDashboardCustomizeDeleteItem",function(){var a=b(this).parent(),c=b("."+d+"[data-type="+a.attr("data-type").split("-").shift()+"]"),f=c.find("."+e);return c.removeClass(g),f.length&&f.text(parseInt(f.text(),10)+1),S&&a.get(0)===S.get(0)&&D(),a.remove(),!1}).on("click","."+j,function(){S&&S.removeClass(i),S=b(this),S.addClass(i),C(),T.addClass(h),F()}),b("."+d).draggable({cancel:"."+g,connectToSortable:"."+f,helper:"clone",revert:function(a){return a||b(this).addClass("fsReverting"),!a},start:function(a,b){b.helper.find("."+e).hide()},stop:function(a){var d=b(a.target);d.hasClass("fsReverting")?d.removeClass("fsReverting"):J(d)}}).click(function(){var a=b(this),c=a.clone();if(!a.hasClass(g)){var d=b("#fsGroupSpaceDashboardCustomizeColumnOne");I(c),c.appendTo(d),c.click(),G(d,c),J(a)}})}b(".fsGroupSpaceElementEditContentLink").click(function(){return w.popUp("cf_group/admingroupcontent.cfm?id="+k+"&contentID="+b(this).attr("data-id"),420,380,"groupContent"),!1}),b(".fsGroupSpaceElementEditRSSLink").click(function(){return b("#fsGroupSpaceDashboardRSSSettings_"+b(this).attr("data-id")).slideToggle(),!1}),b(".fsGroupSpaceElementEditEmbedLink").click(function(){return b("#fsGroupSpaceDashboardEmbedSettings_"+b(this).attr("data-id")).dialog({buttons:[{text:"Close",click:function(){b(this).dialog("destroy")}},{text:"Update",click:function(){var a=b(this).find("form");try{var c=a.find('textarea[name="embedContent"]'),d=$j(c.val()),e=d.attr("src");"iframe"===d.prop("tagName").toLowerCase()&&d.attr("src").length&&e.toLowerCase().indexOf("youtube.com")>=0&&-1==e.indexOf("wmode=")&&(d.attr("src",e+(-1===e.indexOf("?")?"?":"&")+"wmode=opaque"),c.val(b("<div>").append(d.clone()).html()))}catch(f){}a.submit()}}],modal:!0,resizable:!1,title:"Embed Settings",width:600,close:function(){b.qtip&&b(this).find(".fsGroupSpaceDashboardEmbedIcon").qtip("destroy")},open:function(){b(this).find(".fsGroupSpaceDashboardEmbedIcon").qtip({content:{attr:"data-tooltip"}})}}),!1}),b(".fsGroupSpaceElementEditFacebookLink").click(function(){return b("#fsGroupSpaceDashboardFacebookSettings").slideToggle(),!1}),b(".fsGroupSpaceElementEditVimeoLink").click(function(){return b("#fsGroupSpaceDashboardVimeoSettings").slideToggle(),!1}),b(".fsGroupSpaceElementEditFlickrLink").click(function(){return b("#fsGroupSpaceDashboardFlickrSettings").slideToggle(),!1}),b(".fsGroupSpaceElementEditYouTubeLink").click(function(){return b("#fsGroupSpaceDashboardYouTubeSettings").slideToggle(),!1})}b("#fsGroupsAccountMenuAvatarContainer").on("messageCountUpdated",".fsUnreadMessageCount",function(){var c=b(this),d=parseInt(c.attr("data-unreadmessagecount"),10),e=parseInt(c.attr("data-unreadactivitycount"),10),g=(c.parents("#fsGroupsAccountMenuAvatarContainer"),d+e);c.text(g),c.attr("data-unreadmessagecount",d),c.attr("data-unreadactivitycount",e),g>=1&&c.hasClass("fsStyleHidden")?c.removeClass("fsStyleHidden"):0!=g||c.hasClass("fsStyleHidden")||c.addClass("fsStyleHidden")}),v.social.selectFile=function(a,b){q.next().val(b).next().val(a)},b.fn.socialAttachFile=function(a){switch(a=a||"init"){case"clear":this.each(function(){b(this).find("."+n+"ments").hide().empty(),l=0});break;default:this.each(function(){b(this).click(W).on("change",'input[type="file"]',function(a){var c=b(a.target);c.prev().val(c.val().replace("C:\\fakepath\\",""))}).on("keydown",function(a){return 13!==a.keyCode})})}return this},b(".fsUnreadMessageCount").length&&setTimeout(_,t),b(".fsUnreadMessageCount").on("updateMessageCount",function(a,c){var d=b(this),f=(b(this).attr("data-unreadmessagecount"),parseInt(d.text(),10)),c=c?c:0;d.text(c),d.attr("data-unreadmessagecount",c),c>=1&&d.hasClass("fsStyleHidden")?d.removeClass("fsStyleHidden"):0!=c||d.hasClass("fsStyleHidden")||d.addClass("fsStyleHidden"),c-f>0&&b("#conversationList").trigger("loadNewMessages"),f!=c&&d.trigger("messageCountUpdated")}).on("reduceMessageCount",function(a,c){var d=b(this);c=c?c:0;var e=Math.max(0,parseInt(d.text(),10)-c);e>=1&&d.hasClass("fsStyleHidden")?d.removeClass("fsStyleHidden"):0!=e||d.hasClass("fsStyleHidden")||d.addClass("fsStyleHidden"),d.text(e),d.attr("data-unreadmessagecount",e),d.trigger("messageCountUpdated")}),b(".fsUnreadActivityCount").length&&setTimeout(ab,u),b(".fsUnreadActivityCount").on("updateActivityCount",function(a,c){var d=b(this),c=(parseInt(d.text(),10),c?c:0);d.text(c),d.attr("data-unreadactivitycount",c),b("#fsGroupsAccountMenuAvatarContainer").find(".fsUnreadMessageCount").attr("data-unreadactivitycount",c),c>=1&&d.hasClass("fsStyleHidden")?(d.removeClass("fsStyleHidden"),d.parents(".fsGroupsAccountMenuItem").attr("href","groups.cfm?newactivity=1")):0!=c||d.hasClass("fsStyleHidden")||d.addClass("fsStyleHidden"),b(".fsUnreadMessageCount").trigger("messageCountUpdated")
}).on("reduceActivityCount",function(a,c){var d=b(this);c=c?c:0;var e=Math.max(0,parseInt(d.text(),10)-c);e>=1&&d.hasClass("fsStyleHidden")?d.removeClass("fsStyleHidden"):0!=e||d.hasClass("fsStyleHidden")||(d.addClass("fsStyleHidden"),d.parents(".fsGroupsAccountMenuItem").attr("href","groups.cfm")),d.text(e),d.attr("data-unreadactivitycount",e),b("#fsGroupsAccountMenuAvatarContainer").find(".fsUnreadMessageCount").attr("data-unreadactivitycount",e),b(".fsUnreadMessageCount").trigger("messageCountUpdated")}).on("refreshUnreadActivityCount",function(){ab()});var cb=v.calendar;cb.displayEventDetails=function(d,e,f){var g={action:"getEventDialogHTML"};"undefined"==typeof e||isNaN(e)?g.occurID=d:g.eventID=e;var h=f.attr("data-gid");"undefined"!==h&&(g.groupid=h),v.util.displayLoadingPrompt("Loading event"),b.ajax({type:"POST",url:"cf_calendar/ajax/fullcalendar.cfm",data:g,dataType:"json",success:function(e){var g=b("#fsCalendarEventDetails");0===g.length&&(g=b('<div id="fsCalendarEventDetails"></div>'),b("body").append(g));var i={};if(e.result.hasDropbox?i["View Dropbox"]=function(){a.location.href="groups.cfm?groupID="+e.result.groupID+"&tab=dropbox&view=detail&oid="+d,b(this).dialog("close")}:e.result.hasQuiz&&e.result.quizIsActive&&(i["Take Quiz"]=function(){e.result.isTimedQuiz?v.util.dialog("You are about to take a timed quiz. Once you start, you must finish within the allotted time. Would you like to continue?","System Message",{Yes:function(){a.location.href="groups.cfm?groupID="+e.result.groupID+"&tab=quizzes&verbose="+d+"&quizAction=start"},No:function(){b(this).dialog("close")}}):a.location.href="groups.cfm?groupID="+e.result.groupID+"&tab=quizzes&verbose="+d+"&quizAction=start"}),g.html(e.result.HTML).dialog({title:"Event Details",buttons:i,closeOnEscape:!0,autoOpen:!1,modal:!0,resizable:!1,stack:!0,open:function(){b(".ui-widget-overlay").on("click",function(){g.dialog("close")}),g.find("a").blur()},width:isMobile?"100%":550,height:320}).dialog("open"),h==c){var j=$j("#fsGroupSpaceTitle");j.length&&g.find(".fsCalendarEventClass").html(j.html()),g.find(".fsCalendarEventTitle").find("span").html(f.html().replace("<br>"," "))}e.result.hasDropbox&&b(".ui-dialog-buttonpane").find('button:contains("Dropbox")').find("span").removeClass("ui-button-text-only").addClass("ui-button-text-icon-primary").prepend('<img src="images/admin_ui/2.0/black/eye.png">&nbsp;'),v.util.hideLoadingPrompt()}})},b("#fsGroupsBody").on("click",".fsCalendarEventLink",function(){var a=b(this);return a.attr("data-eventID")?cb.displayEventDetails(!1,a.attr("data-eventID"),a):cb.displayEventDetails(a.attr("data-occurID"),"undefined",a),!1});var db=v.athletics;db.displayAthleticDetails=function(a){v.util.displayLoadingPrompt("Loading event"),b.ajax({type:"POST",url:"cf_calendar/ajax/fullcalendar.cfm",data:{action:"getAthleticEventDialogHTML",athleticEventID:a},dataType:"html",success:function(a){var c=b("#fsAthleticsEventDetails");0===c.length&&(c=b('<div id="fsAthleticsEventDetails"></div>'),b("body").append(c)),c.html(a).dialog({title:"Athletic Event Details",buttons:{},closeOnEscape:!0,autoOpen:!1,modal:!0,resizable:!1,stack:!0,open:function(){b(".ui-widget-overlay").on("click",function(){c.dialog("close")}),c.find("a").blur()},width:isMobile?"100%":550,height:320}).dialog("open"),v.util.hideLoadingPrompt()}})},b("#fsGroupsBody").on("click",".fsAthleticsEventLink",function(){return db.displayAthleticDetails(b(this).attr("data-athID")),!1});var eb=v.gradebook;eb.getGradebookEntrySettings=function(a,c){c=c||!1,v.util.displayLoadingPrompt("Loading gradebook"),b.ajax({type:"POST",url:"cf_academics/ajax/lmsGradebook.cfm",data:{action:"getLMSAssignmentSettings",calendarIDList:a},dataType:"json",success:function(a){if(0===a.result.length)return c||w.dialog("You must first select at least one <strong>academic class</strong> calendar before a gradebook entry can be created."),v.gradebook.setDataObject(""),!1;var b=$j("#fsGradebookEntrySettings");$j("#fsGradebookData"),0==b.length&&(b=$j('<div id="fsGradebookEntrySettings" class="dialog"><p><label>Max Points:</label> <input type="text" id="fsGradebookMaxPoints" size="5" maxlength="5"> (whole point values only)</p><div id="fsGradebookGroups"><table><thead><tr><th style="width:200px;">Class</th><th id="fsGradebookEntrySettingsCategoryHeader">Category</th></tr><thead><tbody></tbody></table></div><div id="fsGradebookNew"><span class="requiredField">*</span> A gradebook does not yet exist for this group and one will be created when this event is saved</div></div>'),$j("body").append(b),b.dialog({title:"Gradebook Entry Settings",width:500,autoOpen:!1,closeOnEscape:!1,modal:!0,resizable:!1,stack:!0,open:function(){$j(".ui-dialog-titlebar-close",$j(this).parent()).hide()},buttons:{Apply:function(){var a=parseInt($j("#fsGradebookMaxPoints").val(),10);if(isNaN(a)||0>=a||0!=parseFloat($j("#fsGradebookMaxPoints").val())%1)return w.dialog("The maximum points for this gradebook entry must be a whole point value greater than 0."),eb.setDataObject(""),!1;var b={maxPoints:a,groups:{}};$j("#fsGradebookGroups tbody tr").each(function(a,c){var d=$j(c),e={};e.groupID=parseInt(d.attr("data-groupID")),e.categoryID=isNaN(parseInt(d.find(".fsGradebookGroupsCategory option:selected").val()))?0:parseInt(d.find(".fsGradebookGroupsCategory option:selected").val()),b.groups[e.groupID]=e}),b.type="entry",eb.setDataObject(b),$j(this).dialog("close")},"Delete Gradebook Entry":function(){$j("#fsGradebookData").val().length>0?w.dialog("Are you sure you want to delete the gradebook entry and any grades associated with it?","Confirm Delete",{Delete:function(){$j(this).dialog("close"),eb.setDataObject(""),b.dialog("close")},Cancel:function(){$j(this).dialog("close")}}):(eb.setDataObject(""),$j(this).dialog("close"))},Cancel:function(){$j(this).dialog("close")}}}));try{var e=eb.getDataObject();$j("#fsGradebookMaxPoints").val(e.maxPoints)}catch(f){eb.setDataObject("")}var g=$j("#fsGradebookGroups tbody");g.html("");var h=!1,i=!1;$j.each(a.result,function(a,b){b.gradebookCreated||(h=!0,b.groupName+='<span class="requiredField">*</span>');var c='<tr data-groupID="'+b.groupID+'"><td style="overflow:hidden;">'+b.groupName+"</td><td>";if("object"==typeof b.categories&&b.categories.length>0){i=!0,c+='<select class="fsGradebookGroupsCategory">',c+='<option value="0">Ungraded</option>';for(var d=0;d<b.categories.length;d++)c+='<option value="'+b.categories[d].id+'"',"object"==typeof e.groups&&"object"==typeof e.groups[b.groupID]&&b.categories[d].id===e.groups[b.groupID].categoryID&&(c+=" selected"),c+=">",c+=b.categories[d].name,b.isStandardScale||(c+=" ("+b.categories[d].weight+"%)"),c+="</option>";c+="</select>"}c+="</td></tr>",g.append($j(c))}),i?$j("#fsGradebookEntrySettingsCategoryHeader").show():$j("#fsGradebookEntrySettingsCategoryHeader").hide(),$j("#fsGradebookNew").toggle(h),b.dialog("open")},error:function(){},complete:function(){w.hideLoadingPrompt()}})},eb.getGradebookEntryForm=function(a,c,d){d=d||!1,0==a?v.util.displayLoadingPrompt("Loading New Gradebook Entry Form"):v.util.displayLoadingPrompt("Loading Edit Gradebook Entry Form");var e=$j("#fsGradebookEntryForm"),f=$j("#fsGroupSpaceHeader").attr("data-gid"),g=$j("#fsGroupSpaceTitle").html(),h='<div id="fsGradebookEntryForm" class="dialog" data-type="'+c+'"> <div id="fsGradebookEntryGroups"> <table> <thead> <tr> <th>Class</th> <th class="fsGradebookEntryGroupsCategoryHeader">Category</th> </tr> </thead> <tbody></tbody> </table> </div> <p class="fsGradebookEntryCol"> <label>Max Points</label> <input type="number" pattern="\\d{1,5}" min="1" id="fsGradebookEntryMaxPoints" size="5" maxlength="5"  >(whole point values only)</p>';h+='<p class="fsGradebookEntryRow"> <label>Title</label> ',"entry"==c?h+='<input type="text" id="fsGradebookEntryTitle">':"exam"==c&&(h+='<select id="fsGradebookEntryTitle"></select>',h+='<br><span id="weightInfo"></span>'),h+="</p>",h+='<p class="fsGradebookEntryCol"> <label>Date</label> <input type="text" id="fsGradebookDueDate" size="10" maxlength="10"></p>',h+='<p class="fsGradebookEntryColLg"> <label>Event Type</label> <select id="fsGradebookEventType"></select> </p>',h+='<p class="" style="clear:both"><div class="mpNotification"></div> </p>',"entry"==c&&(h+='<a id="aJumpToCalendar" href="javascript:void 0;" class="fsGroupIconLink fsGroupIconBtnEdit inactive" title=\'"Max Points" must be a whole number greater than 0.\'>Jump to calendar for more options...</a> </div>'),e=$j(h);var i=function(a){var b=e.find("#aJumpToCalendar");a.val()>0&&/^\d+$/.test(a.val())?(b.attr("title",null),b.removeClass("inactive"),b.on("click",function(){v.gradebook.gradebookToCalendarLink()})):(b.attr("title",'"Max Points" must be a whole number greater than 0.'),b.addClass("inactive"),b.unbind("click"))};$j(document).on("keyup","#fsGradebookEntryMaxPoints",function(){i(b(this))}),$j(document).on("change","#fsGradebookEntryMaxPoints",function(){i(b(this))}),e.append('<input type="hidden" id="fsGradeBookEntryData">'),e.append('<input type="hidden" id="fsGradeBookEntryEventID" value="0">'),e.append('<input type="hidden" id="fsGradeBookEntryRecurring" value="0">'),e.append('<input type="hidden" id="fsGradeBookEntryType" value="'+c+'">'),e.replaceWith(e),e.dialog({title:"Gradebook Entry",width:500,autoOpen:!1,closeOnEscape:!1,modal:!0,resizable:!1,stack:!0,async:!1,open:function(){w.hideLoadingPrompt(),w.displayLoadingPrompt("Getting form data"),$j(".ui-dialog-titlebar-close",$j(this).parent()).hide();var e="";"object"==typeof stEventTypes?($j.each(stEventTypes,function(a,b){e+='<option value="'+a+'">'+b+"</option>"}),$j("#fsGradebookEventType").html(e)):$j.ajax({type:"POST",url:"cf_academics/ajax/lmsGradebook.cfm",data:{action:"getCalEventTypes"},dataType:"json",success:function(a){var b="";a.result.DATA.length>0&&$j(a.result.DATA).each(function(){"athletic"!=$j(this)[2]&&(b+='<option value="'+$j(this)[0]+'">'+$j(this)[1]+"</option>")}),$j("#fsGradebookEventType").html(b)}}),$j("#fsGradebookEventType").html(e),$j.ajax({type:"POST",url:"cf_academics/ajax/lmsGradebook.cfm",data:{action:"getEntryEventDetails",entryID:a,groupID:f,groupName:g},dataType:"json",async:!1,success:function(a){var b=a.result,e=(b.event.occurID,b.event.eventID),f=b.event.groups,g=b.event.eventTypeID,h=b.event.recurring,j=(b.event.hasDropbox,b.event.title),k=b.event.linkedExamID,l=b.event.maxPoints,m=b.event.date,n=m.match(/(\d+)/g),o=new Date(n[0],n[1]-1,n[2]),p=b.event.mpid,q=b.event.mpname,r=b.event.termid;if(""==q&&(q="No marking period within selected date range."),$j("#fsGradebookEntryForm").attr("data-maxpoints",l),$j("#fsGradeBookEntryRecurring").val(h),$j("#fsGradeBookEntryEventID").val(e),"entry"==c)$j("#fsGradebookEntryTitle").val($j.trim(j));else if("exam"==c){var s="";$j.each(b.groupexams,function(){s+='<option value="'+this.EXAMID+'"  data-weight="'+this.WEIGHT+'"  data-weighted="'+this.WEIGHTED+'" ',this.EXAMID==k&&(s+=" selected"),s+=">",s+=this.EXAMNAME,s+="</option>"}),$j("#fsGradebookEntryTitle").html(s)}$j("#fsGradebookEntryMaxPoints").val(l>0?l:"").change(),$j('#fsGradebookEventType option[value="'+g+'"]').prop("selected",!0),$j("#fsGradebookDueDate").datepicker({dateFormat:dateFormat,showOn:"both",buttonImage:"images/admin_ui/2.0/calendar.png",buttonImageOnly:!0}).datepicker("setDate",o),$j(".mpNotification").html(q).attr("data-termid",r).attr("data-mpid",p).attr("data-hold_date",$j("#fsGradebookDueDate").val()),h&&($j("#fsGradebookDueDate").attr("readonly",!0).datepicker("destroy"),$j("#fsGradebookDueDate").addClass("fsInactive").after(' <span class="fsInactive">*recurring event - cannot edit</span>')),$j("#fsGradebookEntryGroups tbody").html("");var t=!1;$j.each(f,function(a,b){var d='<tr data-groupID="'+a+'"><td>'+b.groupName+"</td><td>";if("object"==typeof b.categories&&b.categories.length>0&&"entry"==c){t=!0,d+='<select class="fsGradebookGroupsCategory">',d+='<option value="0">',d+=b.isStandardScale?"Uncategorized":"Ungraded",d+="</option>";for(var e=0;e<b.categories.length;e++)d+='<option value="'+b.categories[e].id+'"',b.categoryID==b.categories[e].id&&(d+=" selected"),d+=">"+b.categories[e].name,b.isStandardScale||(d+=" ("+b.categories[e].weight+"%)"),d+="</option>";d+="</select>"}d+="</td></tr>",$j("#fsGradebookEntryGroups tbody").append(d)}),t?$j("#fsGradebookEntryGroups .fsGradebookEntryGroupsCategoryHeader").html("Category"):$j("#fsGradebookEntryGroups .fsGradebookEntryGroupsCategoryHeader").html("")}}),0===a&&$j("#fsGradebookDueDate").datepicker({dateFormat:dateFormat,showOn:"both",buttonImage:"images/admin_ui/2.0/calendar.png",buttonImageOnly:!0}).datepicker("setDate","0"),$j("#fsGradebookDueDate").on("change",function(){eb.checkForChangedMarkingPeriod(f,$j(this),c)}),$j("select#fsGradebookEntryTitle").on("change",function(){var a=$j(this).find("option:selected"),b=a.attr("data-weight"),c=a.attr("data-weighted");1==c?$j("#weightInfo").html(b+"% of year grade"):$j("#weightInfo").remove()}).change(),w.hideLoadingPrompt()},buttons:{Save:function(){var d={entryid:0,groups:{}};if(d.type=c,d.maxPoints=parseInt($j("#fsGradebookEntryMaxPoints").val(),10),d.entryTitle=$j.trim($j("#fsGradebookEntryTitle").val()),d.eventType=$j("#fsGradebookEventType").val(),d.eventID=$j("#fsGradeBookEntryEventID").val(),d.recurring=$j("#fsGradeBookEntryRecurring").val(),d.dueDate=$j.trim($j("#fsGradebookDueDate").val()),isNaN(d.maxPoints)||d.maxPoints<=0||0!=parseFloat($j("#fsGradebookEntryMaxPoints").val())%1)return w.dialog("The maximum points for this gradebook entry must be a whole point value greater than 0."),!1;if(!d.entryTitle.length)return w.dialog("The title is required"),!1;if(!d.dueDate.length)return w.dialog("The due date is required"),!1;if($j("#fsGradebookEntryGroups tbody tr").each(function(a,b){var c=$j(b),e={};e.groupID=c.attr("data-groupID"),e.categoryID=c.find(".fsGradebookGroupsCategory option:selected").val(),d.groups[e.groupID]=e}),$j.isEmptyObject(d.groups))return w.dialog("There are no groups provided to save entry."),$j("#fsGradeBookEntryData").val(""),!1;try{$j("#fsGradeBookEntryData").val(JSON.stringify(d))}catch(e){return $j("#fsGradeBookEntryData").val(""),!1}if(eb.saveGradebookEntryForm(),$j("#fsGradebookEntryForm").attr("data-maxpoints")!=d.maxPoints&&$j("#fsGradebook").attr("data-entrycount")>0&&stRoster.count>0&&0!=a){var f=$j("#fsGradebookEntryList li.fsGradebookEntryItem[data-entryid='"+a+"']").find(".grade-cnt").html()||0;f>0&&$j.blockUI({message:"<h1>Recalculating Grades...</h1>",onBlock:function(){setRosterGrades(!0,!0),$j.unblockUI()}})}b(this).dialog("close")},Cancel:function(){$j(this).dialog("close")}},complete:function(){w.hideLoadingPrompt()},close:function(){$j(this).empty().dialog("destroy"),$j("#fsGradebookEntryForm").find("input#fsGradeBookEntryData").remove(),$j("#fsGradebookEntryForm").find("input#fsGradeBookEntryEventID").remove(),$j("#fsGradebookEntryForm").find("input#fsGradeBookEntryRecurring").remove()}}),e.dialog("open")},eb.gradebookToCalendarLink=function(){var b=$j("#fsGroupSpaceHeader").attr("data-gid"),c=$j("#fsGradebookEntryForm").find("#fsGradebookEntryTitle").val(),d=$j("#fsGradebookEntryForm").find("#fsGradebookEntryMaxPoints").val(),e=$j("#fsGradebookEntryForm").find(".fsGradebookGroupsCategory option:selected").val(),f=$j("#fsGradebookEntryForm").find("#fsGradebookEventType option:selected").val(),g=$j("#fsGradebookEntryForm").find("#fsGradebookDueDate").val(),h=$j("#fsGradeBookEntryEventID").val(),i={},j=$j("#fsGradebookEntryGroups"),k=j.find("tr[data-groupid]");k.each(function(){var a=$j(this),b=a.attr("data-groupid");i[b]={},i[b].groupID=b||0,i[b].categoryID=a.find(".fsGradebookGroupsCategory option:selected").val()||0});var l=encodeURIComponent(JSON.stringify(i));c=escape(c),a.location.href="groups.cfm?groupID="+b+"&tab=calendar&eventid="+h+"&eventtype="+f+"&edittitle="+c+"&editmaxpoints="+d+"&editcategory="+e+"&editdate="+g+"&groupsinfo="+l},eb.saveGradebookEntryForm=function(){var b=$j.parseJSON($j.trim($j("#fsGradeBookEntryData").val())),c=$j("#fsGroupSpaceHeader").attr("data-gid");v.util.displayLoadingPrompt("Saving Entry&hellip;");try{var d={};b.recurring;var f="cf_academics/ajax/lmsGradebook.cfm";d.action="editEvent",d.eventID=b.eventID,"entry"==b.type?d.eventTitle=b.entryTitle:"exam"==b.type&&(d.eventTitle="exam"),d.eventTypeID=b.eventType,d.startDate=b.dueDate,0==d.eventID&&(d.publish=1,d.allday=1,f="cf_calendar/ajax/fullcalendar.cfm",d.calendarID=$j("#fsGroupSpaceHeader").attr("data-calendarid")),2==d.eventTypeID&&(d.assignDate=d.startDate);var g=$j.trim($j("#fsGradeBookEntryData").val());g.length&&(d.gradebookData=g,d.fromgradebooktab=1),$j.ajax({type:"POST",url:f,data:d,success:function(){if(v.util.hideLoadingPrompt(),$j("#fsGradebookEntryTitle").val(""),$j("#fsGradebookEntryMaxPoints").val(""),$j("#fsGradebookDueDate").datepicker("setDate","0"),$j("#fsGradebookEntryList").length){var d=$j("#fsGradebook").attr("data-entrycount");d++,$j("#fsGradebook").attr("data-entrycount",d),loadGradebookEntryList()}else a.location.href="groups.cfm?groupID="+c+"&tab=gradebook&view=entry"},error:function(){v.util.hideLoadingPrompt(),v.util.dialog("An error occurred during save.")}})}catch(h){return v.util.hideLoadingPrompt(),v.util.dialog("An error occurred during save."),""}},eb.getDataObject=function(){try{return JSON.parse($j("#fsGradebookData").val())}catch(a){return""}},eb.setDataObject=function(a){if("object"==typeof a&&a.maxPoints&&a.groups&&!$j.isEmptyObject(a.groups))try{var b=$j.map(a.groups,function(a,b){return b}).length;$j("#fsGradebookLink a").text(b+" gradebook entr"+(1===b?"y":"ies")),$j("#fsGradebookData").val(JSON.stringify(a)),isDirty=!0}catch(c){$j("#fsGradebookLink a").text("Create gradebook entry"),$j("#fsGradebookData").val("")}else $j("#fsGradebookLink a").text("Create gradebook entry"),$j("#fsGradebookData").val("")},eb.setDataString=function(a){try{$j("#fsGradebookData").val(a),eb.setDataObject(eb.getDataObject())}catch(b){eb.setDataObject("")}},eb.checkForChangedMarkingPeriod=function(a,b,c){$j("#fsGradeBookEntryEventID").val(),"exam"==c?$j.ajax({type:"POST",url:"cf_academics/ajax/lmsGradebook.cfm",data:{action:"getTermByDate",groupID:a,date:b.val()},dataType:"json",async:!1,success:function(a){var b=$j(".mpNotification"),c=$j("#fsGradeBookEntryEventID").val();if(0!=c&&a.result.TERMID!=b.attr("data-termid"))alert("Exams can not be moved to other terms."),$j("#fsGradebookDueDate").val(b.attr("data-hold_date"));else if(a.result.GROUPEXAMS.length>0){var d="";$j.each(a.result.GROUPEXAMS,function(){d+='<option value="'+this.EXAMID+'"  data-weight="'+this.WEIGHT+'"  data-weighted="'+this.WEIGHTED+'">',d+=this.EXAMNAME,d+="</option>"}),$j("#fsGradebookEntryTitle").html(d),b.html(a.result.MPNAME),b.attr("data-hold_date",$j("#fsGradebookDueDate").val())}else alert("No exams in selected date range."),b.html("No exams in selected date range."),$j("#fsGradebookDueDate").val(b.attr("data-hold_date"))}}):"entry"==c&&$j.ajax({type:"POST",url:"cf_academics/ajax/lmsGradebook.cfm",data:{action:"getMarkingPeriodByDate",groupID:a,date:b.val()},dataType:"json",async:!1,success:function(a){var b=$j(".mpNotification");a.result.MPID!=b.attr("data-mpid")&&0!=a.result.MPID.length?confirm("Are you sure you want to move this assignment to another marking period?")?(b.attr("data-hold_date",$j("#fsGradebookDueDate").val()),b.html(a.result.MPNAME)):$j("#fsGradebookDueDate").val(b.attr("data-hold_date")):a.result.MPID!=b.attr("data-mpid")&&0==a.result.MPID.length?confirm("Are you sure you want to move this assignment to a date with no marking period defined?")?(b.attr("data-hold_date",$j("#fsGradebookDueDate").val()),b.html("No marking period defined")):$j("#fsGradebookDueDate").val(b.attr("data-hold_date")):(b.html(a.result.MPNAME),b.attr("data-hold_date",$j("#fsGradebookDueDate").val()))}})}}(window,jQuery);