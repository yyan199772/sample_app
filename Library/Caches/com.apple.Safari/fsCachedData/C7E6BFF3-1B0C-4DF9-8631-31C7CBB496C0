var g_iMODW=400;var g_iMODH=300;var g_fLMOC;var g_oDlgMOpt;function ldMOpt(){if(g_fLMOC){return}if(!$("divMOpt")){g_fLMOC=1;ldMOptDlg();return}shwMOptDlg()}function ldMOptDlg(){var oR=new oeReq("EditMessage","LOD",0,cbLdMOptDlg,GET);oR.send()}function cbLdMOptDlg(oR){if(!cbOeh(oR)){return}ldMOptDlgScr.sH=oR.sBody;ldMOptDlgScr()}function ldMOptDlgScr(){var oDivR=Owa.Dom.Document.get_Current().createElement("DIV");oDivR=Owa.Dom.Document.get_Current().appendChild(oDivR);oDivR.set_InnerHtml(ldMOptDlgScr.sH);eval($("divMOptScrpt").get_TextContent());oDivR.remove(true);g_oDlgMOpt=new BtnDlg("divMOpt",ldMOptDlgScr.sH,L_MOpt,new Array(L_OK,L_Close),g_iMODW,null,onClsMOpt,null,0,1);var oDlgOpt=$(g_oDlgMOpt.sId).getDescendantById("dlgOptScrt");var oOptScrt=$("optScrt");if(oOptScrt&&oDlgOpt){oDlgOpt.set_InnerHtml(oOptScrt.get_InnerHtml());oDlgOpt.set_IsShown(1);oOptScrt.remove(true)}shwMOptDlg();g_fLMOC=0}var L_MOpt;var L_Cncl;function shwMOptDlg(){setSelectValue("selImp",getImp().toString(10));setSelectValue("selSens",a_iSens.toString(10));getDialogElement("chkDvRcp").set_IsChecked(a_fDvRcp);getDialogElement("chkRdRcp").set_IsChecked(a_fRdRcp);var oDivWellBcc=$("divWellBcc");var oChkBcc=getDialogElement("chkBcc");var oLblBcc=getDialogElement("lblBcc");if(oDivWellBcc){oChkBcc.set_IsChecked(oDivWellBcc.get_IsShown())}else{oChkBcc.set_IsShown(0);oLblBcc.set_IsShown(0)}var oChkFrom=getDialogElement("chkFrom");var oLblFrom=getDialogElement("lblFrom");if(g_oMmBdy){var oBtnMsgEncrypt=Owa.Components.ToolbarCollection.get_Current().getButton("msgencypt");var oBtnMsgSgnd=Owa.Components.ToolbarCollection.get_Current().getButton("msgsgnd");var oChkEnCntnt=getDialogElement("chkEnCntnt");var oChkAddSig=getDialogElement("chkAddSig");oChkEnCntnt.set_IsChecked(oBtnMsgEncrypt.get_IsPushed());oChkEnCntnt.set_IsDisabled(oBtnMsgEncrypt._oElement.hasCssClass("btnDa"));oChkAddSig.set_IsChecked(oBtnMsgSgnd.get_IsPushed());oChkAddSig.set_IsDisabled(oBtnMsgSgnd._oElement.hasCssClass("btnDa"));getDialogElement("divMmFrm").set_IsShown(1);if($("divWellFrom")){oChkFrom.set_IsDisabled(1);oLblFrom.set_CssClasses(new Array("gry"))}else{oChkFrom.set_IsShown(0);oLblFrom.set_IsShown(0)}}else{var oDivWellFrom=$("divWellFrom");if(oDivWellFrom){oChkFrom.set_IsChecked(oDivWellFrom.get_IsShown())}else{oChkFrom.set_IsShown(0);oLblFrom.set_IsShown(0)}}g_oDlgMOpt.show()}function setSelectValue(sId,sValue){var oSelect=getDialogElement(sId);oSelect.set_Value(sValue)}function getSelectValue(sId){var oSelect=getDialogElement(sId);return oSelect.get_Value()}function getDialogElement(sId){var oDialogElement=null;var oDivDialog=$(g_oDlgMOpt.sId);if(sId){oDialogElement=oDivDialog.getDescendantById(sId)}else{oDialogElement=oDivDialog}return oDialogElement}function onClsMOpt(i){if(i==0){setImp(parseInt(getSelectValue("selImp"),10));a_iSens=parseInt(getSelectValue("selSens"),10);a_fDvRcp=getDialogElement("chkDvRcp").get_IsChecked()?1:0;a_fRdRcp=getDialogElement("chkRdRcp").get_IsChecked()?1:0;shwBcc(getDialogElement("chkBcc").get_IsChecked());shwFrom(getDialogElement("chkFrom").get_IsChecked());if(g_oMmBdy){Owa.Components.ToolbarCollection.get_Current().set_IsButtonPushed("msgencypt",getDialogElement("chkEnCntnt").get_IsChecked());Owa.Components.ToolbarCollection.get_Current().set_IsButtonPushed("msgsgnd",getDialogElement("chkAddSig").get_IsChecked())}}}function shwFrom(f){var oDivWellFrom=$("divWellFrom");if(oDivWellFrom){var oDivFrom=$(FROM);oDivWellFrom.set_IsShown(f);oDivFrom.set_IsDisabled(f?false:true);if(f){rszRw(oDivFrom)}safeResizeBodies();safeResizeWells()}}if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\components/MailTipsUi.js".toLowerCase()])(function(){Type.createNamespace("Owa.Components");var FULL_TIP="divFullTip";var RESTRICTED_TIP="divRestrictedTip";var EXTERNAL_TIP="divExternalTip";var LARGE_AUDIENCE_TIP="divLargeAudienceTip";var MODERATED_TIP="divModeratedTip";var AUTO_REPLY_TIP="divAutoReplyTip";var CUSTOM_TIP="divCustomTip";var BCC_TIP="divBccTip";var FUNCTION_PARAMETER="fnFunction";var SPAN_TIP_CONTROL="spnTipControl";var SPAN_TIP_EXPAND_CONTROL="spnTipExpandControl";var SPAN_TIP_CONTROL_SEPARATOR="spnTipControlSeparator";var SPAN_TIP_REMOVE_CONTROL="spnTipRemoveControl";var SPAN_TIP_EXPAND_TEXT="spnTipExpandText";var IMG_TIP_EXPAND="imgTipExpand";var DIV_TIP_EXPANSION="divTipExpansion";var SPAN_TIP_EXPANSION_ITEM="spnTipExpansionItem";var DIV_TIP_EXPANSION_ITEM="divTipExpansionItem";var IMG_TIP_EXPANSION_ITEM_REMOVE="imgTipExpansionItemRemove";var SPAN_TIP_CONTENT="spnTipContent";var DIV_TIP="oDivTip";var DIV_TIP_SUMMARY_LINE="divTipSummaryLine";var SPAN_TIP_COUNT="spnTipCount";var SPAN_TIP_INDIVIDUAL_COUNT="spnTipIndividualCount";var SPAN_CUSTOM_TIP_CONTENT="spnCustomTipContent";var SPAN_TIP_DISPLAY_NAME="spnTipDisplayName";var SPAN_TIP_INDIVIDUAL="spnTipIndividual";var SPAN_AUTO_REPLY_MESSAGE="spnAutoReplyTipMessage";var SPAN_AUTO_REPLY_DATE="spnAutoReplyTipDate";var SPAN_TIP_EXPANSION_SEPARATOR="spnTipExpansionSeparator";var SPAN_TIP_MAIL="spnTipMail";var URL_ATTRIBUTE="sUrl";var ADDRESS_ATTRIBUTE="sAddress";var CUSTOM_LINK_ID="aCustomLink";var TIP_TYPE_MAP={};TIP_TYPE_MAP[FULL_TIP]=6;TIP_TYPE_MAP[RESTRICTED_TIP]=6;TIP_TYPE_MAP[BCC_TIP]=6;TIP_TYPE_MAP[EXTERNAL_TIP]=4;TIP_TYPE_MAP[LARGE_AUDIENCE_TIP]=3;TIP_TYPE_MAP[MODERATED_TIP]=2;TIP_TYPE_MAP[AUTO_REPLY_TIP]=1;TIP_TYPE_MAP[CUSTOM_TIP]=0;var RECIPIENT_TIP_DIV_IDS=[FULL_TIP,RESTRICTED_TIP,EXTERNAL_TIP,LARGE_AUDIENCE_TIP,MODERATED_TIP,AUTO_REPLY_TIP,CUSTOM_TIP];var TIP_DIV_IDS_WITH_STATE_MAP={};TIP_DIV_IDS_WITH_STATE_MAP[FULL_TIP]=1;TIP_DIV_IDS_WITH_STATE_MAP[RESTRICTED_TIP]=1;TIP_DIV_IDS_WITH_STATE_MAP[EXTERNAL_TIP]=1;TIP_DIV_IDS_WITH_STATE_MAP[MODERATED_TIP]=1;TIP_DIV_IDS_WITH_STATE_MAP[AUTO_REPLY_TIP]=1;var SINGLE_STATE=1;var MULTIPLE_STATE=2;var COMPRESSION_STATE=3;var EXTERNAL_TIP_TEMPLATES=[L_MailTipsExternalSingle,L_MailTipsExternalMultiple,L_MailTipsExternalCompression];var AUTO_REPLY_TIP_TEMPLATES=[L_MailTipsAutoReplySingle,L_MailTipsAutoReplyMultiple,L_MailTipsAutoReplyCompression];var MODERATED_TIP_TEMPLATES=[L_MailTipsModeratedSingle,L_MailTipsModeratedMultiple,L_MailTipsModeratedCompression];var FULL_TIP_TEMPLATES=[L_MailTipsFullSingle,L_MailTipsFullMultiple,L_MailTipsFullCompression];var RESTRICTED_TIP_TEMPLATES=[L_MailTipsRestrictedSingle,L_MailTipsRestrictedMultiple,L_MailTipsRestrictedCompression];var SUMMARY_MAX_CHARS=200;var CANARY="";var _oInstance=null;var _rxNewlineNodeSeeker=new RegExp("(<\/div>|<\/p>)","gi");var _rxNewlineSeeker=new RegExp("\\n","g");Owa.Components.MailTipsUi=function Owa$Components$MailTipsUi(oMailTipsRequester){Owa.Components.MailTipsUi.constructBase(this);this.oDoc=Owa.Dom.Document.get_Current();this.oInfobar=new Owa.UIControls.Infobar($("divInfobar"));this.oRequester=oMailTipsRequester;this.fIsUpdating=0;this.oPendingEvents=0;this.oRecipientsMap=0;this.oTipsMap=0;this.oTipsStatistics=0;this.fDoesSupportRecipientTips=1;var oConfig=this.oRequester.getConfig();this.fHideByDefault=(oConfig)?oConfig.fHideByDefault:0;this.oInfobar.setHideByDefaultValue(this.fHideByDefault);CANARY=rtrvUCCk()};var _oPrototype=Owa.Components.MailTipsUi.prototype;Owa.Components.MailTipsUi.get_Instance=function Owa$Components$MailTipsUi$get_Instance(oMailTipsRequester){if(!_oInstance){_oInstance=new Owa.Components.MailTipsUi(oMailTipsRequester)}return _oInstance};_oPrototype.dispose=function Owa$Components$MailTipsUi$dispose(){this.oDoc=0;this.oInfobar=0;this.oRequester=0;this.oPendingEvents=0;this.oRecipientsMap=0;this.oTipsMap=0;this.oTipsStatistics=0;this.fDoesSupportRecipientTips=0};_oPrototype.getRecipientsMap=function Owa$Components$MailTipsUi$getRecipientsMap(){return this.oRecipientsMap};_oPrototype.setLoadingStatus=function Owa$Components$MailTipsUi$setLoadingStatus(fLoading){this.oInfobar.setLoadingStatus(fLoading)};_oPrototype.getHideByDefaultValue=function Owa$Components$MailTipsUi$getHideByDefaultValue(){return this.fHideByDefault};_oPrototype.setHideByDefaultValue=function Owa$Components$MailTipsUi$setHideByDefaultValue(fHideByDefault){this.fHideByDefault=fHideByDefault;this.oInfobar.setHideByDefaultValue(fHideByDefault)};_oPrototype.updateUi=function Owa$Components$MailTipsUi$updateUi(oUiUpdateMap){if(this.oInfobar.exists()){this.guardConcurrentUpdate(oUiUpdateMap.oTime,this.updateUi,oUiUpdateMap);var fIsLoading=0;if(isDf(typeof(a_fIsReplyAllBcc))&&a_fIsReplyAllBcc){fIsLoading=1;var oBccMessage=this.oInfobar.buildMessage(L_MailTipsReplyAllOnBcc,BCC_TIP,TIP_TYPE_MAP[BCC_TIP]);this.oInfobar.replaceOrInsertMessage(oBccMessage)}else{var oBccMessage=this.oInfobar.getMessageById(BCC_TIP);if(oBccMessage){fIsLoading=1;this.oInfobar.removeMessage(oBccMessage)}}var oUiRequestTime=oUiUpdateMap.oTime;delete oUiUpdateMap.oTime;var oSendingAs=oUiUpdateMap.oSendingAs;delete oUiUpdateMap.oSendingAs;var fIsFirst=1;var fUpdated=0;var rgResolvedRecipientSpans=null;for(var sRecipientAddress in oUiUpdateMap){var oRecipientToUpdate=oUiUpdateMap[sRecipientAddress];if(!this._NeedsUiUpdate(oRecipientToUpdate,sRecipientAddress)){continue}if(!fIsLoading){fIsLoading=1}this.updateRecipientTips(sRecipientAddress,oRecipientToUpdate,oSendingAs);if(fIsFirst){rgResolvedRecipientSpans=Owa.Components.RecipientWellManager.get_Instance().get_AllResolvedRecipientSpans(this.oRequester.getRecipientWellConsumerId());fIsFirst=0}var oRecipient=this.oRecipientsMap[sRecipientAddress];if(oRecipient){oRecipient.oDisplayTime=oUiRequestTime;oRecipient.oCacheEntry=oRecipientToUpdate.oCacheEntry;oRecipient.oRecipient=oRecipientToUpdate.oRecipient;fUpdated=1}}if(rgResolvedRecipientSpans){this.evaluateLargeAudienceTip(rgResolvedRecipientSpans)}var rgInfobarMessages=this.oInfobar.getMessages();if(0<rgInfobarMessages.length){if(rgResolvedRecipientSpans){this.updateTipState(rgInfobarMessages)}if(fUpdated){this.oInfobar.set_IsShown(1)}}if(fIsLoading){this.setLoadingStatus(0);fIsLoading=0}this.processPendingEvents();safeResizeBodies()}};_oPrototype.guardConcurrentUpdate=function Owa$Components$MailTipsUi$guardConcurrentUpdate(oTime,fnFunction,oParameter){if(this.fIsUpdating){if(!this.oPendingEvents){this.oPendingEvents={}}this.oPendingEvents[oTime]={FUNCTION_PARAMETER:fnFunction};this.oPendingEvents[oTime].oParameter=oParameter}else{this.fIsUpdating=1}};_oPrototype.processPendingEvents=function Owa$Components$MailTipsUi$processPendingEvents(){this.fIsUpdating=0;if(this.oPendingEvents){var fDidProcessPendingEvents=0;for(var oTime in this.oPendingEvents){this.oPendingEvents[oTime].fnFunction(this.oPendingEvents[oTime].oParameter);delete this.oPendingEvents[oTime];fDidProcessPendingEvents=1}if(!fDidProcessPendingEvents){this.oPendingEvents=0}}};_oPrototype.updateRecipientTips=function Owa$Components$MailTipsUi$updateRecipientTips(sRecipientAddress,oRecipientToUpdate,oSendingAs){for(var i=0;i<RECIPIENT_TIP_DIV_IDS.length;i++){var sDivId=RECIPIENT_TIP_DIV_IDS[i];var oDivTip=this.getDivTip(sDivId,sRecipientAddress);var fWasNewCustomTip=0;if(this.hasDataToUpdate(sDivId,oRecipientToUpdate,oSendingAs)){if(!oDivTip){oDivTip=this.createDivTipStructure(sDivId,TIP_TYPE_MAP[sDivId]);this.ensureTipsStatisticsExists(sDivId);if(CUSTOM_TIP==sDivId){fWasNewCustomTip=1}else{this.oInfobar.insertMessage(oDivTip)}}this.ensureTipsMapExists(sDivId,sRecipientAddress);this.ensureRecipientsMapExists(sRecipientAddress);this.updateRecipientTip(sDivId,oDivTip,sRecipientAddress,oRecipientToUpdate);if(fWasNewCustomTip){this.oInfobar.insertMessage(oDivTip)}}else if(oDivTip){this.removeTipByRecipient(sDivId,sRecipientAddress,oDivTip)}}};_oPrototype.shouldAutoExpand=function Owa$Components$MailTipsUi$shouldAutoExpand(sDivId,oDivTip,iInfobarMessageCount,iState){if((3<iInfobarMessageCount)||iState&&(SINGLE_STATE==iState)){return false}var oDivTipExpansion=oDivTip.getChildById(DIV_TIP_EXPANSION);switch(sDivId){case LARGE_AUDIENCE_TIP:case AUTO_REPLY_TIP:var rgDivTipExpansionItem=oDivTipExpansion.getChildrenSnapshot();if((1==iInfobarMessageCount)&&(4>rgDivTipExpansionItem.length)){return true}if((2==iInfobarMessageCount)&&(3>rgDivTipExpansionItem.length)){return true}return false;default:var oDivTipExpansionItem=oDivTipExpansion.getChildById(DIV_TIP_EXPANSION_ITEM);var rgSpanItemAndSeparator=oDivTipExpansionItem.getChildrenSnapshot();if((1==iInfobarMessageCount)&&(20>rgSpanItemAndSeparator.length)){return true}if((2==iInfobarMessageCount)&&(10>rgSpanItemAndSeparator.length)){return true}return false}};_oPrototype.updateTipState=function Owa$Components$MailTipsUi$updateTipState(rgInfobarMessages){var fHasAutoExpanded=0;for(var sDivId in TIP_DIV_IDS_WITH_STATE_MAP){var oDivTip=this.getDivTip(sDivId);if(oDivTip){var iRecipientsCount=this.oTipsStatistics[sDivId].iRecipientsCount;var iState=this.getState(sDivId,iRecipientsCount);var sDivTipContentMarkup=this.getDivTipContentMarkup(sDivId,iRecipientsCount,iState);this.updateDivTipContent(sDivId,oDivTip,sDivTipContentMarkup);var oSpanTipControl=oDivTip.getDescendantById(SPAN_TIP_CONTROL);var oSpanTipExpandControl=oSpanTipControl.getChildById(SPAN_TIP_EXPAND_CONTROL);var oSpanTipControlSeparator=oSpanTipControl.getChildById(SPAN_TIP_CONTROL_SEPARATOR);var oSpanTipRemoveControl=oSpanTipControl.getChildById(SPAN_TIP_REMOVE_CONTROL);if(SINGLE_STATE==iState){this.setControlShown(oSpanTipExpandControl,0);this.setControlShown(oSpanTipControlSeparator,0);this.updateControlText(oSpanTipRemoveControl,L_MailTipsRemoveRecipient);this.setExpansionState(oDivTip,0,oSpanTipExpandControl)}else{this.updateControlText(oSpanTipRemoveControl,L_MailTipsRemoveAll);if(MULTIPLE_STATE==iState&&AUTO_REPLY_TIP!=sDivId){this.setControlShown(oSpanTipExpandControl,0);this.setControlShown(oSpanTipControlSeparator,0);this.setExpansionState(oDivTip,0,oSpanTipExpandControl)}else{this.setControlShown(oSpanTipExpandControl,1);this.setControlShown(oSpanTipControlSeparator,1);if(!fHasAutoExpanded&&this.shouldAutoExpand(sDivId,oDivTip,rgInfobarMessages.length,iState)){this.setExpansionState(oDivTip,1,oSpanTipExpandControl);fHasAutoExpanded=1}}}}}};_oPrototype.getDivTipContentMarkup=function Owa$Components$MailTipsUi$getDivTipContentMarkup(sDivId,iRecipientsCount,iState){var sTemplate=this.getTemplateByState(sDivId,iState);var sDivTipContentMarkup;if(COMPRESSION_STATE==iState){var iCount=(EXTERNAL_TIP==sDivId)?this.oTipsStatistics[sDivId].iExternalSize:iRecipientsCount;sDivTipContentMarkup=this.createTipMarkup(sTemplate,[this.createSpanTipCountMarkup(SPAN_TIP_COUNT,iCount)])}else{if(MULTIPLE_STATE==iState){var rgSpanTipDisplayNames=[iState];var i=0;for(var sRecipientAddress in this.oTipsMap[sDivId]){var sDisplayName=this.oRecipientsMap[sRecipientAddress].oRecipient._dn;rgSpanTipDisplayNames[i++]=this.createSpanMarkup(SPAN_TIP_DISPLAY_NAME,sDisplayName)}sDivTipContentMarkup=this.createTipMarkup(sTemplate,rgSpanTipDisplayNames)}else{for(var sRecipientAddress in this.oTipsMap[sDivId]){var sDisplayName=this.oRecipientsMap[sRecipientAddress].oRecipient._dn;var sSpanTipDisplayName=this.createSpanMarkup(SPAN_TIP_DISPLAY_NAME,sDisplayName);if(AUTO_REPLY_TIP==sDivId){sDivTipContentMarkup=this.createAutoReplySingleTipMarkup(L_MailTipsAutoReplySingle,L_MailTipsAutoReplySingleWithDate,sSpanTipDisplayName,this.oRecipientsMap[sRecipientAddress].oCacheEntry)}else{sDivTipContentMarkup=this.createTipMarkup(sTemplate,[sSpanTipDisplayName])}break}}}return sDivTipContentMarkup};_oPrototype.getState=function Owa$Components$MailTipsUi$getState(sDivId,iRecipientsCount){if(EXTERNAL_TIP==sDivId){var oTipStats=this.oTipsStatistics[sDivId];if((1==iRecipientsCount)&&(1==oTipStats.iExternalSize)&&(!oTipStats.iDlCount)){return SINGLE_STATE}else if((2==iRecipientsCount)&&(2==oTipStats.iExternalSize)&&(!oTipStats.iDlCount)){return MULTIPLE_STATE}else{return COMPRESSION_STATE}}else if(AUTO_REPLY_TIP==sDivId){if(1==iRecipientsCount){return SINGLE_STATE}else{return COMPRESSION_STATE}}else if(3>iRecipientsCount){return iRecipientsCount}else{return COMPRESSION_STATE}};_oPrototype.getTemplateByState=function Owa$Components$MailTipsUi$getTemplateByState(sDivId,iState){switch(sDivId){case EXTERNAL_TIP:if((COMPRESSION_STATE==iState)&&1==this.oTipsStatistics[sDivId].iExternalSize){return L_MailTipsExternalCompressionSingular}return EXTERNAL_TIP_TEMPLATES[iState-1];case AUTO_REPLY_TIP:return AUTO_REPLY_TIP_TEMPLATES[iState-1];case MODERATED_TIP:return MODERATED_TIP_TEMPLATES[iState-1];case FULL_TIP:return FULL_TIP_TEMPLATES[iState-1];case RESTRICTED_TIP:return RESTRICTED_TIP_TEMPLATES[iState-1]}};_oPrototype.setControlShown=function Owa$Components$MailTipsUi$setControlShown(oControl,fIsShown){if(fIsShown!=oControl.get_IsShown()){oControl.set_IsShown(fIsShown)}};_oPrototype.updateControlText=function Owa$Components$MailTipsUi$updateControlText(oControl,sControlText){if(sControlText!=oControl.get_TextContent()){oControl.set_TextContent(sControlText)}};_oPrototype.setExpansionState=function Owa$Components$MailTipsUi$setExpansionState(oDivTip,fIsExpanded,oSpanTipExpandControl){if(!oSpanTipExpandControl){oSpanTipExpandControl=oDivTip.getDescendantById(SPAN_TIP_EXPAND_CONTROL)}var oSpanTipExpandText=oSpanTipExpandControl.getChildById(SPAN_TIP_EXPAND_TEXT);var oImgTipExpand=oSpanTipExpandControl.getDescendantById(IMG_TIP_EXPAND);var oDivTipExpansion=oDivTip.getChildById(DIV_TIP_EXPANSION);if(fIsExpanded){this.updateControlText(oSpanTipExpandText,L_MailTipsLess);Owa.Components.CssSprites.updateImage(oImgTipExpand,"up-arrw.gif");this.setControlShown(oDivTipExpansion,1)}else{this.updateControlText(oSpanTipExpandText,L_MailTipsMore);Owa.Components.CssSprites.updateImage(oImgTipExpand,"dwn.gif");this.setControlShown(oDivTipExpansion,0)}safeResizeBodies()};_oPrototype.getDivTip=function Owa$Components$MailTipsUi$getDivTip(sDivId,sRecipientAddress){var oDivTip=0;if(CUSTOM_TIP==sDivId){if(this.oTipsMap[sDivId]&&this.oTipsMap[sDivId][sRecipientAddress]){oDivTip=this.oTipsMap[sDivId][sRecipientAddress].oItem}}else{oDivTip=this.oInfobar.getMessageById(sDivId)}return oDivTip};_oPrototype.hasDataToUpdate=function Owa$Components$MailTipsUi$hasDataToUpdate(sDivId,oRecipientToUpdate,oSendingAs){var fHasDataToUpdate=0;if(oRecipientToUpdate.oRecipient&&oRecipientToUpdate.oCacheEntry&&!oRecipientToUpdate.fDelete&&this.fDoesSupportRecipientTips){var oCacheEntry=oRecipientToUpdate.oCacheEntry;switch(sDivId){case CUSTOM_TIP:fHasDataToUpdate=oCacheEntry.sCustomTip;break;case EXTERNAL_TIP:fHasDataToUpdate=(0<oCacheEntry.iExternalSize);break;case AUTO_REPLY_TIP:fHasDataToUpdate=(oCacheEntry.sAutoReplyEndDate||oCacheEntry.sAutoReplyMessage);break;case MODERATED_TIP:fHasDataToUpdate=oCacheEntry.fModerated;break;case FULL_TIP:fHasDataToUpdate=oCacheEntry.fFull;break;case RESTRICTED_TIP:fHasDataToUpdate=(oCacheEntry.oRestricted&&oCacheEntry.oRestricted[oSendingAs._em]);break;case LARGE_AUDIENCE_TIP:fHasDataToUpdate=(0<oCacheEntry.iSize);break}}return fHasDataToUpdate};_oPrototype.createDivTipStructure=function Owa$Components$MailTipsUi$createDivTipStructure(sDivId,iType){var oDivTip=this.oDoc.createElement("div");oDivTip.set_Id(sDivId);oDivTip.setIntAttribute("iType",iType);oDivTip.addCssClass("infobarMessageItem");if(g_fRtl){oDivTip.addCssClass("rtl")}if((LARGE_AUDIENCE_TIP==sDivId)){oDivTip.set_IsShown(0)}var sMarkup="<div id=\""+DIV_TIP_SUMMARY_LINE+"\">"+"<span id=\""+SPAN_TIP_CONTENT+"\"";if(g_fRtl){sMarkup+=" class=\"rtl\""}sMarkup+="></span></div>";oDivTip.set_InnerHtml(sMarkup);if(CUSTOM_TIP!=sDivId&&BCC_TIP!=sDivId){this.insertControlAndExpansionElements(sDivId,oDivTip)}return oDivTip};_oPrototype.ensureTipsMapExists=function Owa$Components$MailTipsUi$ensureTipsMapExists(sDivId,sRecipientAddress){if(!this.oTipsMap){this.oTipsMap={}}if(!this.oTipsMap[sDivId]){this.oTipsMap[sDivId]={}}if(!this.oTipsMap[sDivId][sRecipientAddress]){this.oTipsMap[sDivId][sRecipientAddress]={}}};_oPrototype.ensureTipsStatisticsExists=function Owa$Components$MailTipsUi$ensureTipsStatisticsExists(sDivId){if(!this.oTipsStatistics){this.oTipsStatistics={}}if(!this.oTipsStatistics[sDivId]){this.oTipsStatistics[sDivId]={}}};_oPrototype.ensureRecipientsMapExists=function Owa$Components$MailTipsUi$ensureRecipientsMapExists(sRecipientAddress){if(!this.oRecipientsMap){this.oRecipientsMap={}}if(!this.oRecipientsMap[sRecipientAddress]){this.oRecipientsMap[sRecipientAddress]={}}};_oPrototype.incrementTipsCountForNewTip=function Owa$Components$MailTipsUi$incrementTipsCountForNewTip(sDivId,sRecipientAddress){if(!this.oTipsMap[sDivId][sRecipientAddress].oItem){if(this.oRecipientsMap[sRecipientAddress].iTipsCount){this.oRecipientsMap[sRecipientAddress].iTipsCount++}else{this.oRecipientsMap[sRecipientAddress].iTipsCount=1}}};_oPrototype.createTipItemMarkup=function Owa$Components$MailTipsUi$createTipItemMarkup(sDivId,sRecipientAddress,oRecipientToUpdate){var oRecipient=oRecipientToUpdate.oRecipient;var sSpanTipDisplayName;if((LARGE_AUDIENCE_TIP==sDivId)&&!this._isDL(oRecipient)){sSpanTipDisplayName=this.createSpanMarkup(SPAN_TIP_INDIVIDUAL,L_MailTipsLargeAudienceIndividual)}else{sSpanTipDisplayName=this.createSpanMarkup(SPAN_TIP_DISPLAY_NAME,oRecipient._dn)}if(CUSTOM_TIP==sDivId){var sCustomMarkup=oRecipientToUpdate.oCacheEntry.sCustomTip;var sCustomTitle=this.getTitleContent(sCustomMarkup);var sCustomTipContent=this.getFormattedContent(sCustomMarkup,1);var sSpanCustomTipContent="<span id=\""+SPAN_CUSTOM_TIP_CONTENT+"\""+" title=\""+sCustomTitle+"\">"+sCustomTipContent+"</span>";return this.createTipMarkup(L_MailTipsCustom,[sSpanTipDisplayName,sSpanCustomTipContent])}else if(AUTO_REPLY_TIP==sDivId){return this.createAutoReplyTipItemMarkup(sSpanTipDisplayName,oRecipientToUpdate.oCacheEntry)}else if(LARGE_AUDIENCE_TIP==sDivId){return this.createLargeAudienceTipItemMarkup(sRecipientAddress,sSpanTipDisplayName,oRecipient,oRecipientToUpdate.oCacheEntry)}else{return sSpanTipDisplayName}};_oPrototype.createSpanMarkup=function Owa$Components$MailTipsUi$createSpanMarkup(sSpanId,sSpanInnerHtml){return"<span id=\""+sSpanId+"\">"+htmlEnc(sSpanInnerHtml)+"</span>"};_oPrototype.createSpanTipCountMarkup=function Owa$Components$MailTipsUi$createSpanTipCountMarkup(sSpanId,iCount){return g_sDE+"<span id=\""+sSpanId+"\">"+iCount+"</span>"+g_sDE};_oPrototype.updateRecipientTip=function Owa$Components$MailTipsUi$updateRecipientTip(sDivId,oDivTip,sRecipientAddress,oRecipientToUpdate){var sTipItemMarkup=this.createTipItemMarkup(sDivId,sRecipientAddress,oRecipientToUpdate);this.incrementTipsCountForNewTip(sDivId,sRecipientAddress);if(CUSTOM_TIP==sDivId){this.updateDivTipContent(sDivId,oDivTip,sTipItemMarkup);this.oTipsMap[sDivId][sRecipientAddress].oItem=oDivTip}else{this.updateRecipientsCount(sDivId,sRecipientAddress,oRecipientToUpdate);this.updateExpansionItem(sDivId,oDivTip,sTipItemMarkup,sRecipientAddress,oRecipientToUpdate.oRecipient)}};_oPrototype.removeTipByRecipient=function Owa$Components$MailTipsUi$removeTipByRecipient(sDivId,sRecipientAddress,oDivTip){var oRecipient=this.oTipsMap[sDivId][sRecipientAddress];var oTipStats=this.oTipsStatistics[sDivId];if(oRecipient){if(CUSTOM_TIP==sDivId){this.oInfobar.removeMessage(oDivTip)}else{if(1==oTipStats.iRecipientsCount){this.oInfobar.removeMessage(oDivTip);delete this.oTipsStatistics[sDivId]}else{oTipStats.iRecipientsCount--;this.removeExpansionItem(sDivId,sRecipientAddress,oRecipient.oItem);if((EXTERNAL_TIP==sDivId)&&oTipStats.iExternalSize&&oRecipient.iExternalSize){oTipStats.iExternalSize-=oRecipient.iExternalSize;if(oRecipient.fIsDl){oTipStats.iDlCount--}}else if((LARGE_AUDIENCE_TIP==sDivId)&&oTipStats.iSize&&oRecipient.iSize){oTipStats.iSize-=oRecipient.iSize;if(oRecipient.iIndividualSize){oTipStats.iIndividualSize-=oRecipient.iIndividualSize}}}}delete this.oTipsMap[sDivId][sRecipientAddress];if(1==this.oRecipientsMap[sRecipientAddress].iTipsCount){delete this.oRecipientsMap[sRecipientAddress]}else{this.oRecipientsMap[sRecipientAddress].iTipsCount--}}};_oPrototype.removeAllRecipientTips=function Owa$Components$MailTipsUi$removeAllRecipientTips(){var oUiUpdateMap=this.oRequester.createUiUpdateMap(new Date());for(var sRecipientAddress in this.oRecipientsMap){oUiUpdateMap[sRecipientAddress]={};oUiUpdateMap[sRecipientAddress].oCacheEntry=this.oRecipientsMap[sRecipientAddress].oCacheEntry;oUiUpdateMap[sRecipientAddress].oRecipient=this.oRecipientsMap[sRecipientAddress].oRecipient;oUiUpdateMap[sRecipientAddress].fDelete=1}this.updateUi(oUiUpdateMap)};_oPrototype.setRecipientTipsSupport=function Owa$Components$MailTipsUi$setRecipientTipsSupport(fDoesSupportRecipientTips){if(this.fDoesSupportRecipientTips!=fDoesSupportRecipientTips){this.fDoesSupportRecipientTips=fDoesSupportRecipientTips;if(!fDoesSupportRecipientTips){this.removeAllRecipientTips()}}};_oPrototype.evaluateLargeAudienceTip=function Owa$Components$MailTipsUi$evaluateLargeAudienceTip(rgResolvedRecipientSpans){var oDivTip=this.getDivTip(LARGE_AUDIENCE_TIP);var oConfig=this.oRequester.getConfig();var oTipStats=this.oTipsStatistics[LARGE_AUDIENCE_TIP];if(oTipStats&&(oTipStats.iSize>oConfig.iLargeAudienceThreshold)){var sSpanTipCount=this.createSpanTipCountMarkup(SPAN_TIP_COUNT,oTipStats.iSize);var sTipContentMarkup=this.createTipMarkup(L_MailTipsLargeAudience,[sSpanTipCount]);this.updateDivTipContent(LARGE_AUDIENCE_TIP,oDivTip,sTipContentMarkup);var iInfobarMessageCount=this.oInfobar.getMessages().length;if(!oDivTip.get_IsShown()){iInfobarMessageCount++;oDivTip.set_IsShown(1)}if(this.shouldAutoExpand(LARGE_AUDIENCE_TIP,oDivTip,iInfobarMessageCount)){var oSpanTipExpandControl=oDivTip.getDescendantById(SPAN_TIP_EXPAND_CONTROL);this.setExpansionState(oDivTip,1,oSpanTipExpandControl)}}else if(oDivTip){this.oInfobar.hideMessage(oDivTip)}};_oPrototype.createAutoReplyTipItemMarkup=function Owa$Components$MailTipsUi$createAutoReplyTipItemMarkup(sSpanTipDisplayName,oCacheEntry){return this.createAutoReplySingleTipMarkup(L_MailTipsAutoReplyExpansion,L_MailTipsAutoReplyExpansionWithDate,sSpanTipDisplayName,oCacheEntry)};_oPrototype.createAutoReplySingleTipMarkup=function Owa$Components$MailTipsUi$createAutoReplyTipMarkup(sTemplateWithoutDate,sTemplateWithDate,sSpanTipDisplayName,oCacheEntry){var sAutoReplyMarkupWithNewlinePrepended=oCacheEntry.sAutoReplyMessage.replace(_rxNewlineNodeSeeker,"<BR>$1");var sAutoReplyMarkup=htmlDec(sAutoReplyMarkupWithNewlinePrepended);var sAutoReplyTitle=this.getTitleContent(sAutoReplyMarkup);var sAutoReplyMessage=this.getFormattedContent(sAutoReplyMarkup,1);var sSpanAutoReplyTipMessage="<span id=\""+SPAN_AUTO_REPLY_MESSAGE+"\""+" title=\""+sAutoReplyTitle+"\"";if(g_fRtl){sSpanAutoReplyTipMessage+=" class=\"rtl\""}sSpanAutoReplyTipMessage+=">"+sAutoReplyMessage+"</span>";var sAutoReplyEndDate=oCacheEntry.sAutoReplyEndDate;if(sAutoReplyEndDate){var sSpanAutoReplyTipDate="<span id=\""+SPAN_AUTO_REPLY_DATE+"\">"+htmlEnc(sAutoReplyEndDate)+"</span>";return this.createTipMarkup(sTemplateWithDate,[sSpanTipDisplayName,sSpanAutoReplyTipDate,sSpanAutoReplyTipMessage])}else{return this.createTipMarkup(sTemplateWithoutDate,[sSpanTipDisplayName,sSpanAutoReplyTipMessage])}};_oPrototype.createLargeAudienceTipItemMarkup=function Owa$Components$MailTipsUi$createLargeAudienceTipItemMarkup(sRecipientAddress,sSpanTipDisplayName,oRecipient,oCacheEntry){var sSpanTipCount;if(this._isDL(oRecipient)){sSpanTipCount=this.createSpanTipCountMarkup(SPAN_TIP_COUNT,oCacheEntry.iSize)}else{var oRecipientInMap=this.oTipsMap[LARGE_AUDIENCE_TIP][sRecipientAddress];var oTipStats=this.oTipsStatistics[LARGE_AUDIENCE_TIP];if(oRecipientInMap.iSize){sSpanTipCount=this.createSpanTipCountMarkup(SPAN_TIP_INDIVIDUAL_COUNT,oTipStats.iIndividualSize)}else{if(oTipStats.iIndividualSize){sSpanTipCount=this.createSpanTipCountMarkup(SPAN_TIP_INDIVIDUAL_COUNT,(oTipStats.iIndividualSize+oCacheEntry.iSize))}else{sSpanTipCount=this.createSpanTipCountMarkup(SPAN_TIP_INDIVIDUAL_COUNT,oCacheEntry.iSize)}}}return this.createTipMarkup(L_MailTipsLargeAudienceExpansion,[sSpanTipDisplayName,sSpanTipCount])};_oPrototype.insertControlAndExpansionElements=function Owa$Components$MailTipsUi$insertControlAndExpansionElements(sDivId,oDivTip){var oDivTipSummaryLine=oDivTip.getChildById(DIV_TIP_SUMMARY_LINE);var oSpanTipControl=this.oDoc.createElement("span");oSpanTipControl.set_Id(SPAN_TIP_CONTROL);oDivTipSummaryLine.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oSpanTipControl);var oSpanTipExpandControl=this.oDoc.createElement("span");oSpanTipExpandControl.set_Id(SPAN_TIP_EXPAND_CONTROL);if(LARGE_AUDIENCE_TIP!=sDivId){oSpanTipExpandControl.set_IsShown(0)}oSpanTipControl.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oSpanTipExpandControl);oSpanTipExpandControl.attachEvent("click",this._createCallback(this._onClickToggleExpansion,oSpanTipExpandControl));var sSpanTipExpandControl="<span id=\""+SPAN_TIP_EXPAND_TEXT+"\"";if(g_fRtl){sSpanTipExpandControl+=" class=\"rtl\""}sSpanTipExpandControl+=">"+htmlEnc(L_MailTipsMore)+"</span>";var sImgTipExpandAttributes="id=\""+IMG_TIP_EXPAND+"\"";if(g_fRtl){sImgTipExpandAttributes+=" class=\"rtl\""}sSpanTipExpandControl+=Owa.Components.CssSprites.getImageMarkup("dwn.gif",sImgTipExpandAttributes);oSpanTipExpandControl.set_InnerHtml(sSpanTipExpandControl);var oSpanTipControlSeparator=this.oDoc.createElement("span");oSpanTipControlSeparator.set_Id(SPAN_TIP_CONTROL_SEPARATOR);if(g_fRtl){oSpanTipControlSeparator.addCssClass("rtl")}if(LARGE_AUDIENCE_TIP!=sDivId){oSpanTipControlSeparator.set_TextContent(L_MailTipsControlSeparator);oSpanTipControlSeparator.set_IsShown(0);oSpanTipControl.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oSpanTipControlSeparator);var oSpanTipRemoveControl=this.oDoc.createElement("span");oSpanTipRemoveControl.set_Id(SPAN_TIP_REMOVE_CONTROL);oSpanTipRemoveControl.set_TextContent(L_MailTipsRemoveRecipient);oSpanTipControl.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oSpanTipRemoveControl);oSpanTipRemoveControl.attachEvent("click",this._createCallback(this._onClickRemoveTip,oSpanTipRemoveControl));oSpanTipRemoveControl.setAttribute("sDivId",sDivId)}var oDivTipExpansion=this.oDoc.createElement("div");oDivTipExpansion.set_Id(DIV_TIP_EXPANSION);if(g_fRtl){oDivTipExpansion.addCssClass("rtl")}oDivTipExpansion.set_IsShown(0);oDivTip.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oDivTipExpansion);oSpanTipExpandControl.setExpando(DIV_TIP,oDivTip)};_oPrototype.updateDivTipContent=function Owa$Components$MailTipsUi$updateDivTipContent(sDivId,oDivTip,sTipContentMarkup){var oSpanTipContent=oDivTip.getDescendantById(SPAN_TIP_CONTENT);if(sTipContentMarkup!=oSpanTipContent.get_InnerHtml()){oSpanTipContent.set_InnerHtml(sTipContentMarkup);if(AUTO_REPLY_TIP==sDivId||CUSTOM_TIP==sDivId){this.addTipLinkHandlers(oSpanTipContent)}}};_oPrototype.updateRecipientsCount=function Owa$Components$MailTipsUi$updateRecipientsCount(sDivId,sRecipientAddress,oRecipientToUpdate){var oRecipientInMap=this.oTipsMap[sDivId][sRecipientAddress];var oTipStats=this.oTipsStatistics[sDivId];if(!oRecipientInMap.oItem){if(oTipStats.iRecipientsCount){oTipStats.iRecipientsCount++}else{oTipStats.iRecipientsCount=1}var oCacheEntry=oRecipientToUpdate.oCacheEntry;var oRecipient=oRecipientToUpdate.oRecipient;if(EXTERNAL_TIP==sDivId){this.updateSizeDifference(oRecipientInMap,oCacheEntry,oTipStats,"iExternalSize");if(this._isDL(oRecipient)){if(oTipStats.iDlCount){oTipStats.iDlCount++}else{oTipStats.iDlCount=1}oRecipientInMap.fIsDl=1}}else if(LARGE_AUDIENCE_TIP==sDivId){this.updateSizeDifference(oRecipientInMap,oCacheEntry,oTipStats,"iSize");if(!this._isDL(oRecipient)){if(oTipStats.iIndividualSize){oTipStats.iIndividualSize+=oCacheEntry.iSize}else{oTipStats.iIndividualSize=oCacheEntry.iSize}oRecipientInMap.iIndividualSize=oCacheEntry.iSize}}}};_oPrototype.updateSizeDifference=function Owa$Components$MailTipsUi$updateSizeDifference(oRecipient,oCacheEntry,oTipStats,sSizeName){var iSizeDifference=(oRecipient[sSizeName])?oCacheEntry[sSizeName]-oRecipient[sSizeName]:oCacheEntry[sSizeName];if(0!=iSizeDifference){oRecipient[sSizeName]=oCacheEntry[sSizeName];if(oTipStats[sSizeName]){oTipStats[sSizeName]+=iSizeDifference}else{oTipStats[sSizeName]=iSizeDifference}}};_oPrototype.updateExpansionItem=function Owa$Components$MailTipsUi$updateExpansionItem(sDivId,oDivTip,sExpansionItemMarkup,sRecipientAddress,oRecipient){var oDivTipExpansion=oDivTip.getDescendantById(DIV_TIP_EXPANSION);var oExpansionItem=this.oTipsMap[sDivId][sRecipientAddress].oItem;if(oExpansionItem){var oSpanTipExpansionItem;switch(sDivId){case AUTO_REPLY_TIP:case LARGE_AUDIENCE_TIP:oSpanTipExpansionItem=oExpansionItem.getDescendantById(SPAN_TIP_EXPANSION_ITEM);break;default:oSpanTipExpansionItem=oExpansionItem;break}if(sExpansionItemMarkup!=oSpanTipExpansionItem.get_InnerHtml()){oSpanTipExpansionItem.set_InnerHtml(sExpansionItemMarkup);if(AUTO_REPLY_TIP==sDivId){this.addTipLinkHandlers(oSpanTipExpansionItem)}}}else{this.insertExpansionItem(sDivId,oDivTipExpansion,sExpansionItemMarkup,sRecipientAddress,oRecipient)}};_oPrototype.insertExpansionItem=function Owa$Components$MailTipsUi$insertExpansionItem(sDivId,oDivTipExpansion,sExpansionItemMarkup,sRecipientAddress,oRecipient){var oExpansionItem=oDivTipExpansion.get_LastChild();if((null==oExpansionItem)||(AUTO_REPLY_TIP==sDivId)||(LARGE_AUDIENCE_TIP==sDivId)&&this.isLargeAudienceItemMissing(oDivTipExpansion,oRecipient)){oExpansionItem=this.oDoc.createElement("div");oExpansionItem.set_Id(DIV_TIP_EXPANSION_ITEM);if(g_fRtl){oExpansionItem.addCssClass("rtl")}if(AUTO_REPLY_TIP==sDivId){this.insertDivExpansionItem(oDivTipExpansion,oExpansionItem,oRecipient._dn,this.compareAutoReplyItem)}else if((LARGE_AUDIENCE_TIP==sDivId)&&this._isDL(oRecipient)){this.insertDivExpansionItem(oDivTipExpansion,oExpansionItem,this.oTipsMap[sDivId][sRecipientAddress].iSize,this.compareLargeAudienceItem)}else{oDivTipExpansion.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oExpansionItem)}}var oSpanTipExpansionItem=this.oDoc.createElement("span");oSpanTipExpansionItem.set_Id(SPAN_TIP_EXPANSION_ITEM);oSpanTipExpansionItem.set_InnerHtml(sExpansionItemMarkup);var sExpansionItemInnerHtml=oExpansionItem.get_InnerHtml();if(sExpansionItemInnerHtml){if(LARGE_AUDIENCE_TIP==sDivId){var sNewExpansionItemInnerHtml=oSpanTipExpansionItem.get_OuterHtml();if(sExpansionItemInnerHtml!=sNewExpansionItemInnerHtml){oExpansionItem.set_InnerHtml(sNewExpansionItemInnerHtml)}}else{this.insertSpanExpansionItem(oExpansionItem,oSpanTipExpansionItem,oRecipient._dn)}}else{oExpansionItem.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oSpanTipExpansionItem)}if(AUTO_REPLY_TIP==sDivId){this.addTipLinkHandlers(oExpansionItem)}if((AUTO_REPLY_TIP==sDivId)||(LARGE_AUDIENCE_TIP==sDivId)&&this._isDL(oRecipient)){var oImgTipExpansionItemRemove=Owa.Components.CssSprites.getImageElement("delete_small.gif",this.oDoc);oImgTipExpansionItemRemove.set_Id(IMG_TIP_EXPANSION_ITEM_REMOVE);if(g_fRtl){oImgTipExpansionItemRemove.addCssClass("rtl")}oExpansionItem.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oImgTipExpansionItemRemove);oImgTipExpansionItemRemove.attachEvent("click",this._createCallback(this._onClickRemoveRecipient,oImgTipExpansionItemRemove));oImgTipExpansionItemRemove.setAttribute("sRecipientAddress",sRecipientAddress);this.oTipsMap[sDivId][sRecipientAddress].oItem=oExpansionItem}else if(LARGE_AUDIENCE_TIP==sDivId){this.oTipsMap[sDivId][sRecipientAddress].oItem=oExpansionItem}else{this.oTipsMap[sDivId][sRecipientAddress].oItem=oSpanTipExpansionItem}};_oPrototype.compareAutoReplyItem=function Owa$Components$MailTipsUi$compareAutoReplyItem(oExpansionItemInBar,sDisplayName){var oSpanDisplayName=oExpansionItemInBar.getDescendantById(SPAN_TIP_DISPLAY_NAME);return sDisplayName<oSpanDisplayName.get_TextContent()};_oPrototype.compareLargeAudienceItem=function Owa$Components$MailTipsUi$compareLargeAudienceItem(oExpansionItemInBar,iSize){var oSpanTipCount=oExpansionItemInBar.getDescendantById(SPAN_TIP_COUNT);if(oSpanTipCount){return iSize>parseInt(oSpanTipCount.get_TextContent())}else{return 1}};_oPrototype.insertDivExpansionItem=function Owa$Components$MailTipsUi$insertDivExpansionItem(oDivTipExpansion,oDivExpansionItem,oKey,fnComparer){var oExpansionItemInBar=oDivTipExpansion.forEachChild(fnComparer,oKey);if(oExpansionItemInBar){oExpansionItemInBar.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeBegin,oDivExpansionItem)}else{oDivTipExpansion.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oDivExpansionItem)}};_oPrototype.insertSpanExpansionItem=function Owa$Components$MailTipsUi$insertSpanExpansionItem(oExpansionItem,oSpanTipExpansionItem,sDisplayName){var fHasChildren=0;var oSpanItemInBar=oExpansionItem.forEachChild(function(oExpansionChildItem){fHasChildren=1;if((SPAN_TIP_EXPANSION_ITEM==oExpansionChildItem.get_Id())&&(sDisplayName<oExpansionChildItem.get_TextContent())){return 1}return 0});if(oSpanItemInBar){oSpanItemInBar.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeBegin,oSpanTipExpansionItem);oSpanItemInBar.insertAdjacentHtml(Owa.ElementInsertionPoint.BeforeBegin,this.createSpanMarkup(SPAN_TIP_EXPANSION_SEPARATOR,L_MailTipsRecipientSeparator+" "))}else{if(fHasChildren){oExpansionItem.insertAdjacentHtml(Owa.ElementInsertionPoint.BeforeEnd,this.createSpanMarkup(SPAN_TIP_EXPANSION_SEPARATOR,L_MailTipsRecipientSeparator+" "))}oExpansionItem.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oSpanTipExpansionItem)}};_oPrototype.removeExpansionItem=function Owa$Components$MailTipsUi$removeExpansionItem(sDivId,sRecipientAddress,oExpansionItem){if(oExpansionItem){if((AUTO_REPLY_TIP!=sDivId)&&(LARGE_AUDIENCE_TIP!=sDivId)){var oSpanTipExpansionSeparator=oExpansionItem.get_PreviousSibling();if(oSpanTipExpansionSeparator){oSpanTipExpansionSeparator.remove(1)}else{oSpanTipExpansionSeparator=oExpansionItem.get_NextSibling();if(oSpanTipExpansionSeparator){oSpanTipExpansionSeparator.remove(1)}}}if(LARGE_AUDIENCE_TIP==sDivId){var iIndividualSize=this.oTipsMap[sDivId][sRecipientAddress].iIndividualSize;if(iIndividualSize){var iNewIndividualSize=this.oTipsStatistics[sDivId].iIndividualSize-iIndividualSize;if(0<iNewIndividualSize){var oSpanInBar=oExpansionItem.getDescendantById(SPAN_TIP_INDIVIDUAL_COUNT);oSpanInBar.set_TextContent(iNewIndividualSize+"");return}}else if(0==iIndividualSize){return}}oExpansionItem.remove(1)}};_oPrototype.getTextContent=function Owa$Components$MailTipsUi$getTextContent(sDivMarkup){var oOuterDiv=this.oDoc.createElement("div");oOuterDiv.set_InnerHtml(sDivMarkup);return oOuterDiv.get_TextContent()};_oPrototype.getTitleContent=function Owa$Components$MailTipsUi$getTitleContent(sDivMarkup){var sDivMarkupWithBR=sDivMarkup.replace(_rxNewlineSeeker," <BR>");var sTextContent=this.getTextContent(sDivMarkupWithBR);var sText=htmlEnc(sTextContent);var newlineConverter=new RegExp("<BR>","gi");return sText.replace(newlineConverter,"\n")};_oPrototype.getFormattedContent=function Owa$Components$MailTipsUi$getFormattedContent(sDivMarkup,fCreateLinks){if(fCreateLinks){var linkSeeker=new RegExp("<a[\\s]+href=\"([^\"]+)\">([^<]+)</a>","gim");sDivMarkup=sDivMarkup.replace(linkSeeker,"\x1E$1\x1E$2\x1E")}var sTitleContent=this.getTitleContent(sDivMarkup);var sText=sTitleContent.replace(_rxNewlineSeeker," ");sText=(SUMMARY_MAX_CHARS<sText.length)?sText.substr(0,SUMMARY_MAX_CHARS):sText;if(fCreateLinks){var mailConverter=new RegExp("@","g");var linkConverter=new RegExp("\\x1E([^\\x1E]+)\\x1E([^\\x1E]+)\\x1E","g");sText=sText.replace(linkConverter,function(sFullMatch,sLink,sLinkText){return"<a id="+CUSTOM_LINK_ID+" href=\"redir.aspx?C="+CANARY+"&URL="+urlEnc(sLink)+"\" title=\""+sLink.replace(mailConverter,"\x1F")+"\" target=\"_blank\">"+sLinkText.replace(mailConverter,"\x1F")+"</a>"});var halfLinkRemover=new RegExp("\\x1E.*","g");sText=sText.replace(halfLinkRemover,"")}var mailCreator=new RegExp("([\\w]+(?:[\\._-][\\w]+)*@[\\w]+(?:[\\.-][\\w]+)+)","g");sText=sText.replace(mailCreator,"<span id=\""+SPAN_TIP_MAIL+"\" title=\"$1\" class=\"tipLink\" "+ADDRESS_ATTRIBUTE+"=\"$1\">$1</span>");if(fCreateLinks){var mailRestorer=new RegExp("\\x1F","g");sText=sText.replace(mailRestorer,"@")}return sText};_oPrototype.createTipMarkup=function Owa$Components$MailTipsUi$createTipMarkup(sTemplate,rgTemplateArguments){var sTipContent=sTemplate;if(rgTemplateArguments){for(var i=0;i<rgTemplateArguments.length;i++){sTipContent=sTipContent.replace("{"+i+"}",rgTemplateArguments[i])}}return sTipContent};_oPrototype._onClickRemoveTip=function Owa$Components$MailTipsUi$_onClickRemoveTip(oCallbackArguments,oSpanTipRemoveControl){var sDivId=oSpanTipRemoveControl.getAttribute("sDivId");if(this.oTipsMap[sDivId]){var oUiUpdateMap=0;for(var sRecipientAddress in this.oTipsMap[sDivId]){this.removeRecipients(sRecipientAddress);if(!oUiUpdateMap){oUiUpdateMap=this.oRequester.createUiUpdateMap(new Date())}oUiUpdateMap[sRecipientAddress]={};oUiUpdateMap[sRecipientAddress].oCacheEntry=this.oRecipientsMap[sRecipientAddress].oCacheEntry;oUiUpdateMap[sRecipientAddress].fDelete=1}this.updateUi(oUiUpdateMap)}};_oPrototype._onClickRemoveRecipient=function Owa$Components$MailTipsUi$_onClickRemoveRecipient(oCallbackArguments,oImgTipExpansionItemRemove){var sRecipientAddress=oImgTipExpansionItemRemove.getAttribute("sRecipientAddress");if(sRecipientAddress&&this.oRecipientsMap[sRecipientAddress]){this.removeRecipients(sRecipientAddress);var oUiUpdateMap=this.oRequester.createUiUpdateMap(new Date());oUiUpdateMap[sRecipientAddress]={};oUiUpdateMap[sRecipientAddress].oCacheEntry=this.oRecipientsMap[sRecipientAddress].oCacheEntry;oUiUpdateMap[sRecipientAddress].fDelete=1;this.updateUi(oUiUpdateMap)}};_oPrototype._onClickToggleExpansion=function Owa$Components$MailTipsUi$_onClickToggleExpansion(oCallbackArguments,oSpanTipExpandControl){this.processToggleExpansion(oSpanTipExpandControl)};_oPrototype.processToggleExpansion=function Owa$Components$MailTipsUi$processToggleExpansion(oSpanTipExpandControl){this.guardConcurrentUpdate(new Date(),this.processToggleExpansion,oSpanTipExpandControl);if(oSpanTipExpandControl){var oDivTip=oSpanTipExpandControl.getExpando(DIV_TIP);if(oDivTip){var oSpanTipExpandText=oSpanTipExpandControl.getChildById(SPAN_TIP_EXPAND_TEXT);if(oSpanTipExpandText){if(L_MailTipsLess==oSpanTipExpandText.get_TextContent()){this.setExpansionState(oDivTip,0,oSpanTipExpandControl)}else{this.setExpansionState(oDivTip,1,oSpanTipExpandControl)}}}}this.processPendingEvents()};_oPrototype.getRecipientAddressFromSpan=function Owa$Components$MailTipsUi$getRecipientAddressFromSpan(oSpan){if(RT_PDL==oSpan.getAttribute("_rt").toUpperCase()){return oSpan.getAttribute("_id").toLowerCase()}else{return oSpan.getAttribute("_em").toLowerCase()}};_oPrototype.removeRecipients=function Owa$Components$MailTipsUi$removeRecipients(sRecipientAddress){var sConsumerId=this.oRequester.getRecipientWellConsumerId();var oSpans=Owa.Components.RecipientWellManager.get_Instance().get_AllResolvedRecipientSpans(sConsumerId);for(var i=0;i<oSpans.length;i++){if(sRecipientAddress==this.getRecipientAddressFromSpan(oSpans[i])){var oWellElement=oSpans[i].get_ParentElement().get_ParentElement();var oRecipientWell=Owa.Components.RecipientWellManager.get_Instance().get_RecipientWell(sConsumerId,oWellElement);oRecipientWell.removeRecipient(oSpans[i])}}};_oPrototype.isLargeAudienceItemMissing=function Owa$Components$MailTipsUi$isLargeAudienceItemMissing(oDivTipExpansion,oRecipient){return this._isDL(oRecipient)||!oDivTipExpansion.getDescendantById(SPAN_TIP_INDIVIDUAL)};_oPrototype.addTipLinkHandlers=function Owa$Components$MailTipsUi$addTipLinkHandlers(oLinkContainer){var rgMailLinks=oLinkContainer.getAllDescendantsById(SPAN_TIP_MAIL);for(var i=0;i<rgMailLinks.length;i++){rgMailLinks[i].attachEvent("click",Owa.Utility.createArgumentContextDelegate(this,this._onClickTipMail,rgMailLinks[i]))}};_oPrototype._onClickTipMail=function Owa$Components$MailTipsUi$_onClickTipMail(oCallbackArguments,oSpanTipMail){var sAddress=oSpanTipMail.getAttribute(ADDRESS_ATTRIBUTE);if(sAddress){opnNwMsg(sAddress)}};_oPrototype._isDL=function Owa$Components$MailTipsUi$_isDL(oRecipient){return(oRecipient._rf&R_DL)};_oPrototype._NeedsUiUpdate=function Owa$Components$MailTipsUi$_NeedsUiUpdate(oRecipientToUpdate,sRecipientAddress){return oRecipientToUpdate.fDelete||!this.oRecipientsMap||!this.oRecipientsMap[sRecipientAddress]||!this.oRecipientsMap[sRecipientAddress].oDisplayTime||!oRecipientToUpdate.oCacheEntry||!oRecipientToUpdate.oCacheEntry.oUpdateTime||this.oRecipientsMap[sRecipientAddress].oDisplayTime<oRecipientToUpdate.oCacheEntry.oUpdateTime};Owa.Components.MailTipsUi.createClass("Owa.Components.MailTipsUi",Owa.Components.Control)})();g_fModuleLoaded[".\\components/MailTipsUi.js".toLowerCase()]=1;var processMailTipsResponse;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\components/MailTipsResponder.js".toLowerCase()])(function(){Type.createNamespace("Owa.Components.MailTipsResponder");var EXPIRY_CONFIG_NAME="iClientCacheEntryExpiryInHours";var NORMAL_EXPIRY_HOURS=2;var MAX_UPDATE_RETRY=6;var _oNamespace=Owa.Components.MailTipsResponder;processMailTipsResponse=_oNamespace.processServerResponse=function Owa$Components$MailTipsResponder$processServerResponse(oMailTipsResult,oMailTipsConfig){if(!g_CC){return}var i=0;do{if(oMailTipsConfig){tryUpdCC(CC_MTCFG,oMailTipsConfig,REF)}tryUpdCC(CC_MTC,oMailTipsResult,REF);if(isDf(typeof(g_CC.oMailTipsCache))&&isDf(typeof(g_CC.oMailTipsConfig))&&g_CC.oMailTipsCache){_oNamespace.pushDataToForms(g_CC.oMailTipsCache,g_CC.oMailTipsConfig)}else{i++}}while((!isDf(typeof(g_CC.oMailTipsCache))||!isDf(typeof(g_CC.oMailTipsConfig)))&&i<MAX_UPDATE_RETRY)};_oNamespace.updateClientCache=function Owa$Components$MailTipsResponder$updateClientCache(oMailTipsResult,oClientCache){var oNow=new Date();var oExpiry=new Date(oNow);if(g_CC&&g_CC.oMailTipsConfig&&g_CC.oMailTipsConfig[EXPIRY_CONFIG_NAME]){oExpiry.setHours(oNow.getHours()+g_CC.oMailTipsConfig[EXPIRY_CONFIG_NAME])}else{oExpiry.setHours(oNow.getHours()+NORMAL_EXPIRY_HOURS)}for(var sRecipientAddress in oMailTipsResult){oMailTipsResult[sRecipientAddress].oUpdateTime=oNow;oMailTipsResult[sRecipientAddress].oExpiry=oExpiry}_oNamespace.mergeCache(oMailTipsResult,oClientCache)};_oNamespace.mergeCache=function Owa$Components$MailTipsResponder$mergeCache(oSourceCache,oTargetCache){if(oSourceCache){for(var sRecipientAddress in oSourceCache){if(!oTargetCache[sRecipientAddress]){oTargetCache[sRecipientAddress]={}}_oNamespace.copyProperties(oSourceCache[sRecipientAddress],oTargetCache[sRecipientAddress]);delete oTargetCache[sRecipientAddress].fIsPending}}};_oNamespace.copyProperties=function Owa$Components$MailTipsResponder$copyProperties(oSource,oTarget){for(var sPropertyName in oSource){var oValue=oSource[sPropertyName];if(oValue&&"object"==typeof(oValue)){if("oExpiry"==sPropertyName){oTarget.oExpiry=new Date(Date.parse(oValue))}else if("oUpdateTime"==sPropertyName){oTarget.oUpdateTime=new Date(Date.parse(oValue))}else if("oRestricted"==sPropertyName){if(!oTarget.oRestricted){oTarget.oRestricted={}}for(var sSenderName in oValue){oTarget.oRestricted[sSenderName]=oValue[sSenderName]}}}else{oTarget[sPropertyName]=oValue}}};_oNamespace.pushDataToForms=function Owa$Components$MailTipsResponder$pushDataToForms(oCache,oConfig){if(!g_CC){return}for(var iHash in g_CC.oMailTipsRequesters){var oMailTipsRequester=g_CC.oMailTipsRequesters[iHash];try{if(oMailTipsRequester){oMailTipsRequester.processServerUpdate(oCache,oConfig)}}catch(e){}}}})();g_fModuleLoaded[".\\components/MailTipsResponder.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\components/MailTipsRequester.js".toLowerCase()])(function(){Type.createNamespace("Owa.Components");var EVENT_NAMESPACE="MailTips";var METHOD_GET="Get";var LOADING_STATUS_DISPLAY_DELAY=500;var MAX_CONCURRENT_REQUESTS=3;var _oInstance=null;Owa.Components.MailTipsRequester=function Owa$Components$MailTipsRequester(){Owa.Components.MailTipsRequester.constructBase(this);this.oCache={};if(g_CC){Owa.Components.MailTipsResponder.mergeCache(g_CC.oMailTipsCache,this.oCache)}this.oPrimaryRecipient=0;if(hasClientCachePrimaryRecipient()){this.oPrimaryRecipient=eval(g_CC.sPr)}this.oConfig={};if(g_CC&&g_CC.oMailTipsConfig){this.cloneConfig(g_CC.oMailTipsConfig)}else{this.fDoesNeedConfig=1}if(this.isEnabled()){tryUpdCC(CC_MTR,this,REF)}this.fIsHandlingTrigger=0;this.fIsTriggerPending=0;this.fHasMainPageRefreshed=0;this.iConcurrentServerRequests=0};var _oPrototype=Owa.Components.MailTipsRequester.prototype;Owa.Components.MailTipsRequester.get_Instance=function Owa$Components$MailTipsRequester$get_Instance(){if(!_oInstance){_oInstance=new Owa.Components.MailTipsRequester()}return _oInstance};_oPrototype.dispose=function Owa$Components$MailTipsRequester$dispose(){if(!this.fHasMainPageRefreshed){if(this.iHash){tryUpdCC(CC_MTR,this,DEL)}if(this.oConfig&&this.oMailTipsUi){this.oConfig.fHideByDefault=this.oMailTipsUi.getHideByDefaultValue();tryUpdCC(CC_MTCFG,this.oConfig,REF)}}this.oCache=0;this.oConfig=0;this.oSendingAs=0;this.oPrimaryRecipient=0;this.fIsHandlingTrigger=0;this.fIsTriggerPending=0;this.sRecipientWellConsumerId=0;this.iHash=0;this.oMailTipsUi=0;this.oUiUpdateMap=0;this.fDoesNeedConfig=0;this.fHasMainPageRefreshed=0;this.iConcurrentServerRequests=0};_oPrototype.setMailTipUi=function Owa$Components$MailTipsRequester$setMailTipUi(oMailTipsUi){this.oMailTipsUi=oMailTipsUi};_oPrototype.setRecipientWellConsumerId=function Owa$Components$MailTipsRequester$setRecipientWellConsumerId(sConsumerId){this.sRecipientWellConsumerId=sConsumerId};_oPrototype.getRecipientWellConsumerId=function Owa$Components$MailTipsRequester$getRecipientWellConsumerId(){return this.sRecipientWellConsumerId};_oPrototype.getFocusInEventString=function Owa$Components$MailTipsRequester$getFocusInEventString(){if(Owa.Utility.isSafari()){return"DOMFocusIn"}else if(Owa.Utility.isIE()){return"focusin"}else{return"focus"}};_oPrototype.setHash=function Owa$Components$MailTipsRequester$setHash(iHash){this.iHash=iHash};_oPrototype.getHash=function Owa$Components$MailTipsRequester$getHash(){return this.iHash};_oPrototype._onFocusOut=function Owa$Components$MailTipsRequester$_onFocusOut(oCallbackArguments){this.handleTrigger()};_oPrototype._onFocusIn=function Owa$Components$MailTipsRequester$_onFocusIn(oCallbackArguments){this.handleTrigger()};_oPrototype._onCheckNames=function Owa$Components$MailTipsRequester$_onCheckNames(oCallbackArguments){this.handleTrigger()};_oPrototype.handleTrigger=function Owa$Components$MailTipsRequester$handleTrigger(){if(this.fHasMainPageRefreshed){if(this.oMailTipsUi){this.oMailTipsUi.setRecipientTipsSupport(0)}return}if(!this.isEnabled()){return}else if(this.fIsHandlingTrigger){this.fIsTriggerPending=1}else{this.fIsHandlingTrigger=1;this.processTrigger();this.fIsHandlingTrigger=0;if(this.fIsTriggerPending){this.fIsTriggerPending=0;this.handleTrigger()}}};_oPrototype.isEnabled=function Owa$Components$MailTipsRequester$isEnabled(){return !this.fDoesNeedConfig&&this.oConfig.fEnabled};_oPrototype.processTrigger=function Owa$Components$MailTipsRequester$processTrigger(){this.parseSendingAs();this.oUiUpdateMap=this.processRecipients();if(this.oUiUpdateMap&&this.oMailTipsUi){this.oMailTipsUi.updateUi(this.oUiUpdateMap)}};_oPrototype.parseSendingAs=function Owa$Components$MailTipsRequester$parseSendingAs(){this.oSendingAs=this.oPrimaryRecipient;if(this.sRecipientWellConsumerId){var oFromWell=null;var oDomFrom=$(FROM);if(oDomFrom){oFromWell=Owa.Components.RecipientWellManager.get_Instance().get_RecipientWell(this.sRecipientWellConsumerId,oDomFrom)}else{oDomFrom=$(SMIMEFROM);if(oDomFrom){oFromWell=Owa.Components.RecipientWellManager.get_Instance().get_RecipientWell(this.sRecipientWellConsumerId,oDomFrom)}}if(oFromWell){var oFrom=oFromWell.get_Recipient();if(oFrom&&(RCP_RES==getRecipientType(oFrom))){this.oSendingAs=oFrom}}}return this.oSendingAs};_oPrototype.getSendingAs=function Owa$Components$MailTipsRequester$getSendingAs(){return this.oSendingAs};_oPrototype.processRecipients=function Owa$Components$MailTipsRequester$processRecipients(){var oUiUpdateMap=0;if(this.sRecipientWellConsumerId){var rgOehStructs=[];var oNow=new Date();var oMailTipsRequest=new oeReq(EVENT_NAMESPACE,METHOD_GET);var rgResolvedRecipients=Owa.Components.RecipientWellManager.get_Instance().get_AllRecipientsByState(this.sRecipientWellConsumerId,Owa.RecipientState.Resolved);var oResolvedRecipientsMap={};for(var i=0;i<rgResolvedRecipients.length;i++){var sRecipientAddress;if(RT_PDL!=rgResolvedRecipients[i]._rt){sRecipientAddress=rgResolvedRecipients[i]._em.toLowerCase()}else{sRecipientAddress=rgResolvedRecipients[i]._id.toLowerCase();rgResolvedRecipients[i]._id=sRecipientAddress;this.updateCacheEntryForPDL(rgResolvedRecipients[i],oNow)}rgResolvedRecipients[i]._em=sRecipientAddress;oResolvedRecipientsMap[sRecipientAddress]=1;var oCacheEntry=this.getCacheEntry(sRecipientAddress,oNow);if(oCacheEntry){if(!oCacheEntry.fIsPending&&oCacheEntry.oUpdateTime){if(!oUiUpdateMap){oUiUpdateMap=this.createUiUpdateMap(oNow)}if(!oUiUpdateMap[sRecipientAddress]){oUiUpdateMap[sRecipientAddress]={"oCacheEntry":oCacheEntry};oUiUpdateMap[sRecipientAddress].oRecipient=rgResolvedRecipients[i]}}}else{var oStruct=convtToOEHStrctMessaging(rgResolvedRecipients[i],oMailTipsRequest);rgOehStructs.push(oStruct);this.createPendingCacheEntry(sRecipientAddress)}}if(0<rgOehStructs.length){this.sendServerRequest(oMailTipsRequest,rgOehStructs);oUiUpdateMap=0}else{oUiUpdateMap=this.updateRemovedRecipients(oUiUpdateMap,oResolvedRecipientsMap,oNow)}}return oUiUpdateMap};_oPrototype.createUiUpdateMap=function Owa$Components$MailTipsRequester$createUiUpdateMap(oNow){var oUiUpdateMap={"oTime":oNow};oUiUpdateMap["oSendingAs"]=this.oSendingAs;return oUiUpdateMap};_oPrototype.updateRemovedRecipients=function Owa$Components$MailTipsRequester$updateRemovedRecipients(oUiUpdateMap,oResolvedRecipientsMap,oNow){var oRecipientsMap=(this.oMailTipsUi)?this.oMailTipsUi.getRecipientsMap():0;if(oRecipientsMap){for(var sRecipientAddress in oRecipientsMap){if(!oResolvedRecipientsMap[sRecipientAddress]){if(!oUiUpdateMap){oUiUpdateMap=this.createUiUpdateMap(oNow)}var oCacheEntry=this.getCacheEntry(sRecipientAddress,oNow);oUiUpdateMap[sRecipientAddress]={"oCacheEntry":oCacheEntry};oUiUpdateMap[sRecipientAddress].fDelete=1}}}return oUiUpdateMap};_oPrototype.sendServerRequest=function Owa$Components$MailTipsRequester$sendServerRequest(oMailTipsRequest,rgOehStructs){if(MAX_CONCURRENT_REQUESTS==this.iConcurrentServerRequests){return}else{this.iConcurrentServerRequests++}if(this.oMailTipsUi){oMailTipsRequest.add("HideMailTipsByDefault",this.oMailTipsUi.getHideByDefaultValue()?1:0)}oMailTipsRequest.addRgSt("Recips",rgOehStructs);if(this.oSendingAs&&this.oSendingAs!=this.oPrimaryRecipient){var oehSenderStructure=convtToOEHStrctMessaging(this.oSendingAs,oMailTipsRequest);oMailTipsRequest.addSt("From",oehSenderStructure)}if(this.fDoesNeedConfig){oMailTipsRequest.add("DoesNeedConfig",1)}if(this.oMailTipsUi){this.stTmout("_checkAndShowLoadingStatus",LOADING_STATUS_DISPLAY_DELAY)}oMailTipsRequest.send()};_oPrototype.set_MainPageRefreshed=function Owa$Components$MailTipsRequester$set_MainPageRefreshed(){this.fHasMainPageRefreshed=1;if(this.iConcurrentServerRequests&&this.oMailTipsUi){this.oMailTipsUi.setLoadingStatus(0)}};_oPrototype.getCacheEntry=function Owa$Components$MailTipsRequester$getCacheEntry(sRecipientAddress,oNow){var oCacheEntry=this.oCache[sRecipientAddress];if(oCacheEntry&&(oCacheEntry.fIsPending||oCacheEntry.oExpiry&&oNow<new Date(Date.parse(oCacheEntry.oExpiry))&&(oCacheEntry.fErrored||this.oSendingAs&&oCacheEntry.oRestricted&&null!=oCacheEntry.oRestricted[this.oSendingAs._em]))){return oCacheEntry}else{return 0}};_oPrototype.updateCacheEntryForPDL=function Owa$Components$MailTipsRequester$updateCacheEntryForPDL(oResolvedPDL,oNow){var oCacheEntry=this.oCache[oResolvedPDL._id];if(!oCacheEntry){oCacheEntry={};oCacheEntry.oExpiry=new Date(2222,1,1);oCacheEntry.iExternalSize=0;oCacheEntry.iSize=1;oCacheEntry.oRestricted={};oCacheEntry.oRestricted[this.oSendingAs._em]=0;oCacheEntry.oUpdateTime=oNow;this.oCache[oResolvedPDL._id]=oCacheEntry}};_oPrototype.createPendingCacheEntry=function Owa$Components$MailTipsRequester$createPendingCacheEntry(sRecipientAddress){if(!this.oCache[sRecipientAddress]){this.oCache[sRecipientAddress]={"fIsPending":1}}else{this.oCache[sRecipientAddress].fIsPending=1}return this.oCache[sRecipientAddress]};_oPrototype.cloneConfig=function Owa$Components$MailTipsRequester$cloneConfig(oMasterConfig){var oNow=new Date();Owa.Components.MailTipsResponder.copyProperties(oMasterConfig,this.oConfig)};_oPrototype.processServerUpdate=function Owa$Components$MailTipsRequester$processServerUpdate(oMasterCache,oMasterConfig){if(oMasterConfig){this.cloneConfig(oMasterConfig)}this.fDoesNeedConfig=0;this.iConcurrentServerRequests--;if(this.isEnabled()){Owa.Components.MailTipsResponder.mergeCache(oMasterCache,this.oCache);this.handleTrigger()}else{tryUpdCC(CC_MTR,this,DEL);this.iHash=0}};_oPrototype.getCache=function Owa$Components$MailTipsRequester$getCache(){return this.oCache};_oPrototype.getConfig=function Owa$Components$MailTipsRequester$getConfig(){return this.oConfig};_oPrototype._checkAndShowLoadingStatus=function Owa$Components$MailTipsRequester$_checkAndShowLoadingStatus(){if(this.iConcurrentServerRequests&&this.oMailTipsUi){this.oMailTipsUi.setLoadingStatus(1)}};Owa.Components.MailTipsRequester.createClass("Owa.Components.MailTipsRequester",Owa.Components.Control)})();g_fModuleLoaded[".\\components/MailTipsRequester.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/ComplianceMenu.js".toLowerCase()])(function(){var oInstance=null;var fIrmMenuItemsEnabled=true;var COMPLIANCE_STATE_UNSELECTED=0;var COMPLIANCE_STATE_SELECTED=1;var COMPLIANCE_TYPE_RMSTEMPLATE="2";var _rgStateIcons=["clear.gif","cmpl_chk.gif"];Owa.UIControls.ComplianceMenu=function Owa$UIControls$ComplianceMenu(){Owa.UIControls.ComplianceMenu.constructBase(this);this._sItemId="0";this._fInitialized=false;this.get_OnPreShow().add(this._createCallback(this._onPreShow));this.get_OnSelect().add(this._createCallback(this._onSelect));this.get_OnClose().add(this._createCallback(this._onClose))};Owa.UIControls.ComplianceMenu.createClass("Owa.UIControls.ComplianceMenu",Owa.UIControls.LazyLoadContextMenu);var _oPrototype=Owa.UIControls.ComplianceMenu.prototype;_oPrototype.set_ComplianceButton=function Owa$UIControls$ComplianceMenu$set_ComplianceButton(oButton){this._oComplianceButton=oButton};_oPrototype._onPreShow=function Owa$UIControls$ComplianceMenu$_onPreShow(){if(this._oComplianceButton){this._oComplianceButton.set_IsPushed(true)}if(!this._fInitialized){this._selectMenuItem(this._get_Element().getAttribute("iCA"));this._fInitialized=true}else{var oMenuItem=this._getMenuItem("divCPLA"+this._sItemId);if(oMenuItem!=null){this.selectMenuItem(oMenuItem,true)}}this._enableIrmMenuItems(fIrmMenuItemsEnabled)};_oPrototype._onSelect=function Owa$UIControls$ComplianceMenu$_onSelect(oEventArgs){var sCommand=oEventArgs.sCommand;if(this._sItemId!=sCommand){this._unselectCurrentMenuItem();this._selectMenuItem(sCommand);var oMenuItem=this._getMenuItem("divCPLA"+sCommand);a_fIsIrmProtected=0;if(oMenuItem.getAttribute("iCType")==COMPLIANCE_TYPE_RMSTEMPLATE){a_fIsIrmProtected=1}updateInfobarForUnprotectableAttachments();this._dispatchEvent(ON_CHANGE_COMPLIANCE,{"cmplSelect":this._sItemId})}};_oPrototype._selectMenuItem=function Owa$UIControls$ComplianceMenu$_selectMenuItem(sCommand){this._sItemId=sCommand;var menuItemId="divCPLA"+this._sItemId;var oMenuItem=this._getMenuItem(menuItemId);if(oMenuItem!=null){this.replaceMenuItemIcon(menuItemId,_rgStateIcons[COMPLIANCE_STATE_SELECTED]);this.selectMenuItem(oMenuItem,true)}};_oPrototype._unselectCurrentMenuItem=function Owa$UIControls$ComplianceMenu$_unselectCurrentMenuItem(){var menuItemId="divCPLA"+this._sItemId;var oMenuItem=this._getMenuItem(menuItemId);if(oMenuItem!=null){this.replaceMenuItemIcon(menuItemId,_rgStateIcons[COMPLIANCE_STATE_UNSELECTED]);this.selectMenuItem(oMenuItem,false)}};_oPrototype._enableIrmMenuItems=function Owa$UIControls$ComplianceMenu$_enableIrmMenuItems(state){for(var i=0;i<this._rgMenuItems.length;i++){var menuItem=this._rgMenuItems[i];if(menuItem.getAttribute("iCType")==COMPLIANCE_TYPE_RMSTEMPLATE){this.enableMenuItem(menuItem.get_Id(),state)}}};_oPrototype._onClose=function Owa$UIControls$ComplianceMenu$_onClose(){if(this._oComplianceButton){this._oComplianceButton.set_IsPushed(false)}};_oPrototype._createLoadHtmlContentRequest=function Owa$UIControls$ComplianceMenu$_createLoadHtmlContentRequest(fnCallback){var oR=new oeReq("Compliance","gtCM",0,fnCallback,GET);if(a_sId)oR.add("id",a_sId);return oR};Owa.UIControls.ComplianceMenu.get_Instance=function Owa$UIControls$ComplianceMenu$get_Instance(){return oInstance};Owa.UIControls.ComplianceMenu.createInstance=function Owa$UIControls$ComplianceMenu$createInstance(){if(oInstance)throw"The instance has already been created";return oInstance=new Owa.UIControls.ComplianceMenu()};Owa.UIControls.ComplianceMenu.set_IsIrmEnabled=function Owa$UIControls$ComplianceMenu$set_IsIrmEnabled(isEnabled){fIrmMenuItemsEnabled=isEnabled};Owa.UIControls.ComplianceMenu.dispose=function Owa$UIControls$ComplianceMenu$dispose(){if(!oInstance)return;oInstance._get_Element().remove(true);oInstance.dispose();oInstance=null};var ON_CHANGE_COMPLIANCE="onChangeCompliance";_oPrototype.get_OnChangeCompliance=function Owa$UIControls$CategoryMenu$get_OnChangeCompliance(){return this._getEventHandlerCollection(ON_CHANGE_COMPLIANCE)}})();g_fModuleLoaded[".\\uicontrols/ComplianceMenu.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\components/EditMessageItem.js".toLowerCase()])(function(){Type.createNamespace("Owa.Pages");var BLUR="blur";Owa.Pages.EditMessageItemPage=function Owa$Pages$EditMessageItemPage(oElement){Owa.Pages.EditMessageItemPage.constructBase(this,[oElement,true]);this.sConsumerId=null};var _oPrototype=Owa.Pages.EditMessageItemPage.prototype;_oPrototype.initialize=function Owa$Pages$EditMessageItemPage$initialize(){this.initializeClientCache();Owa.Pages.EditMessageItemPage.callBase(this,"initialize");g_fFcsLV=1;initIM(1)};_oPrototype.dispose=function Owa$Pages$EditMessageItemPage$dispose(){if(g_fDltDrft){clnUp()}if(g_oDlgMOpt){g_oDlgMOpt.dispose()}setFcsLstV();dispIM();if(this.oMailTipsRequester){this.oMailTipsRequester.dispose()}if(this.oMailTipsUi){this.oMailTipsUi.dispose()}Owa.UIControls.ComplianceMenu.dispose();Owa.Components.RecipientWellManager.get_Instance().dispose();var oEdB=edDoc(1).get_Body();oEdB.detachAllEvents();Owa.Pages.EditMessageItemPage.callBase(this,"dispose")};_oPrototype._initializeHotkeys=function Owa$Components$EditMessageItemPage$_initializeHotkeys(){Owa.Pages.EditMessageItemPage.callBase(this,"_initializeHotkeys");this.addHk(L_HkRcps1,"checknames");this.addHk(L_HkRcps2,"checknames");this.addHk(L_HkSnd,"send");this.addHk("Ctrl+13","send");this.addHk(L_HkSv,"save");if(isSpC()){this.addHk("118","spellcheck")}};_oPrototype._onNewItem=function Owa$Pages$EditMessageItemPage$_onNewItem(){newMail()};_oPrototype._onUserAction=function Owa$Pages$EditMessageItemPage$_onUserAction(sAction,oContext){switch(sAction){case"save":this.processOnSave();break;case"send":this.processOnSend();break;case"checknames":this.checkNames();break;case"messageoptions":ldMOpt();break;case"addressbook":shwAB(TO,"m");break;case"compliance":this.showComplianceMenu();break;case"mailTips":this.toggleInfobar();break;default:Owa.Pages.EditMessageItemPage.callBase(this,"_onUserAction",[sAction,oContext]);break}};_oPrototype.onCompleteSpellCheckOnSend=function Owa$Pages$EditMessageItemPage$onCompleteSpellCheckOnSend(iEventResults){if(iEventResults){Owa.Components.RecipientWellManager.get_Instance().resolveWells(this.sConsumerId,this._createCallback(this.onCompleteResolveNamesOnSend))}};_oPrototype.onCompleteResolveNamesOnSend=function Owa$Pages$EditMessageItemPage$onCompleteResolveNamesOnSend(iEventResults){switch(iEventResults){case RESOLVE_IN_PROGRESS:break;case RESOLVE_MAX_RECIPIENTS:break;case RESOLVE_ANR_CANCEL:break;case RESOLVE_NO_RECIPIENTS:alrt(L_ErrNoRcp);break;case RESOLVE_UNRESOLVED_RECIPIENTS:alrt(L_ErrAmbRcp);break;default:this.processItem(OP_SND|OP_CLS);break}};_oPrototype.processOnSend=function Owa$Pages$EditMessageItemPage$processOnSend(){if(isSpC()&&(a_fSpSn==1)){procSpl(this._createCallback(this.onCompleteSpellCheckOnSend),OP_SND)}else{Owa.Components.RecipientWellManager.get_Instance().resolveWells(this.sConsumerId,this._createCallback(this.onCompleteResolveNamesOnSend))}};_oPrototype.processOnSave=function Owa$Pages$EditMessageItemPage$processOnSave(){if(!Owa.Components.RecipientWellManager.get_Instance().validateMaxRecipients(this.sConsumerId)){return}Owa.Components.RecipientWellManager.get_Instance().loadAllRecipientData(this.sConsumerId);this.processItem(OP_SAV)};_oPrototype.checkNames=function Owa$Pages$EditMessageItemPage$checkNames(){if(this.oMailTipsRequester){Owa.Components.RecipientWellManager.get_Instance().resolveWells(this.sConsumerId,this.oMailTipsRequester._createCallback(this.oMailTipsRequester._onCheckNames))}else{Owa.Components.RecipientWellManager.get_Instance().resolveWells(this.sConsumerId)}};_oPrototype.processItem=function Owa$Pages$EditMessageItemPage$processItem(iOp){g_fDltDrft=0;if(Owa.Components.OehRequest.hasPendingRequests()){return}if(isRepFw()){setRPRefreshDelayFlag()}Owa.Components.RecipientWellManager.get_Instance().set_AreWellsEnabled(this.sConsumerId,false);var oRequest=new oeReq(this.get_OehNameSpace(),(iOp&OP_SAV)?"Save":"Send",iOp,this._createCallback(this.cbProcessItem));Owa.Components.RecipientWellManager.get_Instance().addRecipientOehData(this.sConsumerId,oRequest);this.addBaseParametersForProcessItem(oRequest,iOp);this.addParametersForProcessItem(oRequest,iOp);if((iOp&OP_SAV)||(iOp&OP_SND)){Owa.Components.RecipientWellManager.get_Instance().addCacheOehData(this.sConsumerId,oRequest)}this._addHideMailTipsByDefaultToRequest(oRequest);if(iOp&OP_SND){shwPrgrsInd(L_Sndng)}if(iOp&OP_SAV){shwPrgrsInd(L_Svng)}oRequest.send()};_oPrototype.cbProcessItem=function Owa$Pages$EditMessageItemPage$cbProcessItem(oResponse){var iOp=oResponse.oCtx;var sEr=null;var iEr=0;var oDivR=Owa.Dom.Document.get_Current().createElement("DIV");oDivR=Owa.Dom.Document.get_Current().appendChild(oDivR);oDivR.set_IsShown(false);oDivR.set_InnerHtml(oResponse.sBody);var oContextError=null;if(oResponse.sErr){if(oResponse.fST){popLgn()}oContextError={};oContextError.sError=oResponse.sErr;oContextError.iErrorCode=oResponse.iErr}else{var oElement=oDivR.getDescendantById("err");if(oElement){oContextError=this._processResponseForErrors(oElement)}}if(!oContextError){hideErr($("divErr"));if(iOp&OP_SAV){if(!a_sId){a_sId=oDivR.getDescendantById("itemId").get_TextContent()}a_sCK=oDivR.getDescendantById("ck").get_TextContent();Owa.Components.RecipientWellManager.get_Instance().replaceAllPendingNodes(this.sConsumerId,oDivR);this._updateWindowTitle();rfMailVw(0,1);clrDrty()}else if(iOp&OP_SND){clrDrty();this._refreshViewOnSend()}else if(iOp&OP_CLS){clrDrty()}this._updateOnProcessItem(oResponse);if(iOp&OP_CLS){self.close()}}else{if(iOp&OP_SND){hdPrgrsInd()}Owa.Components.RecipientWellManager.get_Instance().replaceAllPendingNodes(this.sConsumerId,oDivR);this._handleErrorsOnProcessItem(oResponse,iOp,oContextError)}if(iOp&OP_SAV){hdPrgrsInd()}oDivR.remove(true);Owa.Components.RecipientWellManager.get_Instance().set_AreWellsEnabled(this.sConsumerId,true)};_oPrototype._processResponseForErrors=function Owa$Pages$EditMessageItemPage$_processResponseForErrors(oElement){var oContextError={};oContextError.sError=oElement.getAttribute("_msg");oContextError.fText=1;var iErrorCode=oElement.getIntAttribute("_cd");if(!isNaN(iErrorCode)){oContextError.iErrorCode=iErrorCode}return oContextError};_oPrototype._handleErrorsOnProcessItem=function Owa$Pages$EditMessageItemPage$_handleErrorsOnProcessItem(oResponse,iOp,oContextError){if(!oResponse.fST){showErr($("divErr"),oContextError.sError,oResponse.sErrDbg,oContextError.fText)}if(iOp&OP_SND){updIdCkForFR(oResponse)}};_oPrototype._updateOnProcessItem=function Owa$Pages$EditMessageItemPage$_updateOnProcessItem(oResponse){};_oPrototype._refreshViewOnSend=function Owa$Pages$EditMessageItemPage$_refreshViewOnSend(){if(!isNoE(a_sId)){var oContext=this._tryGetViewAndReadingPane();if(oContext.oView){oContext.oView.rmvRws(new Array(a_sId))}if(oContext.oReadingPane){oContext.oReadingPane.rmvIPs(new Array(a_sId))}}};_oPrototype._tryGetViewAndReadingPane=function Owa$Pages$EditMessageItemPage$_tryGetViewAndReadingPane(){var oLV=null;var oRP=null;var oOpenerController=Owa.Components.SubPageControllerFactory.get_CurrentWindowSubPageController().get_OpenerController();if(oOpenerController){try{oLV=Owa.PageHierarchy.getVirtualListViewFromSubPageController(oOpenerController);oRP=oOpenerController.getExpando("oRdCnv");if(!oRP&&oLV){oRP=oOpenerController.invokeFunction("gtCnvRP")}if(!oLV){oLV=Owa.PageHierarchy.getVirtualListViewFromSubPageController(oOpenerController.get_ParentController());if(!oRP){oRP=oOpenerController.get_ParentController().getExpando("oRdCnv")}}}catch(e){}}return{oView:oLV,oReadingPane:oRP}};_oPrototype._updateWindowTitle=function Owa$Pages$EditMessageItemPage$_updateWindowTitle(){var sS=$("txtSubj").get_Value();if(!sS.length){sS=L_UntMsg}Owa.Dom.Document.get_Current().set_Title(sS)};_oPrototype.addBaseParametersForProcessItem=function Owa$Pages$EditMessageItemPage$addBaseParametersForProcessItem(oRequest,iOp){if(a_sId){oRequest.add("Id",a_sId);oRequest.add("CK",a_sCK)}oRequest.add("Subj",$("txtSubj").get_Value());oRequest.add("Imp",getImp());oRequest.add("Sensitivity",a_iSens);oRequest.add("Body",isHtml()?getHtmlBdy(null,!(iOp&OP_SAV)):getTxtBdy());oRequest.add("Text",isHtml()?0:1);oRequest.add("DeliveryRcpt",a_fDvRcp);oRequest.add("ReadRcpt",a_fRdRcp)};_oPrototype.addParametersForProcessItem=function Owa$Pages$EditMessageItemPage$addParametersForProcessItem(oRequest,iOp){};_oPrototype.handleBlockedContent=function Owa$Pages$EditMessageItemPage$handleBlockedContent(){if(isDf(typeof(a_fPmptUsr))&&a_fPmptUsr){if(confirm(L_WrnFmtLssRepFw)){g_fFcsLV=0;openItm(getUrl(this.get_IpmType(),getAc(),getItmSt(),0,1,1),window.name)}}};_oPrototype.get_IpmType=function Owa$Pages$EditMessageItemPage$get_IpmType(){return"IPM.Note"};_oPrototype.setFocus=function Owa$Pages$EditMessageItemPage$setFocus(){var fFocusBody=(isRepFw()&&(a_iNit==RF_RPLY));var fFocusTo=((isRepFw()&&(a_iNit==RF_FWD))||!a_sId);if(fFocusBody){setFcsBdy(1)}else if(fFocusTo){g_oMmBdy?fcsMmTo():fcsTo()}else{$("txtSubj").focus(1)}};_oPrototype.initializeClientCache=function Owa$Pages$EditMessageItemPage$initializeClientCache(){initCC(true);if(!chkCC()){return}if(!isRepFw()&&!isExpDft()&&!chkMime()){a_fTxt=g_CC.fTxt}a_sInitFntNm=g_CC.sInitFntNm;a_sInitFntSz=g_CC.sInitFntSz;a_sDefFntMkp=g_CC.sDefFntMkp;a_sDefFntBIUStyl=g_CC.sDefFntBIUStyl;a_sDefFntStyl=g_CC.sDefFntStyl;a_iFmtBrSt=g_CC.iFmtBrSt;a_sMruFnts=g_CC.sMruFnts;a_fSp=g_CC.fSp;a_iSp=getInt(g_CC.iSp);a_fSpSn=g_CC.fSpSn;a_fSig=g_CC.fSig;a_sSigHtml=g_CC.sSigHtml;a_sSigTxt=g_CC.sSigTxt;a_fASgn=g_CC.fASgn;a_fAEnc=g_CC.fAEnc;a_fSgn=g_CC.fSgn;a_fEnc=g_CC.fEnc;a_fMstUpd=g_CC.fMstUpd;try{if(hasClientCacheAutoCompleteCache()){g_rgoRcp=eval("new Array("+g_CC.sAcc+")")}if(hasClientCachePrimaryRecipient()){g_primaryRecipient=eval(g_CC.sPr)}if(hasClientCacheSubscriptionCache()){g_subscriptionRecipients=eval("new Array("+g_CC.sSc+")")}if(hasClientCacheMruCache()){g_mruRecipients=eval("new Array("+g_CC.sMruc+")")}}catch(e){}};_oPrototype._addHideMailTipsByDefaultToRequest=function Owa$Pages$EditMessageItemPage$_addHideMailTipsByDefaultToRequest(oRequest){if(this.oMailTipsUi){oRequest.add("HideMailTipsByDefault",this.oMailTipsUi.getHideByDefaultValue()?1:0)}};_oPrototype._initializeMailTipsRequester=function Owa$Pages$EditMessageItemPage$_initializeMailTipsRequester(rgRecipientWells){this.oMailTipsRequester=Owa.Components.MailTipsRequester.get_Instance();if(this.oMailTipsRequester.isEnabled()){this.oMailTipsRequester.setRecipientWellConsumerId(this.sConsumerId);if(rgRecipientWells){for(var i=0;i<rgRecipientWells.length;i++){rgRecipientWells[i].addHandler(BLUR,this.oMailTipsRequester._createCallback(this.oMailTipsRequester._onFocusOut))}}var sFocusInEvent=this.oMailTipsRequester.getFocusInEventString();var oSubject=$("txtSubj");if(oSubject){oSubject.attachEvent(sFocusInEvent,this.oMailTipsRequester._createCallback(this.oMailTipsRequester._onFocusIn))}var oEditorDocument=edDoc(1);if(oEditorDocument){oEditorDocument.attachEvent(sFocusInEvent,this.oMailTipsRequester._createCallback(this.oMailTipsRequester._onFocusIn))}this.oMailTipsUi=Owa.Components.MailTipsUi.get_Instance(this.oMailTipsRequester);this.oMailTipsRequester.setMailTipUi(this.oMailTipsUi);this.oMailTipsRequester.handleTrigger();this._refreshInfobar(this.oMailTipsUi.oInfobar)}else{this._refreshInfobar()}};_oPrototype.showComplianceMenu=function Owa$Pages$EditMessageItemPage$showComplianceMenu(){var oCmplMenu=Owa.UIControls.ComplianceMenu.get_Instance();if(!oCmplMenu){oCmplMenu=Owa.UIControls.ComplianceMenu.createInstance();oCmplMenu.get_OnChangeCompliance().add(this._createCallback(this._onChangeCompliance))}var oCmplButton=Owa.Components.ToolbarCollection.get_Current().getButton("compliance");oCmplMenu.set_ComplianceButton(oCmplButton);oCmplMenu.showUnder(oCmplButton._get_ButtonFrame())};_oPrototype._onChangeCompliance=function Owa$Pages$EditMessageItemPage$_onChangeCompliance(oArgument){var sItemId=oArgument.cmplSelect;var oEdD=edDoc(1);if(isDf(typeof(a_fRecipientWellRestricted))&&(a_fRecipientWellRestricted==1)){a_fRecipientWellRestricted=0;var enabledButtonClasses=["hdrBf","tbf","tbfHvr"];$("divToBtn").set_CssClasses(enabledButtonClasses);$("divCcBtn").set_CssClasses(enabledButtonClasses);$("divBccBtn").set_CssClasses(enabledButtonClasses);$("btnTo").attachEvent("click",new Function("shwABM(\"divTo\");"));$("btnCc").attachEvent("click",new Function("shwABM(\"divCc\");"));$("btnBcc").attachEvent("click",new Function("shwABM(\"divBcc\");"));Owa.Components.RecipientWellManager.get_Instance().set_AreWellsReadOnly(this.sConsumerId,false)}if(isDf(typeof(a_fPrintRestricted))&&(a_fPrintRestricted==1)){a_fPrintRestricted=0;$("divBdy").removeCssClass("noPrint");var divBdyNoPrnt=$("divBdyNoPrnt");divBdyNoPrnt.addCssClass("hiddenMsg");divBdyNoPrnt.removeCssClass("noScreen");removeNoPrintStylesFromDocument(oEdD)}if(isDf(typeof(a_fCopyRestricted))&&(a_fCopyRestricted==1)){var oEdB=oEdD.get_Body();a_fCopyRestricted=0;oEdB.detachEvent("copy",canEvt);oEdB.detachEvent("cut",canEvt);oEdB.detachEvent("dragstart",canEvt)}if(g_oFormatCombobox&&!g_oFormatCombobox.get_IsEnabled()){g_oFormatCombobox.set_IsEnabled(true)}var oSgnBtn=Owa.Components.ToolbarCollection.get_Current().getButton("msgsgnd");if(oSgnBtn){oSgnBtn.set_IsDisabled(a_fIsIrmProtected)}var oEncBtn=Owa.Components.ToolbarCollection.get_Current().getButton("msgencypt");if(oEncBtn){oEncBtn.set_IsDisabled(a_fIsIrmProtected)}drty();if(sItemId=="0"){this._updateInfoBarMessage("");return}var oR=new oeReq("Compliance","gtCMIB",0,this._createCallback(this._onChangeComplianceCallback),GET);oR.add("cguid",sItemId);oR.send()};_oPrototype._onChangeComplianceCallback=function Owa$Pages$EditMessageItemPage$_onChangeComplianceCallback(oR){if(!cbOeh(oR))return;this._updateInfoBarMessage(oR.sBody)};_oPrototype._updateInfoBarMessage=function Owa$Pages$EditMessageItemPage$_updateInfoBarMessage(sIB){if(sIB.length==0){checkRemoveInfobarMessage("divCmplIB")}else{var oDiv=Owa.Dom.Document.get_Current().createElement("DIV");oDiv.set_InnerHtml(sIB);var oNewComplianceMessage=oDiv.getChildById("divCmplIB");if(oNewComplianceMessage){replaceOrInsertInfobarMessageElement(oNewComplianceMessage)}}};_oPrototype._refreshInfobar=function Owa$Pages$EditMessageItemPage$_refreshInfobar(oInfobar){if(!oInfobar){oInfobar=new Owa.UIControls.Infobar($("divInfobar"))}oInfobar.refresh()};_oPrototype.toggleInfobar=function Owa$Pages$EditMessageItemPage$toggleInfobar(){var oInfobar=new Owa.UIControls.Infobar($("divInfobar"));var fWasShown=oInfobar.get_IsShown();if(this.oMailTipsUi){this.oMailTipsUi.setHideByDefaultValue(fWasShown)}oInfobar.set_IsShown(!fWasShown);oInfobar.focusToolbarOnButtonClick()};Owa.Pages.EditMessageItemPage.createClass("Owa.Pages.EditMessageItemPage",Owa.Pages.FormSubPage)})();g_fModuleLoaded[".\\components/EditMessageItem.js".toLowerCase()]=1;function fcsTo(){$("divTo").focus(1)}function shwABM(sTgt){shwAB(sTgt,"PickRecipients")}function gtCmplCI(){var oCmplMenu=Owa.UIControls.ComplianceMenu.get_Instance();return(!oCmplMenu?-1:getInt(oCmplMenu._sItemId))}function resizeWells(){var labelIds=new Array("divFromL","divToL","divCcL","divBccL","divSMimeL","divSubjL","divAttachL","divWhenL","divLocationL","divSendOnBehlfL");var size=Owa.Layout.MaximumWidth(labelIds);Owa.Layout.SetWidths(labelIds,size);if(g_fRtl){var oTxtSubj=$("txtSubj");oTxtSubj.set_Width(oTxtSubj.get_ParentElement().get_ClientWidth()-oTxtSubj.getEffectivePadding(Owa.Style.Side.Right)*2)}else{$("divSubjWrap").set_Left(($("divSubjL")._get_OffsetLeft()+size),"px")}}if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\components/EditMessage.js".toLowerCase()])(function(){Type.createNamespace("Owa.Pages");Owa.Pages.EditMessagePage=function Owa$Pages$EditMessagePage(oElement){Owa.Pages.EditMessagePage.constructBase(this,[oElement,true])};var _oPrototype=Owa.Pages.EditMessagePage.prototype;_oPrototype.initialize=function Owa$Pages$EditMessagePage$initialize(){var fReadOnly=false;Owa.Pages.EditMessagePage.callBase(this,"initialize");updateInfobarForUnprotectableAttachments();if(isDf(typeof(a_fRecipientWellRestricted))&&(a_fRecipientWellRestricted==1)){fReadOnly=true}var rgRecipientWells=new Array();var oWellTo=Owa.UIControls.EditRecipientWell.create($(TO));oWellTo.initialize(Owa.RecipientType.To,fReadOnly);rgRecipientWells.push(oWellTo);var oWellCc=Owa.UIControls.EditRecipientWell.create($(CC));oWellCc.initialize(Owa.RecipientType.Cc,fReadOnly);rgRecipientWells.push(oWellCc);var oWellBcc=Owa.UIControls.EditRecipientWell.create($(BCC));oWellBcc.initialize(Owa.RecipientType.Bcc,fReadOnly);rgRecipientWells.push(oWellBcc);this.initializeFromRecipientWell(rgRecipientWells);this.sConsumerId=Owa.Components.RecipientWellManager.get_Instance().registerWells(rgRecipientWells);safeResizeWells();this.setFocus();this.handleBlockedContent();this._initializeMailTipsRequester(rgRecipientWells);if(fReadOnly&&this.oMailTipsUi){this.oMailTipsUi.setRecipientTipsSupport(0)}};_oPrototype.get_OehNameSpace=function Owa$Pages$EditMessagePage$get_OehNameSpace(){return"EditMessage"};_oPrototype.initializeFromRecipientWell=function Owa$Pages$EditMessagePage$initializeFromRecipientWell(rgRecipientWells){var oFromWellContainer=$("divWellFrom");var oDivFromWell=null;if(oFromWellContainer){oDivFromWell=oFromWellContainer.getDescendantById("divFrom")}if(oDivFromWell){var oFromWell=Owa.UIControls.SingleEditRecipientWell.create(oDivFromWell);oFromWell.initialize(Owa.RecipientType.From);if(isDf(typeof(g_subscriptionRecipients))&&g_subscriptionRecipients&&0<g_subscriptionRecipients.length||isDf(typeof(g_mruRecipients))&&g_mruRecipients&&0<g_mruRecipients.length){oFromWellContainer.set_IsShown(true)}if(!oDivFromWell.hasChildNodes()){if(isDf(typeof(g_primaryRecipient))&&g_primaryRecipient){var oDomRecipientSpan=crtRcpSpan(g_primaryRecipient._dn,g_primaryRecipient._em,g_primaryRecipient._rt,g_primaryRecipient._sa,g_primaryRecipient._ao,g_primaryRecipient._rf,g_primaryRecipient._id,g_primaryRecipient._ei,isDf(typeof(g_primaryRecipient._uri))?g_primaryRecipient._uri:"");oFromWell.set_Recipients([g_primaryRecipient])}}rgRecipientWells.push(oFromWell)}};_oPrototype.dispose=function Owa$Pages$EditMessagePage$dispose(){if(this.oFromContextMenu){this.oFromContextMenu.dispose()}$("btnTo").detachAllEvents();$("btnCc").detachAllEvents();$("btnBcc").detachAllEvents();Owa.Pages.EditMessagePage.callBase(this,"dispose")};_oPrototype.addParametersForProcessItem=function Owa$Pages$EditMessagePage$addParametersForProcessItem(oRequest,iOp){var iCmpA=gtCmplCI();if(iCmpA>=0){oRequest.add("CmpAc",iCmpA)}};Owa.Pages.EditMessagePage.createClass("Owa.Pages.EditMessagePage",Owa.Pages.EditMessageItemPage)})();g_fModuleLoaded[".\\components/EditMessage.js".toLowerCase()]=1;var g_fFromMenuCached=false;var g_fFromMenuPendingRequest=false;function showFromMenu(){if(g_fFromMenuPendingRequest){return}g_fFromMenuPendingRequest=true;if(!g_fFromMenuCached){if(isDf(typeof(this.oFromContextMenu))&&this.oFromContextMenu){this.oFromContextMenu.renew()}else{this.oFromContextMenu=Owa.UIControls.FromContextMenu.create()}}if(this.oFromContextMenu&&this.oFromContextMenu.fullyLoaded()){g_fFromMenuPendingRequest=false;g_fFromMenuCached=true;this.oFromContextMenu.showMenu()}}if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\components/EditMeetingResponse.js".toLowerCase()])(function(){Type.createNamespace("Owa.Pages");Owa.Pages.EditMeetingResponsePage=function Owa$Pages$EditMeetingResponsePage(oElement){Owa.Pages.EditMeetingResponsePage.constructBase(this,[oElement,true])};var _oPrototype=Owa.Pages.EditMeetingResponsePage.prototype;_oPrototype.initializeFromRecipientWell=function Owa$Pages$EditMeetingResponsePage$initializeFromRecipientWell(rgRecipientWells){};_oPrototype.setFocus=function Owa$Pages$EditMeetingResponsePage$setFocus(){if(a_iT==a_IT_RSP){setFcsBdy(1)}else{return Owa.Pages.EditMeetingResponsePage.callBase(this,"setFocus")}};_oPrototype.get_IpmType=function Owa$Pages$EditMeetingResponsePage$get_IpmType(){switch(a_iT){case a_IT_INV:return"IPM.Schedule.Meeting.Request";case a_IT_RSP:return"IPM.Schedule.Meeting.Resp";case a_IT_CAN:return"IPM.Schedule.Meeting.Canceled"}};_oPrototype.get_OehNameSpace=function Owa$Pages$EditMeetingResponsePage$get_OehNameSpace(){if(a_iT==a_IT_RSP){return"EditMeetingResponse"}else{return Owa.Pages.EditMeetingResponsePage.callBase(this,"get_OehNameSpace")}};_oPrototype.addParametersForProcessItem=function Owa$Pages$EditMeetingResponsePage$addParametersForProcessItem(oRequest,iOp){if(a_iT==a_IT_RSP){if(iOp&OP_SND){oRequest.add("PermanentDelete",a_fInvInDelItms)}if(a_sIdM){oRequest.add("IdM",a_sIdM)}oRequest.add("Rsp",a_iRsp)}};_oPrototype._refreshViewOnSend=function Owa$Pages$EditMeetingResponsePage$_refreshViewOnSend(){var oContext=this._tryGetViewAndReadingPane();var rgIds=new Array();rgIds.push(a_sId);if(isDf(typeof(a_sIdM))&&a_sIdM){rgIds.push(a_sIdM)}if(oContext.oView){oContext.oView.rmvRws(rgIds)}if(oContext.oReadingPane){oContext.oReadingPane.rmvIPs(rgIds)}};_oPrototype._updateWindowTitle=function Owa$Pages$EditMeetingResponsePage$_updateWindowTitle(){var sS=$("txtSubj").get_Value();if(!sS.length){sS=L_UntMtg}Owa.Dom.Document.get_Current().set_Title(sS)};Owa.Pages.EditMeetingResponsePage.createClass("Owa.Pages.EditMeetingResponsePage",Owa.Pages.EditMessagePage)})();g_fModuleLoaded[".\\components/EditMeetingResponse.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/FromContextMenu.js".toLowerCase()])(function(){Type.createNamespace("Owa.UIControls");var MENU_ID="divFMnu";var MENU_SHELL="<div id=\""+MENU_ID+"\" class=\"ctxMnu ctxMnuScrl\" fscrl=\"1\" style=\"display:none\"></div>";var MENU_ITEM_HEADER="<div _lnk=\"1\" class=\"cmLnk\" cmd=\"an\"";var DIVIDER="<div class=\"cmDvdr\"><span></span></div>";var ADDRESS_ITEM_HEADER="<div id=\"divFAddr\" _lnk=\"1\" class=\"cmLnk\" cmd=\"addr\"><span id=\"spnT\">";Owa.UIControls.FromContextMenu=function Owa$UIControls$FromContextMenu(oElement,oParent){Owa.UIControls.FromContextMenu.constructBase(this,[oElement,oParent]);this._fFullMenuLoaded=false;this._fGetCacheAttempted=false};Owa.UIControls.FromContextMenu.create=function Owa$UIControls$FromContextMenu$create(oParent){var oElement=createOrResetMenu();var oFromContextMenu=new Owa.UIControls.FromContextMenu(oElement,oParent);oFromContextMenu._insertMenuItems();if(oFromContextMenu._fFullMenuLoaded){oFromContextMenu.initialize();oFromContextMenu.get_OnDataBind().add(onDataBind);oFromContextMenu.get_OnSelect().add(onSelect);oFromContextMenu.get_OnClose().add(onClose)}return oFromContextMenu};Owa.UIControls.FromContextMenu.prototype.renew=function Owa$UIControls$FromContextMenu$renew(){this._fGetCacheAttempted=true;this._fFullMenuLoaded=false;this._oElement=createOrResetMenu();this._insertMenuItems()};Owa.UIControls.FromContextMenu.prototype.fullyLoaded=function Owa$UIControls$FromContextMenu$fullyLoaded(){return this._fFullMenuLoaded};Owa.UIControls.FromContextMenu.prototype.showMenu=function Owa$UIControls$FromContextMenu$showMenu(){var oFromButton=$(BTNFROM);if(oFromButton){var iX=oFromButton.get_DocumentLeft();if(g_fRtl){iX+=oFromButton.get_OffsetWidth()}var iY=oFromButton.get_DocumentTop()+oFromButton.get_OffsetHeight();this.show(iX,iY)}};Owa.UIControls.FromContextMenu.prototype._insertMenuItems=function Owa$UIControls$FromContextMenu$_insertMenuItems(){var oCurrentWindow=Owa.Dom.Window.get_Current();var sTemporaryMarkup="";if(isDf(typeof(oCurrentWindow.getGlobalVariable("g_primaryRecipient")))){sTemporaryMarkup+=createMenuItem(oCurrentWindow.getGlobalVariable("g_primaryRecipient"))}else{this._getCache();return}if(isDf(typeof(oCurrentWindow.getGlobalVariable("g_subscriptionRecipients")))){sTemporaryMarkup+=createMenuItems(oCurrentWindow.getGlobalVariable("g_subscriptionRecipients"))}else{this._getCache();return}if(""!=sTemporaryMarkup){this._oElement.set_InnerHtml(sTemporaryMarkup+DIVIDER);sTemporaryMarkup=""}if(isDf(typeof(oCurrentWindow.getGlobalVariable("g_mruRecipients")))){sTemporaryMarkup+=createMenuItems(oCurrentWindow.getGlobalVariable("g_mruRecipients"))}else{this._getCache();return}if(""!=sTemporaryMarkup){this._oElement.insertAdjacentHtml(Owa.ElementInsertionPoint.BeforeEnd,sTemporaryMarkup+DIVIDER)}sTemporaryMarkup=createAddressItem();if(""!=sTemporaryMarkup){this._oElement.insertAdjacentHtml(Owa.ElementInsertionPoint.BeforeEnd,sTemporaryMarkup)}this._fFullMenuLoaded=true};Owa.UIControls.FromContextMenu.prototype._getCache=function Owa$UIControls$FromContextMenu$_getCache(){if(this._getCacheAttempted){var sAddressItem=createAddressItem();if(""!=sAddressItem){this._oElement.insertAdjacentHtml(Owa.ElementInsertionPoint.BeforeEnd,sAddressItem)}return}this._getCacheAttempted=true;var oRequest=new oeReq("RecipWell","GetSFCache",0,getCacheCallback);oRequest.send()};function createOrResetMenu(){var oDoc=Owa.Dom.Document.get_Current();var oMenu=oDoc.getElementById(MENU_ID);if(oMenu){oMenu.set_InnerHtml("")}else{var oBody=oDoc.get_Body();oBody.insertAdjacentHtml(Owa.ElementInsertionPoint.BeforeEnd,MENU_SHELL);oMenu=oDoc.getElementById(MENU_ID)}return oMenu}function createMenuItem(oRecipient){var sItem=MENU_ITEM_HEADER+" _dn=\""+htmlEnc(oRecipient._dn)+"\""+" _em=\""+htmlEnc(oRecipient._em)+"\""+" _sa=\""+htmlEnc(oRecipient._sa)+"\""+" _rt=\""+htmlEnc(oRecipient._rt)+"\""+" _ao=\""+htmlEnc(oRecipient._ao)+"\""+" _rf=\""+htmlEnc(oRecipient._rf)+"\""+" _id=\""+htmlEnc(oRecipient._id)+"\""+" _ei=\""+htmlEnc(oRecipient._ei)+"\"";if(isDf(typeof(oRecipient._uri))&&""!=oRecipient._uri){sItem+=" _uri=\""+htmlEnc(oRecipient._uri)+"\""}sItem+="><span id=\"spnT\">"+htmlEnc(oRecipient._sa)+"</span></div>";return sItem}function createMenuItems(oRecipients){var sTemporaryMarkup="";for(var i=0;i<oRecipients.length;i++){sTemporaryMarkup+=createMenuItem(oRecipients[i])}return sTemporaryMarkup}function createAddressItem(){var oCurrentWindow=Owa.Dom.Window.get_Current();if(isDf(typeof(oCurrentWindow.getGlobalVariable("L_OtrEml")))){return ADDRESS_ITEM_HEADER+oCurrentWindow.getGlobalVariable("L_OtrEml")+"</span></div>"}return""}function getFromButton(){var oFromButtonElement=$(BTNFROM);if(isDf(typeof(oFromButtonElement))&&null!=oFromButtonElement){return new Owa.UIControls.Button(oFromButtonElement)}return null}function onDataBind(oEventArgs){var oFromButton=getFromButton();if(oFromButton){oFromButton.set_IsPushed(true)}}function onSelect(oEventArgs){if("addr"==oEventArgs.sCommand){shwAB(FROM,"PickSendFrom")}else{var oRecipientSpan=Owa.Dom.Node.wrapDomNode(crtRcpSpanFromDomObject(oEventArgs.oMenuItem));var oDivFrom=$(FROM);if(oDivFrom){oDivFrom.set_InnerHtml("");oDivFrom.appendChild(oRecipientSpan)}}}function onClose(oEventArgs){var oFromButton=getFromButton();if(oFromButton){oFromButton.set_IsPushed(false)}}function getCacheCallback(oResponse){var oCurrentWindow=Owa.Dom.Window.get_Current();if(!cbOeh(oResponse)){if(isDf(typeof(oCurrentWindow.getGlobalVariable("fFromMenuPendingRequest")))){oCurrentWindow.setGlobalVariable("fFromMenuPendingRequest",false)}return}var sResponse=oResponse.sBody.toString();var data=sResponse.split(";");if(0<data.length){tryUpdCC(CC_PR,data[0],REF);oCurrentWindow.setGlobalVariable("g_primaryRecipient",eval(data[0]))}if(1<data.length){tryUpdCC(CC_SC,data[1],REF);oCurrentWindow.setGlobalVariable("g_subscriptionRecipients",eval("new Array("+data[1]+")"))}if(2<data.length){tryUpdCC(CC_MRUC,data[2],REF);oCurrentWindow.setGlobalVariable("g_mruRecipients",eval("new Array("+data[2]+")"))}var oFromContextMenu=Owa.UIControls.FromContextMenu.create(true);oCurrentWindow.setGlobalVariable("oFromContextMenu",oFromContextMenu);oCurrentWindow.setGlobalVariable("g_fFromMenuCached",oFromContextMenu.fullyLoaded());oCurrentWindow.setGlobalVariable("g_fFromMenuPendingRequest",false);oFromContextMenu.showMenu()}Owa.UIControls.FromContextMenu.createClass("Owa.UIControls.FromContextMenu",Owa.UIControls.ContextMenu)})();g_fModuleLoaded[".\\uicontrols/FromContextMenu.js".toLowerCase()]=1;stJS("fedtmsg.js");