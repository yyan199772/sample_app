if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\components/forest.js".toLowerCase()])(function(){Owa.Components.ForestControl=function Owa$Components$ForestControl(){Owa.Components.ForestControl.constructBase(this);this.initialize()};Owa.Components.ForestControl.createClass("Owa.Components.ForestControl",Owa.Components.Control);var _oPrototype=Owa.Components.ForestControl.prototype;Owa.Components.ForestControl.prototype.initialize=function Owa$Components$ForestControl$initialize(){this._tr={};this._dfTr=0;this._dfId=0;this._fcsTr=0;Owa.Components.ForestControl.callBase(this,"initialize")};Owa.Components.ForestControl.prototype.dispose=function Owa$Components$ForestControl$dispose(){this.each(function(){this.dispose()});this._tr={};Owa.Components.ForestControl.callBase(this,"dispose")};_oPrototype.addTr=function Owa$Components$ForestControl$addTr(sN,oT){this._tr[sN]=oT;oT._frst=this;oT._nm=sN;if(oT.hsSelNd()&&!this.gtFcsTr())this.stFcsTr(sN);else oT._stFcs(0)};_oPrototype.rmTr=function Owa$Components$ForestControl$rmTr(sN){var oT=this.gtTr(sN);if(!oT)return;if(this.gtFcsTr()==oT)this.selDfN();delete this._tr[sN]};_oPrototype.svDfN=function Owa$Components$ForestControl$svDfN(){this._dfTr=this._fcsTr;this._dfId=this.gtFcsTr().gtSelNd().gtId()};_oPrototype.stFcsTr=function Owa$Components$ForestControl$stFcsTr(sN){var oT=this.gtFcsTr();if(oT&&oT._nm==sN)return;if(oT)oT._stFcs(0);this._fcsTr=sN;oT=this.gtFcsTr();if(oT)oT._stFcs(1)};_oPrototype.gtFcsTr=function Owa$Components$ForestControl$gtFcsTr(){if(this._fcsTr)return this.gtTr(this._fcsTr)};_oPrototype.gtTr=function Owa$Components$ForestControl$gtTr(sN){return this._tr[sN]};_oPrototype.selDfN=function Owa$Components$ForestControl$selDfN(){var oT=this.gtTr(this._dfTr);if(oT)oT.selNdById(this._dfId)};_oPrototype.each=function Owa$Components$ForestControl$each(oF){for(var sN in this._tr){oF.call(this._tr[sN])}};_oPrototype.clrHl=function Owa$Components$ForestControl$clrHl(){this.each(function(){this._clrHl()})};_oPrototype.clrDrpHl=function Owa$Components$ForestControl$clrDrpHl(){this.each(function(){this.clrDrpHl()})};_oPrototype.rfrshHl=function Owa$Components$ForestControl$rfrshHl(){this.each(function(){this._rfrshHl()})};_oPrototype.syncSelNHl=function Owa$Components$ForestControl$syncSelNHl(){this.each(function(){this._syncSelNHl()})};_oPrototype.qtEdtNd=function Owa$Components$ForestControl$qtEdtNd(){this.each(function(){this.qtEdtNd()})}})();g_fModuleLoaded[".\\components/forest.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/NotificationDialog.js".toLowerCase()])(function(){Type.createNamespace("Owa.UIControls");var _rgNotificationDialogs={};var _iNotificationDialogsCount=0;Owa.UIControls.NotificationDialog=function Owa$UIControls$NotificationDialog(oNotificationDialog,sContentId,sBodyId,rgButtons,sTitlebarButtonId){Owa.UIControls.NotificationDialog.constructBase(this,[oNotificationDialog.get_Id(),0,1,0,0,1,1]);this._isOpened=0;this._sSelectionClass="ntfyItmHL";this._oContent=$(sContentId);this._oBody=$(sBodyId);this._oClearIcon=this._oBody.getDescendantById("imgNtfyInfo").clone(true);this._sMultiItemsSelected=this._getAttribute("sMultiItemsSelected");this._fButtonAdjusted=0;this._fAllowMultiSelect=0;this._fSelectFirstItemOnShow=1;this._sTitlebarButtonId=sTitlebarButtonId;this._rgButtons=rgButtons;this._attachEvent(this._get_Element(),"mousedown",this._onMouseDown);this._attachEvent(this._get_Element(),"click",this._onClick);this._attachEvent(this._get_Element(),"dblclick",this._onDoubleClick);this._attachEvent(this._get_Element(),"contextmenu",new Function("return (0)"));var oActionTable=new Owa.Components.ClientActionTable(Owa.Utility.createDelegate(this,this._onAction));this._oHotKeyManager=new Owa.Components.HotKeyManagerPage(oActionTable,Owa.Components.Application.get_RootSubPage());this._oHotKeyManager.addHotKey(L_HkSel,"selectall").addHotKey("esc","hide").addHotKey("tab","tab").addHotKey("shift+tab","shifttab").addHotKey("enter","enter").addHotKey("down","down").addHotKey("up","up").addHotKey("end","end").addHotKey("home","home");this.get_OnClose().add(this._createCallback(this._onClose));this.get_OnShow().add(this._createCallback(this._onShow))};Owa.UIControls.NotificationDialog.getDialog=function Owa$UIControls$NotificationDialog$getDialog(sId){if(!_rgNotificationDialogs){return null}else{return _rgNotificationDialogs[sId]}};Owa.UIControls.NotificationDialog.addDialog=function Owa$UIControls$NotificationDialog$addDialog(sId,oDialog){if(_rgNotificationDialogs[sId]==null){_rgNotificationDialogs[sId]=oDialog;_iNotificationDialogsCount++}return _rgNotificationDialogs[sId]};Owa.UIControls.NotificationDialog.hideAllDialogs=function Owa$UIControls$NotificationDialog$hideAllDialogs(){var oRootWindow=Owa.Utility.getRootOwaWindow();var oCurrentWindow=Owa.Dom.Window.get_Current();if(!oCurrentWindow.equals(oRootWindow)){if(oRootWindow._domWindow.Owa&&oRootWindow._domWindow.Owa.UIControls&&oRootWindow._domWindow.Owa.UIControls.NotificationDialog){oRootWindow._domWindow.Owa.UIControls.NotificationDialog.hideAllDialogs()}}else{for(var sId in _rgNotificationDialogs){_rgNotificationDialogs[sId].hide()}}};Owa.UIControls.NotificationDialog.anyDialogsOpen=function Owa$UIControls$NotificationDialog$anyDialogsOpen(){for(var sId in _rgNotificationDialogs){if(_rgNotificationDialogs[sId].isOpened()){return true}}return false};Owa.UIControls.NotificationDialog.disposeAll=function Owa$UIControls$NotificationDialog$disposeAll(){for(var sId in _rgNotificationDialogs){_rgNotificationDialogs[sId].dispose()}};Owa.UIControls.NotificationDialog.prototype.dispose=function Owa$UIControls$NotificationDialog$dispose(){if(!this._disped){this._get_Element().detachAllEvents();this._detachEvent(this._get_Element().get_OwnerDocument(),"keydown",this._onKeyDown);this._rgButtons=null;this._disped=1;removeDialogFromList(this.get_Id());this._oHotKeyManager.dispose();Owa.UIControls.NotificationDialog.callBase(this,'dispose')}};Owa.UIControls.NotificationDialog.prototype.isOpened=function Owa$UIControls$NotificationDialog$isOpened(){return this._isOpened};Owa.UIControls.NotificationDialog.prototype.selectFirstItem=function Owa$UIControls$NotificationDialog$selectFirstItem(fFcs){var rg=this.getItems();if(!rg.length)return;this.unselectAllItems();this.selectItem(rg[0],1,fFcs)};Owa.UIControls.NotificationDialog.prototype.getItemById=function Owa$UIControls$NotificationDialog$getItemById(sId){var oItem=null;this._oContent.forEachChild(function(oChild){if(oChild.getAttribute("_lnk")=="1"&&oChild.get_IsShown()&&sId==oChild.get_Id())oItem=oChild});return oItem};Owa.UIControls.NotificationDialog.prototype.getItems=function Owa$UIControls$NotificationDialog$getItems(fIncludeHidden){var rg=[];this._oContent.forEachChild(function(oChild){if(oChild.getAttribute("_lnk")=="1"&&(fIncludeHidden||oChild.get_IsShown()))rg.push(oChild)});return rg};Owa.UIControls.NotificationDialog.prototype.getSelectedItem=function Owa$UIControls$NotificationDialog$getSelectedItem(){var rg=this.getItems();var rgS=[];for(var i=0;i<rg.length;i++)if(rg[i].getExpando("_sel"))rgS.push(rg[i]);return rgS};Owa.UIControls.NotificationDialog.prototype.unselectAllItems=function Owa$UIControls$NotificationDialog$unselectAllItems(){var rg=this.getItems();for(var i=0;i<rg.length;i++)this.selectItem(rg[i],0)};Owa.UIControls.NotificationDialog.prototype.selectItem=function Owa$UIControls$NotificationDialog$selectItem(o,f,fF){if(f)o.addCssClass(this._sSelectionClass);else o.removeCssClass(this._sSelectionClass);o.setExpando("_sel",f);var rgS=this.getSelectedItem();this._updateInfo(rgS);this._enableButtons(rgS.length);if(f&&fF){o.focus()}return rgS};Owa.UIControls.NotificationDialog.prototype.removeItems=function Owa$UIControls$NotificationDialog$removeItems(rgR){var iL=rgR.length;for(var i=0;i<iL;++i){rgR[i].remove(true)}this.updateTitlebarButton()};Owa.UIControls.NotificationDialog.prototype.hide=function Owa$UIControls$NotificationDialog$hide(){if(this.isOpened()){this._oHotKeyManager.set_Enabled(false);Owa.UIControls.NotificationDialog.callBase(this,"hide")}};Owa.UIControls.NotificationDialog.prototype.show=function Owa$UIControls$NotificationDialog$show(fR){if(!this.getItems().length||this.isOpened())return;this._prepareToShowDialog(fR);if(!this._get_Element().get_IsShown()){this._get_Element().set_IsShown(true)}if(!this._fButtonAdjusted){this._adjustButtons();this._fButtonAdjusted=1}var oB=this._getTitlebarButton();var iX=rmGtNBX(oB,this._get_Element());var iY=getNBY(oB);this._oHotKeyManager.set_Enabled(true);Owa.UIControls.NotificationDialog.callBase(this,"show",[iX,iY])};Owa.UIControls.NotificationDialog.prototype.toggleDialog=function Owa$UIControls$NotificationDialog$toggleDialog(){if(this.isOpened()){this.hide()}else{this.show()}};Owa.UIControls.NotificationDialog.prototype.setItemsHtml=function Owa$UIControls$NotificationDialog$setItemsHtml(sHTML){this._oContent.set_InnerHtml(sHTML)};Owa.UIControls.NotificationDialog.prototype.updateTitlebarButton=function Owa$UIControls$NotificationDialog$updateTitlebarButton(fForceHideTitlebarButton){var oB=this._getTitlebarButton();if(!oB){return}var iCnt=this.getItems().length;var isVis=oB.get_IsShown();oB.getDescendantById("spnRmT").set_TextContent(iCnt.toString());if((!iCnt&&isVis)||fForceHideTitlebarButton){showNotificationButton(this._sTitlebarButtonId,false)}else if(iCnt){if(isVis)showNotificationButton(this._sTitlebarButtonId,false);showNotificationButton(this._sTitlebarButtonId,true)}};Owa.UIControls.NotificationDialog.prototype._onMouseDown=function Owa$UIControls$NotificationDialog$_onMouseDown(e){var o=this._findItem(e.get_Target());if(!o)return;if(e.isCtrlKeyDown()&&this._fAllowMultiSelect){if(o.getExpando("_sel"))this.selectItem(o,0);else this.selectItem(o,1)}else{this.unselectAllItems();this.selectItem(o,1,1)}};Owa.UIControls.NotificationDialog.prototype._onClick=function Owa$UIControls$NotificationDialog$_onClick(e){var sC=e.get_Target().get_Id();var rgS=this.getSelectedItem();this._handleButtonPress(sC,rgS);e.preventDefault();e.cancelBubble()};Owa.UIControls.NotificationDialog.prototype._onDoubleClick=function Owa$UIControls$NotificationDialog$_onDoubleClick(e){};Owa.UIControls.NotificationDialog.prototype._onAction=function Owa$UIControls$NotificationDialog$_onAction(sAction,oContext){var rg=this.getItems();var iIdx=-1;var fIsShiftDown=false;for(var i=0;i<rg.length&&iIdx<0;i++)if(rg[i].getExpando("_sel"))iIdx=i;var fSel=(iIdx!=-1);var o=oContext;switch(sAction){case"selectall":this._selectAll();break;case"hide":this.hide();break;case"shifttab":fIsShiftDown=true;case"tab":if(!this._rgButtons||this._rgButtons.length==0){return}var iButton=0;var fIsFocusOnButton=false;for(var i=0;i<this._rgButtons.length;i++){if(o.get_Id()==this._rgButtons[i].get_Id()){iButton=i;fIsFocusOnButton=true;break}}if(fIsFocusOnButton){if((iButton==this._rgButtons.length-1&&!fIsShiftDown)||(iButton==0&&fIsShiftDown)){if(fSel)rg[iIdx].focus();else this.selectItem(rg[0],1,1)}else{var iNextButton=iButton+(fIsShiftDown?-1:1);if(iNextButton>=0&&iNextButton<this._rgButtons.length){this._rgButtons[iNextButton].focus()}}}break;case"enter":if(o.get_TagName().toLowerCase()=="button")return;if(this._onEnterPressed(o))return;break;case"down":if(iIdx==(rg.length-1))break;if(fSel){this.selectItem(rg[iIdx],0);this.selectItem(rg[iIdx+1],1,1)}else{this.selectItem(rg[0],1)}break;case"up":if(fSel&&(iIdx!=0)){this.selectItem(rg[iIdx],0);this.selectItem(rg[iIdx-1],1,1)}break;case"end":if(iIdx==(rg.length-1))break;if(fSel)this.selectItem(rg[iIdx],0);this.selectItem(rg[rg.length-1],1,1);break;case"home":if(iIdx==0)break;if(fSel)this.selectItem(rg[iIdx],0);this.selectItem(rg[0],1,1);break}};Owa.UIControls.NotificationDialog.prototype._selectAll=function Owa$UIControls$NotificationDialog$_selectAll(){if(this._fAllowMultiSelect){this.unselectAllItems();var rg=this.getItems();for(var i=0;i<rg.length;i++)this.selectItem(rg[i],1)}};Owa.UIControls.NotificationDialog.prototype._updateInfo=function Owa$UIControls$NotificationDialog$_updateInfo(rgS){var rS=0,rD=0,rL=0,rId=0,sTitle=0;var rI=this._oClearIcon;if(rgS.length==1){var o=rgS[0];if(this._itemId==o.get_Id())return;rI=o.getChildById("imgNtfyEnt").clone();rS=o.getChildById("divNtfyEntCol1").get_InnerHtml();rD=o.getAttribute("tf");if(!rD){rD=sTitle=o.getChildById("divNtfyEntCol2").get_TextContent()}rL=o.getAttribute("l");rId=o.get_Id()}else if(rgS.length){rS=this._sMultiItemsSelected}var oImageTag=this._oBody.getDescendantById("imgNtfyInfo");var oInfoArea=oImageTag.get_ParentElement();rI.set_Id(oImageTag.get_Id());oImageTag.remove(true);oInfoArea.insertAdjacentElement(Owa.ElementInsertionPoint.AfterBegin,rI);this._oBody.getDescendantById("divNtfyItmSb").set_InnerHtml(rS||"&nbsp;");this._oBody.getDescendantById("divNtfyItmTm").set_TextContent(rD||" ");this._oBody.getDescendantById("divNtfyItmLc").set_TextContent(rL||" ");if(sTitle){this._oBody.getDescendantById("divNtfyItmTm").setAttribute("title",sTitle)}this._itemId=rId};Owa.UIControls.NotificationDialog.prototype._findItem=function Owa$UIControls$NotificationDialog$_findItem(o){if(!this._oContent.contains(o))return 0;while(o&&o instanceof Owa.Dom.Element){if(o.getAttribute("_lnk")=="1")return o;o=o.get_ParentElement()}return 0};Owa.UIControls.NotificationDialog.prototype._enableButtons=function Owa$UIControls$NotificationDialog$_enableButtons(f){for(var i=0;i<this._rgButtons.length;i++){var oButton=this._rgButtons[i];if(oButton.getAttribute("preventDisable")&&oButton.getIntAttribute("preventDisable")){continue}if(f){oButton.addCssClass("cpt");if(!Owa.Utility.isIE())oButton.removeCssClass("dsbl")}else{oButton.removeCssClass("cpt");if(!Owa.Utility.isIE())oButton.addCssClass("dsbl")}oButton.set_IsDisabled(!f)}};Owa.UIControls.NotificationDialog.prototype._handleButtonPress=function Owa$UIControls$NotificationDialog$_handleButtonPress(sButtonId){};Owa.UIControls.NotificationDialog.prototype._prepareToShowDialog=function Owa$UIControls$NotificationDialog$_prepareToShowDialog(fR){var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(!oSubPageController)return;var oOwa=oSubPageController.getVariable("Owa");var oSubPage=Owa.PageHierarchy.getFolderViewSubPageFromSubPageController(oSubPageController);var oFilterContextMenu=oSubPage?oSubPage.get_FilterContextMenu():null;if(!oFilterContextMenu){return}if(oFilterContextMenu.get_FromMenu()&&oFilterContextMenu.get_FromMenu().fIsOpen){oFilterContextMenu.get_FromMenu()._suppressClose();this._fRestoreFocusToFilterMenu=true}else if(oFilterContextMenu.fIsOpen){oFilterContextMenu._suppressClose();this._fRestoreFocusToFilterMenu=true}};Owa.UIControls.NotificationDialog.prototype._onEnterPressed=function Owa$UIControls$NotificationDialog$_onEnterPressed(o){};Owa.UIControls.NotificationDialog.prototype._getTitlebarButton=function Owa$UIControls$NotificationDialog$_getTitlebarButton(){return $(this._sTitlebarButtonId)};Owa.UIControls.NotificationDialog.prototype._adjustButtons=function Owa$UIControls$NotificationDialog$_adjustButtons(){if(!Owa.Utility.isIE())return;for(var i=0;i<this._rgButtons.length;++i){var iW=this._rgButtons[i].get_OffsetWidth();if(100<iW)this._rgButtons[i].set_Width(iW*0.8)}};Owa.UIControls.NotificationDialog.prototype._onClose=function Owa$UIControls$NotificationDialog$_onClose(){this._isOpened=0;applyNotificationButtonStyle(0,this._sTitlebarButtonId);if(this._fRestoreFocusToFilterMenu){var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(!oSubPageController)return;var oSubPage=Owa.PageHierarchy.getFolderViewSubPageFromSubPageController(oSubPageController);var oFilterContextMenu=oSubPage?oSubPage.get_FilterContextMenu():null;if(oFilterContextMenu.get_FromMenu()&&oFilterContextMenu.get_FromMenu().fIsOpen)oFilterContextMenu.get_FromMenu()._enableClose();else if(oFilterContextMenu.fIsOpen)oFilterContextMenu._enableClose();this._fRestoreFocusToFilterMenu=false}};Owa.UIControls.NotificationDialog.prototype._onShow=function Owa$UIControls$NotificationDialog$_onShow(){applyNotificationButtonStyle(1,this._sTitlebarButtonId);if(this._fSelectFirstItemOnShow){this.selectFirstItem(0)}else{var rgSelectedItems=this.getSelectedItem();if(rgSelectedItems.length==1){rgSelectedItems[0].focus()}}this._isOpened=1};function removeDialogFromList(sId){if(_rgNotificationDialogs[sId]!=null){_rgNotificationDialogs[sId]=null;_iNotificationDialogsCount--}if(_iNotificationDialogsCount==0){_rgNotificationDialogs=null;_iNotificationDialogsCount=null}}Owa.UIControls.NotificationDialog.createClass("Owa.UIControls.NotificationDialog",Owa.UIControls.Dialog)})();g_fModuleLoaded[".\\uicontrols/NotificationDialog.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/buddydialog.js".toLowerCase()])(function(){var DIALOG_ID="divBddyDlg";Owa.UIControls.BuddyDialog=function Owa$UIControls$BuddyDialog(oBdyDlg){Owa.UIControls.BuddyDialog.constructBase(this,[oBdyDlg,"divBddyDtCnt","divBddyDlgBdy",new Array($("divBtnAcceptall"),$("divBtnDecline"),$("divBtnAccept")),Owa.Strings.Ids.BuddyRequestNotificationButtonId]);this._fSelectFirstItemOnShow=0};Owa.UIControls.BuddyDialog.getDialog=function Owa$UIControls$BuddyDialog$getDialog(){var oDialog=Owa.UIControls.NotificationDialog.getDialog(DIALOG_ID);if(oDialog==null){var oDialogDiv=$(DIALOG_ID);if(!oDialogDiv){return null}oDialog=Owa.UIControls.NotificationDialog.addDialog(DIALOG_ID,new Owa.UIControls.BuddyDialog(oDialogDiv))}return oDialog};Owa.UIControls.BuddyDialog.prototype.updateTitlebarButton=function Owa$UIControls$BuddyDialog$updateTitlebarButton(fHide){Owa.UIControls.BuddyDialog.callBase(this,'updateTitlebarButton',[fHide])};Owa.UIControls.BuddyDialog.prototype.addBuddies=function Owa$UIControls$BuddyDialog$addBuddies(rgContacts){if(!rgContacts||!rgContacts.length)return;var sHtml=this._oContent.get_InnerHtml();var oSel=this.getSelectedItem();var sBuddySelectedId=null;if(oSel&&oSel.length>0){sBuddySelectedId=oSel[0].get_Id()}for(var i=0;i<rgContacts.length;i++){var oBuddy=this.getItemById(rgContacts[i][0]);if(oBuddy)continue;sHtml+=this._constructItemHtml(rgContacts[i])}this._oContent.set_InnerHtml(sHtml);this.updateTitlebarButton();if(sBuddySelectedId){this.selectItem(this.getItemById(sBuddySelectedId),1,1)}else{this.selectFirstItem(1)}if(!this.isOpened()){this.show(0)}};Owa.UIControls.BuddyDialog.prototype.removeBuddy=function Owa$UIControls$BuddyDialog$removeBuddy(sBuddyAddress){if(!isDf(typeof(sBuddyAddress))||!sBuddyAddress||sBuddyAddress=="")return;var oCurrentlySelectedBuddy=this.getItemById(sBuddyAddress);if(!oCurrentlySelectedBuddy)return;var oNextBuddy=this._getNextSelected(sBuddyAddress);this.removeItems([oCurrentlySelectedBuddy]);this.updateTitlebarButton();if(!oNextBuddy)this.hide();else this.selectItem(oNextBuddy,1,1)};Owa.UIControls.BuddyDialog.prototype._handleButtonPress=function Owa$UIControls$BuddyDialog$_handleButtonPress(sButtonId,rgSelectedItems){switch(sButtonId){case"divBtnAcceptall":var rgAllItems=this.getItems();for(var i=0;i<rgAllItems.length;i++){accept(rgAllItems[i].get_Id(),rgAllItems[i].getAttribute("_type"))}break;case"divBtnDecline":decline(rgSelectedItems[0].get_Id(),rgSelectedItems[0].getAttribute("_type"));break;case"divBtnAccept":accept(rgSelectedItems[0].get_Id(),rgSelectedItems[0].getAttribute("_type"));break}};Owa.UIControls.BuddyDialog.prototype._getNextSelected=function Owa$UIControls$BuddyDialog$_getNextSelected(sBuddyAddress){var rgItems=this.getItems();if(rgItems.length==1)return 0;for(var i=0;i<rgItems.length;i++){if(rgItems[i].get_Id()==sBuddyAddress)return(i==rgItems.length-1)?rgItems[0]:rgItems[i+1]}return 0};Owa.UIControls.BuddyDialog.prototype._constructItemHtml=function Owa$UIControls$BuddyDialog$_constructItemHtml(rgContact){var sHtml="";if(rgContact&&!isSlfUri(rgContact[0])){var sImg=isOCSPrv()?"oc.png":"lvlogo.png";var iContactType=parseInt(rgContact[1]);switch(iContactType){case Owa.IM.BUDDY_TYPE.WindowsLive:sImg="lvlogo.png";break;case Owa.IM.BUDDY_TYPE.OfficeCommunicator:sImg="oc.png";break;case Owa.IM.BUDDY_TYPE.Yahoo:sImg="yahoo.png";break}sHtml="<DIV class=\"ntfyItmEnt\" _sel=\"0\" _lnk=\"1\" tabIndex=\"0\" id=\""+rgContact[0]+"\" _type=\""+rgContact[1]+"\">"+"<IMG src=\""+getThmF(sImg)+"\" id=\"imgNtfyEnt\" />"+"<DIV id=\"divNtfyEntCol1\">"+htmlEnc(rgContact[0])+"</DIV>"+"<DIV id=\"divNtfyEntCol2\" title=\""+rgContact[2]+"\">"+rgContact[2]+"</DIV>"+"</DIV>"}return sHtml};function processBuddyInvitation(sBuddyAddress,iType,sC){var oBuddy=new Owa.IM.Bdy(sBuddyAddress,sBuddyAddress,null,gtIMType(),sBuddyAddress);if(!isDf(typeof(oBuddy))||!oBuddy)return;var sUri=gtRcpIM(oBuddy);if(!sUri){noIMInfoErr();return}var oRCtx=new Object();oRCtx.sUri=sUri;oRCtx.prm1=sUri;oRCtx.iType=iType;sndIMReq(sC,cbBuddyInviteRequest,0,oRCtx)}function accept(sBuddyAddress,iType){if(!isDf(typeof(sBuddyAddress))||!sBuddyAddress||sBuddyAddress=="")return;processBuddyInvitation(sBuddyAddress,iType,IM_ACPT)}function decline(sBuddyAddress,iType){if(!isDf(typeof(sBuddyAddress))||!sBuddyAddress||sBuddyAddress=="")return;processBuddyInvitation(sBuddyAddress,iType,IM_DCL)}Owa.UIControls.BuddyDialog.createClass("Owa.UIControls.BuddyDialog",Owa.UIControls.NotificationDialog)})();g_fModuleLoaded[".\\uicontrols/buddydialog.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/colorpickercontextmenu.js".toLowerCase()])(function(){var COLORPICKER_MENU_COMMAND="pickColor";Owa.UIControls.ColorPickerContextMenu=function Owa$UIControls$ColorPickerContextMenu(oSubPage,oElement,oParent,iRows,iCols,fnColorProperties,sDefaultColor,fShowNoneButton,oDialogHelper){this.oColorPicker=new Owa.UIControls.ColorPicker(oSubPage,oElement,"",iRows,iCols,fnColorProperties,new Array(L_MrClrs,L_None),sDefaultColor,fShowNoneButton,oDialogHelper);if(oElement)oElement.appendChild(this.oColorPicker._get_Element());Owa.UIControls.ColorPickerContextMenu.constructBase(this,[oElement,oParent]);this.set_SubPage(oSubPage);this.oColorPicker.get_OnColorSelected().add(this._createCallback(this._onPickInternal))};Owa.UIControls.ColorPickerContextMenu.create=function Owa$UIControls$ColorPickerContextMenu$create(oSubPage,oElement,oParent,iRows,iCols,fnColorProperties,sDefaultColor,fShowNoneButton,oDialogHelper){var oContextMenu=new Owa.UIControls.ColorPickerContextMenu(oSubPage,oElement,oParent,iRows,iCols,fnColorProperties,sDefaultColor,fShowNoneButton,oDialogHelper);oContextMenu.initialize();return oContextMenu};Owa.UIControls.ColorPickerContextMenu.prototype.dispose=function Owa$UIControls$ColorPickerContextMenu$dispose(){this.oColorPicker.dispose();Owa.UIControls.ColorPickerContextMenu.callBase(this,"dispose")};Owa.UIControls.ColorPickerContextMenu.prototype._onPickInternal=function Owa$UIControls$ColorPickerContextMenu$_onPickInternal(oColorPicker){this._fireOnSelect({sCommand:COLORPICKER_MENU_COMMAND,oMenuItem:oColorPicker})};Owa.UIControls.ColorPickerContextMenu.createClass("Owa.UIControls.ColorPickerContextMenu",Owa.UIControls.ContextMenu)})();g_fModuleLoaded[".\\uicontrols/colorpickercontextmenu.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/remindersnoozetimecombobox.js".toLowerCase()])(function(){Owa.UIControls.ReminderSnoozeTimeComboBox=function Owa$UIControls$ReminderSnoozeTimeComboBox(oElement,oParent){Owa.UIControls.ReminderSnoozeTimeComboBox.constructBase(this,[oElement,oParent])};Owa.UIControls.ReminderSnoozeTimeComboBox.prototype.updateSnoozeTime=function Owa$UIControls$ReminderSnoozeTimeComboBox$prototype$updateSnoozeTime(iMaxSnoozeTime){var oValueToSelect=null;if(iMaxSnoozeTime>=0)oValueToSelect=(iMaxSnoozeTime>5?"-5":"0");for(var i=0;i<this._oDropDownList.getItemCount();i++){var iValue=getInt(this._oDropDownList.getValueByIndex(i));var oDomItem=this._oDropDownList.getDomItemByIndex(i);if(iValue<=0){oDomItem.set_IsShown(iMaxSnoozeTime+iValue>0||(iMaxSnoozeTime==0&&iValue==0))}else if(oValueToSelect==null){oValueToSelect=iValue.toString()}}this._selectValue(oValueToSelect)};Owa.UIControls.ReminderSnoozeTimeComboBox.createClass("Owa.UIControls.ReminderSnoozeTimeComboBox",Owa.UIControls.ComboBox)})();g_fModuleLoaded[".\\uicontrols/remindersnoozetimecombobox.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/reminderdialog.js".toLowerCase()])(function(){var DIALOG_ID="divRmdDlg";var CONST_MS_IN_1MIN=60000;Owa.UIControls.ReminderDialog=function Owa$UIControls$ReminderDialog(oRmdDlg){Owa.UIControls.ReminderDialog.constructBase(this,[oRmdDlg,"divRmdDtCnt","divRmdDlgBdy",new Array($("divBtnDismissall"),$("divBtnDismiss"),$("divBtnOpenReminder"),$("divBtnSnooze")),Owa.Strings.Ids.ReminderNotificationButtonId]);this._oRmdSnzDD=new Owa.UIControls.ReminderSnoozeTimeComboBox($("divRmdSnzDD"),null);this._oRmdSnzDD.set_SubPage(this.get_SubPage());this._oRmdSnzDD.initialize();this.dtLastReminderTime=0;this.iTimeDifference=0;this.fSoundEnabled=getInt(this._getAttribute("fSoundEnabled"));this.iTimeOffset=this._getAttribute("iTimeOffset");this._dtNextReminderTime=0;this._oNextReminderItem=0;this._dtLastRefreshTime=0;this._rgTimeUnits=this._getAttribute("rgTU").split(",");this._rgTimeUniteRegExp=new Array(/\{0\}/g,/\{1\}/g,/\{2\}/g,/\{3\}/g);this._iReminderTimer=0;this._iReminderDueInTimer=0;this._sNow=this._getAttribute("sNow");this._sTimeUnitDue=this._getAttribute("sTimeUnitDue");this._sTimeUnitOverdue=this._getAttribute("sTimeUnitOverdue");this._fAllowMultiSelect=1;this.get_OnShow().add(this._createCallback(this._adjustWidth))};Owa.UIControls.ReminderDialog.getDialog=function Owa$UIControls$ReminderDialog$getDialog(){var oDialog=Owa.UIControls.NotificationDialog.getDialog(DIALOG_ID);if(oDialog==null){var oDialogDiv=$(DIALOG_ID);if(!oDialogDiv){return null}oDialog=Owa.UIControls.NotificationDialog.addDialog(DIALOG_ID,new Owa.UIControls.ReminderDialog(oDialogDiv))}return oDialog};Owa.UIControls.ReminderDialog.prototype.dispose=function Owa$UIControls$ReminderDialog$dispose(){Owa.UIControls.ReminderDialog.callBase(this,'dispose');if(!this._disped||this._disped<=1){this._clearTimer();this._clearDueInTimer();this._oRmdSnzDD.dispose();this._disped++}};Owa.UIControls.ReminderDialog.prototype.setItemsHtml=function Owa$UIControls$ReminderDialog$setItemsHtml(sHTML){Owa.UIControls.ReminderDialog.callBase(this,'setItemsHtml',[sHTML]);var oRmdDlg=this;this._oContent.forEachChild(function(oChild){oChild.getChildById("divNtfyEntCol2").set_InnerHtml(oRmdDlg._getReminderItemDueIn(oChild))})};Owa.UIControls.ReminderDialog.prototype.removeItems=function Owa$UIControls$ReminderDialog$removeItems(rgR,iOp,rgU){if(!iOp)iOp=OP_DIS;var iL=rgR.length-1;for(var i=0;i<rgR.length;++i){if(i==iL){var rgItems=this.getItems();this.nxtSelId=null;if(rgItems.length>1)for(var j=0;j<rgItems.length;j++)if(rgItems[j].get_Id()==rgR[i].get_Id())this.nxtSelId=(j==rgItems.length-1)?rgItems[j-1].get_Id():rgItems[j+1].get_Id()}var fD=rgU&&rgU[i].fD;this._removeReminderItem(rgR[i],iOp,fD);if(rgU&&!fD){rgR[i].setAttribute("ck",rgU[i].ck);rgR[i].setAttribute("r",rgU[i].r)}}this.setReminderTimer();this.updateTitlebarButton()};Owa.UIControls.ReminderDialog.prototype.selectItem=function Owa$UIControls$ReminderDialog$selectItem(o,f,fF){var rgS=Owa.UIControls.ReminderDialog.callBase(this,'selectItem',[o,f,fF]);this._oRmdSnzDD.updateSnoozeTime(this.getMaxSnoozeTime());this._oRmdSnzDD.set_IsEnabled(rgS.length>0)};Owa.UIControls.ReminderDialog.prototype.showError=function Owa$UIControls$ReminderDialog$showError(s){this._getDescendant("divRmdErrTxt").set_TextContent(s);this._getDescendant("divRmdErr").set_IsShown(!!s)};Owa.UIControls.ReminderDialog.prototype.setReminderTimer=function Owa$UIControls$ReminderDialog$setReminderTimer(){this._clearTimer();this._updateReminderItemsRNT()};Owa.UIControls.ReminderDialog.prototype.getUTCDifference=function Owa$UIControls$ReminderDialog$getUTCDifference(){var browserNow=new Date();var clientNow=new Date();var browserTZoffset=browserNow.getTimezoneOffset();var browserUTCNow=new Date(Date.UTC(browserNow.getFullYear(),browserNow.getMonth(),browserNow.getDate(),browserNow.getHours(),browserNow.getMinutes(),browserNow.getSeconds()));clientNow.setTime(browserUTCNow.getTime()+((browserTZoffset+this.iTimeOffset)*60000)+this.iTimeDifference);return clientNow};Owa.UIControls.ReminderDialog.prototype.getMaxSnoozeTime=function Owa$UIControls$ReminderDialog$getMaxSnoozeTime(){var rgSelectedItems=this.getSelectedItem();var now=this.getUTCDifference();var dtStartTime=0;var fNotStart=0;if(rgSelectedItems.length==1){var o=rgSelectedItems[0];dtStartTime=new Date(o.getAttribute("t"));if(dtStartTime>now&&isCal(o.getAttribute("c")))fNotStart=1}if(fNotStart)return Math.round((dtStartTime-now)/CONST_MS_IN_1MIN);else return -1};Owa.UIControls.ReminderDialog.prototype.refresh=function Owa$UIControls$ReminderDialog$refresh(f){var rg=this.getItems();if(!rg.length)return;var dt=this.getUTCDifference();var nDiff=dt-this._dtLastRefreshTime;if(nDiff>=20000||f){for(var i=0;i<rg.length;i++)rg[i].getChildById("divNtfyEntCol2").set_InnerHtml(this._getReminderItemDueIn(rg[i]));this._dtLastRefreshTime=dt}};Owa.UIControls.ReminderDialog.prototype._onDoubleClick=function Owa$UIControls$ReminderDialog$_onDoubleClick(e){var o=this._findItem(e.get_Target());if(!o)return;this._openReminderItems(new Array(o))};Owa.UIControls.ReminderDialog.prototype._adjustWidth=function Owa$UIControls$ReminderDialog$_adjustWidth(){var iWidth=this._getDescendant("divBtnDismissall").get_ClientWidth()+this._getDescendant("divBtnDismiss").get_ClientWidth()+this._getDescendant("divBtnOpenReminder").get_ClientWidth();var iPaddingAndMargin=86;iWidth+=iPaddingAndMargin;if(iWidth>this._get_Element().get_Width()){this._get_Element().set_Width(iWidth);var oB=this._getTitlebarButton();var iX=rmGtNBX(oB,this._get_Element());var iY=getNBY(oB);this._get_Element().set_Left(iX);this._get_Element().set_Top(iY)}};Owa.UIControls.ReminderDialog.prototype._handleButtonPress=function Owa$UIControls$ReminderDialog$_handleButtonPress(sButtonId,rgSelectedItems){switch(sButtonId){case"divBtnSnooze":procRm(OP_SNZ,"Snooze",rgSelectedItems,this.dtLastReminderTime,this._oRmdSnzDD.get_SelectedValue());break;case"divBtnDismiss":procRm(OP_DIS,"Dismiss",rgSelectedItems,this.dtLastReminderTime);break;case"divBtnDismissall":procRm(OP_DIS,"Dismiss",this.getItems());break;case"divBtnOpenReminder":this._openReminderItems(rgSelectedItems);break}};Owa.UIControls.ReminderDialog.prototype._prepareToShowDialog=function Owa$UIControls$ReminderDialog$_prepareToShowDialog(fR){this.refresh(fR);this._setDueInReminderTimer();Owa.UIControls.ReminderDialog.callBase(this,"_prepareToShowDialog")};Owa.UIControls.ReminderDialog.prototype._onEnterPressed=function Owa$UIControls$ReminderDialog$_onEnterPressed(o){if(o.getAncestorById("divRmdSnzDD",DIALOG_ID))return true;this._openReminderItems(this.getSelectedItem())};Owa.UIControls.ReminderDialog.prototype._removeReminderItem=function Owa$UIControls$ReminderDialog$_removeReminderItem(o,iOp,fD){if(this._oNextReminderItem==o)this._clearTimer();if(iOp==OP_DIS||fD){o.remove(true)}else{o.set_IsShown(false);this.selectItem(o,0)}};Owa.UIControls.ReminderDialog.prototype._clearDueInTimer=function Owa$UIControls$ReminderDialog$_clearDueInTimer(){if(this._iReminderDueInTimer){this._clearInterval(this._iReminderDueInTimer);this._iReminderDueInTimer=0}};Owa.UIControls.ReminderDialog.prototype._clearTimer=function Owa$UIControls$ReminderDialog$_clearTimer(){if(this._iReminderTimer){this._clearTimeout(this._iReminderTimer);this._iReminderTimer=0}};Owa.UIControls.ReminderDialog.prototype._setDueInReminderTimer=function Owa$UIControls$ReminderDialog$_setDueInReminderTimer(){this._clearDueInTimer();this._iReminderDueInTimer=this._setInterval(this._updateReminderItemsDueIn,30000)};Owa.UIControls.ReminderDialog.prototype._updateReminderItemsDueIn=function Owa$UIControls$ReminderDialog$_updateReminderItemsDueIn(){if(this.isOpened())this.refresh()};Owa.UIControls.ReminderDialog.prototype._updateReminderItemsRNT=function Owa$UIControls$ReminderDialog$_updateReminderItemsRNT(){var rg=this.getItems(true);var nowUTC=this.getUTCDifference();var maxY=4501;var nextRm=0;for(var i=0;i<rg.length;i++){var o=rg[i];var rnt=new Date(o.getAttribute("r"));var dueBy=new Date(o.getAttribute("t"));if(rnt.getYear()==maxY)continue;if(nowUTC<rnt){nextRm=o;o.setExpando("_sel",0);o.set_IsShown(false)}else{if(!o.get_IsShown()){if(nowUTC<dueBy&&!o.getExpando("fired"))this._showActiveReminder(o);else o.set_IsShown(true)}}}if(nextRm){this._dtNextReminderTime=new Date(nextRm.getAttribute("r"));this._iReminderTimer=this._setTimeout(this._fireReminders,this._dtNextReminderTime-nowUTC)}this.updateTitlebarButton();this._oNextReminderItem=nextRm};Owa.UIControls.ReminderDialog.prototype._fireReminders=function Owa$UIControls$ReminderDialog$_fireReminders(){this._iReminderTimer=0;this._showActiveReminder(this._oNextReminderItem);this.setReminderTimer()};Owa.UIControls.ReminderDialog.prototype._showActiveReminder=function Owa$UIControls$ReminderDialog$_showActiveReminder(o){this.selectItem(o,1,1);o.getChildById("divNtfyEntCol2").set_InnerHtml(this._getReminderItemDueIn(o));o.set_IsShown(true);this.updateTitlebarButton();if(!this.isOpened())this.show(1);if(this.fSoundEnabled)plySnd();o.setExpando("fired")};Owa.UIControls.ReminderDialog.prototype._getReminderItemDueIn=function Owa$UIControls$ReminderDialog$_getReminderItemDueIn(o){var dtNow=this.getUTCDifference();var dtDue=new Date(o.getAttribute("t"));var sDue="";var iM=(dtDue-dtNow)/CONST_MS_IN_1MIN;if(0<iM){iM=Math.floor(iM);sDue=this._sTimeUnitDue}else{iM=Math.ceil(iM);iM=-iM;sDue=this._sTimeUnitOverdue}if(iM==0){return this._sNow}else{var rgD=new Array(4);rgD[3]=rgD[2]=rgD[1]=0;rgD[0]=Math.floor(iM/(7*24*60));if(2>rgD[0]){rgD[1]=Math.floor(iM/(24*60))%7;if(2>rgD[1]&&0==rgD[0]){rgD[2]=Math.floor(iM/60)%24;if(8>=rgD[2]&&0==rgD[1])rgD[3]=Math.floor(iM)%60}}var f=1;var u=0;for(var i=0;i<4;i++,u+=3){var s="";if(0!=rgD[i]){if(!f)sDue+=" ";else f=0;var re1=new RegExp(this._getAttribute("re1"),"gi");var re2=new RegExp(this._getAttribute("re2"),"gi");var idx=(re1.test(rgD[i]))?0:re2.test(rgD[i])?1:2;s=(this._rgTimeUnits[u+idx].replace(/\{0\}/,rgD[i]))}sDue=sDue.replace(this._rgTimeUniteRegExp[i],s)}}return sDue};Owa.UIControls.ReminderDialog.prototype._openReminderItems=function Owa$UIControls$ReminderDialog$_openReminderItems(rgS){for(var i=0;i<rgS.length;i++){var sAe="Item";var t=rgS[i].getAttribute("c");if(isCal(t))sAe="PreFormAction";var sUrl="?ae="+sAe;sUrl+="&a=Open";sUrl+="&t="+urlEnc(t);var id=getReminderItemId(rgS[i]);if(rgS[i].getAttribute("oid"))id=rgS[i].getAttribute("oid");sUrl+="&id="+urlEnc(id);openItm(sUrl,null,null,null,null,this.get_SubPage())}};Owa.UIControls.ReminderDialog.prototype._onClose=function Owa$UIControls$ReminderDialog$_onClose(){Owa.UIControls.ReminderDialog.callBase(this,"_onClose");this._clearDueInTimer();this._oRmdSnzDD.hideDropDown()};Owa.UIControls.ReminderDialog.createClass("Owa.UIControls.ReminderDialog",Owa.UIControls.NotificationDialog)})();g_fModuleLoaded[".\\uicontrols/reminderdialog.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/CalendarContextMenu.js".toLowerCase()])(function(){var COLORPICKER_ID="divCalPkr";var NONE_COLOR=-2;Owa.UIControls.CalendarContextMenu=function Owa$UIControls$CalendarContextMenu(oElement,oParent){Owa.UIControls.CalendarContextMenu.constructBase(this,[oElement,oParent])};Owa.UIControls.CalendarContextMenu.create=function Owa$UIControls$CalendarContextMenu$create(oElement,oParent,oSubPage){var oContextMenu=new Owa.UIControls.CalendarContextMenu(oElement,oParent);oContextMenu.set_SubPage(oSubPage);oContextMenu.initialize();return oContextMenu};Owa.UIControls.CalendarContextMenu.prototype._createSubmenu=function Owa$UIControls$CalendarContextMenu$_createSubmenu(oSubmenuElement){if(oSubmenuElement.get_Id()==COLORPICKER_ID){return Owa.UIControls.ColorPickerContextMenu.create(this.get_SubPage(),oSubmenuElement,this,5,3,getColorPropertyForContextMenu,NONE_COLOR,true,null)}else{return Owa.UIControls.CalendarContextMenu.callBase(this,"_createSubmenu")}};function getColorPropertyForContextMenu(iRow,iColumn,iRowCount,iColumnCount){var colorIndexStart=$(COLORPICKER_ID).getIntAttribute("_colorIndexStart");var index=iRow*iColumnCount+iColumn+colorIndexStart;return{sClass:"cal"+index,sValue:index}}Owa.UIControls.CalendarContextMenu.createClass("Owa.UIControls.CalendarContextMenu",Owa.UIControls.ContextMenu)})();g_fModuleLoaded[".\\uicontrols/CalendarContextMenu.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/NewItemAlertDialog.js".toLowerCase()])(function(){var _oNewItemDialog=null;var _oTimer=0;var ID_NWITMDLG="idNewItmDlg";Owa.UIControls.NewItemAlertDialog=function Owa$UIControls$NewItemAlertDialog(sButtonId,sFrom,sSubject,sIconPath,fnOnClose,fnOnClick){var sHtml="<div id=\"divNwItmDlg\"><div class=\"nwItmFrstLn\"><img class=\"nwItmImg\" src=\""+sIconPath+"\"><span class=\"nwItmTxtFrm\">"+sFrom+"</span></div><span class=\"nwItmTxtSbj\">"+sSubject+"</span></div>";Owa.UIControls.NewItemAlertDialog.constructBase(this,[ID_NWITMDLG,sHtml,1,0]);this._fSuppressCloseCallback=0;this._fnOnClose=fnOnClose;this._fnOnClick=fnOnClick;this._oNavigationButton=$(sButtonId);this._attachEvent(this._get_Element(),"click",this._onClick);this.get_OnClose().add(this._createCallback(this._onClose));_oNewItemDialog=this};Owa.UIControls.NewItemAlertDialog.hideDialog=function Owa$UIControls$NewItemAlertDialog$hideDialog(fSuppressCloseCallback){if(_oNewItemDialog){_oNewItemDialog._fSuppressCloseCallback=fSuppressCloseCallback?1:0;_oNewItemDialog.hide()}};Owa.UIControls.NewItemAlertDialog.isType=function Owa$UIControls$NewItemAlertDialog$isType(sId){if(_oNewItemDialog&&_oNewItemDialog._oNavigationButton&&_oNewItemDialog._oNavigationButton.get_Id()==sId){return true}return false};Owa.UIControls.NewItemAlertDialog.clearTimer=function Owa$UIControls$NewItemAlertDialog$clearTimer(){if(_oTimer){window.clearTimeout(_oTimer);_oTimer=0}};Owa.UIControls.NewItemAlertDialog.setTimer=function Owa$UIControls$NewItemAlertDialog$setTimer(delegate,iTimeoutInterval){_oTimer=window.setTimeout(delegate,iTimeoutInterval)};Owa.UIControls.NewItemAlertDialog.prototype.show=function Owa$UIControls$NewItemAlertDialog$show(){var iX=getNBX(this._oNavigationButton)+(g_fRtl?0:-$(ID_NWITMDLG).get_OffsetWidth());var iY=getNBY(this._oNavigationButton);Owa.UIControls.NewItemAlertDialog.callBase(this,'show',[iX,iY]);applyNotificationButtonStyle(1,this._oNavigationButton.get_Id())};Owa.UIControls.NewItemAlertDialog.prototype._onClick=function Owa$UIControls$NewItemAlertDialog$_onClick(){this._fnOnClick(this._oNavigationButton.get_Id());this.hide()};Owa.UIControls.NewItemAlertDialog.prototype._onClose=function Owa$UIControls$NewItemAlertDialog$_onClose(){applyNotificationButtonStyle(0,this._oNavigationButton.get_Id());if(!this._fSuppressCloseCallback)this._fnOnClose();_oNewItemDialog=null};Owa.UIControls.NewItemAlertDialog.createClass("Owa.UIControls.NewItemAlertDialog",Owa.UIControls.Dialog)})();g_fModuleLoaded[".\\uicontrols/NewItemAlertDialog.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/ActiveChatsDialog.js".toLowerCase()])(function(){var DIALOG_ID="divActChtsDlg";var CHAT_ID_PREFIX="cht";var PULSES=2;var FADE_TIME=1000;var PULSE_TIME=100;Owa.UIControls.ActiveChatsDialog=function Owa$UIControls$ActiveChatsDialog(oActiveChatsDlg){Owa.UIControls.ActiveChatsDialog.constructBase(this,[oActiveChatsDlg,"divActChtsDtCnt","divActChtsDlgBdy",new Array($("divBtnOpen")),Owa.Strings.Ids.ActiveChatsNotificationButtonId]);this._fSelectFirstItemOnShow=0;this._oBackgroundFader=new Owa.Components.BackgroundFader($(Owa.Strings.Ids.ActiveChatsNotificationButtonId),PULSES,FADE_TIME,PULSE_TIME)};Owa.UIControls.ActiveChatsDialog.getDialog=function Owa$UIControls$ActiveChatsDialog$getDialog(){var oDialog=Owa.UIControls.NotificationDialog.getDialog(DIALOG_ID);if(oDialog==null){var oDialogDiv=$(DIALOG_ID);if(!oDialogDiv){return null}oDialog=Owa.UIControls.NotificationDialog.addDialog(DIALOG_ID,new Owa.UIControls.ActiveChatsDialog(oDialogDiv))}return oDialog};Owa.UIControls.ActiveChatsDialog.prototype.updateTitlebarButton=function Owa$UIControls$ActiveChatsDialog$updateTitlebarButton(fHide){Owa.UIControls.ActiveChatsDialog.callBase(this,'updateTitlebarButton',[fHide])};Owa.UIControls.ActiveChatsDialog.prototype.addChat=function Owa$UIControls$ActiveChatsDialog$addChat(sChatId,sDisplayName,sContactType,sLatestMessage){if(sLatestMessage==null){sLatestMessage=""}var sHtml=this._constructItemHtml(sChatId,sDisplayName,sContactType,sLatestMessage);this._oContent.set_InnerHtml(sHtml+this._oContent.get_InnerHtml());this.updateTitlebarButton();this.selectFirstItem(0)};Owa.UIControls.ActiveChatsDialog.prototype.removeChat=function Owa$UIControls$ActiveChatsDialog$removeChat(sChatId,fNeverHideDialog){if(sChatId==null||sChatId=="")return;var oChatToRemove=this.getItemById(formalizeChatId(sChatId));if(!oChatToRemove)return;this.removeItems([oChatToRemove]);this.updateTitlebarButton();var iNumItems=this.getItems().length;var oSel=this.getSelectedItem();if(iNumItems>0&&oSel&&oSel.length==0){this.selectFirstItem(0)}if(!fNeverHideDialog&&iNumItems==0){this.hide()}};Owa.UIControls.ActiveChatsDialog.prototype.updateChat=function Owa$UIControls$ActiveChatsDialog$updateChat(sOldChatId,sNewChatId,sNewDisplayName,sNewLatestMessage){var oChatItem=this.getItemById(formalizeChatId(sOldChatId));if(!oChatItem)return;var sType=oChatItem.getAttribute("_type");if(sNewChatId==null||sNewChatId==""){sNewChatId=sOldChatId}if(!sNewDisplayName||sNewDisplayName==""){sNewDisplayName=oChatItem.getChildById("divNtfyEntCol1").get_TextContent()}if(!sNewLatestMessage||sNewLatestMessage==""){sNewLatestMessage=oChatItem.getChildById("divNtfyEntCol2").get_TextContent()}this.removeChat(sOldChatId,true);this.addChat(sNewChatId,sNewDisplayName,sType,sNewLatestMessage)};Owa.UIControls.ActiveChatsDialog.prototype.updateParticipants=function Owa$UIControls$ActiveChatsDialog$updateParticipants(sChatId,sNewParticipants){var oChatItem=this.getItemById(formalizeChatId(sChatId));if(!oChatItem||sNewParticipants=="")return;oChatItem.getChildById("divNtfyEntCol1").set_TextContent(sNewParticipants);if(oChatItem.getExpando("_sel")){this._itemId=null;this._updateInfo([oChatItem])}};Owa.UIControls.ActiveChatsDialog.prototype.fadeInFadeOut=function Owa$UIControls$ActiveChatsDialog$fadeInFadeOut(){var sSelectionColor=getStyle("trDrgEff").backgroundColor;var sNavigationBackgroundColor=gtStl($("divSecNv")._get_DomNode())["backgroundColor"];this._oBackgroundFader.fadeInFadeOut(sSelectionColor,sNavigationBackgroundColor,1)};Owa.UIControls.ActiveChatsDialog.prototype.show=function Owa$UIControls$ActiveChatsDialog$show(){if(!this.isOpened()){Owa.UIControls.ActiveChatsDialog.callBase(this,'show',[0])}};Owa.UIControls.ActiveChatsDialog.prototype._onDoubleClick=function Owa$UIControls$ActiveChatsDialog$_onDoubleClick(e){var o=this._findItem(e.get_Target());if(!o)return;this._openWindow(normalizeChatId(o.get_Id()))};Owa.UIControls.ActiveChatsDialog.prototype._openWindow=function Owa$UIControls$ActiveChatsDialog$_openWindow(sChatId){var oChtSsn=gtIMMgr().GtChtSsn(sChatId);if(oChtSsn){oChtSsn.OpenWindow()}else{this.removeChat(sChatId)}};Owa.UIControls.ActiveChatsDialog.prototype._handleButtonPress=function Owa$UIControls$ActiveChatsDialog$_handleButtonPress(sButtonId,rgSelectedItems){switch(sButtonId){case"divBtnOpen":if(rgSelectedItems&&rgSelectedItems.length!=0){this._openWindow(normalizeChatId(rgSelectedItems[0].get_Id()))}break}};Owa.UIControls.ActiveChatsDialog.prototype._constructItemHtml=function Owa$UIControls$ActiveChatsDialog$_constructItemHtml(sChatId,sDisplayName,sContactType,sLatestMessage){var sHtml="";var sImg=isOCSPrv()?"oc.png":"lvlogo.png";var iContactType=parseInt(sContactType);switch(iContactType){case Owa.IM.BUDDY_TYPE.WindowsLive:sImg="lvlogo.png";break;case Owa.IM.BUDDY_TYPE.OfficeCommunicator:sImg="oc.png";break;case Owa.IM.BUDDY_TYPE.Yahoo:sImg="yahoo.png";break}var sEncLatestMessage=htmlEnc(sLatestMessage);sHtml="<DIV class=\"ntfyItmEnt\" _sel=\"0\" _lnk=\"1\" tabIndex=\"0\" id=\""+formalizeChatId(sChatId)+"\" _type=\""+sContactType+"\">"+"<IMG src=\""+getThmF(sImg)+"\" id=\"imgNtfyEnt\" />"+"<DIV id=\"divNtfyEntCol1\">"+htmlEnc(sDisplayName)+"</DIV>"+"<DIV id=\"divNtfyEntCol2\" title=\""+sEncLatestMessage+"\">"+sEncLatestMessage+"</DIV>"+"</DIV>";return sHtml};function formalizeChatId(sChatId){return Owa.IM.IMUtils.FormalizeString(CHAT_ID_PREFIX,sChatId)}function normalizeChatId(sPrefixedChatId){return Owa.IM.IMUtils.NormalizeString(CHAT_ID_PREFIX,sPrefixedChatId)}Owa.UIControls.ActiveChatsDialog.createClass("Owa.UIControls.ActiveChatsDialog",Owa.UIControls.NotificationDialog)})();g_fModuleLoaded[".\\uicontrols/ActiveChatsDialog.js".toLowerCase()]=1;var CACHE_MAX=8;var g_oPrfCnsl=null;var AE_F="Folder";var AE_AL="AddressList";var TR="divTr";var CLR_NONE=-2;var ID_DFTDOCM="ifDftDcMId";var g_rgsLFids=[];var g_sLstPFT=0;var g_fShwNMBtn=0;var g_fShwNVMBtn=0;var g_fShwNFBtn=0;var g_fShwPndGtErr=0;var g_fShwPllErr=0;var g_sMId="";var g_sVMId="";var g_sFId="";var g_fAB=false;var g_iPllInt=0;var g_iPllPrdMs=0;var g_oRmPllTmOut=0;var g_iRmPllPrdMs=0;var g_fNwMl=0;var g_fNwVMl=0;var g_fNwFx=0;var M_MAIL="Mail";var M_CAL="Calendar";var M_CTS="Contacts";var M_TSK="Tasks";var M_DOC="Documents";var M_PF="PublicFolders";var g_rgActM=[];var OP_DIS=0;var OP_SNZ=1;var EXPND_HAS_RPLC="_fHasReplicaOfSameVrsn";var g_oHelpMenu=null;var g_oLinksMenu=null;var g_oPresenceMenu=null;var g_oDatePickerManger=new PckMgr();var g_sExpIco;var g_sClpsIco;var g_oOpnLocDlg=null;var g_fPLvLd=0;var g_oPblcFldrTree=null;var g_oMMFrst;var g_oCalTr;var g_oCntTr;var g_oTskTr;var g_oFolderTreeMenu;var g_oPublicFolderTreeMenu;var g_oNavigationTreeMenu;var DEFAULT_CALENDAR_CLASS="trDefCalNd";var g_rgTreeRegion=[];var g_oNE=0;var g_rgLiveHeaderContextMenus=[];if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\components/navigationUtility.js".toLowerCase()])(function(){Type.createNamespace("Owa.Pages");Owa.Pages.NavigationPage=function Owa$Pages$NavigationPage(oElement){if(isAB()){this._fSupportHostSubPages=false}Owa.Pages.NavigationPage.constructBase(this,[oElement]);this._fIsStartPage=isDf(typeof(a_fStPg))&&a_fStPg;this._fCloseOnEsc=!this._fIsStartPage};var _oPrototype=Owa.Pages.NavigationPage.prototype;_oPrototype._fSupportHostSubPages=true;_oPrototype.initialize=function Owa$Pages$NavigationPage$initialize(){Owa.Pages.NavigationPage.callBase(this,"initialize");stIMEnabFlg();if(!createMasterWindowCookies()){return}var rgSubPageControllers=[];var sUniqueId=this.get_SubPageController().get_UniqueId();$("divMainView").forEachChild(function(oChild){var oSubPageController=Owa.Components.SubPageControllerFactory.getControllerByElement(oChild);Owa.Components.SubPageControllerFactory.get_CurrentWindowSubPageController().addChildController(oSubPageController);oSubPageController.initialize()});var oDocument=Owa.Dom.Document.get_Current();oDocument.attachEvent("selectstart",onSLSUnav);g_oEd.attachEvent("MarkAllAsRead",null,"cbOnMkAllRd");g_oEd.attachEvent("CopyItems",null,"cbCpMvItms");g_oEd.attachEvent("MoveItems",null,"cbCpMvItms");g_oEd.attachEvent("RenameNavigation",null,"onRenameNavigation");g_oEd.attachEvent("RenameFolder",null,"onRenameFolder");g_iLgn=2;g_sExpIco=getThmF("expnd.gif");g_sClpsIco=getThmF("cllps.gif");this._attachEvent($("divNavHostBody"),"mousedown",navigationResizeStart);Owa.Components.ToolbarCollection.get(this.get_SubPage()).addToolbars(["divAlertBar"],this.get_ActionTable());g_fAB=isAB();if(!g_fAB){g_rgsLFids[NM_MAIL]=a_sInbx;g_rgsLFids[NM_CTS]=a_sCtcts;g_rgsLFids[NM_TSK]=a_sTsks;g_rgsLFids[NM_PF]=a_sPFrt}if(g_fAB)initAB();switch(a_iNM){case NM_CAL:onNavCal();break;case NM_MAIL:onNavMail();break;case NM_AB:case NM_CTS:onNavCnt();break;case NM_TSK:onNavTsk();break;case NM_PF:onNavPF();break}chgAbLvSt(1);if(g_fAB)return;g_oHelpMenu=Owa.UIControls.ContextMenu.create($("divHelpContextMenu"),null,this.get_SubPage());g_oHelpMenu.get_OnSelect().add(onHelpCMLnk);g_oHelpMenu.get_OnClose().add(onHelpCMHid);if(Owa.Utility.isDefined(typeof(a_rgLiveHeaderMenuLinks))&&(a_rgLiveHeaderMenuLinks.length>0)){for(var i=0;i<a_rgLiveHeaderMenuLinks.length;i++){var oLink=$(a_rgLiveHeaderMenuLinks[i]);if(oLink){var sMenuId=oLink.getAttribute("_menuId");var oMenu=$(sMenuId);if(oMenu){var oContextMenu=Owa.UIControls.ContextMenu.create(oMenu);oContextMenu.get_OnSelect().add(onSelectLiveHeaderMenuLink);g_rgLiveHeaderContextMenus[a_rgLiveHeaderMenuLinks[i]]=oContextMenu}oLink.attachEvent("click",openLiveHeaderMenu)}}}var oDivFindSomeone=$(TO);if(oDivFindSomeone){this.oFindSomeoneControl=Owa.UIControls.FindSomeone.create(getNavigationPage(),oDivFindSomeone)}initIMSP();if(a_isMstr){window.setTimeout(updSrvRcpCch,RCP_CCH_TM)}window.setTimeout(setBrandbarPosition,1);window.setTimeout(positionMailboxQuotaBar,1);if(a_fPullNotif)window.setTimeout(stPollN,30000);if(a_fPushNotif)window.setTimeout(stPollN,30000);if(isDf(typeof(a_oPndGt))){window.setTimeout(stPndGt,1)}setAlertBarWidth();if(Owa.PageHierarchy.isInStartPage()){Owa.Dom.Window.get_Current().setTimeout(initCC,500);restartMapiNotificationsResetTimer()}addPerfMarker("Navigation.Init.End")};_oPrototype.dispose=function Owa$Pages$NavigationPage$dispose(){expireMasterWindowCookies();g_oDatePickerManger.dispose();for(var i=0;i<g_rgTreeRegion.length;i++){var oTreeRegion=g_rgTreeRegion[i];oTreeRegion.detachAllEvents();oTreeRegion.clearAllExpandos()}Owa.Components.ToolbarCollection.get(this.get_SubPage()).dispose();if(isDf(typeof(dspAB))){dspAB();var oDirList=$("divDirLst");if(oDirList){initSNDL(oDirList,1)}}else{Owa.UIControls.NotificationDialog.disposeAll()}if(g_oFolderTreeMenu)g_oFolderTreeMenu.dispose();if(g_oPublicFolderTreeMenu)g_oPublicFolderTreeMenu.dispose();if(g_oNavigationTreeMenu)g_oNavigationTreeMenu.dispose();if(Owa.Utility.isDefined(typeof(a_rgLiveHeaderMenuLinks))&&(a_rgLiveHeaderMenuLinks.length>0)){for(var i=0;i<a_rgLiveHeaderMenuLinks.length;i++){var oLink=$(a_rgLiveHeaderMenuLinks[i]);if(oLink){oLink.detachAllEvents()}}}if(this.oFindSomeoneControl){this.oFindSomeoneControl.dispose();dispRecipContextMenus()}hideOpenMailboxDialog();if(isDf(typeof(a_isMstr))&&a_isMstr&&gtIMMgr()&&gtIMMgr().GtChtSsnCnt()>0)gtIMMgr().DsblAllChtsSsns();try{if((isDf(typeof(a_isMstr)))&&a_isMstr&&g_oPrfCnsl&&g_oPrfCnsl.disable)g_oPrfCnsl.disable()}catch(e){}if(g_CC&&g_CC.oMailTipsRequesters){for(var iHash in g_CC.oMailTipsRequesters){g_CC.oMailTipsRequesters[iHash].set_MainPageRefreshed()}}dispIM();window.oR=null;Owa.Pages.NavigationPage.callBase(this,"dispose")};_oPrototype._initializeHotkeys=function Owa$Components$NavigationPage$_initializeHotkeys(){Owa.Pages.NavigationPage.callBase(this,"_initializeHotkeys");this.addHk(L_HkNew,"new")};_oPrototype.onBeforeUnload=function Owa$Pages$NavigationPage$onBeforeUnload(){if(isDf(typeof(a_oPndGt))&&a_oPndGt!=""){a_oPndGt.disp()}Owa.Pages.NavigationPage.callBase(this,"onBeforeUnload")};_oPrototype._onUserAction=function Owa$Pages$NavigationPage$_onUserAction(sAction,oContext){switch(sAction){case"checknames":var sId=oContext.get_Id();if(sId==TO){this.oFindSomeoneControl.checkNames()}else if(sId=="divOpnMbxRw"){showOpenMailboxDialog()}break;case"lnkMySite":sfWinOpn(oContext.getAttribute("sMySiteUrl"));break;case"lnkOptions":navOpts();break;case"lnkAddrBk":addrBk();break;case"lnkHelp":opnHlp();break;case"lnkHelpDD":g_oHelpMenu.showUnder($("lnkHelpDD"),2,true);applyNotificationButtonStyle(1,Owa.Strings.Ids.HelpButtonId);break;case"lnkRm":Owa.UIControls.ReminderDialog.getDialog().toggleDialog();break;case"lnkBr":Owa.UIControls.BuddyDialog.getDialog().toggleDialog();break;case"lnkNwCht":Owa.IM.IMUtils.ClickNewChatToast();break;case"lnkAc":Owa.UIControls.ActiveChatsDialog.getDialog().toggleDialog();break;case"lnkNwVMl":case"lnkNwFx":case"lnkNwMl":doDsplyVw(sAction);return;case"lnkNE":shwNEI();break;case"openlocdl":opnLoc();break;case"opendl":nav(NM_DOC,T_DOC,(oContext.length?oContext[0]:wda("divDfm").docLib.uri));break;case"opennewdl":sfWinOpn(DLF_URI+urlEnc(oContext.length?oContext[0]:wda("divDfm").docLib.uri));break;case"deletedl":delLib();break;case"renamedl":edtLib();break;default:Owa.Pages.NavigationPage.callBase(this,"_onUserAction",[sAction,oContext]);break}};_oPrototype._onNewItem=function Owa$Pages$NavigationPage$_onNewItem(){var oViewPage;try{var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);oViewPage=oSubPageController.get_SubPage()}catch(e){}if(oViewPage){oViewPage._onNewItem()}};_oPrototype.getNewMessageId=function Owa$Pages$NavigationPage$getNewMessageId(){if(g_fNwMl){return g_sMId}else if(g_fNwVMl){return g_sVMId}else if(g_fNwFx){return g_sFId}};_oPrototype.getLstVw=function Owa$Pages$NavigationPage$getLstVw(sFId){var oSubPageController=getViewSubPageControllerByFolderId(sFId);return Owa.PageHierarchy.getVirtualListViewFromSubPageController(oSubPageController)};Owa.Pages.NavigationPage.createClass("Owa.Pages.NavigationPage",Owa.UIControls.SubPage)})();g_fModuleLoaded[".\\components/navigationUtility.js".toLowerCase()]=1;function getNavigationPage(){return Owa.Components.Application.get_RootSubPage()}function chgAbLvSt(f){if(isPkr()){g_fPLvLd=f;disPkrBtns(!f)}}function isAbPLvLd(){return(g_fPLvLd==1)}function getFolderTreeMenu(){if(!g_oFolderTreeMenu)g_oFolderTreeMenu=Owa.UIControls.ContextMenu.create($("divFtm"),null,getNavigationPage());return g_oFolderTreeMenu}function getPublicFolderTreeMenu(){if(!g_oPublicFolderTreeMenu)g_oPublicFolderTreeMenu=Owa.UIControls.ContextMenu.create($("divPFtm"),null,getNavigationPage());return g_oPublicFolderTreeMenu}function getNavigationTreeMenu(){if(!g_oNavigationTreeMenu)g_oNavigationTreeMenu=Owa.UIControls.CalendarContextMenu.create($("divNmCm"),null,getNavigationPage());return g_oNavigationTreeMenu}function onHelpCMLnk(oEventArgs){switch(oEventArgs.sCommand){case"openHelp":opnHlp();break;case"openFeedback":break;case"openWhatsNew":opnHlp(a_sWhatsNewUrl);break;case"openPerfConsole":dbgCnsl();break;case"openSupport":opnHlp(a_sSupportUrl);break;case"openAbout":opnWin("?ae=Options&t=About",null,null,null,null,null,null,getNavigationPage());break;case"openPrivacyStatement":opnPrvcyStmt();break}}function onSelectLiveHeaderMenuLink(oEventArgs){if(!oEventArgs.oMenuItem)return;var sUrl=oEventArgs.oMenuItem.getAttribute("_sUrl");if(!sUrl)return;var fOpenInNewWindow=oEventArgs.oMenuItem.getAttribute("_openInNewWin");if(Owa.Utility.isDefined(typeof(fOpenInNewWindow))&&fOpenInNewWindow){Owa.Dom.Window.get_Current().open(sUrl)}else{Owa.Dom.Window.get_Current().navigate(sUrl)}}function openLiveHeaderMenu(oEvent){var oLink=oEvent.get_Target();if(!oLink.get_Id()){oLink=oLink.get_ParentElement()}var oContextMenu=g_rgLiveHeaderContextMenus[oLink.get_Id()];if(oContextMenu){oContextMenu.showUnder(oLink,0,false)}}function onHelpCMHid(){applyNotificationButtonStyle(0,Owa.Strings.Ids.HelpButtonId)}function positionMailboxQuotaBar(){if(g_fAB)return;hideMailboxUsage();var oMbQt=$("divMbxQt");var oMbQtRg=$("divMbxQtRg");var f=(a_iNM==NM_MAIL&&getInt(oMbQt.getAttribute("_fDsp")));oMbQtRg.set_IsShown(f);$("divSecNv").set_Top((f?oMbQtRg.get_OffsetHeight():0)+$("divMdNm").get_OffsetHeight())}function setBrandbarPosition(){var oLiveLogo=$("imgLiveLogo");var oBrandLogo=$("divBrandLogo");var oBrandbar=$("divBrandBar");if(oLiveLogo){oBrandLogo.set_Width(oLiveLogo.get_OffsetWidth())}else{var oBrandOrgName=$("divBrandOrgName");var oBrandOrgLive=$("divBrandOrgLive");var brandLogoWidth=0;if(g_fRtl){brandLogoWidth=oBrandLogo.get_DocumentLeft()+oBrandLogo.get_OffsetWidth()-Math.min(oBrandOrgName.get_DocumentLeft(),oBrandOrgLive.get_DocumentLeft())}else{brandLogoWidth=Math.max(oBrandOrgName.get_DocumentLeft()+oBrandOrgName.get_OffsetWidth(),oBrandOrgLive.get_DocumentLeft()+oBrandOrgLive.get_OffsetWidth())-oBrandLogo.get_DocumentLeft()}oBrandLogo.set_Width(brandLogoWidth)}var oBrandLink=$("divBrandLinkArea");if(oBrandLink){var oUserTile=$("divUserTile");var iLinkLeft=g_fRtl?oUserTile.get_DocumentLeft()+oUserTile.get_OffsetWidth():oBrandLogo.get_DocumentLeft()+oBrandLogo.get_OffsetWidth();var iLinkRight=g_fRtl?oBrandbar.get_OffsetWidth()-oBrandLogo.get_DocumentLeft():oBrandbar.get_OffsetWidth()-oUserTile.get_DocumentLeft();oBrandLink.set_Left(iLinkLeft);oBrandLink.set_Right(iLinkRight);oBrandLink.set_IsShown(true)}}var g_fNRS=false;var g_iNXS;var g_iNYS;var g_iNXMin;var g_iNXMax;var g_oNDivDrag;var g_iNDivOffset;function navigationResizeStart(e){var oSrc=e.get_Target();if(g_fNRS||!oSrc||oSrc.get_Id()!="imgNvDrag"||!e.isLeftButtonDown())return;e.preventDefault();e.cancelBubble();var oOwaBody=$("divNavHostBody");g_fNRS=true;g_iNXS=e.get_ClientX();g_iNYS=e.get_ClientY();g_oNDivDrag=oSrc;var oNDivDragParent=g_oNDivDrag.get_ParentElement();g_oNDivDrag.replaceCssClass("nvDragging","hidden");oNDivDragParent.replaceCssClass("nvDragging","hidden");g_iNDivOffset=g_oNDivDrag.get_Left()-g_iNXS;g_iNXMin=g_iMinVWW;g_iNXMax=oOwaBody.get_OffsetWidth()-g_iMinRPW;var oDragMask=Owa.Dom.Document.get_Current().createElement("div");oDragMask.set_Id("divNvDragMask");oOwaBody.appendChild(oDragMask);oOwaBody.attachEvent("mouseup",navigationResizeEnd);oOwaBody.attachEvent("mousemove",navigationResizeMove)}function navigationResizeEnd(e){if(!g_fNRS)return;g_fNRS=false;var nChng=(g_oNDivDrag.get_Left()-g_iNDivOffset)-g_iNXS;if(g_fRtl)nChng*=-1;setNavigationPaneWidth($("divNvPn").get_OffsetWidth()+nChng,1);var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);var oSubPage=oSubPageController.get_SubPage();if(oSubPage){oSubPage.fireSizeChanged()}var oOwaBody=$("divNavHostBody");oOwaBody.getDescendantById("divNvDragMask").remove(true);g_oNDivDrag.set_Left(0);var oNDivDragParent=g_oNDivDrag.get_ParentElement();g_oNDivDrag.replaceCssClass("hidden","nvDragging");oNDivDragParent.replaceCssClass("hidden","nvDragging");g_oNDivDrag=null;oOwaBody.detachEvent("mouseup",navigationResizeEnd);oOwaBody.detachEvent("mousemove",navigationResizeMove)}function navigationResizeMove(e){if(!g_fNRS||!e.isLeftButtonDown())return navigationResizeEnd(e);var iN=e.get_ClientX();if(iN<g_iNXMin)iN=g_iNXMin;else if(iN>g_iNXMax)iN=g_iNXMax;g_oNDivDrag.set_Left(iN+g_iNDivOffset);return false}function cbOnMkAllRd(oR,oSndr,sFId){if(!cbOeh(oR))return;var oE={};oE.sFId=sFId;var oV=getNavigationPage().getLstVw(oE.sFId);if(oV)oV.mkAllRd();else updCnt(sFId,-1,0)}function shwOthrSPErr(){Owa.Components.Application.failWithWarning(htmlEnc(L_ErrNoOthrIns))}function removeFolderView(sId){var oSubPageController=getViewSubPageControllerByFolderId(sId);if(oSubPageController){try{oSubPageController.remove()}catch(e){}}if(sId==a_sInbx)return;if(g_oFldrMgr.gtFL(sId)==FL_PUB)return;cancelFolderSubscription(sId)}function initIMSP(){var win=gtMstr();if(win!=window)a_isMstr=0;if(g_fIsIMEnab){var oMnu=$("divIMmnu");if(oMnu){g_oPresenceMenu=Owa.UIControls.ContextMenu.create(oMnu);g_oPresenceMenu.get_OnSelect().add(OnPrsncCmClk)}if(Owa.IM&&a_isMstr)g_IMMgr=new Owa.IM.IMMgr();Owa.IM.IMUtils.SetMenuSISO(true)}}function initSNDL(oL,fDsp){initSNL(oL,fDsp);var fAllALEnabled=!!$("divAllAL");if(fDsp){if(fAllALEnabled){oL.getDescendantById("divABMore").detachEvent("click",clkABMoreLess);oL.getDescendantById("divABLess").detachEvent("click",clkABMoreLess)}Owa.Dom.Window.get_Current().detachEvent("resize",Owa.Utility.createContextDelegate($("divDirLst"),Owa.DomUtility.calculateVerticalScrollBar,$("divDirLst")))}else{if(fAllALEnabled){oL.getDescendantById("divABMore").attachEvent("click",clkABMoreLess);oL.getDescendantById("divABLess").attachEvent("click",clkABMoreLess)}Owa.Dom.Window.get_Current().attachEvent("resize",Owa.Utility.createContextDelegate($("divDirLst"),Owa.DomUtility.calculateVerticalScrollBar,$("divDirLst")));Owa.DomUtility.calculateVerticalScrollBar($("divDirLst"))}if(!fDsp){var rgItms=oL.getAllDescendantsById("divEnt");for(var i=0;i<rgItms.length;i++)if(getInt(rgItms[i].getAttribute("_sel")))snlSelEnt(oL,rgItms[i])}}function isPkr(){return isDf(typeof(g_fABpkr))&&g_fABpkr}function onClkABFld(sFId,sT){if(g_oCntTr){var oTrSel=g_oCntTr.gtSelNd();if(oTrSel)g_oCntTr.stNdSel(oTrSel,0)}var oN=nvCtx();oN.fAB=1;oN.sAe=AE_AL;if(isPaaPkr())oN.sMa="PickPaa";else if(isMblPkr())oN.sMa="PickMobile";else oN.sMa=isPkr()?"Pick":null;nav(NM_AB,sT,sFId,oN)}function clkABMoreLess(e){var oClkItm=e.get_Target();while(oClkItm&&oClkItm.getAttribute("_fMrLs")!="1")oClkItm=oClkItm.get_ParentElement();var fMoreLess=(oClkItm.get_Id()=="divABMore");$("divABMore").set_IsShown(!fMoreLess);$("divABLess").set_IsShown(fMoreLess);var oAllAddressList=$("divAllAL");if(fMoreLess&&oAllAddressList.hasChildNodes()){oAllAddressList.set_IsShown(true);Owa.DomUtility.calculateVerticalScrollBar($("divDirLst"))}else if(!fMoreLess){oAllAddressList.set_IsShown(false);Owa.DomUtility.calculateVerticalScrollBar($("divDirLst"))}else{new oeReq("DB","AllAddressList",null,cbGetAllAddressList).send()}}function cbGetAllAddressList(oR){if(oR.sErr){if(oR.fST)popLgn();else shwErrDlg(oR);return}if(oR.sBody){var oDivAllAL=$("divAllAL");oDivAllAL.set_InnerHtml(oR.sBody);oDivAllAL.set_IsShown(true);prepSNLEnts($("divDirLst"))}Owa.DomUtility.calculateVerticalScrollBar($("divDirLst"))}function cntCtx(sFltr){var oN=nvCtx();if(g_fAB)oN.sMs="AddressBook"+(isPkr()?"Picker":"Browse");if(isPaaPkr())oN.sMa="PAA";else if(isMblPkr())oN.sMa="Mobile";oN.fP=oN.fR=1;oN.fAB=g_fAB;oN.sFltr=sFltr;return oN}function onNavCnt(){if(!g_oCntTr){var oTr=$("cntTr");if(oTr){var oTreeRegion=oTr.get_ParentElement().get_ParentElement();g_oCntTr=new Owa.UIControls.NavigationTree(oTr.get_FirstChild());g_oCntTr.set_SubPage(getNavigationPage());g_oCntTr.onSelChng=onCntSelChng;g_oCntTr.onClkNd=clearSearchOnClickTreeNode;g_oCntTr.setSelectionClass("NMTrSel");makeTreeScrollArea(g_oCntTr);oTreeRegion.attachEvent("dragenter",trStrtAutoScr);oTreeRegion.attachEvent("dragover",trStrtAutoScr);oTreeRegion.attachEvent("mouseout",endAutoScr);oTreeRegion.setExpando("oTgtTr",g_oCntTr);g_rgTreeRegion.push(oTreeRegion);initSNFlt($("divCntFlt"))}}if(!g_fAB)g_oCntTr.selNd(g_oCntTr.gtNdByAls(AL_DEF))}function onCntSelChng(oJO,oJN){if(!oJN)return;var oDirLst=$("divDirLst");if(oDirLst)snlUnsel(oDirLst);var sFId=oJN.gtFId();g_rgsLFids[NM_CTS]=sFId;var oFilter=$("divCntFlt");nav(NM_CTS,T_CON,sFId,cntCtx(oFilter?oFilter.getExpando("iCurFlt"):0))}function onClkCntF(sFltId){var oV=getNavigationPage().getLstVw(a_sLstFID);if(!oV)return;var oF=$(sFltId);if(NM_PF==a_iNM){oV.stFltr(oF.getExpando("iCurFlt"));if(oV.rfrsh)oV.rfrsh();else oV.setExpando("fNdRfrsh",1)}else{var oDirLst=$("divDirLst");if(oDirLst)snlUnsel(oDirLst);if(!g_oCntTr.hsSelNd())g_oCntTr.selNd(g_oCntTr.gtNdByAls(AL_DEF));nav(NM_CTS,T_CON,g_oCntTr.gtSelNd().gtFId(),cntCtx(oF.getExpando("iCurFlt")))}}var g_oBddyLst=null;function gtTrRg(){return $("mailtree").get_ParentElement()}function onNavMail(){if(g_oMMFrst)return;g_oMMFrst=new Owa.Components.ForestControl();var oTRg=gtTrRg();oTRg.forEachChild(function(oChild){var oTreeElement=oChild.get_FirstChild();if(oTreeElement&&oTreeElement.getAttribute("fTR")){switch(oChild.get_Id()){case"mailtree":var oTree=new Owa.UIControls.FolderTree(oTreeElement,0,1);oTree.set_SubPage(getNavigationPage());oTree.onSelChng=onMailSelChng;oTree.onClkNd=clearSearchOnClickTreeNode;g_oMMFrst.addTr("mail",oTree);makeTreeScrollArea(oTree);break;case"favTr":var oTree=new Owa.UIControls.FavoriteTree(oTreeElement);oTree.set_SubPage(getNavigationPage());oTree.onSelChng=onMailSelChng;oTree.onClkNd=clearSearchOnClickTreeNode;g_oMMFrst.addTr("favorite",oTree);makeTreeScrollArea(oTree);break;case"buddytree":g_oBddyLst=new Owa.UIControls.BuddyListTree(oTreeElement);g_oBddyLst.set_SubPage(getNavigationPage());g_oBddyLst.set_ContextMenu(Owa.UIControls.ContextMenu.create($("divBtm"),null,getNavigationPage()));g_oMMFrst.addTr("buddy",g_oBddyLst);makeTreeScrollArea(g_oBddyLst);break;default:var oTree=new Owa.UIControls.FolderTree(oTreeElement,0);oTree.set_SubPage(getNavigationPage());oTree.onSelChng=onMailSelChng;oTree.onClkNd=clearSearchOnClickTreeNode;g_oMMFrst.addTr(oChild.get_Id(),oTree);makeTreeScrollArea(oTree);break}}});var oM=$("divFtm");if(oM)Owa.Dom.Document.get_Current().get_Body().insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oM);var oTreeOuterRegion=oTRg.get_ParentElement();oTreeOuterRegion.attachEvent("dragenter",trStrtAutoScr);oTreeOuterRegion.attachEvent("dragover",trStrtAutoScr);oTreeOuterRegion.attachEvent("mouseout",endAutoScr);oTreeOuterRegion.setExpando("oTgtTr",g_oMMFrst);g_rgTreeRegion.push(oTRg.get_ParentElement());g_oMMFrst.svDfN()}var AUTOSCR_RNG=16;var iAutoScr=0;function trStrtAutoScr(oEvent){var oElement=oEvent.get_CurrentTarget();var iY=oEvent.get_ClientY()-oElement.get_DocumentTop();var iS;if(iY<AUTOSCR_RNG&&oElement.get_ScrollTop()>0)iS=-1;else if(iY>oElement.get_OffsetHeight()-AUTOSCR_RNG&&oElement.get_ScrollTop()<oElement.get_ScrollHeight()-oElement.get_OffsetHeight())iS=1;iAutoScr=iS;if(iS&&oElement.get_OffsetHeight()!=oElement.get_ScrollHeight()){if(autoScr._iAutoScrTId){if(autoScr._AutoScrS==iS)return;else window.clearTimeout(autoScr._iAutoScrTId)}autoScr._iAutoScrTId=Owa.Dom.Window.get_Current().setTimeout(autoScr,50);autoScr._oT=oElement;autoScr._AutoScrS=iS}if(oEvent._oEvent.dataTransfer)oEvent._oEvent.dataTransfer.dropEffect=oEvent._oEvent.dataTransfer.dropEffect;oEvent.preventDefault();oEvent.cancelBubble()}function autoScr(){var oTargetTree=autoScr._oT.getExpando("oTgtTr");if(oTargetTree)oTargetTree.clrDrpHl();autoScr._oT.set_ScrollTop(autoScr._oT.get_ScrollTop()+20*autoScr._AutoScrS);delete autoScr._AutoScrS;delete autoScr._iAutoScrTId}function endAutoScr(){iAutoScr=0}function onSLSUnav(e){var oSrc=e.get_Target();if(oSrc&&isInpt(oSrc))return;e.preventDefault();e.cancelBubble()}function clearSearchOnClickTreeNode(oEvent,oJN){if(oJN.equals(this.gtSelNd())){var oSubPageController=getViewSubPageControllerByFolderId(oJN.gtFId());if(oSubPageController){var oSubPage=Owa.PageHierarchy.getFolderViewSubPageFromSubPageController(oSubPageController);var oSearchControl=oSubPage?oSubPage.get_SearchControl():null;if(oSearchControl){oSearchControl.clearSearch()}}}}function onMailSelChng(oJO,oJN){if(!oJN)return;var oN=nvCtx();var sFId=oJN.gtFId();var sELCId=oJN._tr.gtSelELCNdFId?oJN._tr.gtSelELCNdFId():null;var sCC=oJN.gtFCC();oN.fP=(sFId==g_rgsLFids[NM_MAIL]||sFId==a_sCal||sFId==g_rgsLFids[NM_CTS]||sFId==g_rgsLFids[NM_TSK]);oN.fR=(isDrty(sFId)||sFId==a_sLstFID);var iM=NM_MAIL;if(sELCId&&(sELCId!=sFId))oN.sELCId=sELCId;else oN.sELCId=null;oN.fNC=oJN.isNC();nav(iM,sCC,sFId,oN)}function onPFSelChng(oJO,oJN){if(!oJN)return;var oN=nvCtx();var sFId=oJN.gtFId();var sELCId=oJN._tr.gtSelELCNdFId?oJN._tr.gtSelELCNdFId():null;var sCC=oJN.gtFCC();oN.fP=(sFId==g_rgsLFids[NM_MAIL]||sFId==a_sCal||sFId==g_rgsLFids[NM_CTS]||sFId==g_rgsLFids[NM_TSK]);oN.fR=(isDrty(sFId)||sFId==a_sLstFID);var iM=NM_PF;if(isOfClss(sCC,T_CAL)){oN.fNoTdy=1}else if(isOfClss(sCC,T_CON)){var oFlt=$("divPFCntFlt");oN.sFltr=oFlt?oFlt.getExpando("iCurFlt"):0;oN.fR=1}if(sELCId&&(sELCId!=sFId))oN.sELCId=sELCId;else oN.sELCId=null;nav(iM,sCC,sFId,oN)}function getCalVw(sFId){var oSubPageController=getViewSubPageControllerByFolderId(sFId);return(oSubPageController?oSubPageController.getVariable("g_oView"):null)}function getRPIF(sFId){var oSubPageController=getViewSubPageControllerByFolderId(sFId);return(oSubPageController?oSubPageController.getElementById("ifRP"):null)}g_oEd.attachEvent("DeleteFolder",null,"cbDelFldr");g_oEd.attachEvent("MoveFolder",null,"cbMoveFolder");function cbDelFldr(oR,oSndr,sFId){if(oR.isErr())return;removeFolderView(sFId)}function cbMoveFolder(oR,oSndr,sSrcFId,fSrcD,sDstPFId,fDstD,fC,fExp,iFrt){if(oR.isErr())return;if(g_oFldrMgr.gtFL(sSrcFId)!=g_oFldrMgr.gtFL(sDstPFId))removeFolderView(sSrcFId)}function getViewSubPageControllerByFolderId(sFolderId){var oElement=getFolderViewElementByFolderId(sFolderId);if(oElement){return Owa.Components.SubPageControllerFactory.getControllerByElement(oElement)}else{return null}}function getFolderViewElementByFolderId(sFolderId){return $("divMainView").getChildById("b"+sFolderId)}function stDrty(id,f){var o=getFolderViewElementByFolderId(id);if(o)o.setExpando("_drty",!f)}function isDrty(sFId,fl){var o=getFolderViewElementByFolderId(sFId);return(o?(o.getExpando("_drty")||(o.getExpando("_nc")&&!fl)):0)}function updCnt(id,tc,uc){g_oEd.fire("UpdateCount",id,tc,uc)}function setPllInt(pllPrdMs){if(pllPrdMs!=g_iPllPrdMs){if(g_iPllInt){window.clearInterval(g_iPllInt);g_iPllInt=0}g_iPllPrdMs=pllPrdMs;g_iPllInt=window.setInterval(pollN,pllPrdMs)}}function setRmPllInt(rmpllPrdMs){if(rmpllPrdMs!=g_iRmPllPrdMs){if(g_oRmPllTmOut){window.clearInterval(g_oRmPllTmOut);g_oRmPllTmOut=0}g_iRmPllPrdMs=rmpllPrdMs;g_oRmPllTmOut=window.setInterval(rmpollN,rmpllPrdMs)}}function stPndGt(){a_oPndGt=new pndGt()}function stPollN(){if(isFtEnab(FT_NOTIF)){if(a_fPullNotif){pollN();setPllInt(a_iNtInt)}if(a_fPushNotif){rmpollN();setRmPllInt(a_iRmInt)}}}function pollN(){if(Owa.Components.OehRequest.hasPendingRequests())return;var oR=new oeReq("Notify","Poll",null,cbPoll,null,null,0,1);var oRDlg=Owa.UIControls.ReminderDialog.getDialog();if(oRDlg&&oRDlg.dtLastReminderTime)oR.add("LRT",new Date(oRDlg.dtLastReminderTime));oR.send()}function rmpollN(){if(Owa.Components.OehRequest.hasPendingRequests())return;var oR=new oeReq("Notify","ReminderPoll",true,cbPoll,null,null,0,1);var oRDlg=Owa.UIControls.ReminderDialog.getDialog();if(oRDlg&&oRDlg.dtLastReminderTime)oR.add("LRT",new Date(oRDlg.dtLastReminderTime));oR.send()}function cbPoll(oR,bIsPushNotification){try{bIsPushNotification=false;if(oR.oCtx==true){bIsPushNotification=true}if(oR.sErr){if(oR.fST)rplLgn();else shwNE(1,oR,bIsPushNotification)}else{shwNE(0,0,bIsPushNotification);if(oR.sBody!=""){eval(oR.sBody);if(isDrty(a_sLstFID,1)){var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(oSubPageController){oSubPageController.invokeFunction("refresh")}}window.oR=oR;return true}}}catch(e){if(!Owa.BrowserErrorHandler.isAccessDeny(e.message))throw e}}function rmNotfy(iOff,fR,sRT,sHTML,sErr){var oRDlg=Owa.UIControls.ReminderDialog.getDialog();if(!oRDlg)return;oRDlg.iTimeOffset=iOff;if(fR){oRDlg.iTimeDifference=0;oRDlg.dtLastReminderTime=sRT;var dtClntNw=oRDlg.getUTCDifference();var dtSvrNw=new Date(sRT);oRDlg.iTimeDifference=dtSvrNw-dtClntNw;oRDlg.setItemsHtml(sHTML)}if(sErr)oRDlg.showError(sErr);else oRDlg.showError("");oRDlg.setReminderTimer();oRDlg.updateTitlebarButton();if(!oRDlg.getItems().length){if(oRDlg.isOpened())oRDlg.hide();return}if(oRDlg.isOpened()){var oSel=null;if(oRDlg.nxtSelId)oSel=oRDlg.getItemById(oRDlg.nxtSelId);if(!oSel)oSel=oRDlg.getItems()[0];oRDlg.unselectAllItems();oRDlg.selectItem(oSel,1,1)}if(fR){if(!oRDlg.isOpened())oRDlg.show(1);if(oRDlg.fSoundEnabled)plySnd()}}function shwNM(f){g_fShwNMBtn=f;showNotificationButton(Owa.Strings.Ids.NewMailNotificationButtonId,f)}function shwNVM(f){g_fShwNVMBtn=f;showNotificationButton(Owa.Strings.Ids.NewVoiceMailNotificationButtonId,f)}function shwNF(f){g_fShwNFBtn=f;showNotificationButton(Owa.Strings.Ids.NewFaxNotificationButtonId,f)}function shwNE(f,oR,fPndGt){try{var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(fPndGt)g_fShwPndGtErr=f;else g_fShwPllErr=f;if(oSubPageController){if((oR!=0)||!(g_fShwPndGtErr||g_fShwPllErr)){oSubPageController.invokeFunction("setNEI",[oR])}showNotificationButton(Owa.Strings.Ids.ErrorNotificationButtonId,(g_fShwPndGtErr||g_fShwPllErr))}}catch(e){}}function shwNwItmDlg(sFrm,sSbj,sTyp,sIcnPth){var o=$(sTyp);if(o){Owa.UIControls.NewItemAlertDialog.hideDialog(1);Owa.UIControls.NewItemAlertDialog.clearTimer();if(!Owa.UIControls.NotificationDialog.anyDialogsOpen()){var nmDlg=new Owa.UIControls.NewItemAlertDialog(sTyp,sFrm,sSbj,sIcnPth,hideInbxNB,dsplyVw);nmDlg.show();Owa.UIControls.NewItemAlertDialog.setTimer("Owa.UIControls.NewItemAlertDialog.hideDialog();",5000)}else{Owa.UIControls.NewItemAlertDialog.setTimer("hideInbxNB();",5000)}window.setTimeout("updCmp('"+window+"')",5001)}}function hideInbxNB(){if(!g_fAB&&a_sLstFID==a_sInbx){if(g_fShwNMBtn==1)shwNM(0);if(g_fShwNVMBtn==1)shwNVM(0);if(g_fShwNFBtn==1)shwNF(0)}}function dsplyVw(sId){setTimeout("doDsplyVw(\""+sId+"\")",1)}function doDsplyVw(sId){var sMId;g_fNwMl=0;g_fNwVMl=0;g_fNwFx=0;switch(sId){case Owa.Strings.Ids.NewMailNotificationButtonId:shwNM(0);if(g_sMId)sMId=g_sMId;g_fNwMl=1;break;case Owa.Strings.Ids.NewVoiceMailNotificationButtonId:shwNVM(0);if(g_sVMId)sMId=g_sVMId;g_fNwVMl=1;break;case Owa.Strings.Ids.NewFaxNotificationButtonId:shwNF(0);if(g_sFId)sMId=g_sFId;g_fNwFx=1;break}if(a_sLstFID==a_sInbx){var oV=getNavigationPage().getLstVw(a_sLstFID);var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(oSubPageController){oSubPageController.get_SubPage().get_SearchControl().clearSearch()}if(sMId)oV.seekRw(sMId);else oV.rfrsh()}else{var oN=nvCtx();oN.fR=isDrty(a_sInbx);oN.mId=sMId;oN.cb=onNavMail;nav(NM_MAIL,T_MSG,a_sInbx,oN)}var oTr=getSNTr(NM_MAIL);if(oTr){oTr.selNd(null);oTr.selNd(oTr.gtNdByAls(ALP_DFT+DFT_IBX))}}function getNBX(o){var iX=o.get_DocumentLeft();if(!g_fRtl)iX+=o.get_OffsetWidth();return iX}function rmGtNBX(o,oDlg){var iX=o.get_DocumentLeft();if(!g_fRtl)iX=Math.max(iX+o.get_OffsetWidth()-oDlg.get_OffsetWidth(),0);return iX}function getNBY(o){return $("divBrandBar").get_OffsetHeight()+o.get_ParentElement().get_OffsetHeight()}function plySnd(){if(!plySnd.sUrlSound)plySnd.sUrlSound=getThmF("notify.wav");if(Owa.Utility.isIE()){if(!plySnd.oSoundElement){plySnd.oSoundElement=Owa.Dom.Document.get_Current().createElement("BGSOUND");plySnd.oSoundElement.setAttribute("loop","1");Owa.Dom.Document.get_Current().get_Body().insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,plySnd.oSoundElement)}plySnd.oSoundElement.setAttribute("src",plySnd.sUrlSound)}else if(Owa.Utility.isMac()&&(Owa.Utility.isSafari()||Owa.Utility.isFirefox())){$("divSoundContainer").set_InnerHtml("<EMBED src=\""+plySnd.sUrlSound+"\" height=\"0px\" width=\"0px\"></EMBED>")}}function navMail(f){var oN=nvCtx();oN.fP=1;oN.fR=isDrty(g_rgsLFids[NM_MAIL]);oN.cb=onNavMail;oN.sId=g_rgsLFids[NM_MAIL];if(f)return oN;nav(NM_MAIL,T_MSG,g_rgsLFids[NM_MAIL],oN)}function navCal(){var oN=nvCtx();oN.fP=1;oN.fR=isDrty(a_sCal);oN.cb=onNavCal;nav(NM_CAL,T_CAL,a_sCal,oN)}function navCtcts(){var oN=nvCtx();oN.fP=1;oN.fR=isDrty(a_sCtcts);oN.cb=onNavCnt;var oCntFlt=$("divCntFlt");oN.sFltr=oCntFlt?oCntFlt.getExpando("iCurFlt"):0;nav(NM_CTS,T_CON,a_sCtcts,oN)}function navTsks(){var oN=nvCtx();oN.fP=1;oN.fR=isDrty(a_sTsks);oN.cb=onNavTsk;nav(NM_TSK,T_TSK,a_sTsks,oN)}function navDocs(){var oC=nvCtx();oC.cb=cbNavDocs;nav(NM_DOC,T_DOC,(g_rgsLFids[NM_DOC]?g_rgsLFids[NM_DOC]:ID_DFTDOCM),oC)}function cbNavDocs(){ibe(document.body,wda("divDfm"))}function navPFs(){if(""==a_sPFrt){var oR=new oeReq("Tree","GetRootPublicFolderId",0,cbGetPFRtId);oR.send();return}else if(0==g_rgsLFids[NM_PF]){g_rgsLFids[NM_PF]=a_sPFrt}var oN=nvCtx();oN.fP=1;oN.fR=isDrty(g_rgsLFids[NM_PF]);oN.cb=onNavPF;nav(NM_PF,g_sLstPFT?g_sLstPFT:T_MSG,g_rgsLFids[NM_PF],oN)}function cbGetPFRtId(oR){if(!cbOeh(oR))return;a_sPFrt=oR.sBody;navPFs()}function navOpts(){if(g_fIsIMEnab&&(gtIMMgr().GtChtSsnCnt()>0)){var oD=new BtnDlg("divNavOpts",htmlEnc(L_ErrNavAway),L_Opts,[L_OK,L_Cncl],400,Owa.BUTTON_DIALOG_ICON.WARNING,onNavOpts);oD.show()}else{onNavOpts(0)}}function onNavOpts(i){if(i!=0){return}Owa.Dom.Window.get_Current().navigate(getEcpVdir()+"?rfr=owa")}function nvCtx(){this.sAe=AE_F;this.fP=this.fR=this.mId=this.fNoTdy=this.oC=this.fAB=this.sMa=this.sMs=this.sFltr=this.cb=this.sPrntFdrUri=this.iClr=null;return this}function gtActMd(){if(g_rgActM.length==0)g_rgActM[0]=a_iNM;var rgR=[];rgR[0]=a_iNM;for(var i=0;i<g_rgActM.length;i++)if(g_rgActM[i]!=a_iNM)rgR[rgR.length]=g_rgActM[i];return rgR}function nav(iM,sT,sId,oN){if(!oN)oN=nvCtx();var fAB=oN.fAB;if(!fAB)selectNavigationButton(iM);var oView=getFolderViewElementByFolderId(a_sLstFID);if(oView)setFolderViewStatus(oView,false);try{var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(oSubPageController){oSubPageController.invokeFunction("unselect")}}catch(e){}if(!fAB){$("divMdNm").set_TextContent(getLMN(iM));var oSN=$("divSecNv");if(oSN&&a_iNM!=iM){oSN.forEachChild(function(oChild){oChild.set_IsShown(false)});var oMdTr=null;switch(a_iNM){case NM_MAIL:oMdTr=g_oMMFrst;break;case NM_CAL:oMdTr=g_oCalTr;break;case NM_CTS:oMdTr=g_oCntTr;break;case NM_TSK:oMdTr=g_oTskTr;break;case NM_PF:oMdTr=g_oPblcFldrTree;break}if(oMdTr)oMdTr.qtEdtNd()}}loadView(sT,sId,oN,fAB);if(!fAB&&(iM==NM_PF||a_iNM!=iM))loadSecNv(iM,sId,oN.cb);if(iM!=NM_CAL)g_rgsLFids[iM]=sId;if(a_iNM!=NM_CAL&&Owa.Controls.FolderManager.getOwaStoreObjectIdPrefix(a_sLstFID)==FL_OUM)stDrty(a_sLstFID);a_sLstFID=sId;a_iNM=iM;var fFst=1;for(var i=0;i<g_rgActM.length;i++)if(g_rgActM[i]==a_iNM)fFst=0;if(fFst)g_rgActM[g_rgActM.length]=a_iNM;if(iM==NM_PF)g_sLstPFT=sT;positionMailboxQuotaBar()}function clearNwMB(){g_fShwNMBtn=0;g_fShwNVMBtn=0;g_fShwNFBtn=0;showNotificationButton(Owa.Strings.Ids.NewMailNotificationButtonId,false);showNotificationButton(Owa.Strings.Ids.NewVoiceMailNotificationButtonId,false);showNotificationButton(Owa.Strings.Ids.NewFaxNotificationButtonId,false)}function loadView(sT,sId,oN,fAB){var sSrc="?ae="+oN.sAe+"&t=";var sMac=oN.sMa?"&a="+oN.sMa:"";var sMst=oN.sMs?"&s="+oN.sMs:"";hideInbxNB();var oFolderView=getFolderViewElementByFolderId(sId);if(oFolderView&&oFolderView.get_TagName().toLowerCase()=="iframe"){var oCW=oFolderView.get_ContentWindow();try{var oD=oCW.get_Document()}catch(e){oFolderView.remove(true);oFolderView=0}}if(oFolderView&&oFolderView.getBoolAttribute("fError")){oFolderView.remove(true);oFolderView=0}if(oFolderView){var oSubPageController=Owa.Components.SubPageControllerFactory.getControllerByElement(oFolderView);if(sT==T_CAL&&oN.iClr)try{updateColorInCalendarView(oN.iClr,oSubPageController)}catch(e){}setFolderViewStatus(oFolderView,true);if(!fAB){hideOpenMailboxDialog();if(oD)setFolderViewTitleWidth(sId)}try{oSubPageController.invokeFunction("select",[oN])}catch(e){}}else{var oMV=$("divMainView");var iChildCount=0;var oChildToUnload=null;oMV.forEachChild(function(oChild){iChildCount++;if(!getInt(oChild.getAttribute("_cF"))&&oChildToUnload==null)oChildToUnload=oChild});if(iChildCount>=CACHE_MAX&&oChildToUnload){var id=oChildToUnload.get_Id();if(id&&(id.charAt(0)=="b"))id=id.substring(1);if(id!=a_sInbx){cancelFolderSubscription(id)}var oSubPageController=Owa.Components.SubPageControllerFactory.getControllerByElement(oChildToUnload);oSubPageController.remove()}chgAbLvSt(0);sSrc+=urlEnc(sT)+sMac+sMst;if(oN.sFltr)sSrc+="&fltr="+oN.sFltr;if(oN.sPrntFdrUri)sSrc+=oN.sPrntFdrUri;if(sId)sSrc+=((sT!=T_DOC)?"&id=":"&URL=")+urlEnc(sId);if((sT==T_DOC)&&oN.oC)sSrc+=oN.oC;if(oN.sELCId&&isAllwdELCClss(sT))sSrc+="&elcId="+urlEnc(oN.sELCId);if(sT==T_CAL&&oN.iClr)sSrc+="&clr="+oN.iClr;var oSubPageController=Owa.Components.SubPageControllerFactory.createControllerByUrl(oMV,sSrc);var o=oSubPageController._get_Element();o.set_Id("b"+sId);o.set_CssClasses(["mainView"]);o.setAttribute("_cF",oN.fP?"1":"0");o.setExpando("_drty",0);o.setExpando("_nc",oN.fNC);Owa.Components.SubPageControllerFactory.get_CurrentWindowSubPageController().addChildController(oSubPageController)}}function regNotfs(){setFolderViewTitleWidth()}function getSNTr(iM){switch(iM){case NM_MAIL:return g_oMMFrst?g_oMMFrst.gtTr("mail"):null;case NM_PF:return g_oPblcFldrTree;case NM_CTS:return g_oCntTr;case NM_CAL:return g_oCalTr;case NM_TSK:return g_oTskTr}}function loadSecNv(iM,sId,fnOnNav){var sMId=getMN(iM);var oSecNv=$("divSecNv");var oMdSecNv=oSecNv.getDescendantById(sMId);if(oMdSecNv){oMdSecNv.set_IsShown(true);var oTree=getSNTr(iM);var oTreeRegion=oTree?oTree.root.get_ParentElement().get_ParentElement().get_ParentElement():null;if(iM==NM_PF)shwPFFlt();else if(iM==NM_CAL||iM==NM_CTS||iM==NM_TSK){oTree.selNd(oTree.gtNdByAls(AL_DEF))}if(oTreeRegion)Owa.DomUtility.calculateVerticalScrollBar(oTreeRegion)}else if(!oSecNv.getExpando("_prg"+sMId)){oSecNv.setExpando("_prg"+sMId,1);var oCtx={};oCtx.iM=iM;oCtx.sId=sId;oCtx.fnOnNav=fnOnNav;var oR=sv("GetSecondaryNavigation","m",iM,oCtx,cbReqSecNv,1);oR.send()}}function cbReqSecNv(oR){if(oR.sErr){if(oR.fST)rplLgn();else shwErrDlg(oR)}else{var oC=oR.oCtx;updSecNv(oC.iM,oC.sId,oR.sBody,oC.fnOnNav)}var sMId=getMN(oR.oCtx.iM);$("divSecNv").setExpando("_prg"+sMId,0)}function updSecNv(iM,sId,sBody,fnOnNav){var sMId=getMN(iM);var o=Owa.Dom.Document.get_Current().createElement("DIV");$("divSecNv").appendChild(o);o.set_Id(sMId);o.addCssClass("secNvPaneCont");o.set_InnerHtml(sBody);if(a_iNM!=iM){o.set_IsShown(false)}if(fnOnNav)fnOnNav()}function getMN(iM){var rg=[];rg[NM_MAIL]=M_MAIL;rg[NM_CAL]=M_CAL;rg[NM_CTS]=M_CTS;rg[NM_TSK]=M_TSK;rg[NM_AB]="";rg[NM_DOC]=M_DOC;rg[NM_PF]=M_PF;return rg[iM]}function getLMN(iM){var s=null;switch(iM){case NM_CAL:s="lnkCal";break;case NM_CTS:s="lnkCtcts";break;case NM_TSK:s="lnkTsks";break;case NM_DOC:s="lnkDocs";break;case NM_PF:s="lnkPFs";break;default:s="lnkInbx";break}return $(s).get_TextContent().trim()}function tglNvMnu(){var oNbMax=$("divNbMax");var oNbMin=$("divNbMin");var oTree=getSNTr(a_iNM);var f=oNbMax.get_IsShown();oNbMin.set_IsShown(f);oNbMax.set_IsShown(!f);$("divSecNv").set_Bottom($("divNbR").get_OffsetHeight());if(oTree){var oTreeRegion=oTree.root.get_ParentElement().get_ParentElement().get_ParentElement();Owa.DomUtility.calculateVerticalScrollBar(oTreeRegion)}sv("PersistQuickLinksBar","q",f?1:0,null,cbSv).send()}function selectNavigationButton(iNavigationModule){var rg=[];rg[NM_MAIL]="Inbx";rg[NM_CAL]="Cal";rg[NM_CTS]="Ctcts";rg[NM_TSK]="Tsks";rg[NM_DOC]="Docs";rg[NM_PF]="PFs";var sHighlight="nbHiLt";var sNoHighlight="nbNoHiLt";var oOriginalLink=$("lnk"+rg[a_iNM]);var oOriginalLinkQl=$("lnkQl"+rg[a_iNM]);var oTargetLink=$("lnk"+rg[iNavigationModule]);var oTargetLinkQl=$("lnkQl"+rg[iNavigationModule]);if(oOriginalLink.hasCssClass(sHighlight))oOriginalLink.replaceCssClass(sNoHighlight,sHighlight);if(oOriginalLinkQl.hasCssClass(sHighlight))oOriginalLinkQl.replaceCssClass(sNoHighlight,sHighlight);if(oTargetLink.hasCssClass(sNoHighlight))oTargetLink.replaceCssClass(sHighlight,sNoHighlight);if(oTargetLinkQl.hasCssClass(sNoHighlight))oTargetLinkQl.replaceCssClass(sHighlight,sNoHighlight)}function sv(sE,sP,oV,sC,fn,fGet){var oR=new oeReq("Navigation",sE,sC,fn,fGet?GET:POST);oR.add(sP,oV);return oR}function cbSv(oR){if(oR.fST)rplLgn()}function setNavigationPaneWidth(iW,fSave){var iMW=$("divNavHostBody").get_OffsetWidth()-g_iMinRPW;if(iW>iMW)iW=iMW;if(iW<g_iMinVWW)iW=g_iMinVWW;if(fSave&&a_iNW!=iW){a_iNW=iW;if(!g_fAB)sv("PersistWidth","w",iW,null,cbSv).send()}$("divNvPn").set_Width(iW);var oNvDrag=$("divNvDrag");var oViewPane=$("divMainViewPane");if(g_fRtl){oNvDrag.set_Right(iW);oViewPane.set_Right(iW+oNvDrag.get_OffsetWidth())}else{oNvDrag.set_Left(iW);oViewPane.set_Left(iW+oNvDrag.get_OffsetWidth())}var oTree=getSNTr(a_iNM);if(oTree)errorInfobarSizeChangedInTree.call(oTree);positionMailboxQuotaBar()}function initSnDp(sId,fnOnDtChg,fnOnErr,fnOnNavM,sFid){var oDp=new Owa.UIControls.DatePicker($(sId),fnOnDtChg);oDp.set_SubPage(getNavigationPage());oDp.onErr=fnOnErr;oDp.get_OnAfterMonthNavigate().add(fnOnNavM);if(!sFid){sFid=a_sLstFID}var oFolderView=getFolderViewElementByFolderId(sFid);if(oFolderView){if(!oDp.fFBLd){getFB(oDp,[sFid],fnOnErr);oDp.fFBLd=1}}return oDp}function initSnMp(sId,fnOnMChg){var oControl=new Owa.UIControls.MonthPicker($(sId),fnOnMChg);oControl.set_SubPage(getNavigationPage());return oControl}function onErrSnDp(oDivErr,oR,fErr){if(fErr)showErr(oDivErr,oR.sErr,oR.sErrDbg);else hideErr(oDivErr)}function onSnDtChg(){var rgDts=g_oDatePickerManger.getSelDts();var fDoNotSaveViewType=(g_oDatePickerManger.iMode==g_oDatePickerManger.getDp().iMode);g_oDatePickerManger.iMode=g_oDatePickerManger.getDp().iMode;var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(oSubPageController){oSubPageController.invokeFunction("setVw",[rgDts,g_oDatePickerManger.iMode,0,0,0,fDoNotSaveViewType])}}function onNavCal(){if(!g_oCalTr){var oTr=$("calTr");if(oTr){var oTreeRegion=oTr.get_ParentElement().get_ParentElement();g_oCalTr=new Owa.UIControls.NavigationTree(oTr.get_FirstChild());g_oCalTr.set_SubPage(getNavigationPage());g_oCalTr.onClkNd=onCalClkNd;g_oCalTr.onAfRld=onCalAfRld;g_oCalTr.onOpnCal=onOpnCal;makeTreeScrollArea(g_oCalTr);oTreeRegion.attachEvent("dragenter",trStrtAutoScr);oTreeRegion.attachEvent("dragover",trStrtAutoScr);oTreeRegion.attachEvent("mouseout",endAutoScr);oTreeRegion.setExpando("oTgtTr",g_oCalTr);g_rgTreeRegion.push(oTreeRegion)}}var oJD=g_oCalTr.gtNdByAls(AL_DEF);var iClr=oJD.getSavedColor();if(iClr<0)oJD.setHighlightEffect(DEFAULT_CALENDAR_CLASS);else oJD.setDisplayColor(iClr);oJD.stCk(1);g_oDatePickerManger.setPck(initSnDp("dp",onSnDtChg,onErrCalDP,onCalDpNavM),initSnMp("divMp",onSnDtChg),0)}function onOpnCal(sFId){if(a_iNM==NM_CAL){var oSubPageController=getViewSubPageControllerByFolderId(g_oCalTr.gtNdByAls(AL_DEF).gtFId());if(oSubPageController){var oJN=g_oCalTr.gtNdByFId(sFId);if(oJN){updateCalendarTree([],[]);oJN.stCk(1)}oSubPageController.invokeFunction("rfshVw",[this.gtRgFId(),sFId,1])}}}function onCalAfRld(){if(a_iNM==NM_CAL){var oSubPageController=getViewSubPageControllerByFolderId(g_oCalTr.gtNdByAls(AL_DEF).gtFId());if(oSubPageController){var rgId=oSubPageController.invokeFunction("rfshVw",[this.gtRgFId(),this.gtSelFId(),0]);for(var i=0;i<rgId.length;i++){var oJN=g_oCalTr.gtNdByFId(rgId[i]);if(oJN)oJN.stCk(1)}}}}function onCalClkNd(e,oJN){if(!oJN||!((oJN) instanceof(Owa.Components.NavigationFolderTreeNode)))return;var sFid=oJN.gtFId();var iColor=oJN.getSavedColor();var oSubPageController=getViewSubPageControllerByFolderId(g_oCalTr.gtNdByAls(AL_DEF).gtFId());oSubPageController.invokeFunction("tglCal",[sFid,iColor,g_oCalTr.gtRgFId()])}function updateCalendarTree(rgFId,rgClr){if(!isDf(typeof g_oCalTr)||g_oCalTr==null)return;var oDefNd=g_oCalTr.gtNdByAls(AL_DEF);g_oCalTr.forEachNd(function(oJH,oJF){if((oJF) instanceof(Owa.Components.NavigationFolderTreeNode)){var sFId=oJF.gtFId();var i=0;for(;i<rgFId.length;i++){if(rgFId[i]==sFId){oJF.stCk(1);if(oJF.equals(oDefNd)&&rgClr[i]<0)oJF.setHighlightEffect(DEFAULT_CALENDAR_CLASS);else oJF.setDisplayColor(rgClr[i]);break}}if(i==rgFId.length){oJF.stCk(0);oJF.setDisplayColor(CLR_NONE)}}})}function onErrCalDP(oR,fErr){onErrSnDp(wda("divErrDP"),oR,fErr)}function onCalDpNavM(oDp){var rgFId=[];g_oCalTr.forEachNd(function(oJH,oJF){if(oJF.isChkd())rgFId.push(oJF.gtFId())});getFB(oDp,rgFId,onErrCalDP)}function rfrshCal(){var divMainView=wda("divMainView");if(!divMainView)return;for(var i=0;i<divMainView.children.length;i++){var oIF=divMainView.children[i];if(oIF){var oCW=oIF.contentWindow;if(oCW){try{if(isDf(typeof(oCW.a_fCal))&&oCW.a_fCal){if(isDisp(oIF))oCW.refresh();else stDrty(oIF.id.substring(1),1)}}catch(e){}}}}}function SNLStl(o,sC){o.className=sC;var oS=gtStl(o);this.backgroundColor=oS.backgroundColor;this.borderColor=oS.borderTopColor}function onNavTsk(){if(!g_oTskTr){var oTr=$("tskTr");if(oTr){var oTreeRegion=oTr.get_ParentElement().get_ParentElement();g_oTskTr=new Owa.UIControls.NavigationTree(oTr.get_FirstChild());g_oTskTr.set_SubPage(getNavigationPage());g_oTskTr.onSelChng=onTskSelChng;g_oTskTr.onClkNd=clearSearchOnClickTreeNode;g_oTskTr.setSelectionClass("NMTrSel");makeTreeScrollArea(g_oTskTr);oTreeRegion.attachEvent("dragenter",trStrtAutoScr);oTreeRegion.attachEvent("dragover",trStrtAutoScr);oTreeRegion.attachEvent("mouseout",endAutoScr);oTreeRegion.setExpando("oTgtTr",g_oTskTr);g_rgTreeRegion.push(oTreeRegion)}}initSNFlt($("divTskFlt"));g_oTskTr.selNd(g_oTskTr.gtNdByAls(AL_DEF));updTskFlt()}function onTskSelChng(oJO,oJN){if(!oJN)return;var sFid=oJN.gtFId();var oN=nvCtx();oN.fP=oN.fR=1;nav(NM_TSK,T_TSK,sFid,oN);updTskFlt()}function updTskFlt(sFId){sFId=sFId?sFId:a_sLstFID;var oV=getNavigationPage().getLstVw(sFId);if(!oV)return;snFltSet(isPFId(sFId)?$("divPFTskFlt"):$("divTskFlt"),oV.gtFltr())}function onClkTskFlt(sFltId){var oV=getNavigationPage().getLstVw(a_sLstFID);if(!oV||!oV.rfrsh)return;oV.stFltr($(sFltId).getExpando("iCurFlt"));oV.rfrsh()}function refreshTaskViewIfNeed(oRefreshedSubPageController){if(a_iNM!=NM_TSK)return;var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(oSubPageController&&!oSubPageController.equals(oRefreshedSubPageController)){oSubPageController.get_SubPage().udRP(true);var oLV=Owa.PageHierarchy.getVirtualListViewFromSubPageController(oSubPageController);if(oLV)oLV.rfrsh()}}function onNavPF(){if(!g_oPblcFldrTree){var oTr=$("publictree");if(oTr){var oTreeRegion=oTr.get_ParentElement().get_ParentElement();g_oPblcFldrTree=new Owa.UIControls.FolderTree(oTr.get_FirstChild(),0);g_oPblcFldrTree.set_SubPage(getNavigationPage());g_oPblcFldrTree.onSelChng=onPFSelChng;makeTreeScrollArea(g_oPblcFldrTree);oTreeRegion.attachEvent("dragenter",trStrtAutoScr);oTreeRegion.attachEvent("dragover",trStrtAutoScr);oTreeRegion.attachEvent("mouseout",endAutoScr);oTreeRegion.get_ParentElement().setExpando("oTgtTr",g_oPblcFldrTree);g_rgTreeRegion.push(oTreeRegion)}var oM=$("divPFtm");if(oM)Owa.Dom.Document.get_Current().get_Body().insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oM);shwPFFlt()}}function onRenameNavigation(oR,oSndr,sGS,sNId){if(oR.isErr())return;var oTree;if(sGS==GS_CNT)oTree=g_oCntTr;else if(sGS==GS_TSK)oTree=g_oTskTr;else if(sGS==GS_CAL)oTree=g_oCalTr;else if(sGS==GS_FVR&&g_oMMFrst)oTree=g_oMMFrst.gtTr("favorite");if(!oTree)return;var oJN=oTree.gtNdById(padF(sNId));if(sGS==GS_FVR){if(!((oJN) instanceof(Owa.Components.FavoriteFolderTreeNode)))return}else{if(!((oJN) instanceof(Owa.Components.NavigationFolderTreeNode)))return}var oSubPageController=getViewSubPageControllerByFolderId(sGS==GS_CAL?oTree.gtNdByAls(AL_DEF).gtFId():oJN.gtFId());if(!oSubPageController)return;var oRDiv=Owa.Dom.Document.get_Current().createElement("div");oRDiv.set_InnerHtml(oR.sBody);var sName=oRDiv.getDescendantById("ntn").get_TextContent();if(sGS==GS_CAL){oSubPageController.invokeFunction("rnmCal",[oJN.gtFId(),sName])}else{oSubPageController.invokeFunction("renameFolderName",[sName])}}function onRenameFolder(oR,oSndr,sFId){if(oR.isErr())return;var oSubPageController=getViewSubPageControllerByFolderId(sFId);if(!oSubPageController)return;var oRDiv=Owa.Dom.Document.get_Current().createElement("div");oRDiv.set_InnerHtml(oR.sBody);oSubPageController.invokeFunction("renameFolderName",[oRDiv.getDescendantById("tn").get_TextContent()])}var g_rgfFltLd=[];function shwPFFlt(){var sT=g_oPblcFldrTree.gtSelNd().gtFCC();var sId=g_oPblcFldrTree.gtSelNd().gtId();var sFId=g_oPblcFldrTree.gtSelNd().gtFId();var iHasRplc=g_oPblcFldrTree.gtSelNd().getIntAttribute(EXPND_HAS_RPLC);if(isNaN(iHasRplc)){var o={};o.sT=sT;o.sFId=sFId;var oR=new oeReq("Tree","GetPublicFolderReplicaType",o,cbGetPfRt);oR.add("id",sFId);oR.send();return}var sId=getPfFltId(sT);if(sId==0||!iHasRplc){shwPFFDiv(1);return}var o=$(sId);if(o){shwPFFDiv(0,sT);if(isOfClss(sT,T_TSK))updTskFlt(sFId)}else{var oCtx={};oCtx.sT=sT;oCtx.sFId=sFId;var oR=sv("GetPFFilter","t",sT,oCtx,cbGetPFFlt,1);if(isOfClss(sT,T_CAL))oR.add("fId",sFId);oR.send()}}function cbGetPfRt(oR){if(oR.isErr()){return}eval(oR.sBody);if(g_oPblcFldrTree){g_oPblcFldrTree.gtNdByFId(oR.oCtx.sFId).setIntAttribute(EXPND_HAS_RPLC,iHasRplc);shwPFFlt()}}function cbGetPFFlt(oR){if(!cbOeh(oR)){shwPFFDiv(1);return}var sT=oR.oCtx.sT;if(!g_rgfFltLd[sT]){var oP=$("divPFFlt");oP.insertAdjacentHtml(Owa.ElementInsertionPoint.BeforeEnd,oR.sBody);g_rgfFltLd[sT]=1;var o=oP.get_LastChild();if(isOfClss(sT,T_CON)||isOfClss(sT,T_TSK))initSNFlt(o);else if(isOfClss(sT,T_CAL))g_oDatePickerManger.setPck(initSnDp("divPfDp",onSnDtChg,onErrPfDP,onPfDpNavM),initSnMp("divPfMp",onSnDtChg),1);o.set_IsShown(false);shwPFFlt()}}function shwPFFDiv(fH,sT,fR){if(!fH)shwPFFDiv(1,0,1);var oP=$("divPFFlt");oP.set_IsShown(!fH);oP.forEachChild(function(oChild){oChild.set_IsShownAroundIEBug(false)});if(sT){oP.getChildById(getPfFltId(sT)).set_IsShown(!fH)}if(!fR)setPFTreeTop(fH)}function setPFTreeTop(fH){var oDivSecNv=$("divSecNv").getDescendantById(getMN(NM_PF));oDivSecNv.getDescendantById("divPFTrR").set_Top(fH?0:oDivSecNv.getDescendantById("divPFFlt").get_OffsetHeight())}function getPfFltId(sT){if(isOfClss(sT,T_CON))return"divPFCntFlt";else if(isOfClss(sT,T_TSK))return"divPFTskFlt";else if(isOfClss(sT,T_CAL))return"divPFCalFlt";return 0}function onErrPfDP(oR,fErr){onErrSnDp(wda("divErrPfDp"),oR,fErr)}function onPfDpNavM(oDp){getFB(oDp,[a_sLstFID],onErrPfDP)}function opnNew(sId,sT,sELCId,iClr){var sUrl="?ae=Folder&t="+urlEnc(sT)+"&id="+urlEnc(sId);if(sELCId&&(sELCId!=sId)&&isAllwdELCClss(sT))sUrl+="&elcId="+urlEnc(sELCId);if(iClr)sUrl+="&clr="+iClr;sUrl+="&"+PARENT_SUBPAGE_ID_ATTR+"="+getNavigationPage().get_SubPageController().get_UniqueId();sfWinOpn(sUrl)}function showOpenMailboxDialog(){Owa.UIControls.OpenMailboxDialog.showDialog()}function hideOpenMailboxDialog(){Owa.UIControls.OpenMailboxDialog.hideDialog()}function OnPrsncCmClk(oEventArgs){switch(oEventArgs.sCommand){case"opnMbx":showOpenMailboxDialog();break;case"signinim":ImSIR(0,1,1);break;case"signoutim":var oRCtx={};sndIMReq(IM_SO,null,null,oRCtx);break;default:var oRCtx={};oRCtx.sC=oEventArgs.sCommand;if(oEventArgs.sCommand!="reset")oRCtx.prsnc=gtPrsncValFrmNm(oEventArgs.sCommand);oRCtx.feOnErr=onPrsncChngErr;sndIMReq(IM_CPR,cbPrsncChngd,null,oRCtx);break}}function cbPrsncChngd(oRCtx,sBody){if(oRCtx.sC=="reset"){if(isDf(typeof(sBody))&&sBody)gtPrsncIdFrmVal(sBody);else return}else stSlfPrsnc(gtPrsncIdFrmVal(oRCtx.prsnc))}function onPrsncChngErr(sErr,status){alrt(L_ErrIMPr,null,Owa.BUTTON_DIALOG_ICON.WARNING,L_ErrIMPrTtl)}function opnLoc(){g_oOpnLocDlg=new OpnLocDlg(onOpnLocCls);var oOpnLocDlg=$("divOpnLocDlg");var oOpnLocBtn=$("divOpnLoc");var y=oOpnLocBtn.get_DocumentTop()+oOpnLocBtn.get_OffsetHeight()+1;g_oOpnLocDlg.show((g_fRtl?(oOpnLocBtn.get_DocumentLeft()+oOpnLocBtn.get_OffsetWidth()-oOpnLocDlg.get_OffsetWidth()):oOpnLocBtn.get_DocumentLeft()),y);wda("inpOpnLoc").select();oOpnLocDlg.attachEvent("keydown",kdOpnLoc);oOpnLocBtn.addCssClass("opnLocHightlight")}function onOpnLocCls(){$("divOpnLoc").removeCssClass("opnLocHightlight")}function OpnLocDlg(fnCls){var oOpnLocBtn=wda("divOpnLoc");var sHtml="<div id=\"divOpnLocDlg\"><div class=\"opnLocDlgTtl\">"+"<img class=\"opnLocClsImg\" onclick=\"g_oOpnLocDlg.hide();\" src=\""+getThmF("closedlg.gif")+"\">"+oOpnLocBtn.getAttribute("L_OpnLoc")+"</div><div class=\"opnLocMnRg\"><div class=\"opnLocMn\"><div>"+oOpnLocBtn.getAttribute("L_OpnLocDesc")+"</div><input type=\"text\" id=\"inpOpnLoc\"></div><div class=\"opnLocBtnRg\"><div id=\"divOpnLocPrg\"><img class=\"opnLocPrgImg\" src=\""+getThmF("pgrs-sm.gif")+"\"><div class=\"opnLocPrgTxt\">"+oOpnLocBtn.getAttribute("L_Opning")+"</div></div><button id=\"btnOpnLoc\" onclick=\"clkOpnLoc()\" onmouseover=\"btnOnMsOvrBtn(this)\" onmouseout=\"btnOnMsOutBtn(this)\">"+oOpnLocBtn.getAttribute("L_Opn")+"</button></div></div></div>";var oDlg=new Dlg("divOpnDocLib",sHtml,0,1,0,0);oDlg.get_OnClose().add(fnCls);return oDlg}function clkOpnLoc(){var oInpOL=wda("inpOpnLoc");var sU=oInpOL.value.trim();oInpOL.value=sU;if(sU.length==0){setFcs(oInpOL);return}var oOpnLocDlgBtn=$("btnOpnLoc");var oOpnLocBtn=wda("divOpnLoc");var f=(oOpnLocDlgBtn.get_TextContent()==oOpnLocBtn.getAttribute("L_Opn"));wda("divOpnLocPrg").style.visibility=f?"visible":"";oInpOL.disabled=f;oOpnLocDlgBtn.set_TextContent(oOpnLocBtn.getAttribute(f?"L_Cncl":"L_Opn"));if(!f)oInpOL.select();else clsLnk(sU)}function clsLnk(sU){var oR=new oeReq("DocumentLibrary","ClassifyLink",sU,cbClsLnk);oR.add("uri",sU);oR.send()}function cbClsLnk(oR){var oOpnLocDlgBtn=$("btnOpnLoc");var oOpnLocBtn=wda("divOpnLoc");if(!wda("divOpnLocDlg")||(oOpnLocDlgBtn.get_TextContent()==oOpnLocBtn.getAttribute("L_Opn")))return;if(oR.sErr){if(oR.fST){rplLgn()}else{clkOpnLoc();alrt(L_InvUri)}return}var oD=Owa.Dom.Document.get_Current().createElement("DIV");oD.set_InnerHtml(oR.sBody);var oErr=oD.getDescendantById("err");if(oErr){clkOpnLoc();var oOpnLocLib=wda("divOpnDocLib");var okDlg=new BtnDlg("idOkDlg",htmlEnc(oErr.getAttribute("_msg")),oErr.getAttribute("_ttl"),[oOpnLocBtn.getAttribute("L_OK")],null,parseInt(oErr.getAttribute("_icn")),opnDlgOnCls,oOpnLocLib);okDlg.show();return}var sU=oD.getDescendantById("uri").get_TextContent();var iUF=parseInt(oD.getChildById("uf").get_TextContent());var sId=oD.getDescendantById("oid").get_TextContent();var iFWR=oD.getDescendantById("divFwr").get_TextContent();if(iFWR==1)opnWebRFrm(sU,iUF);else opnDocItm(sU,iUF,sId);g_oOpnLocDlg.hide()}function opnDlgOnCls(){wda("inpOpnLoc").select()}function kdOpnLoc(oEvent){switch(oEvent.get_KeyCodeForKeyUpDown()){case 13:clkOpnLoc();break;case 27:g_oOpnLocDlg.hide();break}oEvent.cancelBubble()}function edtLib(){var oDfm=wda("divDfm");var o=oDfm.docLib;var oS=getDocLibSpn(o);var oT=document.createElement("INPUT");oT.type="text";oT.value=oS.innerText;oT.onkeydown=onKDLib;oT.maxLength=255;oT.className="docFavDNEdt";iae(oS,oT);hideEm(oS);var oC={};oC.spn=oS;oC.txt=oT;oC.docLib=oDfm.docLib;oT.oC=oC;oT.select();oT.onfocusout=renLib;oT.oncontextmenu=canEvt;oT.onclick=canEvt}function onKDLib(e){var oE=e||event;var oT=getEvtTgt(oE);if(getKeyCode(oE)==13)oT.blur();else if(getKeyCode(oE)==27)rstrLib(oT.oC);cnclBbl(event)}function renLib(e){if(!e)e=event;var sV=getEvtTgt(e).value;var oC=getEvtTgt(e).oC;if((sV.length==0)||(sV==oC.spn.innerText)){rstrLib(oC);return}var oR=new oeReq("DocumentLibrary","RenFav",oC,cbRenLib);oR.add("uri",oC.docLib.uri);oR.add("dn",sV);oR.send()}function cbRenLib(oR){if(oR.sErr){if(oR.fST)rplLgn();return}var oC=oR.oCtx;oC.spn.innerText=oC.txt.value;var sT=oC.docLib.title;oC.docLib.title=oC.txt.value+"\n"+sT.substring(sT.indexOf("\n")+1);rstrLib(oC)}function rstrLib(oC){rn(oC.txt);showEm(oC.spn);oC.docLib.style.backgroundColor=""}function delLib(){var oDfm=wda("divDfm");var oR=new oeReq("DocumentLibrary","DelFav",oDfm.docLib,cbDelLib);oR.add("uri",oDfm.docLib.uri);oR.send()}function cbDelLib(oR){if(oR.sErr){if(oR.fST)rplLgn();return}rn(oR.oCtx)}function isDispOF(){return isDisp(wda("divFavFldrs"))}function tglDocBlk(){var oFavFldrs=$("divFavFldrs");if(oFavFldrs.get_IsShown()){oFavFldrs.set_IsShown(false);$("imgFavFldrs").setAttribute("src",g_sExpIco);svDocBlkSt(0)}else{if(!oFavFldrs.hasChildNodes()){new oeReq("DocumentLibrary","GetFavFldrs",0,cbGetBlk).send()}else{oFavFldrs.set_IsShown(true);$("imgFavFldrs").setAttribute("src",g_sClpsIco);svDocBlkSt(1)}}}function cbGetBlk(oR){if(oR.sErr){if(oR.fST)rplLgn()}else{var o=wda("divFavFldrs");showEm(o);wda("imgFavFldrs").src=g_sClpsIco;o.innerHTML=oR.sBody}}function svDocBlkSt(iV){var oR=new oeReq("DocumentLibrary","PersistFavFldrs",null,cbSv);oR.add("fV",iV);oR.send()}function shwDocMnu(o,fF){var oDfm=wda("divDfm");var oDfmD=wda("divDfmD");var oDfmR=wda("divDfmR");if(!oDfm.show)CtxMnu(oDfm,getNavigationPage().get_ActionHandler());showEms([oDfmD,oDfmR],!fF);oDfmD.setAttribute("_lnk",fF?1:0);oDfmR.setAttribute("_lnk",fF?1:0);oDfm.docLib=o;oDfm.show(event)}function getDocLibSpn(o){return getOneDescendant(o,"spnDocFavDN")}function procRm(iOp,sC,rgS,sRT,iT){if(Owa.Components.OehRequest.hasPendingRequests())return;var oC={};oC.iOp=iOp;oC.rgS=rgS;var oR=new oeReq("RemindersEventHandler",sC,oC,cbProcRm);if(iT)oR.add("Snt",iT);if(sRT)oR.add("LRT",new Date(sRT));var rg=rmGetRemindersInfo(oR,rgS);if(!rg||!rg.length)return;oR.addRgSt("Rm",rg);oR.send()}function cbProcRm(oR){if(oR.sErr){if(oR.fST)popLgn();else shwErrDlg(oR)}else{var oC=oR.oCtx;var iOp=oC.iOp;var rgS=oC.rgS;var oRDlg=Owa.UIControls.ReminderDialog.getDialog();oRDlg.removeItems(rgS,iOp,iOp==OP_SNZ?eval(oR.sBody):null);if((oRDlg.getItems().length<1)&&oRDlg.isOpened()){oRDlg.hide()}else if(oRDlg.isOpened()){var o=oRDlg.getItems()[0];if(oRDlg.nxtSelId)o=oRDlg.getItemById(oRDlg.nxtSelId);oRDlg.selectItem(o,1,1)}}}function rmToStrc(oRI,oR){var oRS=new oeSt(oR,"rmInfo");oRS.add("id",oRI.id);oRS.add("ck",oRI.ck);return oRS}function getReminderItemId(o){return o.get_Id().substring(1)}function RmInfo(o){this.id=getReminderItemId(o);this.ck=o.getAttribute("ck")}function rmGetRemindersInfo(oR,rgS){var rg=[];for(var i=0;i<rgS.length;i++){var o=rgS[i];var oRm=new RmInfo(o);rg.push(rmToStrc(oRm,oR))}return rg}function Rrsp(sCk,sRnt,fD){this.ck=sCk;this.r=sRnt;this.fD=fD?1:0}function showNotificationButton(sButtonId,f){if(f){resetAlertBarWidth()}$(sButtonId).set_IsShown(f);setFolderViewTitleWidth();setAlertBarWidth()}function resetAlertBarWidth(){$("divAlertBar").set_Width($("divMainViewPane").get_ClientWidth())}function setAlertBarWidth(){if(!g_fAB)$("divAlertBar").set_Width(getAlertBarWidth())}function getAlertBarWidth(){var iWidth=0;if(!g_fAB){var oHelp=$("lnkHelp");var oMeasure=$("divAlertMeasure");var oMainPage=$("divMainPage");if(oMeasure.get_DocumentTop()<oHelp.get_DocumentTop()+oHelp.get_OffsetHeight()){if(g_fRtl)iWidth=oMeasure.get_DocumentLeft()+oMeasure.get_OffsetWidth();else iWidth=oMainPage.get_ClientWidth()-oMeasure.get_DocumentLeft();iWidth+=1}else{iWidth=$("divMainView").get_ClientWidth()}}return iWidth>0?iWidth:0}function setFolderViewTitleWidth(){if(g_fAB)return;var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(oSubPageController)oSubPageController.invokeFunction("setTitleWidth",[oSubPageController.get_SubPage()])}function getTitleWidth(){var iTitleWidth=-1;if(!g_fAB)iTitleWidth=$("divMainView").get_ClientWidth()-getAlertBarWidth();return iTitleWidth>=0?iTitleWidth:-1}function applyNotificationButtonStyle(f,sButtonId){if(!sButtonId)return;Owa.Components.ToolbarCollection.get(getNavigationPage()).set_IsButtonPushed(sButtonId,f)}function initSNL(oL,fDsp){prepSNLEnts(oL,fDsp);oL.setExpando("oSelItm",null)}function prepSNLEnts(oList,fDsp){var rgItms=oList.getAllDescendantsById("divEnt");for(var i=0;i<rgItms.length;i++){if(fDsp){rgItms[i].detachEvent("mouseover",onMOvrSNL);rgItms[i].detachEvent("mouseout",onMOutSNL);rgItms[i].detachEvent("click",onClkSNL)}else{if(rgItms[i].getExpando("_init"))continue;rgItms[i].attachEvent("mouseover",onMOvrSNL);rgItms[i].attachEvent("mouseout",onMOutSNL);rgItms[i].attachEvent("click",onClkSNL);rgItms[i].setAttribute("title",rgItms[i].get_TextContent());rgItms[i].setExpando("_init",1)}}}function snlSelEnt(oList,oItemToSelect){var oItemSelected=oList.getExpando("oSelItm");if(oItemSelected&&oItemSelected.equals(oItemToSelect))return;if(oItemSelected!=null)oItemSelected.replaceCssClass("snlDef","snlSel");oItemToSelect.removeCssClass("snlHvr");oItemToSelect.removeCssClass("snlDef");oItemToSelect.addCssClass("snlSel");oList.setExpando("oSelItm",oItemToSelect)}function snlUnsel(oList){var oItemSelected=oList.getExpando("oSelItm");if(oItemSelected)oItemSelected.replaceCssClass("snlDef","snlSel");oList.setExpando("oSelItm",null)}function onMOvrSNL(e){var oItem=gtSNLEnt(e.get_Target());var oList=gtSNL(oItem);var oItemSelected=oList.getExpando("oSelItm");if(!oItemSelected||!oItemSelected.equals(oItem))oItem.replaceCssClass("snlHvr","snlDef")}function onMOutSNL(e){var oItem=gtSNLEnt(e.get_Target());if(oItem.hasCssClass("snlHvr")){var oList=gtSNL(oItem);var oItemSelected=oList.getExpando("oSelItm");if(!oItemSelected||!oItemSelected.equals(oItem)){oItem.replaceCssClass("snlDef","snlHvr")}}}function onClkSNL(e){var oItem=gtSNLEnt(e.get_Target());var oList=gtSNL(oItem);snlSelEnt(oList,oItem);eval(oItem.getAttribute("_onclick"))}function gtSNLEnt(o){while(o&&o.get_Id()!="divEnt")o=o.get_ParentElement();return o}function gtSNL(o){while(o&&!getInt(o.getAttribute("fSNL")))o=o.get_ParentElement();return o}function initSNFlt(oF){oF.setExpando("iCurFlt",0);var rgItms=oF.getAllDescendantsById("divSecNvFltItm");for(var i=0;i<rgItms.length;i++){var oChild=rgItms[i];if(oChild.get_FirstChild().get_FirstChild().get_IsChecked())oF.setExpando("iCurFlt",getInt(oChild.getAttribute("_iF")));oChild.attachEvent("click",onClkSNFlt)}}function snFltSet(oFilterList,iF){var rgItms=oFilterList.getAllDescendantsById("divSecNvFltItm");for(var i=0;i<rgItms.length;i++){var oChild=rgItms[i];if(getInt(oChild.getAttribute("_iF"))==iF){oChild.get_FirstChild().get_FirstChild().set_IsChecked(true);oFilterList.setExpando("iCurFlt",iF);break}}}function onClkSNFlt(e){var oFltItm=e.get_Target();while(oFltItm&&oFltItm.get_Id()!="divSecNvFltItm")oFltItm=oFltItm.get_ParentElement();var oF=gtSNFlt(oFltItm);oFltItm.get_FirstChild().get_FirstChild().set_IsChecked(true);oF.setExpando("iCurFlt",getInt(oFltItm.getAttribute("_iF")));eval(oF.getAttribute("_onclick"))}function gtSNFlt(o){while(o&&!getInt(o.getAttribute("fSNFlt")))o=o.get_ParentElement();return o}function opnShrDlg(){new Owa.UIControls.OpenOtherFolderInNavPane(getNavigationPage()).clickButton(a_iNM)}function updateColorInCalendarView(sV,oSubPageController,sFId){if(!oSubPageController)oSubPageController=getViewSubPageControllerByFolderId(g_oCalTr.gtNdByAls(AL_DEF).gtFId());if(sFId){try{oSubPageController.invokeFunction("refClrByFId",[sFId,sV])}catch(e){}}}function cbSetColor(oR){if(oR.sErr){if(oR.fST){popLgn()}else{shwErrDlg(0,oR.sErr)}return}}var g_fQtFlg=0;function getMailboxUsage(fShw,iX,iY){var oMbQt=$("divMbxQt");if(!getInt(oMbQt.getAttribute("_fDsp"))&&!fShw){return}if(g_fQtFlg==0){g_fQtFlg=1;var oCtx={};oCtx.fShw=fShw?1:0;oCtx.iX=iX;oCtx.iY=iY;new oeReq("Tree","GetMailboxUsage",oCtx,cbGetMailboxUsage,POST).send()}}function cbGetMailboxUsage(oR){if(oR.isErr()){if(oR.fST)popLgn();shwErrDlg(oR)}else{updateMailboxUsage(oR.sBody,oR.oCtx.fShw,oR.oCtx.iX,oR.oCtx.iY)}g_fQtFlg=0}function updateMailboxUsage(sHtml,fShw,iX,iY){hideMailboxUsage();var oMbQt=$("divMbxQt");var oMbQtRg=$("divMbxQtRg");var oOwaBody=$("divNavHostBody");if(oMbQt!=null){oMbQtRg.set_InnerHtml(sHtml);oMbQt=oMbQtRg.getDescendantById("divMbxQt");if(getInt(oMbQt.getAttribute("_fDsp"))){oMbQtRg.set_IsShown(true)}else if(fShw){var iW=180;oMbQt.remove(true);oMbQtRg.set_IsShown(false);oMbQt.addCssClass("floatMbxQt");if(g_fRtl)iX=iX-iW;oMbQt.set_Left(iX);oMbQt.set_Top(iY);oOwaBody.appendChild(oMbQt)}}}function hideMailboxUsage(){var oMbQt=$("divMbxQt");var oMbQtRg=$("divMbxQtRg");if(oMbQt){if(!getInt(oMbQt.getAttribute("_fDsp"))){oMbQt.remove(true);oMbQt.removeCssClass("floatMbxQt");oMbQtRg.appendChild(oMbQt);oMbQt.set_Left(0);oMbQt.set_Top(0)}}}function opnPrsncMnu(){g_oPresenceMenu.showUnder($("aUserTile"),-5,true)}function isAllwdELCClss(sT){return(sT.startsW(T_MSG)||(sT==T_NTS))}function pmSetPck(oDp,oMp,fPF){var t=this;t.fPF=fPF;if(fPF){if(t.oPfDp){t.oPfDp.dispose()}if(t.oPfMp){t.oPfMp.dispose()}t.oPfDp=oDp;t.oPfMp=oMp}else{if(t.oDp){t.oDp.dispose()}if(t.oMp){t.oMp.dispose()}t.oDp=oDp;t.oMp=oMp}}function pmGetDp(){return this.fPF?this.oPfDp:this.oDp}function pmGetMp(){return this.fPF?this.oPfMp:this.oMp}function pmSetVT(iVT,fPF,fS){var t=this;t.fMV=(iVT==DP_MTH);t.fPF=fPF;t.iMode=t.getDp().iMode=iVT;if(!fS)return;var o=wda(fPF?"divErrPfDp":"divErrDp");if(o)hideEm(o);var oDp=t.getDp();var oMp=t.getMp();if(!oDp||!oMp)return;oDp.shw(t.fMV);oMp.shw(!t.fMV)}function pmSelDs(rgDt){if(this.getDp())this.getDp().setSDs(rgDt)}function pmSelM(oDt){if(this.getMp())this.getMp().selYM(oDt.gyr(),oDt.gmo()+1,1)}function pmGetSelDts(){var oP=this.fMV?this.getMp():this.getDp();return oP.getSelDts()}function datePickerManagerDispose(){if(this.oPfDp){this.oPfDp.dispose();this.oPfDp=null}if(this.oPfMp){this.oPfMp.dispose();this.oPfMp=null}if(this.oDp){this.oDp.dispose();this.oDp=null}if(this.oMp){this.oMp.dispose();this.oMp=null}}function PckMgr(){this.fPF=this.fMV=this.oPfDp=this.oDp=this.oPfMp=this.oMp=0;this.setPck=pmSetPck;this.getDp=pmGetDp;this.getMp=pmGetMp;this.getSelDts=pmGetSelDts;this.setVT=pmSetVT;this.selDs=pmSelDs;this.selM=pmSelM;this.dispose=datePickerManagerDispose}var RCP_CCH_TM=60000*60*10;function updSrvRcpCch(){var oR=new oeReq("RecipWell","SvCchBE",null,null,POST,null,false,true);oR.send();window.setTimeout(updSrvRcpCch,RCP_CCH_TM)}function setFolderViewStatus(oFrameElement,fShow){var oSubPageController=Owa.Components.SubPageControllerFactory.getControllerByElement(oFrameElement);oSubPageController.set_IsShown(fShow)}function getWCY(o){var iY=getCY(o);var oW=god(o).parentWindow;if(!isWP()){while(1){try{var oFE=oW.frameElement;var oF=oFE.document.parentWindow;if(!oF.g_fOwa)break;iY+=getCY(oFE);oW=oF}catch(e){break}}}return iY}function logOff(){try{location="logoff.owa"}catch(e){}}function opnPrvcyStmt(){opnWin("http://go.microsoft.com/fwlink/?LinkId=91487",null,null,null,null,null,null,getNavigationPage())}function dbgCnsl(){var prfCnsOn=0;try{if((g_oPrfCnsl)&&(g_oPrfCnsl.dbgWinDsptch)){g_oPrfCnsl.dbgWinDsptch("");prfCnsOn=1}}catch(e){}if(prfCnsOn){var oD=new OKDlg(L_Err2PrfCnsOpnd,null,null,Owa.BUTTON_DIALOG_ICON.WARNING,L_PrfCns);oD.show()}else{g_oPrfCnsl=opnWin("?ae=Dialog&t=PerfConsole",a_iPCW,a_iPCH,1,null,null,null,getNavigationPage())}}function setNEI(oR){g_oNE=oR}function shwNEI(){if(g_oNE)shwErrDlg(g_oNE)}function excPrfCnsl(sScrpt){var thrE=0;try{if((g_oPrfCnsl)&&(g_oPrfCnsl.clctOeh)&&(g_oPrfCnsl.dbgWinDsptch)){thrE=1;g_oPrfCnsl.dbgWinDsptch(sScrpt)}}catch(e){if(thrE)throw e}}function safeResizeBodies(){}function resizeBodyOffset(){}if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/treenode.js".toLowerCase()])(function(){var CONTENT_OFFSET=19;Owa.Components.TreeNode=function Owa$Components$TreeNode(el,tr){Owa.Components.TreeNode.constructBase(this);this._oElement=el;this._tr=tr};Owa.Components.TreeNode.createClass("Owa.Components.TreeNode",Owa.Components.Control);var _oPrototype=Owa.Components.TreeNode.prototype;_oPrototype._fClearTimeoutCallbackInDisposing=true;Owa.Components.TreeNode.prototype.equals=function Owa$Components$TreeNode$equals(oJN){return oJN&&this.inTr(oJN._tr)&&this.gtId()==oJN.gtId()};Owa.Components.TreeNode.prototype._get_Element=function Owa$Components$TreeNode$_get_Element(){return this._oElement};Owa.Components.TreeNode.prototype.get_Id=function Owa$Components$TreeNode$get_Id(){return this._oElement.get_Id()};Owa.Components.TreeNode.prototype.isRt=function Owa$Components$TreeNode$isRt(){var o=this.getContainer().get_ParentElement();if(o)return o.getExpando("isRoot")};Owa.Components.TreeNode.prototype.hdCnt=function Owa$Components$TreeNode$hdCnt(){this.getContent().set_IsShown(false)};Owa.Components.TreeNode.prototype.shwCnt=function Owa$Components$TreeNode$shwCnt(){this.getContent().set_IsShown(true)};Owa.Components.TreeNode.prototype.gtDspNm=function Owa$Components$TreeNode$gtDspNm(){return this.getContent().get_TextContent()};Owa.Components.TreeNode.prototype.stDspNm=function Owa$Components$TreeNode$stDspNm(sDisplayName){this.getContent().set_TextContent(sDisplayName)};Owa.Components.TreeNode.prototype.hsChld=function Owa$Components$TreeNode$hsChld(){return this._get_Element().getAttribute("_hsChld")};Owa.Components.TreeNode.prototype.getChildIndent=function Owa$Components$TreeNode$getChildIndent(){var iChildIndent=this._get_Element().getIntAttribute("_chldIndnt");return iChildIndent?iChildIndent:0};Owa.Components.TreeNode.prototype.getIndent=function Owa$Components$TreeNode$getIndent(){var iIndent=this._get_Element().getIntAttribute("_indnt");return iIndent?iIndent:0};Owa.Components.TreeNode.prototype.setIndent=function Owa$Components$TreeNode$setIndent(iIndent){var oEC=this.gtEC();var oContent=this.getContent();if(oEC){if(g_fRtl){oEC.set_Right(iIndent)}else{oEC.set_Left(iIndent)}}if(oContent){if(g_fRtl){oContent.set_Right(iIndent+CONTENT_OFFSET)}else{oContent.set_Left(iIndent+CONTENT_OFFSET)}}this._get_Element().setIntAttribute("_indnt",iIndent)};Owa.Components.TreeNode.prototype.gtEC=function Owa$Components$TreeNode$gtEC(){return this.gtHl().getChildById(EC)};Owa.Components.TreeNode.prototype.getContainer=function Owa$Components$TreeNode$getContainer(){return this.gtHl().get_ParentElement()};Owa.Components.TreeNode.prototype.gtHl=function Owa$Components$TreeNode$gtHl(){return this._get_Element().get_ParentElement()};Owa.Components.TreeNode.prototype.gtCC=function Owa$Components$TreeNode$gtCC(){return this.getContainer().getChildById(NODE_CHILDREN)};Owa.Components.TreeNode.prototype.gtId=function Owa$Components$TreeNode$gtId(){return this._get_Element().get_Id()};Owa.Components.TreeNode.prototype.getContent=function Owa$Components$TreeNode$getContent(){return this._get_Element().getChildById(NODE_CONTENT)};Owa.Components.TreeNode.prototype.gtImg=function Owa$Components$TreeNode$gtImg(){return this._get_Element().getChildById(NODE_ICON)};Owa.Components.TreeNode.prototype.stUTD=function Owa$Components$TreeNode$stUTD(fValue){this._get_Element().setAttribute("_sync",fValue?null:"1")};Owa.Components.TreeNode.prototype.isUTD=function Owa$Components$TreeNode$isUTD(){return !this._get_Element().getAttribute("_sync")};Owa.Components.TreeNode.prototype.canMv=function Owa$Components$TreeNode$canMv(){return 0};Owa.Components.TreeNode.prototype.canCp=function Owa$Components$TreeNode$canCp(){return 0};Owa.Components.TreeNode.prototype.canDel=function Owa$Components$TreeNode$canDel(){return 0};Owa.Components.TreeNode.prototype.canCrt=function Owa$Components$TreeNode$canCrt(){return 0};Owa.Components.TreeNode.prototype.canRnm=function Owa$Components$TreeNode$canRnm(){return 0};Owa.Components.TreeNode.prototype.inTr=function Owa$Components$TreeNode$inTr(tr){return this._tr.root.equals(tr.root)};Owa.Components.TreeNode.prototype.isExp=function Owa$Components$TreeNode$isExp(){return this._get_Element().getAttribute("_exp")};Owa.Components.TreeNode.prototype.getIntAttribute=function Owa$Components$TreeNode$getIntAttribute(sName){return this._get_Element().getIntAttribute(sName)};Owa.Components.TreeNode.prototype.setIntAttribute=function Owa$Components$TreeNode$setIntAttribute(sName,iV){return this._get_Element().setIntAttribute(sName,iV)};Owa.Components.TreeNode.prototype.isEC=function Owa$Components$TreeNode$isEC(oN){return oN.get_Id()==EC};Owa.Components.TreeNode.prototype._onBeforeContextMenu=function Owa$Components$TreeNode$_onBeforeContextMenu(mnu){return true};Owa.Components.TreeNode.prototype.shwPrg=function Owa$Components$TreeNode$shwPrg(iTO,iImg){if(this._get_Element().getExpando("_prg"))return;var oPrg={};oPrg={};oPrg._img=iImg;oPrg._tid=this._setTimeout(this.shwPrgTO,iTO);this._get_Element().setExpando("_prg",oPrg)};Owa.Components.TreeNode.prototype.shwPrgTO=function Owa$Components$TreeNode$shwPrgTO(){var oElement=this._get_Element();var o=oElement.getExpando("_prg");if(!o)return;o._tid=0;var oImg=o._img?this.gtImg():this.gtEC();var sClss=o._img?"prI":"prEC";var sH="<img id="+PR+" class=\""+sClss+"\" src=\""+g_sTimerIco+"\">";if(oImg){oImg.set_IsShown(false);oImg.insertAdjacentHtml("beforeBegin",sH)}else{oElement.insertAdjacentHtml("beforeBegin",sH)}var oProgImg=this.gtHl().getChildById(PR);if(oProgImg){if(g_fRtl){oProgImg.set_Right(this.getIndent())}else{oProgImg.set_Left(this.getIndent())}}};Owa.Components.TreeNode.prototype.hdPrg=function Owa$Components$TreeNode$hdPrg(){var o=this._get_Element().getExpando("_prg");if(!o)return;this._get_Element().setExpando("_prg",null);if(o._tid)return this._clearTimeout(o._tid);var oProgImg=this.gtHl().getChildById(PR);if(oProgImg){oProgImg.remove(true)}var oImg=o._img?this.gtImg():this.gtEC();if(oImg){oImg.set_IsShown(true)}};Owa.Components.TreeNode.prototype.tggl=function Owa$Components$TreeNode$tggl(){if(this.isExp())this.collapse();else this.expand()};Owa.Components.TreeNode.prototype.sync=function Owa$Components$TreeNode$sync(){if(this.hsChld()&&!this.isUTD()&&this._tr.getChildren){this._tr.getChildren(this);this.shwPrg(1);return 1}};Owa.Components.TreeNode.prototype.persistExp=function Owa$Components$TreeNode$persistExp(f){};Owa.Components.TreeNode.prototype.expand=function Owa$Components$TreeNode$expand(){if(this.isExp()||!this.hsChld())return;var oC=this.gtCC();if(!oC||!oC.hasChildNodes())if(this.sync())return;this._get_Element().setAttribute("_exp","1");this.upd();this._tr.fireOnResize();this.persistExp(1)};Owa.Components.TreeNode.prototype.collapse=function Owa$Components$TreeNode$collapse(){if(!this.isExp())return;this._get_Element().setAttribute("_exp",null);this.upd();this._tr.fireOnResize();this.persistExp(0)};Owa.Components.TreeNode.prototype.upd=function Owa$Components$TreeNode$upd(){var oC=this.gtCC();var oEC=this.gtEC();var fCC=oC&&oC.hasChildNodes()?"1":null;if(!fCC&&oC)oC.set_IsShown(false);if(this.hsChld()!=fCC&&this.isUTD())this._get_Element().setAttribute("_hsChld",fCC);if(this.hsChld()){if(oEC)oEC._get_DomNode().style.cursor=POINTER;if(this.isExp()){if(oEC)Owa.Components.CssSprites.updateImage(oEC,g_sMinusIco);oC.set_IsShown(true)}else{if(oEC){Owa.Components.CssSprites.updateImage(oEC,g_sPlusIco)}else{var sH=this._tr.mkECH(g_sPlusIco,this._get_Element());var iIndent=this.getIndent();this.gtHl().insertAdjacentHtml(Owa.ElementInsertionPoint.AfterBegin,sH);this.setIndent(iIndent)}if(oC){oC.set_IsShown(false)}}}else{if(oEC){Owa.Components.CssSprites.updateImage(oEC,g_sNoChildIco);oEC._get_DomNode().style.cursor=AUTO}}};Owa.Components.TreeNode.prototype.setHighlightEffect=function Owa$Components$TreeNode$setHighlightEffect(sClassName,oStyleObject){var oHighlightEffect=this.gtHl().getChildById(NODE_EFFECT);if(sClassName||oStyleObject){if(!oHighlightEffect){oHighlightEffect=this._tr.root.get_OwnerDocument().createElement(DIV);oHighlightEffect.set_Id(NODE_EFFECT);this.gtHl().insertAdjacentElement(Owa.ElementInsertionPoint.AfterBegin,oHighlightEffect)}}else{if(oHighlightEffect)oHighlightEffect.remove();return}if(sClassName){oHighlightEffect.set_CssClasses(["trNdSel",sClassName])}else{var oHlS=oHighlightEffect._get_DomNode().style;oHlS.backgroundColor=oStyleObject.bgC?oStyleObject.bgC:"";oHlS.borderColor=oStyleObject.bdrC?oStyleObject.bdrC:"";oHlS.borderStyle=oStyleObject.bdrS?oStyleObject.bdrS:"";oHlS.borderWidth=oStyleObject.bdrW?oStyleObject.bdrW:"";oHlS.color=oStyleObject.c?oStyleObject.c:""}};Owa.Components.TreeNode.prototype.clearHighlightEffect=function Owa$Components$TreeNode$clearHighlightEffect(){var oHighlightEffect=this.gtHl().getChildById(NODE_EFFECT);if(oHighlightEffect)oHighlightEffect.remove(true)};Owa.Components.TreeNode.prototype.canSel=function Owa$Components$TreeNode$canSel(){return !this._get_Element().getAttribute("_nosel")};Owa.Components.TreeNode.prototype.isSel=function Owa$Components$TreeNode$isSel(){return this._get_Element().getAttribute("_sel")};Owa.Components.TreeNode.prototype.stSel=function Owa$Components$TreeNode$stSel(fS){this._get_Element().setAttribute("_sel",fS?"1":null)};Owa.Components.TreeNode.prototype.stHl=function Owa$Components$TreeNode$stHl(fHl){if(fHl){this.setHighlightEffect(this._tr.getSelectionClass());this._get_Element().setAttribute("_hl","1")}else{this.clearHighlightEffect(this._tr.getSelectionClass());this._get_Element().setAttribute("_hl",null)}};Owa.Components.TreeNode.prototype.isHl=function Owa$Components$TreeNode$isHl(){return this._get_Element().getAttribute("_hl")};Owa.Components.TreeNode.prototype.stDrpHl=function Owa$Components$TreeNode$stDrpHl(fD){if(fD)this.setHighlightEffect(this._tr.getDragEffectClass());else this.stHl(this.isSel())};Owa.Components.TreeNode.prototype.canDrg=function Owa$Components$TreeNode$canDrg(){return 0};Owa.Components.TreeNode.prototype.onDrg=function Owa$Components$TreeNode$onDrg(oEvent){return};Owa.Components.TreeNode.prototype.drpIn=function Owa$Components$TreeNode$drpIn(oRootElement,iDM){return};Owa.Components.TreeNode.prototype.canDrpExp=function Owa$Components$TreeNode$canDrpExp(oRootElement){return true};Owa.Components.TreeNode.prototype.gtDrpMd=function Owa$Components$TreeNode$gtDrpMd(oJN,oEvent,oRootElement){return DRP_NONE}})();g_fModuleLoaded[".\\uicontrols/treenode.js".toLowerCase()]=1;var TN_FTN="folderTreeNode";var TN_GH="navigationGroupHeaderNode";var DIV="div";var A="a";var AUTO="auto";var POINTER="pointer";var CONTENT_OFFSET=19;var TR="divTr";var NODE_CHILDREN="divTrNdCC";var NODE_HIGHLIGHT="divTrNdHl";var NODE_EFFECT="divTrNdEff";var NODE_CONTAINER="divTrNdO";var EC="ec";var PR="pr";var NODE_ICON="imgTrNd";var NODE_CONTENT="spnTrNdCnt";var DRP_NONE=0;var DRP_COPY=1;var DRP_MOVE=2;var DRP_LINK=3;var DRP_IC_MSK=3;var DRP_EFF_MSK=12;var DRP_ABOVE=4;var DRP_BELOW=8;var AFLG_PRV=0x01;var AFLG_PRT=0x02;var AFLG_RT=0x10;var EFF_SHI=0x400;var EFF_EXB=0x02000000;var EFF_RMH=0x04000000;var EFF_XORG=0x40000000;var FRT_ALL=0x00;var FRT_HSF=0x01;var FRT_HGF=0x02;var g_sPlusIco;var g_sMinusIco;var g_sNoChildIco;var g_sTimerIco;var g_rgsFIcns=[];g_rgsFIcns[T_MSG]="fldr.png";g_rgsFIcns[T_CAL]="appt.gif";g_rgsFIcns[T_CON]="contact.gif";g_rgsFIcns[T_TSK]="tsk.gif";g_rgsFIcns[T_NTS]="notes.png";g_rgsFIcns[T_JNL]="journal.gif";var GS_FVR="1";var GS_CAL="3";var GS_CNT="4";var GS_TSK="5";var EDT_INPT=1;var EDT_CHK=2;var ECR_ESC=0;var ECR_ENTER=1;var ECR_FO=2;var FKID="FakeNode";var FNID="spnFldrNm";var AL_DEF="default";var ALP_DFT="DFT.";var g_iPrgIndQt;var CCDT_NONE=0;var CCDT_ITMC=1;(function(){var g_sDragEffectClass="trDrgEff";var g_sSelelectionClass="trDefSel";Owa.UIControls.TreeControl=function Owa$UIControls$TreeControl(root){Owa.UIControls.TreeControl.constructBase(this,[root]);this.root=root;if(!g_sPlusIco){if(g_fRtl){g_sPlusIco="plusrtl.png";g_sMinusIco="minusrtl.png"}else{g_sPlusIco="plus.png";g_sMinusIco="minus.png"}g_sNoChildIco="clear.gif";g_sTimerIco=getThmF("pgrs-sm.gif")}this._aDict={};this._sSelelectionClass=g_sSelelectionClass;this._sDragEffectClass=g_sDragEffectClass;this.root.setExpando("isRoot",1);this._sErrNm=this.root.getAttribute("_errDiv");this._sHdErrNm=this.root.getAttribute("_errHd");this.initialize()};Owa.UIControls.TreeControl.createClass("Owa.UIControls.TreeControl",Owa.UIControls.UIControl);Owa.UIControls.TreeControl.prototype.initialize=function Owa$UIControls$TreeControl$initialize(){Owa.UIControls.TreeControl.callBase(this,"initialize");if(!this._sSelNdId){this._sSelNdId=null;this._sHlNdId=null;var rgDivs=this.root.getDescendantsByTagName(DIV);for(var i=0;i<rgDivs.length;i++){if(rgDivs[i].getAttribute("_sel")){this.stNdSel(this.gtNd(rgDivs[i]),1);break}}}else{this.syncSelNHl()}if(this._onKD)this._attachEvent(this.root,"keydown",this._onKD);if(this._onDO){this._attachEvent(this.root,"dragenter",this._onDO);this._attachEvent(this.root,"dragover",this._onDO);Owa.Components.Storage.DragDrop.enableDNDInFireFox(this._get_Element())}if(this._onDrp)this._attachEvent(this.root,"drop",this._onDrp);if(this._onDL)this._attachEvent(this.root,"dragleave",this._onDL);if(this._onClk)this._attachEvent(this.root,"click",this._onClk);if(this._onContextMenuEventHandler)this._attachEvent(this.root,"contextmenu",this._onContextMenuEventHandler);if(this._onDS)this._attachEvent(this.root,"dragstart",this._onDS);if(this._onSS)this._attachEvent(this.root,"selectstart",this._onSS)};Owa.UIControls.TreeControl.prototype.dispose=function Owa$UIControls$TreeControl$dispose(){if(this._edting)this.qtEdtNd();this.root.detachAllEvents();this._oElement=null;this.root=null;this._edt=null;this._drp=null;this._aDict=null;Owa.UIControls.TreeControl.callBase(this,"dispose")};Owa.UIControls.TreeControl.prototype.stAls=function Owa$UIControls$TreeControl$stAls(sA,sId){if(sId){this._aDict[sA]=sId}else{this._aDict[sA]=null;delete this._aDict[sA]}};Owa.UIControls.TreeControl.prototype.clrAls=function Owa$UIControls$TreeControl$clrAls(){this._aDict={}};Owa.UIControls.TreeControl.prototype.get_ContextMenu=function Owa$UIControls$TreeControl$get_ContextMenu(){return this._oContextMenu};Owa.UIControls.TreeControl.prototype.set_ContextMenu=function Owa$UIControls$TreeControl$set_ContextMenu(oContextMenu){this._oContextMenu=oContextMenu};Owa.UIControls.TreeControl.prototype.gtNd=function Owa$UIControls$TreeControl$gtNd(o){if(!o)return;while(o&&!o.getExpando("isRoot")&&(o.get_Id()!=NODE_CONTAINER&&o.get_Id()!=NODE_HIGHLIGHT&&o.get_Id()!=NODE_CHILDREN))o=o.get_ParentElement();if(!o||o.getExpando("isRoot"))return;var sId=o.get_Id();var oN;if(sId==NODE_CONTAINER)oN=o.getChildById(NODE_HIGHLIGHT).getDescendantsByTagName(A)[0];else if(sId==NODE_HIGHLIGHT)oN=o.getDescendantsByTagName(A)[0];else if(sId==NODE_CHILDREN)oN=o.get_ParentElement().getChildById(NODE_HIGHLIGHT).getDescendantsByTagName(A)[0];if(oN)return this.wrapNd(oN)};Owa.UIControls.TreeControl.prototype.wrapNd=function Owa$UIControls$TreeControl$wrapNd(oN){return new Owa.Components.TreeNode(oN,this)};Owa.UIControls.TreeControl.prototype.gtNdById=function Owa$UIControls$TreeControl$gtNdById(sId){var o=this.gtDomNdById(sId);return o?this.wrapNd(o):o};Owa.UIControls.TreeControl.prototype.gtChdNdById=function Owa$UIControls$TreeControl$gtChdNdById(oJPN,sId){if(!oJPN)return;var oCC=oJPN.gtCC();if(!oCC)return;var oNode=oCC.getDescendantById(sId);if(!oNode)return;return this.gtNd(oNode)};Owa.UIControls.TreeControl.prototype.gtNdFrstChld=function Owa$UIControls$TreeControl$gtNdFrstChld(oJN){var oCC=oJN.gtCC();if(!oCC||!oCC.get_FirstChild())return;return this.gtNd(oCC.get_FirstChild())};Owa.UIControls.TreeControl.prototype.gtNdRt=function Owa$UIControls$TreeControl$gtNdRt(){return this.gtNd(this.root.get_FirstChild())};Owa.UIControls.TreeControl.prototype.gtDomNdById=function Owa$UIControls$TreeControl$gtDomNdById(sId){if(sId&&this.root)return this.root.getDescendantById(sId)};Owa.UIControls.TreeControl.prototype.gtNdPrnt=function Owa$UIControls$TreeControl$gtNdPrnt(oJN){if(oJN.isRt())return;return this.gtNd(oJN.getContainer().get_ParentElement())};Owa.UIControls.TreeControl.prototype.gtNdNxt=function Owa$UIControls$TreeControl$gtNdNxt(oJN){return this.gtNd(oJN.getContainer().get_NextSibling())};Owa.UIControls.TreeControl.prototype.gtNdPrv=function Owa$UIControls$TreeControl$gtNdPrv(oJN){return this.gtNd(oJN.getContainer().get_PreviousSibling())};Owa.UIControls.TreeControl.prototype.gtNdByAls=function Owa$UIControls$TreeControl$gtNdByAls(sA){return this.gtNdById(this._aDict[sA])};Owa.UIControls.TreeControl.prototype.isContainer=function Owa$UIControls$TreeControl$isContainer(o){return o.get_Id()==NODE_CONTAINER};Owa.UIControls.TreeControl.prototype.stKds=function Owa$UIControls$TreeControl$stKds(oJN,rgChildren){this.clrKds(oJN);this.addKds(oJN,rgChildren)};Owa.UIControls.TreeControl.prototype.clrKds=function Owa$UIControls$TreeControl$clrKds(oJN){var o=oJN._get_Element();if(oJN.gtCC())oJN.gtCC().remove(true);o.setAttribute("_exp",null);o.setAttribute("_hsChld",null);this.rplcNd(oJN.gtId(),o)};Owa.UIControls.TreeControl.prototype.rmNd=function Owa$UIControls$TreeControl$rmNd(oJN){var oJPN=this.gtNdPrnt(oJN);var oC=oJN.getContainer();oC.remove(true);if(!oJPN)return;var oC=oJPN.gtCC();if(oC.hasChildNodes()==0){if(oJN.gtId()!=FKID)oJPN._get_Element().setAttribute("_hsChld","0");oJPN._get_Element().setAttribute("_exp",null)}oJPN.upd();this.fireOnResize()};Owa.UIControls.TreeControl.prototype.rplcNd=function Owa$UIControls$TreeControl$rplcNd(sId,oNew,iIndent){var oJO=this.gtNdById(sId);if(!oJO||!oNew)return;if(!Owa.Utility.isDefined(typeof(iIndent)))iIndent=oJO.getIndent();var oC=oJO.getContainer();var oNewContainer=this.wrapContainer(oNew,iIndent);oC.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeBegin,oNewContainer);oC.remove(true);var oJN=this.gtNdById(oNew.get_Id());oJN.stSel(oJO.isSel());oJN.stHl(oJO.isHl());if(this._drp)this.drpHlNd(this._drp.oNd,this._drp.sDM);return oJN._get_Element()};Owa.UIControls.TreeControl.prototype.addKdPos=function Owa$UIControls$TreeControl$addKdPos(oJPN,oN,fFrcEC,oJN,aft){var oD=this.root.get_OwnerDocument().createElement(DIV);oD.appendChild(oN);if(oJN)this.insrtKdsPos(oJN,oD.getChildrenSnapshot(),fFrcEC,aft);else this.addKds(oJPN,oD.getChildrenSnapshot(),fFrcEC)};Owa.UIControls.TreeControl.prototype.addKds=function Owa$UIControls$TreeControl$addKds(oJN,rgChildren,fFrcEC){var oC=oJN.gtCC();oJN._get_Element().setAttribute("_hsChld","1");if(!oC){this.rplcNd(oJN.gtId(),oJN._get_Element());oC=oJN.gtCC()}var iIndent=oJN.getIndent()+oJN.getChildIndent();while(rgChildren.length>0){var oNd=rgChildren.shift();if(!this.isContainer(oNd)){oNd=this.wrapContainer(oNd,iIndent,fFrcEC)}oC.appendChild(oNd)}oJN.upd();this.fireOnResize()};Owa.UIControls.TreeControl.prototype.insrtKdsPos=function Owa$UIControls$TreeControl$insrtKdsPos(oJN,rgChildren,fFrcEC,aft){var iIndent=oJN.getIndent();var oContainer=oJN.getContainer();while(rgChildren.length>0){var oKid=aft?rgChildren.pop():rgChildren.shift();var oNewContainer;if(this.isContainer(oKid))oNewContainer=oKid;else oNewContainer=this.wrapContainer(oKid,iIndent,fFrcEC);if(!aft)oContainer.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeBegin,oNewContainer);else oContainer.insertAdjacentElement(Owa.ElementInsertionPoint.AfterEnd,oNewContainer)}this.fireOnResize()};Owa.UIControls.TreeControl.prototype.mkECH=function Owa$UIControls$TreeControl$mkECH(sEC,oN,iIndent){return Owa.Components.CssSprites.getImageMarkup(sEC,"id=\""+EC+"\" style=\""+(g_fRtl?"right":"left")+":"+iIndent+"px\"")};Owa.UIControls.TreeControl.prototype.wrapContainer=function Owa$UIControls$TreeControl$wrapContainer(oN,iIndent,fFrcEC){var hasKids=oN.getAttribute("_hsChld");var img=oN.getAttribute("_exp")?g_sMinusIco:g_sPlusIco;var imgS=hasKids?this.mkECH(img,oN,iIndent):(fFrcEC?this.mkECH(g_sNoChildIco,oN):"");var kidsDiv=hasKids?"<div id=\""+NODE_CHILDREN+"\" style=\"display: none; width: 100%\"></div>":"";var oContainer=this.root.get_OwnerDocument().createElement(DIV);var sHlCls=oN.getAttribute("_hlCls");sHlCls=sHlCls?sHlCls:"trNdHl";oContainer.set_Id(NODE_CONTAINER);oContainer.set_InnerHtml("<div id=\""+NODE_HIGHLIGHT+"\" class=\""+sHlCls+"\">"+imgS+"</div>"+kidsDiv);oContainer.get_FirstChild().appendChild(oN);if(g_fRtl){oN.set_Right(iIndent+CONTENT_OFFSET)}else{oN.set_Left(iIndent+CONTENT_OFFSET)}oN.setIntAttribute("_indnt",iIndent);return oContainer};Owa.UIControls.TreeControl.prototype.isAncstr=function Owa$UIControls$TreeControl$isAncstr(oJAN,oJN,fSlf){if(!oJAN||!oJN)return;if(fSlf&&oJAN.equals(oJN))return 1;var oJPN=oJN;while(oJPN){oJPN=this.gtNdPrnt(oJPN);if(oJPN&&oJPN.equals(oJAN))return 1}};Owa.UIControls.TreeControl.prototype.createNewNode=function Owa$UIControls$TreeControl$createNewNode(id,oJN,isSibling,isAfter,option){option=option?option:{};var oDiv=this.root.get_OwnerDocument().createElement(DIV);var html="<a class=\""+(option.bodyClassName?option.bodyClassName:"trNd")+"\" hideFocus=1 href=\"#\"";html+=" id=\""+id+"\"";if(option.nosel)html+=" _nosel=1";if(option.sync)html+=" _sync=1";else html+=" _sync=0";if(option.exp)html+=" _exp=1";if(option.padding)html+=" _pd="+option.padding;if(option.highlightClassName)html+=" _hlCls=\""+option.highlightClassName+"\"";html+=">";if(option.contentHTML){html+=option.contentHTML+"</a>"}else{if(option.iconHTML)html+=option.iconHTML;html+="<span id=\""+NODE_CONTENT+"\""+(option.contentClassName?" class=\""+option.contentClassName+"\"":"")+">"+(option.contentInnerHTML?option.contentInnerHTML:"")+"</span></a>"}oDiv.set_InnerHtml(html);var oElement=this.wrapNd(Owa.Dom.Node.wrapDomNode(oDiv._get_DomNode().childNodes[0]));if(isSibling){this.insrtKdsPos(oJN,oDiv.getChildrenSnapshot(),0,isAfter)}else{this.addKds(oJN,oDiv.getChildrenSnapshot())}return oElement};Owa.UIControls.TreeControl.prototype.shwNd=function Owa$UIControls$TreeControl$shwNd(oJN){var oJPN=this.gtNdPrnt(oJN);while(oJPN){oJPN.expand();oJPN=this.gtNdPrnt(oJPN)}var oE=oJN._get_Element();var iY=getCY(oE._get_DomNode(),0,this.root._get_DomNode().offsetParent)-getCY(this.root._get_DomNode(),0,this.root._get_DomNode().offsetParent);if(iY<0||iY>=this.root.get_OffsetHeight())oJN._get_Element()._get_DomNode().scrollIntoView()};Owa.UIControls.TreeControl.prototype.feOnBfEdt=function Owa$UIControls$TreeControl$feOnBfEdt(oJN){if(this.onBfEdt)return this.onBfEdt(oJN)};Owa.UIControls.TreeControl.prototype.crtFkNd=function Owa$UIControls$TreeControl$crtFkNd(icnMrkup){var oTreeNodeElement=this.root.get_OwnerDocument().createElement(A);oTreeNodeElement.set_CssClasses(["trNd"]);oTreeNodeElement.set_Id(FKID);oTreeNodeElement.setAttribute("hideFocus","1");oTreeNodeElement.setAttribute("src","#");oTreeNodeElement.set_InnerHtml((icnMrkup?icnMrkup:"")+"<SPAN id=\""+NODE_CONTENT+"\"></SPAN>");return oTreeNodeElement};Owa.UIControls.TreeControl.prototype.gtNwNdIcnMrkup=function Owa$UIControls$TreeControl$gtNwNdIcnMrkup(oPN,oCtx){return Owa.Components.CssSprites.getImageMarkup(g_rgsFIcns[T_MSG],"id="+NODE_ICON)};Owa.UIControls.TreeControl.prototype.strtEdt=function Owa$UIControls$TreeControl$strtEdt(oCtx){this._edting=EDT_INPT;this._fDontSyncSelection=1;if(!this._edt)this._edt={};this._edt.oCtx=oCtx};Owa.UIControls.TreeControl.prototype.crtNwNd=function Owa$UIControls$TreeControl$crtNwNd(oJPN,oCtx,fFrcEC,oJN){if(this._edting)return;this.strtEdt(oCtx);this._edt.crtNw=1;this._edt._hsChld=oJPN.hsChld();var nwNd=this.crtFkNd(this.gtNwNdIcnMrkup(oJPN,oCtx));this.addKdPos(oJPN,nwNd,fFrcEC,oJN);oJPN.expand();this.edtNd(this.gtNdById(FKID),oCtx,1)};Owa.UIControls.TreeControl.prototype.edtNd=function Owa$UIControls$TreeControl$edtNd(oJN,oCtx,fCrtNw){if(this._edting&&!fCrtNw)return;this.strtEdt(oCtx);this._edt.nd=oJN;if(this.feOnBfEdt())return;this.shwNd(oJN);var oInp=this.crtInp(oJN);this._edt.inp=oInp;oJN.gtHl().insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oInp);oInp.get_FirstChild().set_Value(oJN.gtDspNm());oInp.get_FirstChild().focus(100);this.clrHl();oJN.hdCnt();oInp.get_FirstChild()._get_DomNode().select()};Owa.UIControls.TreeControl.prototype.crtInp=function Owa$UIControls$TreeControl$crtInp(oJN){var iImgWidth=0;var oImg=oJN.gtImg();if(oImg)iImgWidth+=oImg.get_OffsetWidth()+oImg._get_EffectiveMarginWidth();var oInp=this.root.get_OwnerDocument().createElement("input");var oOuter=this.root.get_OwnerDocument().createElement(DIV);var oBorder=this.root.get_OwnerDocument().createElement(DIV);oInp.set_CssClasses(["trEdtInp"]);oOuter.set_CssClasses(["trEdtO"]);oBorder.set_CssClasses(["trEdtBd"]);oInp.setAttribute("maxLength",this.getMaxInputLength());if(g_fRtl){oBorder.set_Right(-2-iImgWidth);oOuter.set_Right(iImgWidth+oJN.getIndent()+CONTENT_OFFSET)}else{oBorder.set_Left(-2-iImgWidth);oOuter.set_Left(iImgWidth+oJN.getIndent()+CONTENT_OFFSET)}if(this.onInpKD)this._attachEvent(oInp,"keydown",this.onInpKD);if(this.onInputBlur)this._attachEvent(oInp,"blur",this.onInputBlur);oOuter.appendChild(oInp);oOuter.appendChild(oBorder);if(Owa.Utility.isFirefox()){try{document.execCommand("enableObjectResizing",false,"false")}catch(e){}}return oOuter};Owa.UIControls.TreeControl.prototype.getMaxInputLength=function Owa$UIControls$TreeControl$getMaxInputLength(){return"255"};Owa.UIControls.TreeControl.prototype.onInpKD=function Owa$UIControls$TreeControl$onInpKD(oEvent){switch(oEvent.get_KeyCodeForKeyUpDown()){case 13:if(this._edting==EDT_CHK)return;oEvent.cancelBubble();this.chkEdtNd(ECR_ENTER);break;case 27:oEvent.cancelBubble();this.chkEdtNd(ECR_ESC);break}};Owa.UIControls.TreeControl.prototype.onInputBlur=function Owa$UIControls$TreeControl$onInputBlur(oEvent){if(this._edting!=EDT_CHK)this.chkEdtNd(ECR_FO)};Owa.UIControls.TreeControl.prototype.feOnRnNd=function Owa$UIControls$TreeControl$feOnRnNd(rsn,sV){if(this.onRnNd)this.onRnNd(rsn,sV)};Owa.UIControls.TreeControl.prototype.feOnNwNd=function Owa$UIControls$TreeControl$feOnNwNd(rsn,sV){if(this.onNwNd)this.onNwNd(rsn,sV)};Owa.UIControls.TreeControl.prototype.chkEdtNd=function Owa$UIControls$TreeControl$chkEdtNd(rsn){this._edting=EDT_CHK;this._edt.nd.shwPrg(1000,this._edt.nd.gtImg()?1:0);return this._edt.crtNw?this.feOnNwNd(rsn,this._edt.inp.get_FirstChild().get_Value()):this.feOnRnNd(rsn,this._edt.inp.get_FirstChild().get_Value())};Owa.UIControls.TreeControl.prototype.reEdtNd=function Owa$UIControls$TreeControl$reEdtNd(){this._edting=EDT_INPT;try{this._edt.inp.get_FirstChild().focus(0);this._edt.nd.hdPrg()}catch(e){this.qtEdtNd()}};Owa.UIControls.TreeControl.prototype.qtEdtNd=function Owa$UIControls$TreeControl$qtEdtNd(){if(!this._edting)return;var oJN=this._edt.nd;var oJPN=this.gtNdPrnt(oJN);oJN.hdPrg();if(this._edt.crtNw){oJPN._get_Element().setAttribute("_hsChld",this._edt._hsChld);this.rmNd(oJN)}else{this._edt.inp.get_FirstChild().detachAllEvents();this._edt.inp.remove(true);oJN.shwCnt()}this._edt=null;this._edting=0;this.hdErr();this.syncSelNHl();this.feOnAfEdt()};Owa.UIControls.TreeControl.prototype.feOnAfEdt=function Owa$UIControls$TreeControl$feOnAfEdt(){if(this.onAfEdt)this.onAfEdt()};Owa.UIControls.TreeControl.prototype.shwErr=function Owa$UIControls$TreeControl$shwErr(sErr,fInlineError){var oErr=this.root.get_OwnerDocument().getElementById(this._sErrNm);if(fInlineError){showErr(oErr._get_DomNode(),sErr);if(this._sHdErrNm){var oHdErr=this.root.get_OwnerDocument().getElementById(this._sHdErrNm);oHdErr.set_IsShown(true)}this.fireOnErrorInfobarChanged();if(this._edting)this._edt.inp._get_DomNode().scrollIntoView(0)}else{shwErrDlg(0,sErr)}};Owa.UIControls.TreeControl.prototype.hdErr=function Owa$UIControls$TreeControl$hdErr(){var oErr=this.root.get_OwnerDocument().getElementById(this._sErrNm);hideErr(oErr._get_DomNode());if(this._sHdErrNm){var oHdErr=this.root.get_OwnerDocument().getElementById(this._sHdErrNm);oHdErr.set_IsShown(false)}this.fireOnErrorInfobarChanged()};Owa.UIControls.TreeControl.prototype.cbOeh=function Owa$UIControls$TreeControl$cbOeh(oR,fInlineError){var fE=this._edting;if(!cbOehST(oR)){if(fE)this.qtEdtNd();return}if(oR.sErr){this.shwErr(oR.sErr,fInlineError);if(fE)this.reEdtNd();return}var oDiv=this.root.get_OwnerDocument().createElement(DIV);oDiv.set_InnerHtml(oR.sBody);var oErr=oDiv.getDescendantById("err");if(oErr){this.shwErr(oErr.getAttribute("_msg"),fInlineError);if(fE)this.reEdtNd();return}if(fE)this.qtEdtNd();return 1};Owa.UIControls.TreeControl.prototype._onKD=function Owa$UIControls$TreeControl$_onKD(oEvent){if(this._edting)return;if(oEvent.isAltKeyDown()||oEvent.isCtrlKeyDown()||oEvent.get_KeyCodeForKeyUpDown()==9)return;var oJSel=this.gtSelNd();switch(oEvent.get_KeyCodeForKeyUpDown()){case 37:case 109:if(oJSel&&oJSel.isExp())oJSel.collapse();break;case 39:case 107:if(oJSel&&!oJSel.isExp())oJSel.expand();break;default:this.feOnKD(oEvent);return}oEvent.preventDefault()};Owa.UIControls.TreeControl.prototype.feOnKD=function Owa$UIControls$TreeControl$feOnKD(oEvent){if(this.onKD)this.onKD(oEvent)};Owa.UIControls.TreeControl.prototype._onClk=function Owa$UIControls$TreeControl$_onClk(oEvent){if(this._edting)return;var oTarget=oEvent.get_Target();var oJN=this.gtNd(oTarget);if(!oJN)return;if(oTarget.get_Id()==NODE_CHILDREN)return;if(oJN.isEC(oTarget)){oJN.tggl();oEvent.preventDefault();oEvent.cancelBubble();return}this.feOnClkNd(oEvent,oJN);oEvent.preventDefault();oEvent.cancelBubble()};Owa.UIControls.TreeControl.prototype.feOnClkNd=function Owa$UIControls$TreeControl$feOnClkNd(oEvent,oJN){if(this.onClkNd)this.onClkNd(oEvent,oJN);if(oJN.canSel()){this.selNd(oJN)}else{oJN.tggl();oEvent.preventDefault();oEvent.cancelBubble()}};Owa.UIControls.TreeControl.prototype._onSS=function Owa$UIControls$TreeControl$_onSS(oEvent){if(this._edting&&oEvent.get_Target().equals(this._edt.inp.get_FirstChild())){oEvent.cancelBubble();return}oEvent.preventDefault()};Owa.UIControls.TreeControl.prototype.getSelectionClass=function Owa$UIControls$TreeControl$getSelectionClass(){return this._sSelelectionClass};Owa.UIControls.TreeControl.prototype.setSelectionClass=function Owa$UIControls$TreeControl$setSelectionClass(sClass){this._sSelelectionClass=sClass;this.rfrshHl()};Owa.UIControls.TreeControl.prototype.hsSelNd=function Owa$UIControls$TreeControl$hsSelNd(){return !!this._sSelNdId};Owa.UIControls.TreeControl.prototype.hsHlNd=function Owa$UIControls$TreeControl$hsHlNd(){return !!this._sHlNdId};Owa.UIControls.TreeControl.prototype.gtSelNd=function Owa$UIControls$TreeControl$gtSelNd(){if(!this.hsSelNd())return;return this.gtNdById(this._sSelNdId)};Owa.UIControls.TreeControl.prototype.gtHlNd=function Owa$UIControls$TreeControl$gtHlNd(){if(!this.hsHlNd())return;return this.gtNdById(this._sHlNdId)};Owa.UIControls.TreeControl.prototype.selNdById=function Owa$UIControls$TreeControl$selNdById(sId){this.stNdSel(this.gtNdById(sId),1)};Owa.UIControls.TreeControl.prototype.gtNrstNd=function Owa$UIControls$TreeControl$gtNrstNd(oJN){var oJT=this.gtNdPrv(oJN);while(oJT){if(oJT.canSel())return oJT;oJT=this.gtNdPrv(oJT)}oJT=this.gtNdNxt(oJN);while(oJT){if(oJT.canSel())return oJT;oJT=this.gtNdNxt(oJT)}oJT=this.gtNdPrnt(oJN);if(oJT&&oJT.canSel())return oJT;if(oJT)return this.gtNrstNd(oJT)};Owa.UIControls.TreeControl.prototype.clrSel=function Owa$UIControls$TreeControl$clrSel(){this.stNdSel(this.gtSelNd(),0)};Owa.UIControls.TreeControl.prototype.clrHl=function Owa$UIControls$TreeControl$clrHl(){if(this._frst)this._frst.clrHl();else this._clrHl()};Owa.UIControls.TreeControl.prototype._clrHl=function Owa$UIControls$TreeControl$_clrHl(){this.stNdHl(this.gtHlNd(),0)};Owa.UIControls.TreeControl.prototype.stNdSel=function Owa$UIControls$TreeControl$stNdSel(oJN,fSel){if(oJN&&!oJN.canSel())return;var oJSel=this.gtSelNd();if(fSel){if(oJSel&&oJSel.equals(oJN)&&this._fcs){this.rfrshHl()}else{this.stFcs(1);if(oJSel)oJSel.stSel(0);if(oJN){this._sSelNdId=oJN.gtId();oJN.stSel(1)}else{this._sSelNdId=null}this.stNdHl(oJN,fSel)}}else{if(oJN&&oJN.equals(oJSel))oJSel.stSel(0);this._sSelNdId=null;this.stNdHl(oJN,fSel)}if(!oJSel&&oJN||oJSel&&!oJSel.equals(oJN))this.feOnSelChng(oJSel,this.gtSelNd())};Owa.UIControls.TreeControl.prototype.stFcs=function Owa$UIControls$TreeControl$stFcs(fF){if(this._frst)this._frst.stFcsTr(fF?this._nm:null);else if(this._fcs!=fF)this._stFcs(fF)};Owa.UIControls.TreeControl.prototype._stFcs=function Owa$UIControls$TreeControl$_stFcs(fF){this._fcs=fF;if(!fF)this.clrSel()};Owa.UIControls.TreeControl.prototype.stNdHl=function Owa$UIControls$TreeControl$stNdHl(oJN,fHl){var oJHlNd=this.gtHlNd();if(fHl){this.clrHl();if(oJN){this._sHlNdId=oJN.gtId();oJN.stHl(1)}}else if(oJN&&oJN.equals(oJHlNd)){oJHlNd.stHl(0)}};Owa.UIControls.TreeControl.prototype._onContextMenuCloseEventHandler=function Owa$UIControls$TreeControl$_onContextMenuCloseEventHandler(){if(!this._fDontSyncSelection)this.syncSelNHl();var oContextMenu=this.get_ContextMenu();oContextMenu.get_OnClose().remove(this._createCallback(this._onContextMenuCloseEventHandler));oContextMenu.get_OnSelect().remove(this._createCallback(this._onContextMenuSelectEventHandler))};Owa.UIControls.TreeControl.prototype._onContextMenuSelectEventHandler=function Owa$UIControls$TreeControl$_onContextMenuSelectEventHandler(oEventArgs,oJN){if(oJN){this.stNdHl(oJN,1)}if(oJN&&oJN.onContextMenuClick){return oJN.onContextMenuClick(oEventArgs)}return false};Owa.UIControls.TreeControl.prototype.syncSelNHl=function Owa$UIControls$TreeControl$syncSelNHl(){if(this._frst)this._frst.syncSelNHl();else this._syncSelNHl()};Owa.UIControls.TreeControl.prototype._syncSelNHl=function Owa$UIControls$TreeControl$_syncSelNHl(){var oJSel=this.gtSelNd();var oJHl=this.gtHlNd();if(!oJSel){this._clrHl();return}if(oJSel.equals(oJHl)){this._rfrshHl()}else{if(oJHl)oJHl.stHl(0);oJSel.stHl(1);this._sHlNdId=oJSel.gtId()}};Owa.UIControls.TreeControl.prototype.selNd=function Owa$UIControls$TreeControl$selNd(oJN){this.stNdSel(oJN,1)};Owa.UIControls.TreeControl.prototype.feOnSelChng=function Owa$UIControls$TreeControl$feOnSelChng(oJO,oJN){if(this.onSelChng)this.onSelChng(oJO,oJN)};Owa.UIControls.TreeControl.prototype.rfrshHl=function Owa$UIControls$TreeControl$rfrshHl(){if(this._frst)this._frst.rfrshHl();else this._rfrshHl()};Owa.UIControls.TreeControl.prototype._rfrshHl=function Owa$UIControls$TreeControl$_rfrshHl(){if(!this._fcs)return;var oJHl=this.gtHlNd();if(oJHl)oJHl.stHl(1)};Owa.UIControls.TreeControl.prototype.getDragEffectClass=function Owa$UIControls$TreeControl$getDragEffectClass(){return this._sDragEffectClass};Owa.UIControls.TreeControl.prototype._onDS=function Owa$UIControls$TreeControl$_onDS(oEvent){if(this._edting)return;var oTarget=oEvent.get_Target();var oJN=this.gtNd(oTarget);if(oJN&&oJN.canDrg()){this.feOnDrg(oEvent,oJN)}else{var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);oDragDrop.deny()}};Owa.UIControls.TreeControl.prototype.feOnDrg=function Owa$UIControls$TreeControl$feOnDrg(oEvent,oJN){oJN.onDrg(oEvent);if(this.onDrg)return this.onDrg(oEvent,oJN)};Owa.UIControls.TreeControl.prototype._onDrp=function Owa$UIControls$TreeControl$_onDrp(oEvent){if(this._edting)return;this.clrExpNdTO();var oJN=this._drp.oNd;if(this._drp.iTid)this._clearTimeout(this._drp.iTid);if(oJN){var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);var oDraggableObject=Owa.Components.Storage.StorableObject.createFromStorage(oDragDrop);var iDM=this._drp.sDM;if(oDraggableObject){oJN.drpIn(oDraggableObject,iDM);if(this.drpIn)this.drpIn(oJN,oDraggableObject,iDM)}}this.onDLTOCB()};Owa.UIControls.TreeControl.prototype._onDL=function Owa$UIControls$TreeControl$_onDL(oEvent){if(!this._drp)return;if(this._drp.sLstEvt=="dragenter"){this._drp.sLstEvt=null;oEvent.cancelBubble();oEvent.preventDefault();return}if(this._drp.iTid)this._clearTimeout(this._drp.iTid);if(this._drp.oNd)this._drp.iTid=Owa.Dom.Window.get_Current().setTimeout(this._createCallback(this.onDLTOCB),50);this.clrExpNdTO();oEvent.cancelBubble();oEvent.preventDefault()};Owa.UIControls.TreeControl.prototype.onDLTOCB=function Owa$UIControls$TreeControl$onDLTOCB(){this.clrDrpHl();this._drp=null};Owa.UIControls.TreeControl.prototype._onDO=function Owa$UIControls$TreeControl$_onDO(oEvent){if(isDf(typeof iAutoScr)&&iAutoScr)return;var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);if(this._edting){oDragDrop.deny();return}var oDraggableObject=Owa.Components.Storage.StorableObject.createFromStorage(oDragDrop);if(!oDraggableObject){oDragDrop.deny();this.clrDrpHl();return}if(!this._drp)this._drp={};this._drp.sLstEvt=oEvent.get_Type();if(this._drp.iTid)this._clearTimeout(this._drp.iTid);var oJN=this.gtNd(oEvent.get_Target());if(oJN){var sDM;var oJT=oJN;while(oJT){sDM=oJT.gtDrpMd(oJN,oEvent,oDraggableObject);if(sDM!=DRP_NONE)break;oJT=this.gtNdPrnt(oJT)}switch(sDM&DRP_IC_MSK){case DRP_COPY:oDragDrop.setEffect(Owa.Components.Storage.DragDrop.Effect.Copy);break;case DRP_MOVE:oDragDrop.setEffect(Owa.Components.Storage.DragDrop.Effect.Move);break;case DRP_LINK:oDragDrop.setEffect(Owa.Components.Storage.DragDrop.Effect.Link);break;default:oDragDrop.setEffect(Owa.Components.Storage.DragDrop.Effect.None);break}if(!oJT||!oJT.equals(this._drp.oNd)||this._drp.sDM!=sDM){if(!isFlgSt(sDM,DRP_BELOW)||!isFlgSt(sDM,DRP_ABOVE)||isFlgSt(sDM,DRP_ABOVE)&&!oJT.equals(this.gtNdNxt(this._drp.oNd))||isFlgSt(sDM,DRP_BELOW)&&!oJT.equals(this.gtNdPrv(this._drp.oNd))){this.drpHlNd(oJT,sDM)}}this._drp.sDM=sDM;if(oJN.hsChld()&&oJN.canDrpExp(oDraggableObject))this.stExpNdTO(oJN);else this.clrExpNdTO()}};Owa.UIControls.TreeControl.prototype.stExpNdTO=function Owa$UIControls$TreeControl$stExpNdTO(oJN){if(oJN.hsChld()&&!oJN.isExp()){if(this._expNdId==oJN.gtId())return;if(this._expNdTId)this._clearTimeout(this._expNdTId);this._expNdId=oJN.gtId();this._expNdTId=Owa.Dom.Window.get_Current().setTimeout(this._createCallback(this.expNd),800)}};Owa.UIControls.TreeControl.prototype.clrExpNdTO=function Owa$UIControls$TreeControl$clrExpNdTO(){if(this._expNdTId)this._clearTimeout(this._expNdTId);this._expNdTId=0;this._expNdId=0};Owa.UIControls.TreeControl.prototype.expNd=function Owa$UIControls$TreeControl$expNd(){var oJN=this.gtNdById(this._expNdId);if(oJN&&!oJN.isExp())oJN.expand();this._expNdId=0;this._expNdTId=0};Owa.UIControls.TreeControl.prototype.clrDrpHl=function Owa$UIControls$TreeControl$clrDrpHl(){if(!this._drp||!this._drp.oNd)return;if(this._drp.oSp){this._drp.oSp.remove(true);this._drp.oSp=null}else{if(this._drp.oNd)this._drp.oNd.stDrpHl(0)}this._drp.sDM=DRP_NONE};Owa.UIControls.TreeControl.prototype.drpHlNd=function Owa$UIControls$TreeControl$drpHlNd(oJT,sDM){if(this._drp.iTid)this._clearTimeout(this._drp.iTid);if(this._frst)this._frst.clrDrpHl();else this.clrDrpHl();if(!oJT||sDM==DRP_NONE)return;switch(sDM&DRP_EFF_MSK){case DRP_ABOVE:this.addDrpSpDiv(oJT,1);break;case DRP_BELOW:this.addDrpSpDiv(oJT,0);break;default:oJT.stDrpHl(1);break}this._drp.oNd=oJT;this._drp.sDM=sDM};Owa.UIControls.TreeControl.prototype.addDrpSpDiv=function Owa$UIControls$TreeControl$addDrpSpDiv(oJT,fTop){var oDivOuter=this.root.get_OwnerDocument().createElement(DIV);var oDivInner=this.root.get_OwnerDocument().createElement(DIV);oDivOuter.set_CssClasses(["trDrpEffO"]);oDivInner.set_CssClasses(["trDrpEffI"]);oDivOuter.insertAdjacentElement(Owa.ElementInsertionPoint.AfterBegin,oDivInner);this._drp.oSp=oDivOuter;if(fTop)oJT.getContainer().insertAdjacentElement(Owa.ElementInsertionPoint.AfterBegin,oDivOuter);else oJT.getContainer().insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oDivOuter)};Owa.UIControls.TreeControl.prototype._onContextMenuEventHandler=function Owa$UIControls$TreeControl$_onContextMenuEventHandler(oEvent){if(this._edting)return;var oJN=this.gtNd(oEvent.get_Target());if(oJN){if(this._onBeforeContextMenu(oJN))return;var oContextMenu=this.get_ContextMenu();if(!oContextMenu)return;if(oContextMenu.get_IsShown()){oContextMenu.close()}oContextMenu.get_OnClose().add(this._createCallback(this._onContextMenuCloseEventHandler));oContextMenu.get_OnSelect().add(this._createCallback(this._onContextMenuSelectEventHandler,oJN));oContextMenu.showAtEvent(oEvent);this._fDontSyncSelection=0;this.stNdHl(oJN,1)}oEvent.cancelBubble();oEvent.preventDefault()};Owa.UIControls.TreeControl.prototype._onBeforeContextMenu=function Owa$UIControls$TreeControl$_onBeforeContextMenu(oTreeNode){return oTreeNode._onBeforeContextMenu()};Owa.UIControls.TreeControl.prototype.fireOnResize=function Owa$UIControls$TreeControl$fireOnResize(){if(this.onResize)this.onResize()};Owa.UIControls.TreeControl.prototype.fireOnErrorInfobarChanged=function Owa$UIControls$TreeControl$fireOnErrorInfobarChanged(){if(this.onErrorInfobarChanged)this.onErrorInfobarChanged()}})();if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/foldertreenode.js".toLowerCase()])(function(){Owa.Components.FolderTreeNode=function Owa$Components$FolderTreeNode(oN,tr){Owa.Components.FolderTreeNode.constructBase(this,[oN,tr])};Owa.Components.FolderTreeNode.createClass("Owa.Components.FolderTreeNode",Owa.Components.TreeNode);Owa.Components.FolderTreeNode.prototype.gtFId=function Owa$Components$FolderTreeNode$gtFId(){return this.gtId().substr(1)};Owa.Components.FolderTreeNode.prototype.gtFT=function Owa$Components$FolderTreeNode$gtFT(){return this._get_Element().getAttribute("_ft")?getInt(this._get_Element().getAttribute("_ft")):0};Owa.Components.FolderTreeNode.prototype.isS=function Owa$Components$FolderTreeNode$isS(sFT){if(sFT)return this.gtFT()==sFT;else return !!this.gtFT()};Owa.Components.FolderTreeNode.prototype.gtFCC=function Owa$Components$FolderTreeNode$gtFCC(){return this._get_Element().getAttribute("_fcc")};Owa.Components.FolderTreeNode.prototype.getFolderNameElement=function Owa$Components$FolderTreeNode$getFolderNameElement(){return this.getContent().getChildById(FNID)};Owa.Components.FolderTreeNode.prototype.gtDspNm=function Owa$Components$FolderTreeNode$gtDspNm(){return this.gtFldNm()};Owa.Components.FolderTreeNode.prototype.stDspNm=function Owa$Components$FolderTreeNode$stDspNm(sNm){this.getFolderNameElement().set_TextContent(sNm);this.stFldNm(sNm)};Owa.Components.FolderTreeNode.prototype.gtFldNm=function Owa$Components$FolderTreeNode$gtFldNm(){return this.getFolderNameElement().getAttribute("fldrNm")};Owa.Components.FolderTreeNode.prototype.stFldNm=function Owa$Components$FolderTreeNode$stFldNm(sNm){this.getFolderNameElement().setAttribute("fldrNm",sNm)};Owa.Components.FolderTreeNode.prototype.isNC=function Owa$Components$FolderTreeNode$isNC(){return this._get_Element().getAttribute("_nc")};Owa.Components.FolderTreeNode.prototype.gtCCDT=function Owa$Components$FolderTreeNode$gtCCDT(){return this._get_Element().getAttribute("_ccdt")};Owa.Components.FolderTreeNode.prototype.isPlcy=function Owa$Components$FolderTreeNode$isPlcy(){return this._get_Element().getAttribute("_fPlcy")};Owa.Components.FolderTreeNode.prototype.gtAFlg=function Owa$Components$FolderTreeNode$gtAFlg(){return this._get_Element().getAttribute("_iAFlg")};Owa.Components.FolderTreeNode.prototype.gtEFFlg=function Owa$Components$FolderTreeNode$gtEFFlg(){return this._get_Element().getAttribute("_eff")};Owa.Components.FolderTreeNode.prototype.isOSF=function Owa$Components$FolderTreeNode$isOSF(){return this._get_Element().getAttribute("_osf")};Owa.Components.FolderTreeNode.prototype.isXOrg=function Owa$Components$FolderTreeNode$isXOrg(){return this.gtEFFlg()&EFF_XORG};Owa.Components.FolderTreeNode.prototype.gtER=function Owa$Components$FolderTreeNode$gtER(){return this._get_Element().getAttribute("_iER")};Owa.Components.FolderTreeNode.prototype.isPFR=function Owa$Components$FolderTreeNode$isPFR(){return this._get_Element().getAttribute("_iPFR")};Owa.Components.FolderTreeNode.prototype.canCp=function Owa$Components$FolderTreeNode$canCp(){if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){return !this.isPFR()}else{return !this.isXOrg()&&!(this.gtEFFlg()&EFF_SHI)&&!this.isS(DFT_SFR)&&!this.isOSF()&&g_oFldrMgr.gtFL(this.gtFId())!=FL_OUM&&!(this.gtAFlg()&(AFLG_RT|AFLG_PRV|AFLG_PRT))&&!this.isS(DFT_ROT)}};Owa.Components.FolderTreeNode.prototype.canMv=function Owa$Components$FolderTreeNode$canMv(){if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){return !this.isPFR()&&hasER(this.gtER(),ER_DLT)}else{var iAFlg=this.gtAFlg();return !(this.isS()||this.isXOrg()||(this.gtEFFlg()&(EFF_RMH|EFF_SHI))||this.isOSF()||(iAFlg&AFLG_PRV)||(iAFlg&AFLG_PRT))}};Owa.Components.FolderTreeNode.prototype.canDel=function Owa$Components$FolderTreeNode$canDel(){if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){return !this.isPFR()&&hasER(this.gtER(),ER_DLT)}else{var iAFlg=this.gtAFlg();return !(this.isS()||this.isXOrg()||(this.gtEFFlg()&EFF_RMH)||this.isOSF()||(iAFlg&AFLG_PRV)||(iAFlg&AFLG_PRT))}};Owa.Components.FolderTreeNode.prototype.canRnm=function Owa$Components$FolderTreeNode$canRnm(){if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){return !this.isPFR()&&hasER(this.gtER(),ER_MDF)}else{var iAFlg=this.gtAFlg();return !(this.isS()||this.isOSF()||this.isXOrg()||(this.gtEFFlg()&EFF_RMH)||(iAFlg&AFLG_PRV)||(iAFlg&AFLG_PRT))}};Owa.Components.FolderTreeNode.prototype.canAcceptSubFolderType=function Owa$Components$FolderTreeNode$canAcceptSubFolderType(sChildClass){if(this.canCrt()){if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){return true}else{var sClass=this.gtFCC();var fGeekFolder=(isOfClss(sClass,T_CAL)||isOfClss(sClass,T_CON)||isOfClss(sClass,T_TSK));var fChildGeekFolder=(isOfClss(sChildClass,T_CAL)||isOfClss(sChildClass,T_CON)||isOfClss(sChildClass,T_TSK));return !fGeekFolder||fChildGeekFolder}}else{return false}};Owa.Components.FolderTreeNode.prototype.canCrt=function Owa$Components$FolderTreeNode$canCrt(){if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){return hasER(this.gtER(),ER_CH)}else{return(g_oFldrMgr.gtFL(this.gtFId())!=FL_OUM)&&!this.isOSF()&&!this.isS(DFT_SFR)&&!(this.gtEFFlg()&(EFF_RMH|EFF_EXB))&&!(this.gtAFlg()&AFLG_RT)}};Owa.Components.FolderTreeNode.prototype.persistExp=function Owa$Components$FolderTreeNode$persistExp(){if(this._tr._fPrstRt&&this.isRt())g_oFldrMgr.prstTrExpSt()};Owa.Components.FolderTreeNode.prototype.feUpdCnts=function Owa$Components$FolderTreeNode$feUpdCnts(){g_oEd.fire("UpdateCount",this.gtFId(),getInt(this._get_Element().getAttribute("_iTC")),getInt(this._get_Element().getAttribute("_iUC")))};Owa.Components.FolderTreeNode.prototype.updCnts=function Owa$Components$FolderTreeNode$updCnts(iTC,iUC){var oContent=this.getContent();var oFldrNm=this.getFolderNameElement();var oEl=this._get_Element();if((iTC==-1||iTC==getInt(oEl.getAttribute("_iTC")))&&(iUC==-1||iUC==getInt(oEl.getAttribute("_iUC"))))return;if(iTC!=-1)oEl.setAttribute("_iTC",""+iTC);if(iUC!=-1)oEl.setAttribute("_iUC",""+iUC);if(this.gtCCDT()!=CCDT_NONE){var f=this.gtCCDT()==CCDT_ITMC;var iC=f?iTC:iUC;if(iC==-1)return;oFldrNm.set_FontWeight(iC?Owa.Style.FontWeight.Bold:Owa.Style.FontWeight.Normal);var sHtml=oFldrNm.get_OuterHtml();if(iC){sHtml+="<span id=\""+(f?"spnC":"spnUC")+"\">";sHtml+=g_sDE+(f?"[":"(")+"<span id=spnCV>"+iC+"</span>"+(f?"]":")")+g_sDE;sHtml+="</span>"}oContent.set_InnerHtml(sHtml)}};Owa.Components.FolderTreeNode.prototype.onDrg=function Owa$Components$FolderTreeNode$onDrg(oEvent){var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);var oDraggableObject=Owa.Components.Storage.StorableObject.create(Owa.Components.DraggableObjects.Type.Folder);var oFolder=oDraggableObject.get_RootElement();oFolder.set_IsOutlookSearchFolder(this.isOSF());oFolder.set_FolderId(this.gtFId());oDraggableObject.set_DenyCopy(!this.canCp());oDraggableObject.set_DenyMove(!this.canMv());var oJD=this._tr.gtNdByAls(ALP_DFT+DFT_DEL);var oJJ=this._tr.gtNdByAls(ALP_DFT+DFT_JNK);oFolder.set_IsInDeletedItems(this._tr.isAncstr(oJD,this));oFolder.set_IsInJunkItems(this._tr.isAncstr(oJJ,this));oFolder.set_FolderType(this.gtFT().toString());oFolder.set_FolderContainerClass(this.gtFCC());oDraggableObject.save(oDragDrop)};Owa.Components.FolderTreeNode.prototype.canDrg=function Owa$Components$FolderTreeNode$canDrg(){return !(g_oFldrMgr.gtFL(this.gtFId())==FL_OUM||this.isS(DFT_SFR)||(this.gtAFlg()&AFLG_RT))};Owa.Components.FolderTreeNode.prototype.canDrpExp=function Owa$Components$FolderTreeNode$canDrpExp(oDraggableObject){if((oDraggableObject.get_TypeName()!=Owa.Components.DraggableObjects.Type.Folder&&oDraggableObject.get_TypeName()!=Owa.Components.DraggableObjects.Type.Items&&oDraggableObject.get_TypeName()!=Owa.Components.DraggableObjects.Type.Conversations)||this.isS(DFT_SFR)||this.isOSF())return false;if(oDraggableObject.get_TypeName()==Owa.Components.DraggableObjects.Type.Folder&&g_oFldrMgr.gtFL(this.gtFId())==FL_OUM)return false;if(oDraggableObject.get_TypeName()==Owa.Components.DraggableObjects.Type.Folder)return true;else return isValidDropFolder(oDraggableObject,this.gtFCC())};Owa.Components.FolderTreeNode.prototype.gtDrpMd=function Owa$Components$FolderTreeNode$gtDrpMd(oJN,oEvent,oDraggableObject){if(!this.equals(oJN))return DRP_NONE;if(this.isS(DFT_TDS)||this.isS(DFT_SFR)||this.isOSF()||(this.gtAFlg()&AFLG_RT))return DRP_NONE;var fAC=!oDraggableObject.get_DenyCopy();var fAM=!oDraggableObject.get_DenyMove();var fFC=oEvent.isCtrlKeyDown();var fFM=oEvent.isShiftKeyDown();if(!fAC&&!fAM)return DRP_NONE;var sType=oDraggableObject.get_TypeName();var oRootElement=oDraggableObject.get_RootElement();if(sType===Owa.Components.DraggableObjects.Type.Folder||sType===Owa.Components.DraggableObjects.Type.Items||sType===Owa.Components.DraggableObjects.Type.Conversations){var sSrcFL=g_oFldrMgr.gtFL(oRootElement.get_FolderId());var sDstFL=g_oFldrMgr.gtFL(this.gtFId());var fMailTreeToMailTree=sSrcFL==FL_MBX&&sDstFL==FL_MBX;var fMA=(sSrcFL==FL_MBX||sSrcFL==FL_AMB)&&(sDstFL==FL_MBX||sDstFL==FL_AMB);var fC=(fMailTreeToMailTree||fMA)?fFC:!fFM;if(fC&&!fAC)return DRP_NONE;if(!fC&&!fAM)return DRP_NONE}switch(sType){case Owa.Components.DraggableObjects.Type.Items:case Owa.Components.DraggableObjects.Type.Conversations:if(g_oFldrMgr.gtFL(this.gtFId())==FL_OUM&&this.isRt())return DRP_NONE;var fSF=(this.gtFId()==oRootElement.get_FolderId())&&!oRootElement.get_IsCrossFolder();if(fSF&&!fC)return DRP_NONE;if(!isValidDropFolder(oDraggableObject,this.gtFCC()))return DRP_NONE;if(!this._hasDrpER(sType))return DRP_NONE;return fC?DRP_COPY:DRP_MOVE;case Owa.Components.DraggableObjects.Type.Folder:if(oRootElement.get_IsOutlookSearchFolder()||!this.canAcceptSubFolderType(oRootElement.get_FolderContainerClass()))return DRP_NONE;var oJS=this._tr.gtNdByFId(oRootElement.get_FolderId());if(oJS&&this._tr.isAncstr(oJS,this,1))return DRP_NONE;if(oJS&&!fC&&this.equals(this._tr.gtNdPrnt(oJS)))return DRP_NONE;if(!this._hasDrpER(sType))return DRP_NONE;return fC?DRP_COPY:DRP_MOVE;case Owa.Components.DraggableObjects.Type.NavigationNode:if(this.isS(DFT_DEL)&&fAM)return DRP_MOVE;else return DRP_NONE;default:return DRP_NONE}};Owa.Components.FolderTreeNode.prototype._hasDrpER=function Owa$Components$FolderTreeNode$_hasDrpER(sType){var iER=this.gtER();if(iER&&((sType==Owa.Components.DraggableObjects.Type.Folder&&!hasER(iER,ER_CH))||((sType==Owa.Components.DraggableObjects.Type.Items||sType==Owa.Components.DraggableObjects.Type.Conversations)&&!hasER(iER,ER_CC))))return 0;return 1};Owa.Components.FolderTreeNode.prototype.drpIn=function Owa$Components$FolderTreeNode$drpIn(oDraggableObject,iDM){var sDstFId=this.gtFId();var oRootElement=oDraggableObject.get_RootElement();switch(oDraggableObject.get_TypeName()){case Owa.Components.DraggableObjects.Type.Folder:var sSourceFolderId=oRootElement.get_FolderId();var oJD=this._tr.gtNdByAls(ALP_DFT+DFT_DEL);var oJSrc=this._tr.gtNdByFId(sSourceFolderId);var oJDst=this._tr.gtNdByFId(sDstFId);var fSrcD=this._tr.isAncstr(oJD,oJSrc,1);var fDstD=this._tr.isAncstr(oJD,oJDst,1);g_oFldrMgr.cpMvFld(this._tr,sSourceFolderId,fSrcD,sDstFId,fDstD,(iDM&DRP_IC_MSK)==DRP_COPY?1:0,!this.isUTD(),this._tr.gtFrt());break;case Owa.Components.DraggableObjects.Type.Items:case Owa.Components.DraggableObjects.Type.Conversations:var oListView;if(Owa.Utility.isDefined(typeof getLstVw))oListView=getNavigationPage().getLstVw(sSourceFolderId);if(checkLimit(oDraggableObject,oListView))return;var rgIds=[];oRootElement.foreach_Item(function(oItemElement){rgIds.push(oItemElement.get_ItemId())});g_oFldrMgr.cpMvItms(wt(),this._tr.get_SubPage(),oRootElement.get_FolderId(),rgIds,sDstFId,(iDM&DRP_IC_MSK)==DRP_COPY?1:0);break;case Owa.Components.DraggableObjects.Type.NavigationNode:var sSourceFolderId=oRootElement.get_FolderId();g_oNvNdMgr.rmvFrmFvr(this._tr,sSourceFolderId);break}};Owa.Components.FolderTreeNode.prototype._onBeforeContextMenu=function Owa$Components$FolderTreeNode$_onBeforeContextMenu(){var iFolderLocation=g_oFldrMgr.gtFL(this.gtFId());var oContextMenu;if(iFolderLocation==FL_PUB){var oContextMenu=getPublicFolderTreeMenu();this._preparePublicFolderMenu(oContextMenu)}else{if(this.isS(DFT_SFR)||(this.gtAFlg()&AFLG_RT))return true;var oContextMenu=getFolderTreeMenu();this._prepareFolderMenu(oContextMenu)}this._tr.set_ContextMenu(oContextMenu)};Owa.Components.FolderTreeNode.prototype._prepareFolderMenu=function Owa$Components$FolderTreeNode$_prepareFolderMenu(oContextMenu){var rgId=oContextMenu.getAllMenuItemIds();oContextMenu.showMenuItems(rgId,false);var fOUF=g_oFldrMgr.gtFL(this.gtFId())==FL_OUM;if(fOUF&&this.isS(DFT_ROT)){oContextMenu.showMenuItems(["divOUM","divRSF"],true);oContextMenu.enableMenuItems(["divOUM","divRSF"],true);return}var rgShowId=["divO","divON","divMvF","divCpF","divD","divRnm","divMAR","divCF"];oContextMenu.showMenuItems(rgShowId,true);oContextMenu.enableMenuItems(rgShowId,true);var sFId=this.gtFId();if(g_oNvNdMgr.isInFvr(sFId)){oContextMenu.showMenuItem("divRmFvr",true);oContextMenu.enableMenuItem("divRmFvr",true)}else if(g_oNvNdMgr.canAddToFvr(this.gtFId(),this.gtFCC(),this.gtFT(),this._tr.isAncstr(this._tr.gtNdByAls(ALP_DFT+DFT_DEL),this))){oContextMenu.showMenuItem("divFvr",true);oContextMenu.enableMenuItem("divFvr",true)}else{oContextMenu.enableMenuItem("divFvr",false)}if(g_oFldrMgr.isMyFId(sFId)){if(this.isS(DFT_ROT)&&(isFtEnab(FT_DLGACC))){oContextMenu.showMenuItem("divOUM",true);if(isExpLgn())oContextMenu.enableMenuItem("divOUM",false);else oContextMenu.enableMenuItem("divOUM",true)}if(oContextMenu._getDescendant("divDelPtg")&&!this.isS(DFT_ROT)){oContextMenu.showMenuItem("divDelPtg",true);oContextMenu.enableMenuItem("divDelPtg",true);Owa.UIControls.DeletePolicyContextMenu.get_Instance(this._tr.get_SubPage()).set_SelectedIds(new Array(sFId))}if(oContextMenu._getDescendant("divMvPtg")&&!this.isS(DFT_ROT)&&!this.isS(DFT_JNK)){var oJJ=this._tr.gtNdByAls(ALP_DFT+DFT_JNK);if(!this._tr.isAncstr(oJJ,this)){oContextMenu.showMenuItem("divMvPtg",true);oContextMenu.enableMenuItem("divMvPtg",true);Owa.UIControls.MovePolicyContextMenu.get_Instance(this._tr.get_SubPage()).set_SelectedIds(new Array(sFId))}}}if(!this.canCrt())oContextMenu.enableMenuItem("divCF",false);var oJD=this._tr.gtNdByAls(ALP_DFT+DFT_DEL);if(this._tr.isAncstr(oJD,this)){oContextMenu.showMenuItem("divRs",true);oContextMenu.enableMenuItem("divRs",true)}if(!this.canDel())oContextMenu.enableMenuItem("divD",false);if(!this.canRnm())oContextMenu.enableMenuItem("divRnm",false);if(this.isS(DFT_DEL)){oContextMenu.showMenuItem("divED",true);oContextMenu.enableMenuItem("divED",true);if(isFtEnab(FT_DUMPSTER)){oContextMenu.showMenuItem("divRD",true);oContextMenu.enableMenuItem("divRD",true)}}else if(this.isS(DFT_JNK)){oContextMenu.showMenuItem("divEJ",true);oContextMenu.enableMenuItem("divEJ",true)}else if(this.isOSF()||this.isS(DFT_RSS)||fOUF){oContextMenu.enableMenuItem("divEF",false)}else{oContextMenu.showMenuItem("divEF",true);oContextMenu.enableMenuItem("divEF",true)}if(!this.canMv())oContextMenu.enableMenuItem("divMvF",false);if(!this.canCp())oContextMenu.enableMenuItem("divCpF",false)};Owa.Components.FolderTreeNode.prototype._preparePublicFolderMenu=function Owa$Components$FolderTreeNode$_preparePublicFolderMenu(oContextMenu){var rgId=oContextMenu.getAllMenuItemIds();oContextMenu.showMenuItems(rgId,true);oContextMenu.enableMenuItems(rgId,true);if(!this.canCrt())oContextMenu.enableMenuItem("divCPF",false);if(!this.canDel())oContextMenu.enableMenuItem("divDPF",false);if(!this.canRnm())oContextMenu.enableMenuItem("divRnmPF",false);if(!this.canMv())oContextMenu.enableMenuItem("divMvPF",false);if(!this.canCp())oContextMenu.enableMenuItem("divCpPF",false);var sT=this.gtFCC();if(!isOfClss(sT,T_MSG))oContextMenu.enableMenuItem("divEPF",false);if(isOfClss(sT,T_CAL)||isOfClss(sT,T_CON)||isOfClss(sT,T_TSK))oContextMenu.showMenuItem("divMPFR",false)};Owa.Components.FolderTreeNode.prototype.onContextMenuClick=function Owa$Components$FolderTreeNode$onContextMenuClick(oEventArgs){var oT=this._tr;switch(oEventArgs.sCommand){case"openotherfolder":opnShrDlg();break;case"markread":g_oFldrMgr.mkAllRd(this._tr,this.gtFId());break;case"emptydeleted":case"emptyfldr":case"emptyjunk":this.emptyFld();break;case"recoverdeleted":this._tr.get_ContextMenu().close();var sUrl="?ae=Dialog&t=RecoverDeletedItems&id="+urlEnc(this.gtFId());opnWin(sUrl,520,620,1,null,null,null,this._tr.get_SubPage());break;case"open":if(a_iNM==NM_CAL)oT.feOnOpnCal(this.gtFId());else oT.selNdById(this.gtId());break;case"opennew":opnNew(this.gtFId(),this.gtFCC(),oT.gtSelELCNdFId?oT.gtSelELCNdFId():null);break;case"delete":var fP=g_oFldrMgr.gtFL(this.gtFId())==FL_PUB?1:0;var fD=this._tr.isAncstr(this._tr.gtNdByAls(ALP_DFT+DFT_DEL),this);this.delFld(fP,fD);break;case"rename":oT.nwFld(this,0);break;case"createfolder":oT.nwFld(this,1);break;case"move":case"movefolder":var oFolderPickerDialog=Owa.UIControls.FolderPickerDialog.get_Default();oFolderPickerDialog.set_IsShowPublicFolder(true);oFolderPickerDialog.set_ButtonCaptions([L_Mv]);oFolderPickerDialog.set_Title(L_MvToFld);oFolderPickerDialog.set_SourceTreeNode(this);oFolderPickerDialog.onCheckCustomButtons=updateFolderPickerCopyMoveFolderButton;oFolderPickerDialog.onButtonClick=this._createCallback(this.cbFolderPickerDialogButtonClick,oFolderPickerDialog);oFolderPickerDialog.show();break;case"copy":case"copyfolder":var oFolderPickerDialog=Owa.UIControls.FolderPickerDialog.get_Default();oFolderPickerDialog.set_IsShowPublicFolder(true);oFolderPickerDialog.set_ButtonCaptions([L_Cp]);oFolderPickerDialog.set_Title(L_CpToFld);oFolderPickerDialog.set_SourceTreeNode(this);oFolderPickerDialog.onCheckCustomButtons=updateFolderPickerCopyMoveFolderButton;oFolderPickerDialog.onButtonClick=this._createCallback(this.cbFolderPickerDialogButtonClick,oFolderPickerDialog);oFolderPickerDialog.show();break;case"removefromview":g_oNvNdMgr.rmvOUM(this._tr,this.gtFId());break;case"restore":if(g_oFldrMgr.gtFL(this.gtFId())==FL_AMB){var oJR=this._tr.gtNdByAls(ALP_DFT+DFT_ROT);g_oFldrMgr.cpMvFld(this._tr,this.gtFId(),1,oJR.gtFId(),0,0,0,this._tr.gtFrt())}else{if(isOfClss(this.gtFCC(),T_CAL))g_oFldrMgr.cpMvFld(this._tr,this.gtFId(),1,this._tr.gtDfCalId(),0,0,0,FRT_ALL);else if(isOfClss(this.gtFCC(),T_CON))g_oFldrMgr.cpMvFld(this._tr,this.gtFId(),1,this._tr.gtDfCntId(),0,0,0,FRT_ALL);else if(isOfClss(this.gtFCC(),T_TSK))g_oFldrMgr.cpMvFld(this._tr,this.gtFId(),1,this._tr.gtDfTskId(),0,0,0,FRT_ALL);else{var oJI=this._tr.gtNdByAls(ALP_DFT+DFT_IBX);g_oFldrMgr.cpMvFld(this._tr,this.gtFId(),1,oJI.gtFId(),0,0,0,FRT_ALL)}}break;case"createMailFld":oT.nwFld(this,1,T_MSG);break;case"createCalFld":oT.nwFld(this,1,T_CAL);break;case"createCntFld":oT.nwFld(this,1,T_CON);break;case"createTskFld":oT.nwFld(this,1,T_TSK);break;case"createNtsFld":oT.nwFld(this,1,T_NTS);break;case"addfavorite":g_oNvNdMgr.addFvr(this._tr,this.gtFId());break;case"removefromfavorite":g_oNvNdMgr.rmvFrmFvr(this._tr,this.gtFId());break}};Owa.Components.FolderTreeNode.prototype.cbFolderPickerDialogButtonClick=function Owa$Components$FolderTreeNode$cbFolderPickerDialogButtonClick(iButtonIndex,oFolderPickerDialog){var oTree=oFolderPickerDialog._get_TreeControl();var sId=oTree.gtSelNd().gtFId();var fIsDestinationInDeletedItems=oTree.isAncstr(oTree.gtNdByAls(ALP_DFT+DFT_DEL),oTree.gtSelNd(),1);var fIsCopy=oFolderPickerDialog.get_ButtonCaptions(iButtonIndex)==L_Cp;var oDestinationTreeNode=this._tr.gtNdByFId(sId);var fIsSourceInDeletedItems=this._tr.isAncstr(this._tr.gtNdByAls(ALP_DFT+DFT_DEL),this._tr.gtNdByFId(this.gtFId()),1);var fIsExpand=oDestinationTreeNode&&!oDestinationTreeNode.isUTD();g_oFldrMgr.cpMvFld(this._tr,this.gtFId(),fIsSourceInDeletedItems,sId,fIsDestinationInDeletedItems,fIsCopy,fIsExpand,(fIsDestinationInDeletedItems||isPFId(sId))?FRT_HSF:FRT_HGF)};Owa.Components.FolderTreeNode.prototype.emptyFld=function Owa$Components$FolderTreeNode$emptyFld(){var sDlgMsg;var sDlgTtl;if(g_oFldrMgr.gtFL(this.gtFId())==FL_PUB){sDlgMsg=L_PrEmpPF;sDlgTtl=L_EmptDltFdrTtl}else if(this.isS(DFT_DEL)){sDlgMsg=L_WrnEmpt;sDlgTtl=L_EmptFdrTtl}else if(this.isS(DFT_JNK)){sDlgMsg=L_WrnEmptJnk;sDlgTtl=L_EmptJnk}else{sDlgMsg=L_WrnEmptFldr;sDlgTtl=L_EmptDltFdrTtl}this._tr._fDontSyncSelection=1;var oD=new BtnDlg("divDlt",htmlEnc(sDlgMsg),sDlgTtl,[L_Yes,L_No],null,Owa.BUTTON_DIALOG_ICON.QUESTION,this._createCallback(this.onEmptyFdr));oD.show()};Owa.Components.FolderTreeNode.prototype.onEmptyFdr=function Owa$Components$FolderTreeNode$onEmptyFdr(i){if(i==0){var sMthd;if(this.isS(DFT_DEL))sMthd="EmptyDeletedItems";else if(this.isS(DFT_JNK))sMthd="EmptyJunkEmail";else sMthd="EmptyFolder";g_oFldrMgr.emptyFld(this._tr,sMthd,this.gtFId())}this._tr.syncSelNHl()};Owa.Components.FolderTreeNode.prototype.delFld=function Owa$Components$FolderTreeNode$delFld(fP,fD){var sMsg;fP=fD?1:fP;sMsg=fP?L_PrDelFldrPrp:L_WrnDlFl;this._tr._fDontSyncSelection=1;var oD=new BtnDlg("divDlt",htmlEnc(sMsg),L_WrnDlFlTtl,[L_Yes,L_No],null,Owa.BUTTON_DIALOG_ICON.QUESTION,this._createCallback(this.cbOnDelFld,[fP,fD]));oD.show();return};Owa.Components.FolderTreeNode.prototype.cbOnDelFld=function Owa$Components$FolderTreeNode$cbOnDelFld(i,oContext){var fP=oContext[0];var fD=oContext[1];if(i==0)g_oFldrMgr.delFld(this._tr,this.gtFId(),fD,fP);this._tr.syncSelNHl()}})();g_fModuleLoaded[".\\uicontrols/foldertreenode.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/foldertree.js".toLowerCase()])(function(){var g_sFldIco=0;Owa.UIControls.FolderTree=function Owa$UIControls$FolderTree(root,fOS,fPrstRt){this._fOS=fOS;Owa.UIControls.FolderTree.constructBase(this,[root]);this._fPrstRt=fPrstRt?1:0;if(!g_sFldIco)g_sFldIco=g_rgsFIcns[T_MSG]};Owa.UIControls.FolderTree.createClass("Owa.UIControls.FolderTree",Owa.UIControls.TreeControl);Owa.UIControls.FolderTree.prototype.initialize=function Owa$UIControls$FolderTree$initialize(){this.root.setExpando("_frt",this.root.getAttribute("_frt")?getInt(this.root.getAttribute("_frt")):0);if(!this._fOS){var oJN=this.gtNd(this.root.get_FirstChild());var o=oJN._get_Element();if(g_oFldrMgr.isMyFId(oJN.gtFId())){if(this.gtAndShwMbxUsg)this._attachEvent(o,"mouseover",this.gtAndShwMbxUsg);if(this.hdMbxUsg)this._attachEvent(o,"mouseout",this.hdMbxUsg)}}else{this._onDrp=null;this._onDO=null;this._onDL=null;this._onDS=null;this._onContextMenuEventHandler=null}var oJS=this.crtAls(this.gtNdRt());if(oJS)this._sSelNdId=oJS.gtId();Owa.UIControls.FolderTree.callBase(this,"initialize");g_oEd.attachEvent("RenameFolder",this,"cbOnRnFld");g_oEd.attachEvent("NewFolder",this,"cbOnNwFld");g_oEd.attachEvent("MoveFolder",this,"cbOnCpMvFld");g_oEd.attachEvent("CopyFolder",this,"cbOnCpMvFld");g_oEd.attachEvent("DeleteFolder",this,"cbOnDelFld");g_oEd.attachEvent("EmptyFolder",this,"cbOnEmptyFld");g_oEd.attachEvent("UpdateCount",this,"cbOnUpdCnt");g_oEd.attachEvent("RemoveFromView",this,"cbOnRmvOUM");g_oEd.attachEvent("RemoveNavigation",this,"cbOnRmvNvNd");if(this._fOS)this.clrSel()};Owa.UIControls.FolderTree.prototype.dispose=function Owa$UIControls$FolderTree$dispose(){var oJN=this.gtNd(this.root.get_FirstChild());if(oJN){var o=oJN._get_Element();if(o){if(this.gtAndShwMbxUsg)this._detachEvent(o,"mouseover",this.gtAndShwMbxUsg);if(this.hdMbxUsg)this._detachEvent(o,"mouseout",this.hdMbxUsg)}}g_oEd.detachEvent("RenameFolder",this,"cbOnRnFld");g_oEd.detachEvent("NewFolder",this,"cbOnNwFld");g_oEd.detachEvent("MoveFolder",this,"cbOnCpMvFld");g_oEd.detachEvent("CopyFolder",this,"cbOnCpMvFld");g_oEd.detachEvent("DeleteFolder",this,"cbOnDelFld");g_oEd.detachEvent("EmptyFolder",this,"cbOnEmptyFld");g_oEd.detachEvent("UpdateCount",this,"cbOnUpdCnt");g_oEd.detachEvent("RemoveFromView",this,"cbOnRmvOUM");g_oEd.detachEvent("RemoveNavigation",this,"cbOnRmvNvNd");Owa.UIControls.FolderTree.callBase(this,"dispose")};Owa.UIControls.FolderTree.prototype.crtAls=function Owa$UIControls$FolderTree$crtAls(oJP){var oJN=this.gtNdFrstChld(oJP);var oJS;if(oJP.gtFT&&oJP.gtFT())this.stAls(ALP_DFT+oJP.gtFT(),oJP.gtId());if(oJP.isSel())oJS=oJP;while(oJN){if(!oJS&&oJN.isSel())oJS=oJN;if(oJN.hsChld()&&oJN.isUTD()){if(!oJS)oJS=this.crtAls(oJN);else this.crtAls(oJN)}else if(oJN.gtFT&&oJN.gtFT())this.stAls(ALP_DFT+oJN.gtFT(),oJN.gtId());oJN=this.gtNdNxt(oJN)}return oJS};Owa.UIControls.FolderTree.prototype.gtDfCalId=function Owa$UIControls$FolderTree$gtDfCalId(){return this.root.getAttribute("_DfCal")};Owa.UIControls.FolderTree.prototype.gtDfCntId=function Owa$UIControls$FolderTree$gtDfCntId(){return this.root.getAttribute("_DfCnt")};Owa.UIControls.FolderTree.prototype.gtDfTskId=function Owa$UIControls$FolderTree$gtDfTskId(){return this.root.getAttribute("_DfTsk")};Owa.UIControls.FolderTree.prototype.gtNdByFId=function Owa$UIControls$FolderTree$gtNdByFId(sFId){return this.gtNdById(padF(sFId))};Owa.UIControls.FolderTree.prototype.gtSelELCNdFId=function Owa$UIControls$FolderTree$gtSelELCNdFId(){var oJN=this.gtSelNd();while(oJN){if(oJN.isRt())return;if((oJN.isS()&&oJN.isPlcy())||oJN.gtAFlg())break;oJN=this.gtNdPrnt(oJN)}return oJN?oJN.gtFId():null};Owa.UIControls.FolderTree.prototype.gtFrt=function Owa$UIControls$FolderTree$gtFrt(){return this.root.getExpando("_frt")};Owa.UIControls.FolderTree.prototype.isCmptblFrt=function Owa$UIControls$FolderTree$isCmptblFrt(oJN,iFrt0,iFrt1){if(this.isAncstr(this.gtNdByAls(ALP_DFT+DFT_DEL),oJN,1))return(iFrt0&~FRT_HGF)==(iFrt1&~FRT_HGF);else return iFrt0==iFrt1};Owa.UIControls.FolderTree.prototype.wrapNd=function Owa$UIControls$FolderTree$wrapNd(oN){if(oN.getAttribute("_t")==TN_FTN)return new Owa.Components.FolderTreeNode(oN,this);else return Owa.UIControls.FolderTree.callBase(this,"wrapNd",arguments)};Owa.UIControls.FolderTree.prototype.onKD=function Owa$UIControls$FolderTree$onKD(oEvent){switch(oEvent.get_KeyCodeForKeyUpDown()){case 46:var oJSel=this.gtSelNd();var fP=g_oFldrMgr.gtFL(oJSel.gtFId())==FL_PUB?1:oEvent.isShiftKeyDown();if(oJSel&&oJSel.canDel())oJSel.delFld(fP,0)}};Owa.UIControls.FolderTree.prototype.getChildren=function Owa$UIControls$FolderTree$getChildren(oJN){this.expOeh(oJN)};Owa.UIControls.FolderTree.prototype.feUpdChldCnt=function Owa$UIControls$FolderTree$feUpdChldCnt(oJN){for(var oJNC=this.gtNdFrstChld(oJN);oJNC;oJNC=this.gtNdNxt(oJNC))oJNC.feUpdCnts()};Owa.UIControls.FolderTree.prototype.expOeh=function Owa$UIControls$FolderTree$expOeh(oJN){var oCtx={sId:oJN.gtId()};var iFrt=this.gtFrt();var oJD=this.gtNdByAls(ALP_DFT+DFT_DEL);var oR=new oeReq("Tree","Expand",oCtx,this._createCallback(this.cbExpOeh),GET);oR.add("id",oJN.gtFId());if(this.isAncstr(oJD,oJN,1))iFrt&=~FRT_HGF;oR.add("rdt",iFrt);oR.send()};Owa.UIControls.FolderTree.prototype.cbExpOeh=function Owa$UIControls$FolderTree$cbExpOeh(oR){var oJN=this.gtNdById(oR.oCtx.sId);oJN.hdPrg();if(!this.cbOeh(oR))return;var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);this.stKds(oJN,oC.getDescendantById("tn").getChildrenSnapshot());oJN.stUTD(1);oJN.expand();this.feUpdChldCnt(oJN)};Owa.UIControls.FolderTree.prototype.cbOnRmvNvNd=function Owa$UIControls$FolderTree$cbOnRmvNvNd(oR,oSndr,sNId,fP){if(oR.isErr())return;var oJD=this.gtNdByAls(ALP_DFT+DFT_DEL);if(oJD&&oJD.isUTD()){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oC=oC.getDescendantById("tn");if(oC){var rgChildrenValid=[];var rgChildren=oC.getChildrenSnapshot();while(rgChildren.length>0){var oNd=rgChildren.shift();var sFId=oNd.getAttribute("id").substr(1);if(g_oFldrMgr.gtFL(oJD.gtFId())==g_oFldrMgr.gtFL(sFId)){rgChildrenValid.push(oNd)}}if(rgChildrenValid.length>0){this.addKds(oJD,rgChildrenValid)}}}};Owa.UIControls.FolderTree.prototype.cbOnDelFld=function Owa$UIControls$FolderTree$cbOnDelFld(oR,oSndr,sFId,fD,fP){var fSndBM=oSndr==this;if(fSndBM&&!this.cbOeh(oR))return;if(oR.isErr())return;var oJF=this.gtNdByFId(sFId);var oJD=this.gtNdByAls(ALP_DFT+DFT_DEL);var oJSel=this.gtSelNd();var fSel=oJF?this.isAncstr(oJF,oJSel,1):0;var oJT;if(fSel)oJT=this.gtNrstNd(oJF);if(oJF)this.rmNd(oJF);if(!fP&&oJD&&oJF){if(oJD.isUTD()){var oDiv=this.root.get_OwnerDocument().createElement(DIV);oDiv.set_InnerHtml(oR.sBody);this.addKds(oJD,oDiv.getDescendantById("tn").getChildrenSnapshot())}else{this.clrKds(oJD);oJD.stUTD(0);oJD._get_Element().setAttribute("_hsChld","1");oJD.upd()}}if(fSel){if(!oJT){if(this._frst)this._frst.selDfN();else this.clrSel()}else this.selNd(oJT)}};Owa.UIControls.FolderTree.prototype.cbOnRmvOUM=function Owa$UIControls$FolderTree$cbOnRmvOUM(oR,oSndr){var fSndBM=oSndr==this;if(!fSndBM)return;if(!this.cbOeh(oR))return;if(this._frst)this._frst.rmTr(this._nm);var oJR=this.gtNdRt();var oJN=this.gtNdFrstChld(oJR);if(oJN)removeFolderView(oJN.gtFId());this.root.get_ParentElement().remove(true);this.dispose()};Owa.UIControls.FolderTree.prototype.cbOnCpMvFld=function Owa$UIControls$FolderTree$cbOnCpMvFld(oR,oSndr,sSrcFId,fSrcD,sDstPFId,fDstD,fC,fExp,iFrt){var fSndBM=oSndr==this;if(fSndBM&&!this.cbOeh(oR))return;if(oR.isErr())return;var oJSrc=this.gtNdByFId(sSrcFId);var oJDst=this.gtNdByFId(sDstPFId);if(!oJSrc&&!oJDst)return;var oJSel=this.gtSelNd();var fSel=this.hsSelNd()&&this.isAncstr(oJSrc,oJSel,1);var oJT;if(fSel){if(fC)oJT=oJSel;else oJT=this.gtNrstNd(oJSrc)}if(!fC&&oJSrc)this.rmNd(oJSrc);if(oJDst){if(oJDst.isUTD()||(fExp&&this.isCmptblFrt(oJDst,this.gtFrt(),iFrt))){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oC=oC.getDescendantById("tn");if(oJDst.isUTD()){var sNewId;oC.forEachChild(function(oElement){if(oElement.getAttribute("_NF")){oElement.setAttribute("_NF",null);sNewId=oElement.get_Id();return 1}});if(sNewId){oC.set_InnerHtml(oC.getDescendantById(sNewId).get_OuterHtml());if(oJDst.isS(DFT_ROT)&&(this.gtFrt()&FRT_HGF)){if(g_oFldrMgr.isMyFId(oJDst.gtFId())){var oJI=this.gtNdByAls(ALP_DFT+DFT_IBX);this.insrtKdsPos(oJI,oC.getChildrenSnapshot(),0,1)}else if(g_oFldrMgr.gtFL(oJDst.gtFId())==FL_AMB){var oJF=this.gtNdFrstChld(oJDst);this.insrtKdsPos(oJF,oC.getChildrenSnapshot(),0,0)}}else{this.addKds(oJDst,oC.getChildrenSnapshot())}}}else{var fIsExp=oJDst.isExp();this.clrKds(oJDst);this.addKds(oJDst,oC.getChildrenSnapshot());if(fIsExp)oJDst.expand();else oJDst.collapse();oJDst.stUTD(1)}}oJDst.expand();this.feUpdChldCnt(oJDst)}if(fSel){if(!oJT&&this._frst)return this._frst.selDfN();if(oJT){this.selNd(oJT);this.syncSelNHl()}}};Owa.UIControls.FolderTree.prototype.cbOnUpdCnt=function Owa$UIControls$FolderTree$cbOnUpdCnt(sFId,iTC,iUC){var oJN=this.gtNdByFId(sFId);if(!oJN)return;oJN.updCnts(iTC,iUC)};Owa.UIControls.FolderTree.prototype.cbOnEmptyFld=function Owa$UIControls$FolderTree$cbOnEmptyFld(oR,oSndr,sMthd,sFId){var fSndBM=oSndr==this;if(fSndBM&&!this.cbOeh(oR))return;if(oR.isErr())return;var oJN=this.gtNdByFId(sFId);if(!oJN)return;if(oJN.isS(DFT_DEL)||oJN.isS(DFT_JNK)){if(this.isAncstr(oJN,this.gtSelNd())){this.selNd(this.gtNdByAls(ALP_DFT+DFT_IBX))}this.clrKds(oJN)}g_oEd.fire("UpdateCount",sFId,0,0);if(a_sLstFID==sFId){var oLV=this.get_SubPage().getLstVw(sFId);if(oLV&&oLV.rfrsh)oLV.rfrsh()}else{var oSubPageController;if(oJN.isS(DFT_DEL)||oJN.isS(DFT_JNK))oSubPageController=getViewSubPageControllerByFolderId(sFId);if(oSubPageController)oSubPageController.remove()}if(oJN.isS(DFT_DEL)||oJN.isS(DFT_JNK))getMailboxUsage()};Owa.UIControls.FolderTree.prototype.nwFld=function Owa$UIControls$FolderTree$nwFld(oJPN,fNw,sCC){var oCtx={sCC:sCC};if(!fNw){return this.edtNd(oJPN,oCtx)}else if(!(oJPN.isS(DFT_ROT)&&(this.gtFrt()&FRT_HGF))||g_oFldrMgr.gtFL(oJPN.gtFId())==FL_AMB){return this.crtNwNd(oJPN,oCtx,0,this.gtNdFrstChld(oJPN))}else{var oJI=this.gtNdByAls(ALP_DFT+DFT_IBX);var oJN=this.gtNdNxt(oJI);this.crtNwNd(oJPN,oCtx,0,oJN)}};Owa.UIControls.FolderTree.prototype.onRnNd=function Owa$UIControls$FolderTree$onRnNd(rsn,sV){var oJN=this._edt.nd;if(rsn!=ECR_ESC)g_oFldrMgr.rnmFld(this,oJN.gtFId(),sV);else this.qtEdtNd()};Owa.UIControls.FolderTree.prototype.cbOnRnFld=function Owa$UIControls$FolderTree$cbOnRnFld(oR,oSndr,sFId){var fSndBM=oSndr==this;if(fSndBM&&this._edting&&!this.cbOeh(oR,true))return;if(oR.isErr())return;var oJN=this.gtNdByFId(sFId);if(oJN){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);var oC=oC.getDescendantById("tn");if(oC)oJN.stDspNm(oC.get_TextContent())}};Owa.UIControls.FolderTree.prototype.onNwNd=function Owa$UIControls$FolderTree$onNwNd(rsn,sV){var oJN=this._edt.nd;var oJPN=this.gtNdPrnt(oJN);if(rsn!=ECR_ESC){var oJD=this.gtNdByAls(ALP_DFT+DFT_DEL);var fD=this.isAncstr(oJD,oJN,1);g_oFldrMgr.nwFld(this,oJPN.gtFId(),fD,this._edt.oCtx.sCC?this._edt.oCtx.sCC:oJPN.gtFCC(),sV,oJPN.isUTD()?0:1,fD?FRT_ALL:this.gtFrt())}else{this.qtEdtNd()}};Owa.UIControls.FolderTree.prototype.cbOnNwFld=function Owa$UIControls$FolderTree$cbOnNwFld(oR,oSndr,sPFId,fD,sCC,sNwNm,fExp,iFrt){var fSndBM=oSndr==this;if(fSndBM&&this._edting&&!this.cbOeh(oR,true))return;if(oR.isErr())return;var oJPN=this.gtNdByFId(sPFId);if(!oJPN)return;if(oJPN.isUTD()||(fExp&&this.isCmptblFrt(oJPN,this.gtFrt(),iFrt))){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oC=oC.getDescendantById("tn");var sNewId;if(fSndBM||oJPN.isUTD()){oC.forEachChild(function(oElement){if(oElement.getAttribute("_NF")){oElement.setAttribute("_NF",null);sNewId=oElement.get_Id();return 1}})}if(oJPN.isUTD()&&sNewId){oC.set_InnerHtml(oC.getDescendantById(sNewId).get_OuterHtml());if(oJPN.isS(DFT_ROT)&&g_oFldrMgr.isMyFId(oJPN.gtFId())&&(this.gtFrt()&FRT_HGF)){var oJI=this.gtNdByAls(ALP_DFT+DFT_IBX);this.insrtKdsPos(oJI,oC.getChildrenSnapshot(),0,1)}else{var oJPos=this.gtNdFrstChld(oJPN);if(oJPos)this.insrtKdsPos(oJPos,oC.getChildrenSnapshot());else this.addKds(oJPN,oC.getChildrenSnapshot())}}else{var fIsExp=oJPN.isExp();this.clrKds(oJPN);this.addKds(oJPN,oC.getChildrenSnapshot());if(fIsExp)oJPN.expand();else oJPN.collapse();oJPN.stUTD(1)}this.feUpdChldCnt(oJPN)}if(fSndBM){oJPN.expand();var oJN=this.gtNdById(sNewId);this.feOnNwFld(oJN)}};Owa.UIControls.FolderTree.prototype.feOnNwFld=function Owa$UIControls$FolderTree$feOnNwFld(oJN){if(this.onNwFld)this.onNwFld(oJN)};Owa.UIControls.FolderTree.prototype.gtNwNdIcnMrkup=function Owa$UIControls$FolderTree$gtNwNdIcnMrkup(oJPN,oCtx){var img=oJPN.gtImg();var sIcnMrkup=img.get_OuterHtml();if(isOfClss(oJPN.gtFCC(),T_MSG))sIcnMrkup=Owa.Components.CssSprites.getImageMarkup(g_sFldIco,"id=\""+NODE_ICON+"\"");if(oCtx.sCC){var sT=oCtx.sCC;sIcnMrkup=Owa.Components.CssSprites.getImageMarkup(g_rgsFIcns[sT]?g_rgsFIcns[sT]:g_rgsFIcns[T_MSG],"id=\""+NODE_ICON+"\"")}return sIcnMrkup};Owa.UIControls.FolderTree.prototype.gtAndShwMbxUsg=function Owa$UIControls$FolderTree$gtAndShwMbxUsg(oEvent){g_iPrgIndQt=Owa.Dom.Window.get_Current().setTimeout(this._createCallback(this.cbGtAndShwMbxUsg,[oEvent.get_ClientX(),oEvent.get_ClientY()]),1000)};Owa.UIControls.FolderTree.prototype.cbGtAndShwMbxUsg=function Owa$UIControls$FolderTree$cbGtAndShwMbxUsg(oNull,oContext){var x=oContext[0];var y=oContext[1];if(g_iPrgIndQt!=0)getMailboxUsage(1,x,y)};Owa.UIControls.FolderTree.prototype.hdMbxUsg=function Owa$UIControls$FolderTree$hdMbxUsg(){if(g_iPrgIndQt){this._clearTimeout(g_iPrgIndQt);g_iPrgIndQt=0}hideMailboxUsage()}})();g_fModuleLoaded[".\\uicontrols/foldertree.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/navigationheadertreenode.js".toLowerCase()])(function(){Owa.Components.NavigationHeaderTreeNode=function Owa$Components$NavigationHeaderTreeNode(oN,tr){Owa.Components.NavigationHeaderTreeNode.constructBase(this,[oN,tr])};Owa.Components.NavigationHeaderTreeNode.createClass("Owa.Components.NavigationHeaderTreeNode",Owa.Components.TreeNode);Owa.Components.NavigationHeaderTreeNode.prototype.gtNId=function Owa$Components$NavigationHeaderTreeNode$gtNId(){return this.gtId().substr(1)};Owa.Components.NavigationHeaderTreeNode.prototype.gtDrpMd=function Owa$Components$NavigationHeaderTreeNode$gtDrpMd(oJN,oEvent,oDraggableObject){var oRootElement=oDraggableObject.get_RootElement();switch(oDraggableObject.get_TypeName()){case Owa.Components.DraggableObjects.Type.NavigationHeader:var sNavigationNodeId=oRootElement.get_NavigationNodeId();if(this.gtNId()==sNavigationNodeId)return DRP_NONE;var iClientY=oEvent.get_ClientY();var iNodeMiddleY=this.getContainer().get_DocumentTop()+this.getContainer().get_OffsetHeight()/2;if(iClientY>iNodeMiddleY){var oJN=this._tr.gtNdNxt(this);if(!oJN||oJN.gtNId()!=sNavigationNodeId)return DRP_BELOW|DRP_MOVE}else{var oJP=this._tr.gtNdPrv(this);if(!oJP||oJP.gtNId()!=sNavigationNodeId)return DRP_ABOVE|DRP_MOVE}return DRP_NONE;case Owa.Components.DraggableObjects.Type.NavigationNode:var sNavigationNodeId=oRootElement.get_NavigationNodeId();if(!oJN.equals(this))return DRP_NONE;var oJNN=this._tr.gtNdById(padF(sNavigationNodeId));if(!oJNN)return DRP_NONE;var oJP=this._tr.gtNdPrnt(oJNN);return oJP.gtNId()==this.gtNId()?DRP_NONE:DRP_MOVE;case Owa.Components.DraggableObjects.Type.Folder:var fCanAdd=g_oNvNdMgr.canAddToFvr(oRootElement.get_FolderId(),oRootElement.get_FolderContainerClass(),oRootElement.get_FolderType(),oRootElement.get_IsInDeletedItems());if(!fCanAdd||!this.equals(oJN)||this._tr.gtGS()!=GS_FVR)return DRP_NONE;return DRP_COPY;default:return DRP_NONE}};Owa.Components.NavigationHeaderTreeNode.prototype.drpIn=function Owa$Components$NavigationHeaderTreeNode$drpIn(oDraggableObject,iDM){var oRootElement=oDraggableObject.get_RootElement();switch(oDraggableObject.get_TypeName()){case Owa.Components.DraggableObjects.Type.NavigationNode:var oJN=this._tr.gtNdById(padF(oRootElement.get_NavigationNodeId()));if(oJN)this._tr.mv(oJN,this,1);return;case Owa.Components.DraggableObjects.Type.NavigationHeader:var oJN=this._tr.gtNdById(padF(oRootElement.get_NavigationNodeId()));if(oJN)this._tr.mv(oJN,this,(iDM&DRP_EFF_MSK)==DRP_ABOVE?0:1);return;case Owa.Components.DraggableObjects.Type.Folder:if(this._tr.gtGS()!=GS_FVR)return;g_oNvNdMgr.addFvr(this._tr,oRootElement.get_FolderId());return;default:return Owa.Components.NavigationHeaderTreeNode.callBase(this,"drpIn",arguments)}};Owa.Components.NavigationHeaderTreeNode.prototype.canDrg=function Owa$Components$NavigationHeaderTreeNode$canDrg(){return 1};Owa.Components.NavigationHeaderTreeNode.prototype.onDrg=function Owa$Components$NavigationHeaderTreeNode$onDrg(oEvent){var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);var oDraggableObject=Owa.Components.Storage.StorableObject.create(Owa.Components.DraggableObjects.Type.NavigationHeader);var oNavigationHeader=oDraggableObject.get_RootElement();oNavigationHeader.set_NavigationNodeId(this.gtNId());oNavigationHeader.set_GroupSection(this._tr.gtGS());oDraggableObject.save(oDragDrop)};Owa.Components.NavigationHeaderTreeNode.prototype.canDrpExp=function Owa$Components$NavigationHeaderTreeNode$canDrpExp(oDraggableObject){return this.hsChld()};Owa.Components.NavigationHeaderTreeNode.prototype.persistExp=function Owa$Components$NavigationHeaderTreeNode$persistExp(f){if(this._tr.gtGS()==GS_FVR){g_oFldrMgr.prstTrExpSt()}else{var oR=new oeReq("NavigationNode","PersistExpand",null,null,POST);oR.add("GS",this._tr.gtGS());oR.add("srcNId",this.gtNId());oR.add("exp",f?1:0);oR.send()}};Owa.Components.NavigationHeaderTreeNode.prototype._onBeforeContextMenu=function Owa$Components$NavigationHeaderTreeNode$_onBeforeContextMenu(){if(this._tr.gtGS()==GS_FVR)return true;var oContextMenu=getNavigationTreeMenu();if(!oContextMenu)return true;var rgShowId={_divNG:true,_divRnmGp:true,_divDelGp:true,_divMvUp:true,_divMvDn:true};var rgAllId=oContextMenu.getAllMenuItemIds();for(var iIndex=0;iIndex<rgAllId.length;iIndex++){var sId=rgAllId[iIndex];oContextMenu.showMenuItem(sId,rgShowId[sId]);if(rgShowId[sId])oContextMenu.enableMenuItem(sId,true)}if(!this._tr.gtNdPrv(this))oContextMenu.enableMenuItem("_divMvUp",false);if(!this._tr.gtNdNxt(this))oContextMenu.enableMenuItem("_divMvDn",false);switch(this._tr.gtGS()){case GS_CAL:oContextMenu.showMenuItems(["_divNCal","_divOUCal"],true);oContextMenu.enableMenuItems(["_divNCal","_divOUCal"],true);if(isExpLgn())oContextMenu.enableMenuItem("_divOUCal",false);break;case GS_CNT:oContextMenu.showMenuItems(["_divNCnt"],true);oContextMenu.enableMenuItems(["_divNCnt"],true);break;case GS_TSK:oContextMenu.showMenuItems(["_divNTsk"],true);oContextMenu.enableMenuItems(["_divNTsk"],true);break}this._tr.set_ContextMenu(oContextMenu)};Owa.Components.NavigationHeaderTreeNode.prototype.onContextMenuClick=function Owa$Components$NavigationHeaderTreeNode$onContextMenuClick(oEventArgs){var oT=this._tr;switch(oEventArgs.sCommand){case"openotherfolder":opnShrDlg();break;case"newgroup":oT.crtNwGp();break;case"new":oT.crtNw(this);break;case"rename":oT.rnmGp(this);break;case"delete":oT.rmv(this,L_WrnRmGp,L_RmGpTtl);break;case"moveup":case"movedown":oT.upDn(this,oEventArgs.sCommand=="moveup");break}}})();g_fModuleLoaded[".\\uicontrols/navigationheadertreenode.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/navigationfoldertreenode.js".toLowerCase()])(function(){Owa.Components.NavigationFolderTreeNode=function Owa$Components$NavigationFolderTreeNode(oN,tr){Owa.Components.NavigationFolderTreeNode.constructBase(this,[oN,tr])};Owa.Components.NavigationFolderTreeNode.createClass("Owa.Components.NavigationFolderTreeNode",Owa.Components.FolderTreeNode);Owa.Components.NavigationFolderTreeNode.prototype.hsChld=function Owa$Components$NavigationFolderTreeNode$hsChld(){return 0};Owa.Components.NavigationFolderTreeNode.prototype.gtImgCk=function Owa$Components$NavigationFolderTreeNode$gtImgCk(){return this._get_Element().getChildById("imgCk")};Owa.Components.NavigationFolderTreeNode.prototype.stCk=function Owa$Components$NavigationFolderTreeNode$stCk(fCk){this._get_Element().setExpando("_fCk",fCk);Owa.Components.CssSprites.updateImage(this.gtImgCk(),fCk?"chk-chkd.gif":"chk-unchk.gif")};Owa.Components.NavigationFolderTreeNode.prototype.isChkd=function Owa$Components$NavigationFolderTreeNode$isChkd(){return this._get_Element().getExpando("_fCk")};Owa.Components.NavigationFolderTreeNode.prototype.hdCnt=function Owa$Components$NavigationFolderTreeNode$hdCnt(){if(this._tr.gtGS()==GS_CAL)this.gtImgCk().set_IsShown(false);this.getContent().set_IsShown(false)};Owa.Components.NavigationFolderTreeNode.prototype.shwCnt=function Owa$Components$NavigationFolderTreeNode$shwCnt(){if(this._tr.gtGS()==GS_CAL)this.gtImgCk().set_IsShown(true);this.getContent().set_IsShown(true)};Owa.Components.NavigationFolderTreeNode.prototype.gtNId=function Owa$Components$NavigationFolderTreeNode$gtNId(){return this.gtId().substr(1)};Owa.Components.NavigationFolderTreeNode.prototype.canDel=function Owa$Components$NavigationFolderTreeNode$canDel(){var sFolderLocation=g_oFldrMgr.gtFL(this.gtFId());if(sFolderLocation==FL_OUM||sFolderLocation==FL_GS)return 0;return Owa.Components.NavigationFolderTreeNode.callBase(this,"canDel",arguments)};Owa.Components.NavigationFolderTreeNode.prototype.canRnm=function Owa$Components$NavigationFolderTreeNode$canRnm(){if(this._get_Element().getAttribute("_fltr"))return 1;return Owa.Components.NavigationFolderTreeNode.callBase(this,"canRnm",arguments)};Owa.Components.NavigationFolderTreeNode.prototype.canMv=function Owa$Components$NavigationFolderTreeNode$canMv(){var sFolderLocation=g_oFldrMgr.gtFL(this.gtFId());if(sFolderLocation==FL_OUM||sFolderLocation==FL_GS)return 0;return Owa.Components.NavigationFolderTreeNode.callBase(this,"canMv",arguments)};Owa.Components.NavigationFolderTreeNode.prototype.canCp=function Owa$Components$NavigationFolderTreeNode$canCp(){if(this.isS(DFT_TDS)||g_oFldrMgr.gtFL(this.gtFId())==FL_GS)return 0;return Owa.Components.NavigationFolderTreeNode.callBase(this,"canCp",arguments)};Owa.Components.NavigationFolderTreeNode.prototype.gtFId=function Owa$Components$NavigationFolderTreeNode$gtFId(){return this._get_Element().getAttribute("_fid")};Owa.Components.NavigationFolderTreeNode.prototype.setDisplayColor=function Owa$Components$NavigationFolderTreeNode$setDisplayColor(iClr){if(this._tr.gtGS()!=GS_CAL)return;this.setHighlightEffect("nbcal"+iClr)};Owa.Components.NavigationFolderTreeNode.prototype.saveColor=function Owa$Components$NavigationFolderTreeNode$saveColor(iClr){if(this._tr.gtGS()!=GS_CAL)return;this._get_Element().setIntAttribute("_iSavedColor",iClr);var oR=new oeReq("CalendarView","SetCalendarColor",0,cbSetColor);oR.add("fId",this.gtFId());oR.add("Idx",iClr);oR.send()};Owa.Components.NavigationFolderTreeNode.prototype.getSavedColor=function Owa$Components$NavigationFolderTreeNode$getSavedColor(){if(this._tr.gtGS()==GS_CAL){var iClr=this._get_Element().getIntAttribute("_iSavedColor");if(iClr>0)return iClr}return -1};Owa.Components.NavigationFolderTreeNode.prototype.stHl=function Owa$Components$NavigationFolderTreeNode$stHl(fHl){if(this._tr.gtGS()==GS_CAL)return;Owa.Components.NavigationFolderTreeNode.callBase(this,"stHl",arguments)};Owa.Components.NavigationFolderTreeNode.prototype.canDrg=function Owa$Components$NavigationFolderTreeNode$canDrg(){return 1};Owa.Components.NavigationFolderTreeNode.prototype.onDrg=function Owa$Components$NavigationFolderTreeNode$onDrg(oEvent){var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);var oDraggableObject=Owa.Components.Storage.StorableObject.create(Owa.Components.DraggableObjects.Type.NavigationNode);var oNavigationNode=oDraggableObject.get_RootElement();oNavigationNode.set_NavigationNodeId(this.gtNId());oNavigationNode.set_GroupSection(this._tr.gtGS());oNavigationNode.set_FolderId(this.gtFId());oDraggableObject.save(oDragDrop)};Owa.Components.NavigationFolderTreeNode.prototype.gtDrpMd=function Owa$Components$NavigationFolderTreeNode$gtDrpMd(oJN,oEvent,oDraggableObject){var iDrpEff;var oRootElement=oDraggableObject.get_RootElement();switch(oDraggableObject.get_TypeName()){case Owa.Components.DraggableObjects.Type.Items:case Owa.Components.DraggableObjects.Type.Conversations:return Owa.Components.NavigationFolderTreeNode.callBase(this,"gtDrpMd",arguments);case Owa.Components.DraggableObjects.Type.Folder:if(!g_oNvNdMgr.canAddToFvr(oRootElement.get_FolderId(),oRootElement.get_FolderContainerClass(),oRootElement.get_FolderType(),oRootElement.get_IsInDeletedItems())||this._tr.gtGS()!=GS_FVR)return DRP_NONE;iDrpEff=DRP_COPY;break;case Owa.Components.DraggableObjects.Type.NavigationNode:if(oRootElement.get_NavigationNodeId()==this.gtNId())return DRP_NONE;if(oRootElement.get_GroupSection()!=this._tr.gtGS())return DRP_NONE;iDrpEff=DRP_MOVE;break;default:return DRP_NONE}var iClientY=oEvent.get_ClientY();var iNodeMiddleY=this.getContainer().get_DocumentTop()+this.getContainer().get_OffsetHeight()/2;if(iClientY>iNodeMiddleY){var oJN=this._tr.gtNdNxt(this);if(!oJN||oJN.gtFId()!=oRootElement.get_FolderId())return DRP_BELOW|iDrpEff}else{var oJP=this._tr.gtNdPrv(this);if(!oJP||oJP.gtFId()!=oRootElement.get_FolderId())return DRP_ABOVE|iDrpEff}return DRP_NONE};Owa.Components.NavigationFolderTreeNode.prototype.drpIn=function Owa$Components$NavigationFolderTreeNode$drpIn(oDraggableObject,iDM){var oRootElement=oDraggableObject.get_RootElement();switch(oDraggableObject.get_TypeName()){case Owa.Components.DraggableObjects.Type.NavigationNode:var oJN=this._tr.gtNdById(padF(oRootElement.get_NavigationNodeId()));if(oJN)this._tr.mv(oJN,this,(iDM&DRP_EFF_MSK)==DRP_ABOVE?0:1);return;default:return Owa.Components.NavigationFolderTreeNode.callBase(this,"drpIn",arguments)}};Owa.Components.NavigationFolderTreeNode.prototype.canDrpExp=function Owa$Components$NavigationFolderTreeNode$canDrpExp(oDraggableObject){return false};Owa.Components.NavigationFolderTreeNode.prototype._onBeforeContextMenu=function Owa$Components$NavigationFolderTreeNode$_onBeforeContextMenu(){var oContextMenu=getNavigationTreeMenu();if(!oContextMenu)return true;var groupSection=this._tr.gtGS();var rgShowId={_divO:true,_divON:true,_divDel:true,_divRnm:true,_divMvUp:true,_divMvDn:true,_divRFV:groupSection!=GS_CAL,_divDonotShowCal:groupSection==GS_CAL};var rgAllId=oContextMenu.getAllMenuItemIds();for(var iIndex=0;iIndex<rgAllId.length;iIndex++){var sId=rgAllId[iIndex];oContextMenu.showMenuItem(sId,rgShowId[sId]);if(rgShowId[sId])oContextMenu.enableMenuItem(sId,true)}var fIsMyFolder=g_oFldrMgr.isMyFId(this.gtFId());if(fIsMyFolder){if(!this.isXOrg()){oContextMenu.showMenuItem("_divRFV",false);oContextMenu.showMenuItem("_divDonotShowCal",false)}}else{oContextMenu.enableMenuItem("_divDel",false)}if(groupSection==GS_CAL){oContextMenu.showMenuItem("_divShCal",true);oContextMenu.showMenuItem("_divChShPm",true);var fNotSharedInCalendar=fIsMyFolder&&!this.isXOrg();oContextMenu.enableMenuItem("_divShCal",fNotSharedInCalendar);oContextMenu.enableMenuItem("_divChShPm",fNotSharedInCalendar)}var sModuleName;switch(groupSection){case GS_CAL:oContextMenu.showMenuItem("_divPCC",true);sModuleName="Cal";break;case GS_CNT:sModuleName="Cnt";break;case GS_TSK:sModuleName="Tsk";break}if(!this._tr.gtNdPrv(this))oContextMenu.enableMenuItem("_divMvUp",false);if(!this._tr.gtNdNxt(this))oContextMenu.enableMenuItem("_divMvDn",false);oContextMenu.showMenuItem("_divN"+sModuleName,true);oContextMenu.enableMenuItem("_divN"+sModuleName,true);oContextMenu.showMenuItem("_divM"+sModuleName,true);oContextMenu.showMenuItem("_divC"+sModuleName,true);oContextMenu.showMenuItem("_divRnm",true);oContextMenu.showMenuItem("_divDel",true);if(this.canMv())oContextMenu.enableMenuItem("_divM"+sModuleName,true);else oContextMenu.enableMenuItem("_divM"+sModuleName,false);if(this.canCp())oContextMenu.enableMenuItem("_divC"+sModuleName,true);else oContextMenu.enableMenuItem("_divC"+sModuleName,false);if(this.canRnm())oContextMenu.enableMenuItem("_divRnm",true);else oContextMenu.enableMenuItem("_divRnm",false);if(this.canDel())oContextMenu.enableMenuItem("_divDel",true);else oContextMenu.enableMenuItem("_divDel",false);this._tr.set_ContextMenu(oContextMenu)};Owa.Components.NavigationFolderTreeNode.prototype.onContextMenuClick=function Owa$Components$NavigationFolderTreeNode$onContextMenuClick(oEventArgs){var oT=this._tr;switch(oEventArgs.sCommand){case"new":oT.crtNw(this._tr.gtNdPrnt(this));break;case"rename":oT.rnm(this);break;case"delete":if(oT.gtGS()==GS_FVR)return Owa.Components.NavigationFolderTreeNode.callBase(this,"onContextMenuClick",arguments);oT.rmv(this,L_WrnDlFl,L_WrnDlFlTtl);break;case"moveup":case"movedown":oT.upDn(this,oEventArgs.sCommand=="moveup");break;case"removefromview":case"donotshowthiscalendar":if(this.isXOrg()&&oT.gtGS()==GS_CAL)g_oFldrMgr.delFld(oT,this.gtFId(),0,1);else g_oNvNdMgr.rmv(oT,this.gtNId(),oT.gtGS());break;case"pickColor":var iValue=parseInt(oEventArgs.oMenuItem.sColorValue);if(this.getSavedColor()!=iValue){if(this.isChkd()){this.setDisplayColor(iValue);var oJD=g_oCalTr.gtNdByAls(AL_DEF);if(oJD.equals(this)&&iValue<0){this.setHighlightEffect(DEFAULT_CALENDAR_CLASS)}}this.saveColor(iValue);var sFId=this.gtFId();updateColorInCalendarView(iValue,null,sFId)}return true;case"sharecal":newItm("IPM.Sharing",null,"&fldId="+Owa.Encoder.urlEncode(this.gtFId()),null,null,this._tr.get_SubPage());break;case"changesharingpremissions":openEcpChangeCalendarSharingPermissionWin(this.gtFId());break;default:return Owa.Components.NavigationFolderTreeNode.callBase(this,"onContextMenuClick",arguments)}}})();g_fModuleLoaded[".\\uicontrols/navigationfoldertreenode.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/navigationtree.js".toLowerCase()])(function(){Owa.UIControls.NavigationTree=function Owa$UIControls$NavigationTree(root,fD){this._fD=fD;Owa.UIControls.NavigationTree.constructBase(this,[root])};Owa.UIControls.NavigationTree.createClass("Owa.UIControls.NavigationTree",Owa.UIControls.TreeControl);Owa.UIControls.NavigationTree.prototype.initialize=function Owa$UIControls$NavigationTree$initialize(){this._iGS=this.root.getAttribute("_iGS");var oJS=this.crtNFDict();if(oJS)this._sSelNdId=oJS.gtId();if(this._fD){this._onDrp=null;this._onDO=null;this._onDL=null;this._onDS=null;this._onContextMenuEventHandler=null}g_oEd.attachEvent("RemoveNavigation",this,"cbRmvNvNd");g_oEd.attachEvent("NewFolder",this,"cbOnFldrOeh");g_oEd.attachEvent("MoveFolder",this,"cbOnFldrOeh");g_oEd.attachEvent("CopyFolder",this,"cbOnFldrOeh");g_oEd.attachEvent("ReloadNavigationTree",this,"cbOnFldrOeh");if(this.gtGS()!=GS_FVR){g_oEd.attachEvent("DeleteFolder",this,"cbOnFldrOeh");g_oEd.attachEvent("NewNavigation",this,"cbOnNwNv");g_oEd.attachEvent("RenameNavigation",this,"cbOnRnmNv")}g_oEd.attachEvent("EmptyFolder",this,"cbOnFldrOeh");Owa.UIControls.NavigationTree.callBase(this,"initialize")};Owa.UIControls.NavigationTree.prototype.dispose=function Owa$UIControls$NavigationTree$dispose(){g_oEd.detachEvent("RemoveNavigation",this,"cbRmvNvNd");g_oEd.detachEvent("NewFolder",this,"cbOnFldrOeh");g_oEd.detachEvent("MoveFolder",this,"cbOnFldrOeh");g_oEd.detachEvent("CopyFolder",this,"cbOnFldrOeh");g_oEd.detachEvent("DeleteFolder",this,"cbOnFldrOeh");g_oEd.detachEvent("EmptyFolder",this,"cbOnFldrOeh");g_oEd.detachEvent("NewNavigation",this,"cbOnNwNv");g_oEd.detachEvent("RenameNavigation",this,"cbOnRnmNv");Owa.UIControls.NavigationTree.callBase(this,"dispose")};Owa.UIControls.NavigationTree.prototype.gtNdByFId=function Owa$UIControls$NavigationTree$gtNdByFId(sFId){var oD=this._NFDict[padF(sFId)];if(oD)return this.gtNdById(oD.id)};Owa.UIControls.NavigationTree.prototype.stDfNd=function Owa$UIControls$NavigationTree$stDfNd(){var oJN;switch(this.gtGS()){case GS_CAL:oJN=this.gtNdByAls(ALP_DFT+DFT_CAL);break;case GS_CNT:oJN=this.gtNdByAls(ALP_DFT+DFT_CNT);break;case GS_TSK:oJN=this.gtNdByAls(ALP_DFT+DFT_TDS);break}if(oJN)this.stAls(AL_DEF,oJN.gtId())};Owa.UIControls.NavigationTree.prototype.gtGS=function Owa$UIControls$NavigationTree$gtGS(){return this._iGS};Owa.UIControls.NavigationTree.prototype.wrapNd=function Owa$UIControls$NavigationTree$wrapNd(oN){switch(oN.getAttribute("_t")){case TN_FTN:return new Owa.Components.NavigationFolderTreeNode(oN,this);case TN_GH:return new Owa.Components.NavigationHeaderTreeNode(oN,this);default:return Owa.UIControls.NavigationTree.callBase(this,"wrapNd",arguments)}};Owa.UIControls.NavigationTree.prototype.gtRgFId=function Owa$UIControls$NavigationTree$gtRgFId(){return this._rgFId};Owa.UIControls.NavigationTree.prototype.gtSelFId=function Owa$UIControls$NavigationTree$gtSelFId(){return this._sSelFId};Owa.UIControls.NavigationTree.prototype.forEachNd=function Owa$UIControls$NavigationTree$forEachNd(fnProcNd){var oJR=this.gtNdRt();var oJH=this.gtNdFrstChld(oJR);while(oJH){var oJF=this.gtNdFrstChld(oJH);while(oJF){fnProcNd.call(this,oJH,oJF);oJF=this.gtNdNxt(oJF)}oJH=this.gtNdNxt(oJH)}};Owa.UIControls.NavigationTree.prototype.crtNFDict=function Owa$UIControls$NavigationTree$crtNFDict(){if(!this._NFDict)this._NFDict={};this._rgFId=[];this._sSelFId=0;g_oNvNdMgr.stNFDict(this.gtGS(),this._NFDict);var oJS;this.clrAls();this.forEachNd(function(oJH,oJF){if(this.gtGS()==GS_FVR)oJF.feUpdCnts();if(oJF.isSel()){oJS=oJF;this._sSelFId=oJF.gtFId()}if(oJF.isS())this.stAls(ALP_DFT+oJF.gtFT(),oJF.gtId());if(this._NFDict[padF(oJF.gtFId())]){var oRec=this.crtNFRec(oJF,oJH);oRec._next=this._NFDict[padF(oJF.gtFId())];this._NFDict[padF(oJF.gtFId())]=oRec}else{this._NFDict[padF(oJF.gtFId())]=this.crtNFRec(oJF,oJH)}this._rgFId.push(oJF.gtFId())});this.stDfNd();return oJS};Owa.UIControls.NavigationTree.prototype.crtNFRec=function Owa$UIControls$NavigationTree$crtNFRec(oJF,oJH){return{id:oJF.gtId(),nid:oJF.gtNId(),pid:oJH.gtId(),pnid:oJH.gtNId()}};Owa.UIControls.NavigationTree.prototype.onKD=function Owa$UIControls$NavigationTree$onKD(oEvent){switch(oEvent.get_KeyCodeForKeyUpDown()){case 46:var oJSel=this.gtSelNd();if(oJSel&&oJSel.canDel())this.rmv(oJSel,L_WrnDlFl,L_WrnDlFlTtl)}};Owa.UIControls.NavigationTree.prototype.rldFrmR=function Owa$UIControls$NavigationTree$rldFrmR(oR){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);var oN=oC.getDescendantById("ntn");if(oN){var oTr=oN.getDescendantById(this.root.get_ParentElement().get_Id());if(oTr)this.rld(oTr)}};Owa.UIControls.NavigationTree.prototype.cbRmvNvNd=function Owa$UIControls$NavigationTree$cbRmvNvNd(oR,oSndr,sNId,sGS){var oJN=this.gtNdById(padF(sNId));if((oJN) instanceof(Owa.Components.NavigationFolderTreeNode)&&g_oFldrMgr.gtFL(oJN.gtFId())==FL_OUM)removeFolderView(oJN.gtFId());this.cbOnFldrOeh(oR,oSndr)};Owa.UIControls.NavigationTree.prototype.cbOnFldrOeh=function Owa$UIControls$NavigationTree$cbOnFldrOeh(oR,oSndr){this.rldFrmR(oR);if(oSndr==this)this.cbOeh(oR)};Owa.UIControls.NavigationTree.prototype.rld=function Owa$UIControls$NavigationTree$rld(oRN){var rgColSt={};var oJR=this.gtNdRt();var oJH=this.gtNdFrstChld(oJR);var oJOS=this.gtSelNd();var oJSO;var oJST=oJOS;var fSel=this.hsSelNd();var sSTId=fSel?oJST.gtId():"";while(oJH){rgColSt[oJH.gtId()]=oJH.hsChld()?!oJH.isExp():0;oJH=this.gtNdNxt(oJH)}var oNwRtNd=oRN.get_FirstChild().get_FirstChild();if(fSel){while(sSTId&&!oNwRtNd.getDescendantById(sSTId)){oJSO=oJST;oJST=this.gtNrstNd(oJST);sSTId=oJST?oJST.gtId():null;this.rmNd(oJSO)}if(!sSTId||!oNwRtNd.getDescendantById(sSTId))sSTId=null}var rootNode=this.root.get_FirstChild();if(rootNode){rootNode.insertAdjacentElement(Owa.ElementInsertionPoint.BeforeBegin,oRN.get_FirstChild().get_FirstChild());rootNode.remove(true)}else{this.root.appendChild(oNwRtNd)}for(var i in rgColSt){oJH=this.gtNdById(i);if(oJH){if(rgColSt[i])oJH.collapse();else oJH.expand()}}this._NFDict=null;var oJS=this.crtNFDict();var oJD=this.gtNdByAls(AL_DEF);oJST=this.gtNdById(sSTId);if(this._fcs){if(oJS)this.stNdSel(oJS,1);else{oJS=this.gtSelNd();if(oJS)this.stNdSel(oJS,1);else if(oJST)this.stNdSel(oJST,1);else if(oJD)this.stNdSel(oJD,1);else if(this._frst)this._frst.selDfN();if(!this.gtSelNd())this.stNdSel()}}this._notifyShareCalendarMenu();this.feOnAfRld();this.fireOnResize()};Owa.UIControls.NavigationTree.prototype.feOnAfRld=function Owa$UIControls$NavigationTree$feOnAfRld(){if(this.onAfRld)return this.onAfRld()};Owa.UIControls.NavigationTree.prototype.feOnOpnCal=function Owa$UIControls$NavigationTree$feOnOpnCal(sFId){if(this.onOpnCal)this.onOpnCal(sFId)};Owa.UIControls.NavigationTree.prototype.rmv=function Owa$UIControls$NavigationTree$rmv(oJN,sMsg,sTtl){this._fDontSyncSelection=1;var oD=new BtnDlg("divDlt",htmlEnc(sMsg),sTtl,[L_Yes,L_No],null,Owa.BUTTON_DIALOG_ICON.QUESTION,this._createCallback(this.cbRmv,oJN));oD.show()};Owa.UIControls.NavigationTree.prototype.cbRmv=function Owa$UIControls$NavigationTree$cbRmv(i,oJN){if(i==0)g_oNvNdMgr.rmv(this,oJN.gtNId(),this.gtGS());this.syncSelNHl()};Owa.UIControls.NavigationTree.prototype.upDn=function Owa$UIControls$NavigationTree$upDn(oJN,iD){var oJT=iD?this.gtNdPrv(oJN):this.gtNdNxt(oJN);this.mv(oJN,oJT,!iD)};Owa.UIControls.NavigationTree.prototype.mv=function Owa$UIControls$NavigationTree$mv(oJN,oJT,fIsAft){var oR=new oeReq("NavigationNode","Move",null,this._createCallback(this.cbMv),POST);oR.add("srcNId",oJN.gtNId());oR.add("tgtid",oJT.gtNId());if(oJN.constructor==oJT.constructor)oR.add("mt",fIsAft?2:1);oR.add("GS",this.gtGS());oR.send()};Owa.UIControls.NavigationTree.prototype.cbMv=function Owa$UIControls$NavigationTree$cbMv(oR){this.rldFrmR(oR);this.cbOeh(oR)};Owa.UIControls.NavigationTree.prototype.crtNw=function Owa$UIControls$NavigationTree$crtNw(oJN){this.crtNwNd(oJN,{isGp:0})};Owa.UIControls.NavigationTree.prototype.crtNwGp=function Owa$UIControls$NavigationTree$crtNwGp(oJN){var oJPos;if(oJN)oJPos=this.gtNdNxt(oJN);this.crtNwNd(this.gtNdRt(),{isGp:1,posId:oJPos?oJPos.gtId():null},1,oJPos)};Owa.UIControls.NavigationTree.prototype.gtNwNdIcnMrkup=function Owa$UIControls$NavigationTree$gtNwNdIcnMrkup(oPN,oCtx){if(!oCtx.isGp){switch(this.gtGS()){case GS_CAL:return Owa.Components.CssSprites.getImageMarkup(g_rgsFIcns[T_CAL],"id=\""+NODE_ICON+"\"");case GS_CNT:return Owa.Components.CssSprites.getImageMarkup(g_rgsFIcns[T_CON],"id=\""+NODE_ICON+"\"");case GS_TSK:return Owa.Components.CssSprites.getImageMarkup(g_rgsFIcns[T_TSK],"id=\""+NODE_ICON+"\"")}}};Owa.UIControls.NavigationTree.prototype.onNwNd=function Owa$UIControls$NavigationTree$onNwNd(rsn,sV){if(rsn!=ECR_ESC){if(this._edt.oCtx.isGp)g_oNvNdMgr.nw(this,this.gtGS(),null,sV,{posId:this._edt.oCtx.posId});else{var oJPN=this.gtNdPrnt(this._edt.nd);g_oNvNdMgr.nw(this,this.gtGS(),oJPN.gtNId(),sV)}}else{this.qtEdtNd()}};Owa.UIControls.NavigationTree.prototype.cbOnNwNv=function Owa$UIControls$NavigationTree$cbOnNwNv(oR,oSndr,sGS,sPNId){if(oSndr!=this)return;if(!this.cbOeh(oR,true))return;if(oR.isErr())return;var oJPN=sPNId?this.gtNdById(padF(sPNId)):this.gtNdRt();var oJPos=oR.oCtx?this.gtNdById(oR.oCtx.posId):null;if(oJPN){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oC=oC.getDescendantById("ntn");if(oJPos)this.insrtKdsPos(oJPos,oC.getChildrenSnapshot());else this.addKds(oJPN,oC.getChildrenSnapshot());oJPN.expand()}this._notifyShareCalendarMenu();this.crtNFDict()};Owa.UIControls.NavigationTree.prototype.rnm=function Owa$UIControls$NavigationTree$rnm(oJN){this.edtNd(oJN,{isGp:0})};Owa.UIControls.NavigationTree.prototype.rnmGp=function Owa$UIControls$NavigationTree$rnmGp(oJN){this.edtNd(oJN,{isGp:1})};Owa.UIControls.NavigationTree.prototype.onRnNd=function Owa$UIControls$NavigationTree$onRnNd(rsn,sV){var oJN=this._edt.nd;if(rsn!=ECR_ESC){if(this._edt.oCtx.isGp)g_oNvNdMgr.rnm(this,this.gtGS(),oJN.gtNId(),sV);else{var sFId=oJN.gtFId();if(this.gtGS()==GS_FVR&&(g_oFldrMgr.isMyFId(sFId)||g_oFldrMgr.gtFL(sFId)==FL_AMB))g_oFldrMgr.rnmFld(this,sFId,sV);else g_oNvNdMgr.rnm(this,this.gtGS(),oJN.gtNId(),sV)}}else this.qtEdtNd()};Owa.UIControls.NavigationTree.prototype.cbOnRnmNv=function Owa$UIControls$NavigationTree$cbOnRnmNv(oR,oSndr,sGS,sNId){if(oSndr!=this)return;if(!this.cbOeh(oR,true))return;if(oR.isErr())return;var oJN=this.gtNdById(padF(sNId));if(oJN){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oJN.stDspNm(oC.getDescendantById("ntn").get_TextContent());if(Owa.Components.FolderTreeNode.isInstance(oJN)){oJN.stFldNm(oC.getDescendantById("tn").get_TextContent())}}};Owa.UIControls.NavigationTree.prototype._notifyShareCalendarMenu=function Owa$UIControls$NavigationTree$_notifyShareCalendarMenu(){if(this.gtGS()==GS_CAL){updateCalendarFolders()}}})();g_fModuleLoaded[".\\uicontrols/navigationtree.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/favoritefoldertreenode.js".toLowerCase()])(function(){Owa.Components.FavoriteFolderTreeNode=function Owa$Components$FavoriteFolderTreeNode(oN,tr){Owa.Components.FavoriteFolderTreeNode.constructBase(this,[oN,tr])};Owa.Components.FavoriteFolderTreeNode.createClass("Owa.Components.FavoriteFolderTreeNode",Owa.Components.NavigationFolderTreeNode);Owa.Components.FavoriteFolderTreeNode.prototype._onBeforeContextMenu=function Owa$Components$FavoriteFolderTreeNode$_onBeforeContextMenu(){var oContextMenu=getFolderTreeMenu();this._prepareFolderMenu(oContextMenu);var rgShowId=["divRmFvr","divMvUp","divMvDn"];oContextMenu.showMenuItems(rgShowId,true);oContextMenu.enableMenuItems(rgShowId,true);oContextMenu.showMenuItem("divCF",false);if(!this._tr.gtNdNxt(this))oContextMenu.enableMenuItem("divMvDn",false);if(!this._tr.gtNdPrv(this))oContextMenu.enableMenuItem("divMvUp",false);this._tr.set_ContextMenu(oContextMenu)};Owa.Components.FavoriteFolderTreeNode.prototype.onContextMenuClick=function Owa$Components$FavoriteFolderTreeNode$onContextMenuClick(oEventArgs){var oT=this._tr;switch(oEventArgs.sCommand){case"removefromfavorite":g_oNvNdMgr.rmv(oT,this.gtNId(),oT.gtGS());break;case"moveup":case"movedown":oT.upDn(this,oEventArgs.sCommand=="moveup");break;default:return Owa.Components.FavoriteFolderTreeNode.callBase(this,"onContextMenuClick",arguments)}};Owa.Components.FavoriteFolderTreeNode.prototype.drpIn=function Owa$Components$FavoriteFolderTreeNode$drpIn(oDraggableObject,iDM){var oRootElement=oDraggableObject.get_RootElement();switch(oDraggableObject.get_TypeName()){case Owa.Components.DraggableObjects.Type.Folder:if(g_oNvNdMgr.isInFvr(oRootElement.get_FolderId()))return;g_oNvNdMgr.addFvr(this._tr,oRootElement.get_FolderId(),this.gtNId(),(iDM&DRP_EFF_MSK)==DRP_ABOVE?0:1);return;default:Owa.Components.FavoriteFolderTreeNode.callBase(this,"drpIn",arguments)}};Owa.Components.FavoriteFolderTreeNode.prototype.delFld=function Owa$Components$FavoriteFolderTreeNode$delFld(fP,fD){if(!fP){this._tr._fDontSyncSelection=1;var sMsg=L_WrnDlFlInFvr+"<div style=\"overflow-y:hidden; height: 4px\"></div>&nbsp;&nbsp;<input type=radio id=dlFldrInFavRd0 name=cmfDltInFvr checked>&nbsp;<label for=dlFldrInFavRd0>"+L_RdDlt+"</label><br>&nbsp;&nbsp;<input type=radio id=dlFldrInFavRd1 name=cmfDltInFvr>&nbsp;<label for=dlFldrInFavRd1>"+L_RdRmvFrmFvr+"</label>";var oD=new BtnDlg("divDlt",sMsg,L_WrnDlFlTtl,[L_OK,L_Cncl],null,Owa.BUTTON_DIALOG_ICON.QUESTION,this._createCallback(this.cbOnDelFldNP));oD.show();return}else{Owa.Components.FavoriteFolderTreeNode.callBase(this,"delFld",arguments)}};Owa.Components.FavoriteFolderTreeNode.prototype.cbOnDelFldNP=function Owa$Components$FavoriteFolderTreeNode$cbOnDelFldNP(i){if(i==0){if(chkd(wtda("dlFldrInFavRd0")))Owa.Components.FavoriteFolderTreeNode.callBase(this,"cbOnDelFld",[0,0,0]);else g_oNvNdMgr.rmv(this._tr,this.gtNId(),this._tr.gtGS())}this._tr.syncSelNHl()}})();g_fModuleLoaded[".\\uicontrols/favoritefoldertreenode.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/favoritetree.js".toLowerCase()])(function(){Owa.UIControls.FavoriteTree=function Owa$UIControls$FavoriteTree(root){Owa.UIControls.FavoriteTree.constructBase(this,[root])};Owa.UIControls.FavoriteTree.createClass("Owa.UIControls.FavoriteTree",Owa.UIControls.NavigationTree);Owa.UIControls.FavoriteTree.prototype.initialize=function Owa$UIControls$FavoriteTree$initialize(){Owa.UIControls.FavoriteTree.callBase(this,"initialize");g_oEd.attachEvent("UpdateCount",this,"cbOnUpdCnt");g_oEd.attachEvent("AddToFavorites",this,"cbAddToFvr");g_oEd.attachEvent("AddFilterToFavorites",this,"cbOnFldrOeh");g_oEd.attachEvent("DeleteFolder",this,"cbOnFldrOeh");g_oEd.attachEvent("RenameFolder",this,"cbOnRnFld");g_oEd.attachEvent("RenameNavigation",this,"cbOnRnFltr")};Owa.UIControls.FavoriteTree.prototype.dispose=function Owa$UIControls$FavoriteTree$dispose(){g_oEd.detachEvent("UpdateCount",this,"cbOnUpdCnt");g_oEd.detachEvent("AddToFavorites",this,"cbAddToFvr");g_oEd.detachEvent("DeleteFolder",this,"cbOnFldrOeh");g_oEd.detachEvent("RenameFolder",this,"cbOnRnFld");g_oEd.detachEvent("RenameNavigation",this,"cbOnRnFltr");Owa.UIControls.FavoriteTree.callBase(this,"dispose")};Owa.UIControls.FavoriteTree.prototype.wrapNd=function Owa$UIControls$FavoriteTree$wrapNd(oN){switch(oN.getAttribute("_t")){case TN_FTN:return new Owa.Components.FavoriteFolderTreeNode(oN,this);default:return Owa.UIControls.FavoriteTree.callBase(this,"wrapNd",arguments)}};Owa.UIControls.FavoriteTree.prototype.onKD=function Owa$UIControls$FavoriteTree$onKD(oEvent){switch(oEvent.get_KeyCodeForKeyUpDown()){case 46:var oJSel=this.gtSelNd();if(oJSel&&oJSel.canDel())oJSel.delFld(oEvent.isShiftKeyDown(),0)}};Owa.UIControls.FavoriteTree.prototype.onRnNd=function Owa$UIControls$FavoriteTree$onRnNd(rsn,sV){var oJN=this._edt.nd;if(rsn!=ECR_ESC&&oJN._get_Element().getAttribute("_fltr")){g_oNvNdMgr.rnm(this,this.gtGS(),oJN.gtNId(),sV);return}Owa.UIControls.FavoriteTree.callBase(this,"onRnNd",[rsn,sV])};Owa.UIControls.FavoriteTree.prototype.cbOnRnFltr=function Owa$UIControls$FavoriteTree$cbOnRnFltr(oR,oSndr,sGS,sNId){var fSndBM=oSndr==this;if(fSndBM&&!this.cbOeh(oR,true))return;if(oR.isErr())return;var oJN=this.gtNdById(padF(sNId));if(oJN){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oJN.stDspNm(oC.getDescendantById("ntn").get_TextContent())}};Owa.UIControls.FavoriteTree.prototype.cbOnRnFld=function Owa$UIControls$FavoriteTree$cbOnRnFld(oR,oSndr,sFId){var fSndBM=oSndr==this;if(fSndBM&&!this.cbOeh(oR,true))return;if(oR.isErr())return;var oJN=this.gtNdByFId(sFId);if(oJN){var oC=this.root.get_OwnerDocument().createElement(DIV);oC.set_InnerHtml(oR.sBody);oJN.stDspNm(oC.getDescendantById("ntn").get_TextContent());if(Owa.Components.FolderTreeNode.isInstance(oJN)){oJN.stFldNm(oC.getDescendantById("tn").get_TextContent())}}};Owa.UIControls.FavoriteTree.prototype.cbOnUpdCnt=function Owa$UIControls$FavoriteTree$cbOnUpdCnt(sFId,iTC,iUC){var oJN=this.gtNdByFId(sFId);if(!oJN)return;oJN.updCnts(iTC,iUC)};Owa.UIControls.FavoriteTree.prototype.gtSelELCNdFId=function Owa$UIControls$FavoriteTree$gtSelELCNdFId(){var oJN=this.gtSelNd();return oJN?oJN._get_Element().getAttribute("_sPlcyFId"):0};Owa.UIControls.FavoriteTree.prototype.cbAddToFvr=function Owa$UIControls$FavoriteTree$cbAddToFvr(oR,oSndr,sFId,sNId,fIsAft){this.rldFrmR(oR);this.cbOeh(oR)}})();g_fModuleLoaded[".\\uicontrols/favoritetree.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/buddylisttreenode.js".toLowerCase()])(function(){Owa.Components.BuddyListTreeNode=function Owa$Components$BuddyListTreeNode(oN,tr){Owa.Components.BuddyListTreeNode.constructBase(this,[oN,tr])};Owa.Components.BuddyListTreeNode.createClass("Owa.Components.BuddyListTreeNode",Owa.Components.TreeNode);Owa.Components.BuddyListTreeNode.prototype.persistExp=function Owa$Components$BuddyListTreeNode$persistExp(f){if(this.isRt())g_oFldrMgr.prstTrExpSt();else{var oBuddyList=gtIMMgr().bdyLst;var rgGrpIdsInBdyLst=oBuddyList.GetGroups();var rgGrpIds=[];var oNode;for(var sGroupId in rgGrpIdsInBdyLst){oNode=g_oBddyLst.gtNdById(sGroupId);if(oNode&&oNode.isExp()){rgGrpIds.push(sGroupId)}}var oRCtx=new Object();oRCtx.rgGrpIds=rgGrpIds;sndIMReq(IM_PSTEXP,null,0,oRCtx)}};Owa.Components.BuddyListTreeNode.prototype.canDrg=function Owa$Components$BuddyListTreeNode$canDrg(){if(this._get_Element().getAttribute("sUri")){return true}else{return false}};Owa.Components.BuddyListTreeNode.prototype.canDrpExp=function Owa$Components$BuddyListTreeNode$canDrpExp(oDraggableObject){return false};Owa.Components.BuddyListTreeNode.prototype.onDrg=function Owa$Components$BuddyListTreeNode$onDrg(oEvent){var oDragDrop=new Owa.Components.Storage.DragDrop(oEvent);var oDraggableObject=Owa.Components.Storage.StorableObject.create(Owa.Components.DraggableObjects.Type.Buddy);var oBuddy=oDraggableObject.get_RootElement();oBuddy.set_GroupId(this._get_Element().getAttribute("sGroupId"));oBuddy.set_BuddyId(this._get_Element().getAttribute("sUri"));oDraggableObject.save(oDragDrop)};Owa.Components.BuddyListTreeNode.prototype.gtDrpMd=function Owa$Components$BuddyListTreeNode$gtDrpMd(oJN,oEvent,oDraggableObject){var sType=oDraggableObject.get_TypeName();if(sType!=Owa.Components.DraggableObjects.Type.Buddy){return DRP_NONE}var oBuddyList=gtIMMgr().bdyLst;var oGroup=oBuddyList.GetGroup(this.get_Id());if(oGroup&&!oGroup.IsOtherContactsGroup()){var oRootElement=oDraggableObject.get_RootElement();if(oGroup.IsMember(oRootElement.get_BuddyId()))return DRP_NONE;if(oEvent.isCtrlKeyDown()&&!oGroup.IsOtherContactsGroup()){return DRP_COPY}else{return DRP_MOVE}}return DRP_NONE};Owa.Components.BuddyListTreeNode.prototype.drpIn=function Owa$Components$BuddyListTreeNode$drpIn(oDraggableObject,iDM){var sNewGroupId=this.get_Id();var oRootElement=oDraggableObject.get_RootElement();var sBuddyId=oRootElement.get_BuddyId();var sOldGroupId=oRootElement.get_GroupId();switch(iDM){case DRP_COPY:copyToGroupRequest(sBuddyId,sNewGroupId);break;case DRP_MOVE:if(isOCSPrv()&&sOldGroupId==gtIMMgr().bdyLst.sOtherContactsID){copyToGroupRequest(sBuddyId,sNewGroupId)}else{moveToGroupRequest(sBuddyId,sOldGroupId,sNewGroupId)}break}};Owa.Components.BuddyListTreeNode.prototype._onBeforeContextMenu=function Owa$Components$BuddyListTreeNode$_onBeforeContextMenu(){if(g_iIM_SI){return true}if(this.isRt()){this._prepContextMenu(this.gtDspNm(),true,false,false,true);return}var oBuddyList=gtIMMgr().bdyLst;var sBuddyId=this._get_Element().getAttribute("sUri");var oGroup=oBuddyList.GetGroup(this.get_Id());var oBuddy=oBuddyList.GtBdy(sBuddyId);if(oGroup){this._prepContextMenu(oGroup.groupName,true,false,false,oGroup.IsOtherContactsGroup()||oGroup.IsFavoritesGroup());return}else if(oBuddy){var oBuddyGroup=oBuddyList.GetGroup(this._get_Element().getAttribute("sGroupId"));this._prepContextMenu(oBuddy.dn,false,oBuddyGroup.IsOtherContactsGroup(),gtIMMgr().IsBlkd(oBuddy.uri));return}return true};Owa.Components.BuddyListTreeNode.prototype._prepContextMenu=function Owa$Components$BuddyListTreeNode$_prepContextMenu(sHeaderText,fGroup,fInOtherContactsGroup,fBlocked,fReadOnly){var oContextMenu=this._tr.get_ContextMenu();var oSpnHdr=oContextMenu._get_Element().getDescendantById("spnHdr");oSpnHdr.set_TextContent(sHeaderText);oSpnHdr.set_Title(sHeaderText);var fMSN=isMSNPrv();oContextMenu.enableMenuItem("divBtmChat",!fGroup);oContextMenu.enableMenuItem("divBtmRmvBase",!fGroup);oContextMenu.showMenuItem("divBtmBlock",fMSN&&(fGroup||!fBlocked));oContextMenu.enableMenuItem("divBtmBlock",!fGroup&&!fBlocked);oContextMenu.showMenuItem("divBtmUnblock",fMSN&&!fGroup&&fBlocked);oContextMenu.enableMenuItem("divBtmUnblock",!fGroup&&fBlocked);oContextMenu.showMenuItem("divBtmRmvGroup",!fGroup&&!fInOtherContactsGroup);oContextMenu.enableMenuItem("divBtmRenameGroup",fGroup&&!fReadOnly);oContextMenu.enableMenuItem("divBtmRemoveGroup",fGroup&&!fReadOnly);oContextMenu.showMenuItem("divBtmNewContact",fMSN);oContextMenu.showMenuItem("divBtmNewOcsContact",!fMSN)};Owa.Components.BuddyListTreeNode.prototype.onContextMenuClick=function Owa$Controls$BuddyListTreeNode$prototype$onContextMenuClick(oEventArgs){switch(oEventArgs.sCommand){case"chat":nwChtFrmRcp(this._getRecipientSpan());break;case"block":blkBdyReq(this._getRecipientSpan());break;case"unblock":blkBdyReq(this._getRecipientSpan(),1);break;case"removeFromGroup":rmFrmGrpReq(this._tr.get_SubPage(),this._getRecipientSpan());break;case"removeFromList":rmBdyLstReq(this._tr.get_SubPage(),this._getRecipientSpan());break;case"renameGroup":this._tr.get_ContextMenu().close();this._tr.newGroup(this,0);break;case"removeGroup":removeGroupRequest(this.get_Id());break;case"newGroup":this._tr.get_ContextMenu().close();this._tr.newGroup(this,1);break;case"newContact":this._tr.get_ContextMenu().close();this._tr.addBddyRequest();break;case"newOcsContact":this._tr.get_ContextMenu().close();this._tr.addBddyFrmAb();break}};Owa.Components.BuddyListTreeNode.prototype._getRecipientSpan=function Owa$Controls$BuddyListTreeNode$prototype$_getRecipientSpan(){return this._get_Element().get_FirstChild().get_FirstChild().get_FirstChild()._get_DomNode()}})();g_fModuleLoaded[".\\uicontrols/buddylisttreenode.js".toLowerCase()]=1;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/buddylisttree.js".toLowerCase()])(function(){var ADD_BDDY_ID="addBddy";var BDDY_RT_ID="bddyRt";var LABEL="grpLB";var INF_BR_ID="divIB";var LEGACY_USER="LegacyUser";var RMT_SGNOUT_UI_ID="divRmtSgnOut";var SGNOUT_TME_UI_ID="divSgnOutTME";var SGNOUT_NTW_UI_ID="divSgnOutNTW";var CONFIG_ISSUE_UI_ID="divCfgIss";var SGNOUT_MNL_UI_ID="divSgnOutMNL";var MSN_TOU_UI_ID="divMsnTOU";var BUDDY_PADDING=3;var ABCH_MAX_GROUP_NAME_LENGTH="60";Owa.UIControls.BuddyListTree=function Owa$UIControls$BuddyListTree(root){Owa.UIControls.BuddyListTree.constructBase(this,[root]);this.fRendering=0};Owa.UIControls.BuddyListTree.createClass("Owa.UIControls.BuddyListTree",Owa.UIControls.TreeControl);Owa.UIControls.BuddyListTree.prototype.initialize=function Owa$UIControls$BuddyListTree$initialize(){Owa.UIControls.BuddyListTree.callBase(this,"initialize");this._cbOnDblClk=this._attachEvent(this.root,"dblclick",this.onDblClk);this.startRendering()};Owa.UIControls.BuddyListTree.prototype.dispose=function Owa$UIControls$BuddyListTree$dispose(){if(!this._disped){if(this.onDblClk)this._detachEvent(this.root,"dblclick",this.onDblClk);if(this._oContextMenu){this._oContextMenu.dispose()}Owa.UIControls.BuddyListTree.callBase(this,"dispose")}};Owa.UIControls.BuddyListTree.prototype.wrapNd=function Owa$UIControls$BuddyListTree$wrapNd(oN){return new Owa.Components.BuddyListTreeNode(oN,this)};Owa.UIControls.BuddyListTree.prototype._onClk=function Owa$UIControls$BuddyListTree$_onClk(oEvent){var oJN=this.gtNd(oEvent.get_Target());if(!oJN)return;if(oJN.gtId()==ADD_BDDY_ID){var imType=gtIMType();if(imType==IM_TYPE_OCS){this.addBddyFrmAb()}else if(imType==IM_TYPE_MSN){this.addBddyRequest()}oEvent.preventDefault();oEvent.cancelBubble();return}else if(this.shdCanEvt(oJN.gtId())){oEvent.preventDefault();oEvent.cancelBubble();return}Owa.UIControls.BuddyListTree.callBase(this,"_onClk",[oEvent,1])};Owa.UIControls.BuddyListTree.prototype.addBddyRequest=function Owa$UIControls$BuddyListTree$addBddyRequest(){var oP={};oP.sTgt=TO;oP.sTo="";shwDlg("AddContact",400,250,DLG_MOD|DLG_CTR,oP)};Owa.UIControls.BuddyListTree.prototype.addBddyFrmAb=function Owa$UIControls$BuddyListTree$addBddyFrmAb(){var oP={};oP.sTgt=TO;oP.sTo="";oP.fResolve=1;shwDlg("AddressBook",a_iABW,a_iABH,DLG_MOD|DLG_CTR|DLG_RSZ,oP,"&a=PickBuddy");var divBddys=getEm(DIV,god(this.root._get_DomNode()));divBddys.innerHTML=oP.sTo;var rgoBddys=divBddys.getElementsByTagName("span")["spnR"];if(!isDf(typeof(rgoBddys)))return;if(!rgoBddys.length){addBdyLstReq(this.get_SubPage(),rgoBddys)}else{for(var i=0;i<rgoBddys.length;i++){addBdyLstReq(this.get_SubPage(),rgoBddys[i])}}};Owa.UIControls.BuddyListTree.prototype.onDblClk=function Owa$UIControls$BuddyListTree$onDblClk(oEvent){var oJN=this.gtNd(oEvent.get_Target());if(!oJN||oJN.hsChld())return;var sId=oJN.gtId();if(sId==ADD_BDDY_ID||sId==LABEL||sId==FKID||oJN._get_Element().get_FirstChild().get_Id()=="dvInf")return;if(this.shdCanEvt(sId)){canEvt(oEvent);return}var spnRn=oJN._get_Element().get_FirstChild().get_FirstChild().get_FirstChild();var fExst=gtIMMgr().LdExstChtSsn(spnRn.getAttribute("_uri"));if(fExst)return;nwChtFrmRcp(spnRn._get_DomNode())};Owa.UIControls.BuddyListTree.prototype.OthrCnctGrpExists=function Owa$UIControls$BuddyListTree$OthrCnctGrpExists(){var oJBR=this.gtNdById(gtIMMgr().bdyLst.sOtherContactsID);if(oJBR){return 1}return 0};Owa.UIControls.BuddyListTree.prototype.addGrpToTr=function Owa$UIControls$BuddyListTree$addGrpToTr(sName,sGroupID,iFlags,iExpand){var oBuddyList=gtIMMgr().bdyLst;var oJBR=(oBuddyList.sOtherContactsID==null||(iFlags&Owa.IM.GROUP_FLAGS.OtherContacts)!=0)?this.gtNdById(ADD_BDDY_ID):this.gtNdById(oBuddyList.sOtherContactsID);var fSibling=1;if(!oJBR){oJBR=this.gtNdById(BDDY_RT_ID);fSibling=0}var oJN=this.createNewNode(sGroupID,oJBR,fSibling,0,{nosel:1,exp:iExpand,padding:BUDDY_PADDING});oJN.stDspNm(sName);var oGL=this.createNewNode(LABEL,oJN,0,0,{nosel:1,exp:0,padding:BUDDY_PADDING});oGL.stDspNm(L_GrpLbl);if(this._edting&&this._edt.oCtx){if(sName.trim()==this._edt.oCtx.originalValue){this.qtEdtNd()}}};Owa.UIControls.BuddyListTree.prototype.renameGroup=function Owa$UIControls$BuddyListTree$renameGroup(sGroupId,sNewName){var oNode=this.gtNdById(sGroupId);if(oNode){oNode.stDspNm(sNewName);if(this._edting&&this._edt.oCtx){if(sNewName.trim()==this._edt.oCtx.originalValue){this.qtEdtNd()}}}};Owa.UIControls.BuddyListTree.prototype.newGroup=function Owa$UIControls$BuddyListTree$newGroup(oNode,fNew){var oCtx={};if(!fNew){this.edtNd(oNode,oCtx)}else{var oBuddyList=gtIMMgr().bdyLst;this.crtNwNd(this.gtNdById(BDDY_RT_ID),oCtx,0,(oBuddyList.sOtherContactsID!=null)?this.gtNdById(oBuddyList.sOtherContactsID):this.gtNdById(ADD_BDDY_ID))}};Owa.UIControls.BuddyListTree.prototype.onNwNd=function Owa$UIControls$BuddyListTree$onNwNd(rsn,sV){if(rsn!=ECR_ESC){var sErrMsg=Owa.IM.BdyGrp.ValidateGroupName(sV,true);if(sErrMsg){this.shwErr(sErrMsg,true);this.reEdtNd()}else{this._edt.oCtx.originalValue=sV.trim();createGroupRequest(sV)}}else{this.qtEdtNd()}};Owa.UIControls.BuddyListTree.prototype.onRnNd=function Owa$UIControls$BuddyListTree$onRnNd(rsn,sV){var oJN=this._edt.nd;if(rsn!=ECR_ESC){if(oJN._get_Element().get_TextContent()==sV.trim()){this.qtEdtNd();return}var sErrMsg=Owa.IM.BdyGrp.ValidateGroupName(sV,false);if(sErrMsg){this.shwErr(sErrMsg,true);this.reEdtNd()}else{var oIMManager=gtIMMgr();if(oIMManager){this._edt.oCtx.originalValue=sV.trim();renameGroupRequest(oIMManager.bdyLst.GetGroup(oJN.get_Id()),sV)}}}else{this.qtEdtNd()}};Owa.UIControls.BuddyListTree.prototype.gtNwNdIcnMrkup=function Owa$UIControls$BuddyListTree$gtNwNdIcnMrkup(oPN,oCtx){return null};Owa.UIControls.BuddyListTree.prototype.getMaxInputLength=function Owa$UIControls$BuddyListTree$getMaxInputLength(){return ABCH_MAX_GROUP_NAME_LENGTH};Owa.UIControls.BuddyListTree.prototype.removeGroup=function Owa$UIControls$BuddyListTree$removeGroup(sGroupID){var oGroupNode=this.gtNdById(sGroupID);if(oGroupNode){this.rmNd(oGroupNode)}};Owa.UIControls.BuddyListTree.prototype.renderAddBddyLnk=function Owa$UIControls$BuddyListTree$renderAddBddyLnk(){var oJN=this.createNewNode(ADD_BDDY_ID,this.gtNdById(BDDY_RT_ID),0,0,{nosel:1,iconHTML:Owa.Components.CssSprites.getImageMarkup("adbdy.gif","id="+NODE_ICON),contentClassName:"bddyLk"});oJN.stDspNm(L_AddBddsElps);oJN.gtHl().set_Padding(Owa.Style.Side.Top,4)};Owa.UIControls.BuddyListTree.prototype.startRendering=function Owa$UIControls$BuddyListTree$startRendering(){this.fRendering=1;window.setTimeout(function(){if(g_oBddyLst){g_oBddyLst._render()}},0)};Owa.UIControls.BuddyListTree.prototype._render=function Owa$UIControls$BuddyListTree$_render(){var oIMManager=gtIMMgr();if(oIMManager){var sGroupId,oGroup,rgBdyUrisInGrp,sUri,oBuddy,iPrsnc;var start=(new Date()).getTime();var oBuddyList=oIMManager.bdyLst;var rgGrpIdsInBdyLst=oBuddyList.GetGroups();for(sGroupId in rgGrpIdsInBdyLst){oGroup=oBuddyList.GetGroup(sGroupId);if(oGroup){rgBdyUrisInGrp=oGroup.GetMembers();for(sUri in rgBdyUrisInGrp){if(oGroup.IsMember(sUri)&&!oGroup.GetRenderingStatus(sUri)){oBuddy=oBuddyList.GtBdy(sUri);if(oBuddy){iPrsnc=oIMManager.gtPrsnc(sUri);this.addBddyToGrp(oBuddy.dn,sUri,sGroupId,iPrsnc,oBuddy.iType);if((new Date()).getTime()-start>125){this.startRendering();return}}}}}}}if(!g_fSigningIn){this.shwPrgInd(1)}this.fRendering=0};Owa.UIControls.BuddyListTree.prototype.hdChldNodes=function Owa$UIControls$BuddyListTree$hdChldNodes(){var oCC=this.gtNdRt().gtCC();if(oCC){var rgNodes=oCC.getChildrenSnapshot();for(var i=0;i<rgNodes.length;i++){rgNodes[i].set_IsShown(false)}}};Owa.UIControls.BuddyListTree.prototype.addBddyToGrp=function Owa$UIControls$BuddyListTree$addBddyToGrp(sDn,sUri,sGroupId,iPrsnc,iType){var oG=this.gtNdById(sGroupId);if(oG==null)return;var oGL=this.gtChdNdById(oG,LABEL);if(oGL){var divGL=oGL.getContainer();if(divGL.get_IsShown())divGL.set_IsShown(false)}var oChildNodes=oG.gtCC()._get_DomNode().childNodes;var oJNBF=this._findInsertPosition(oChildNodes,sDn,1,oChildNodes.length-1);var oJN=this.createNewNode(sGroupId+Owa.IM.IMUtils.CleanUri(sUri),(oJNBF==null)?this.gtNdById(sGroupId):oJNBF,(oJNBF==null)?0:1,0,{nosel:1});oJN._get_Element().setAttribute("sGroupId",sGroupId);oJN._get_Element().setAttribute("sUri",sUri);var spnBddy=createOwaRcpSpan(sDn,Owa.IM.IMUtils.NrmSipUri(sUri),RT_SMTP,"",AO_O,0,"",0,sUri,1,1,1,sGroupId,iType);renderJB(spnBddy.get_FirstChild(),0,0,1,iPrsnc);oJN.getContent().appendChild(spnBddy);gtIMMgr().bdyLst.GetGroup(sGroupId).SetRenderingStatus(sUri,true)};Owa.UIControls.BuddyListTree.prototype.rmvBddyFrmGrp=function Owa$UIControls$BuddyListTree$rmvBddyFrmGrp(sGroupID,sUri){var oJN=this.gtNdById(sGroupID+Owa.IM.IMUtils.CleanUri(sUri));if(oJN)this.rmNd(oJN);var oGroup=gtIMMgr().bdyLst.GetGroup(sGroupID);if(oGroup.GtLen()==0){var oGL=this.gtChdNdById(this.gtNdById(sGroupID),LABEL);if(oGL){var divGL=oGL.getContainer();divGL.set_IsShown(true)}}oGroup.SetRenderingStatus(sUri,false)};Owa.UIControls.BuddyListTree.prototype.updateGrpPrsc=function Owa$UIControls$BuddyListTree$updateGrpPrsc(sGroupID,sDn,sUri,iPrsnc){var oJBddy=this.gtNdById(sGroupID+Owa.IM.IMUtils.CleanUri(sUri));if(oJBddy){if(isDf(typeof(iPrsnc))){var oImg=oJBddy._get_Element().getDescendantsByTagName("img")[0];if(oImg){setJBPrsnc(oImg,iPrsnc,0)}}var oBddyNm=oJBddy._get_Element().getDescendantById("bdyNm");if(sDn&&sDn!=""&&sDn!=oBddyNm.get_TextContent()){var oG=this.gtNdById(sGroupID);if(oG){var oChildNodes=oG.gtCC()._get_DomNode().childNodes;var oJNBF=this._findInsertPosition(oChildNodes,sDn,1,oChildNodes.length-1);if(oJNBF!=oJBddy){if(oJNBF==null)this.addKds(oG,[oJBddy.getContainer()]);else this.insrtKdsPos(oJNBF,[oJBddy.getContainer()],0,0)}}oBddyNm.set_TextContent(sDn);var spnIn=oJBddy._get_Element().get_FirstChild().get_FirstChild().get_FirstChild();spnIn.setAttribute("_dn",sDn);spnIn.setAttribute("title",sDn+"\n"+imns.IMUtils.NrmSipUri(sUri))}}};Owa.UIControls.BuddyListTree.prototype.shwIMUnavl=function Owa$UIControls$BuddyListTree$shwIMUnavl(iErr){Owa.IM.BdyGrp.sOtherContactsID=null;var iId=INF_BR_ID;var iFailure=isDf(typeof(iErr))?iErr:0;switch(iFailure){case IM_FAIL_SESSION_SIGN_OUT:iId=RMT_SGNOUT_UI_ID;break;case IM_FAIL_CLIENT_SIGN_OUT:iId=SGNOUT_MNL_UI_ID;break;case IM_FAIL_CLIENT_LIMIT:iId=SGNOUT_TME_UI_ID;break;case IM_FAIL_MSN_TERMS_OF_USE_NOT_SIGNED:iId=MSN_TOU_UI_ID;this.gtNdRt().collapse();break;case IM_FAIL_ADDRESS_NOT_AVAILABLE:case IM_FAIL_EXTERNAL_AUTHENTICATION_DISABLED:case IM_FAIL_EXTERNAL_IDENTITY_UNKNOWN:iId=CONFIG_ISSUE_UI_ID;break;case IM_FAIL_SERVER_TIMEOUT:iId=SGNOUT_NTW_UI_ID;break}this.shwNdById(iId)};Owa.UIControls.BuddyListTree.prototype.shwIMUnsupported=function Owa$UIControls$BuddyListTree$shwIMUnsupported(){this.shwNdById(INF_BR_ID,1)};Owa.UIControls.BuddyListTree.prototype.shwPrgInd=function Owa$UIControls$BuddyListTree$shwPrgInd(fH){if(!fH){if(!this.gtNdById(ADD_BDDY_ID)){this.renderAddBddyLnk()}this.hdChldNodes();var oCC=this.gtNdRt().gtCC();if(oCC){oCC.set_IsShown(false);this.fireOnResize()}this.gtNdById(BDDY_RT_ID).shwPrg(0)}else{if(this.gtNdRt().isExp()){var oCC=this.gtNdRt().gtCC();if(oCC){oCC.set_IsShown(true);this.fireOnResize()}}this.gtNdById(BDDY_RT_ID).hdPrg()}};Owa.UIControls.BuddyListTree.prototype.shwNdById=function Owa$UIControls$BuddyListTree$shwNdById(iId,fLU){this.hdChldNodes();this.gtNdById(BDDY_RT_ID).hdPrg();var oJIF=this.gtNdById(iId);if(!oJIF){if(isDf(typeof(fLU))&&fLU){this.createInfoNode(LEGACY_USER)}else{this.createInfoNode(iId)}}else{oJIF.getContainer().set_IsShown(true)}};Owa.UIControls.BuddyListTree.prototype.shwAddBddyLnk=function Owa$UIControls$BuddyListTree$shwAddBddyLnk(){var oJAB=this.gtNdById(ADD_BDDY_ID);if(!oJAB){this.renderAddBddyLnk();oJAB=this.gtNdById(ADD_BDDY_ID)}if(!oJAB.getContainer().get_IsShown()){oJAB.getContainer().set_IsShown(true)}};Owa.UIControls.BuddyListTree.prototype.insertInfoNode=function Owa$UIControls$BuddyListTree$insertInfoNode(sId,oJParent,contentHTML){return this.createNewNode(sId,oJParent,0,0,{nosel:1,contentHTML:contentHTML,highlightClassName:"bddyInfoNdHl",bodyClassName:"bddyInfoNd"})};Owa.UIControls.BuddyListTree.prototype.createInfoNode=function Owa$UIControls$BuddyListTree$createInfoNode(sId){var contentHTML;switch(sId){case INF_BR_ID:contentHTML="<DIV id=\"dvInf\" class=\"errBx\">"+L_IMNtAvl+"</div>";break;case LEGACY_USER:contentHTML="<DIV id=\"dvInf\" class=\"errBx\">"+L_IMLegacyUser+"</div>";break;case RMT_SGNOUT_UI_ID:contentHTML="<div id=\"dvInf\" class=\"errBx\">"+L_ErrRmtSo+"&nbsp;"+"<span id=spnSgnInAgn onclick=\"g_oBddyLst.clkSgnIn()\">"+L_sgnInAgn+"</span></div>";break;case SGNOUT_TME_UI_ID:contentHTML="<div id=\"dvInf\" class=\"errBx\">"+L_ErrManyEndpoints+"&nbsp;"+"<span id=spnSgnInAgn onclick=\"g_oBddyLst.clkSgnIn()\">"+L_sgnInAgn+"</span></div>";break;case SGNOUT_MNL_UI_ID:contentHTML="<div id=\"dvInf\" class=\"errBx\">"+L_SignedOutOfIM+"&nbsp;"+"<span id=spnSgnInAgn onclick=\"g_oBddyLst.clkSgnIn(1)\">"+L_SignIn+"</span></div>";break;case MSN_TOU_UI_ID:contentHTML="<div id=\"dvInf\" class=\"errBx\">"+L_ErrorTermsOfUseNotSigned+"&nbsp;"+"<span id=spnSgnInAgn onclick=\"g_oBddyLst.clickTOU()\">"+L_ErrorTermsOfUseLink+"</span></div>";break;case CONFIG_ISSUE_UI_ID:contentHTML="<DIV id=\"dvInf\" class=\"errBx\">"+L_IMInvConf+"</div>";break;case SGNOUT_NTW_UI_ID:contentHTML="<div id=\"dvInf\" class=\"errBx\">"+L_IMNetPblm+"&nbsp;"+"<span id=spnSgnInAgn onclick=\"g_oBddyLst.clkSgnIn()\">"+L_sgnInAgn+"</span></div>";break}var oJInfo=this.insertInfoNode(sId,this.gtNdById(BDDY_RT_ID),contentHTML);oJInfo._get_Element()._get_DomNode().removeAttribute("href");oJInfo._get_Element().set_Right(0);oJInfo._get_Element().set_Left(0)};Owa.UIControls.BuddyListTree.prototype.shdCanEvt=function Owa$UIControls$BuddyListTree$shdCanEvt(sId){if(sId==INF_BR_ID||sId==RMT_SGNOUT_UI_ID||sId==SGNOUT_TME_UI_ID||sId==SGNOUT_MNL_UI_ID||sId==MSN_TOU_UI_ID||sId==SGNOUT_NTW_UI_ID||sId==CONFIG_ISSUE_UI_ID)return true;else return false};Owa.UIControls.BuddyListTree.prototype.clkSgnIn=function Owa$UIControls$BuddyListTree$clkSgnIn(fMnlSI){ImSIR(0,1,fMnlSI);this.shwPrgInd()};Owa.UIControls.BuddyListTree.prototype._findInsertPosition=function Owa$UIControls$BuddyListTree$_findInsertPosition(oChildNodes,sDn,begin,end){if(oChildNodes==null||begin>end)return null;while(1){if(begin>=end){var oJN=Owa.Dom.Node.wrapDomNode(oChildNodes[end]);if(oJN&&oJN.get_TextContent().localeCompare(sDn)>0)return this.gtNd(oJN);else return null}else{var middle=Math.floor(begin+(end-begin)/2);var oJN=Owa.Dom.Node.wrapDomNode(oChildNodes[middle]);if(oJN&&oJN.get_TextContent().localeCompare(sDn)>0)end=middle;else begin=middle+1}}};Owa.UIControls.BuddyListTree.prototype.clickTOU=function Owa$UIControls$BuddyListTree$clickTOU(){var oDocument=Owa.Dom.Document.get_Current();var oForm=Owa.Dom.Document.get_Current().createElement("form");oForm.setAttribute("method","post");var oHiddenInput=oDocument.createElement("input");oHiddenInput.setAttribute("type","hidden");oHiddenInput.setAttribute("name","InstantMessage_TOU");oHiddenInput.setAttribute("value","1");oForm.appendChild(oHiddenInput);oDocument.appendChild(oForm);oForm._get_DomNode().submit()}})();g_fModuleLoaded[".\\uicontrols/buddylisttree.js".toLowerCase()]=1;(function(){var States={Unload:0,Loading:1,Loaded:2,Showing:3};Owa.UIControls.FolderPickerDialog=function Owa$UIControls$FolderPickerDialog(){Owa.UIControls.FolderPickerDialog.constructBase(this);this._sId=g_sFPDId+Owa.UIControls.FolderPickerDialog._iIndex;Owa.UIControls.FolderPickerDialog._iIndex++;this._attachEvent(Owa.Dom.Window.get_Current(),"unload",this._dispose);g_oEd.attachEvent("RenameFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("NewFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("MoveFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("CopyFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("DeleteFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("EmptyFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("RemoveNavigation",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("RenameNavigation",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("NewNavigation",this,"_cbClearHtmlCacheAfterOEH");g_oEd.attachEvent("UpdateCount",this,"_cbClearHtmlCacheAfterCountChanged")};Owa.UIControls.FolderPickerDialog.createClass("Owa.UIControls.FolderPickerDialog",Owa.UIControls.UIControl);Owa.UIControls.FolderPickerDialog._iIndex=0;Owa.UIControls.FolderPickerDialog.prototype._iDefaultButtonIndex=0;Owa.UIControls.FolderPickerDialog.prototype._sState=States.Unload;Owa.UIControls.FolderPickerDialog.prototype._iTreeHeight=300;Owa.UIControls.FolderPickerDialog.prototype._iTreeWidth=260;Owa.UIControls.FolderPickerDialog.prototype._fIsShowPublicFolder=true;Owa.UIControls.FolderPickerDialog.prototype._sTitle="";Owa.UIControls.FolderPickerDialog.get_Default=function Owa$UIControls$FolderPickerDialog$get_Default(){if(!Owa.Dom.Window.get_Current().equals(Owa.Utility.getIFrameParentOwaWindow())){var oTopOwa=Owa.Utility.getIFrameParentOwaWindow().getGlobalVariable("Owa");return oTopOwa.UIControls.FolderPickerDialog.get_Default()}if(!this._oDefault)this._oDefault=new Owa.UIControls.FolderPickerDialog();return this._oDefault};Owa.UIControls.FolderPickerDialog.prototype._get_State=function Owa$UIControls$FolderPickerDialog$_get_State(){return this._sState};Owa.UIControls.FolderPickerDialog.prototype._set_State=function Owa$UIControls$FolderPickerDialog$_set_State(sState){this._sState=sState};Owa.UIControls.FolderPickerDialog.prototype.set_Title=function Owa$UIControls$FolderPickerDialog$set_Title(sTitle){if(this._get_State()==States.Showing)throw new Error("Can't change title when folder picker dialog is showing");this._sTitle=sTitle};Owa.UIControls.FolderPickerDialog.prototype.set_TreeHtml=function Owa$UIControls$FolderPickerDialog$set_TreeHtml(sTreeHtml){if(this._get_State()==States.Showing){throw new Error("Can't change tree html when folder picker dialog is showing")}this._sCustomTreeHtml=sTreeHtml};Owa.UIControls.FolderPickerDialog.prototype.set_SourceTreeNode=function Owa$UIControls$FolderPickerDialog$set_SourceTreeNode(oNode){if(this._get_State()==States.Showing)throw new Error("Can't set the source tree node when folder picker dialog is showing");this._oSourceTreeNode=oNode};Owa.UIControls.FolderPickerDialog.prototype.get_SourceTreeNode=function Owa$UIControls$FolderPickerDialog$get_SourceTreeNode(){return this._oSourceTreeNode};Owa.UIControls.FolderPickerDialog.prototype.get_Title=function Owa$UIControls$FolderPickerDialog$get_Title(){return this._sTitle};Owa.UIControls.FolderPickerDialog.prototype.set_IsShowPublicFolder=function Owa$UIControls$FolderPickerDialog$set_IsShowPublicFolder(fIsShowPublicFolder){if(this._get_State()==States.Showing)throw new Error("Can't change title when folder picker dialog is showing");if(this._fIsShowPublicFolder!=fIsShowPublicFolder){this._fIsShowPublicFolder=fIsShowPublicFolder;this._set_State(States.Unload)}};Owa.UIControls.FolderPickerDialog.prototype.set_TreeWidth=function Owa$UIControls$FolderPickerDialog$set_TreeWidth(iValue){this._iTreeWidth=iValue};Owa.UIControls.FolderPickerDialog.prototype.get_TreeWidth=function Owa$UIControls$FolderPickerDialog$get_TreeWidth(){return this._iTreeWidth};Owa.UIControls.FolderPickerDialog.prototype.set_TreeHeight=function Owa$UIControls$FolderPickerDialog$set_TreeHeight(iValue){this._iTreeHeight=iValue};Owa.UIControls.FolderPickerDialog.prototype.get_TreeHeight=function Owa$UIControls$FolderPickerDialog$get_TreeHeight(){return this._iTreeHeight};Owa.UIControls.FolderPickerDialog.prototype.set_ButtonCaptions=function Owa$UIControls$FolderPickerDialog$set_ButtonCaptions(rgButtonCaption){if(this._get_State()==States.Showing)throw new Error("Can't change button when folder picker dialog is showing");this._rgButtonCaption=rgButtonCaption};Owa.UIControls.FolderPickerDialog.prototype.get_ButtonCaptions=function Owa$UIControls$FolderPickerDialog$get_ButtonCaptions(){return this._rgButtonCaption};Owa.UIControls.FolderPickerDialog.prototype.set_DefaultButtonIndex=function Owa$UIControls$FolderPickerDialog$set_DefaultButtonIndex(iDefaultButtonIndex){this._iDefaultButtonIndex=iDefaultButtonIndex};Owa.UIControls.FolderPickerDialog.prototype.get_DefaultButtonIndex=function Owa$UIControls$FolderPickerDialog$get_DefaultButtonIndex(){return this._iDefaultButtonIndex};Owa.UIControls.FolderPickerDialog.prototype.getButton=function Owa$UIControls$FolderPickerDialog$getButton(sButtonCaption){if(!sButtonCaption)return null;return this._get_ButtonDialog().getButton(sButtonCaption)};Owa.UIControls.FolderPickerDialog.prototype.get_DefaultButton=function Owa$UIControls$FolderPickerDialog$get_DefaultButton(){return this.getButton(this.get_ButtonCaptions()[this.get_DefaultButtonIndex()])};Owa.UIControls.FolderPickerDialog.prototype.show=function Owa$UIControls$FolderPickerDialog$show(){if(this._get_State()==States.Showing)throw new Error("Dialog already showed");if(this._get_State()==States.Unload){this._load();return}if(this._get_State()==States.Loading){return}this._show()};Owa.UIControls.FolderPickerDialog.prototype._show=function Owa$UIControls$FolderPickerDialog$_show(){this._createButtonDialog();var oTreeContainer=this._get_TreeControl()._get_Element().get_ParentElement();this._get_ButtonDialog().show();oTreeContainer.get_ParentElement().get_ParentElement().get_ParentElement().set_Width(this._iTreeWidth);oTreeContainer.get_ParentElement().get_ParentElement().get_ParentElement().set_Height(this._iTreeHeight);this._set_State(States.Showing)};Owa.UIControls.FolderPickerDialog.prototype._load=function Owa$UIControls$FolderPickerDialog$_load(){if(this._sCustomTreeHtml){this._sHtml=this._sCustomTreeHtml;this._set_State(States.Loaded);this._show()}else{var oRequest=new oeReq("Navigation","GetFolderPickerTree",null,this._createCallback(this._cbLoad));oRequest.add("pTr",this._fIsShowPublicFolder?1:0);oRequest.send();this._set_State(States.Loading)}};Owa.UIControls.FolderPickerDialog.prototype._cbLoad=function Owa$UIControls$FolderPickerDialog$_cbLoad(oResponse){if(!cbOeh(oResponse)){this._set_State(States.Unload);return}this._sHtml=oResponse.sBody;this._set_State(States.Loaded);this._show()};Owa.UIControls.FolderPickerDialog.prototype._createButtonDialog=function Owa$UIControls$FolderPickerDialog$_createButtonDialog(){var iMargin=52;var rgButton=this.get_ButtonCaptions();rgButton=rgButton.slice();rgButton.unshift(L_CrtNewFldElps);this._oButtonDialog=new BtnDlg(this._sId,this._sHtml,this.get_Title(),rgButton,this._iTreeWidth+iMargin,null,this._createCallback(this._cbOnButtonClick));this._oDialogElement=$(this._sId);var oTreeElement=this._oDialogElement.getDescendantById("fptree").get_FirstChild();var oTreeContainer=oTreeElement.get_ParentElement();var oTree=new Owa.UIControls.FolderTree(oTreeElement,1);if(this._oTree)unmakeTreeScrollArea(this._oTree);this._oTree=oTree;oTree.clrSel();oTreeContainer.get_ParentElement().get_ParentElement().get_ParentElement().set_Width(this._iTreeWidth);oTreeContainer.get_ParentElement().get_ParentElement().get_ParentElement().set_Height(this._iTreeHeight);makeTreeScrollArea(oTree);oTree.onSelChng=Owa.Utility.createDelegate(this,this._cbOnTreeSelectionChange);oTree.onAfEdt=Owa.Utility.createDelegate(this,this._cbOnTreeAfterEdit);oTree.onNwFld=Owa.Utility.createDelegate(this,this._cbOnTreeNewFolder);this._attachEvent(oTree.root,"dblclick",this._cbOnTreeDoublcClick);this.enableAllDialogButton(false);this._set_State(States.Loaded)};Owa.UIControls.FolderPickerDialog.prototype._dispose=function Owa$UIControls$FolderPickerDialog$_dispose(){var oTree=this._get_TreeControl();if(this._get_State()==States.Showing)this._detachEvent(oTree.root,"dblclick",this._cbOnTreeDoublcClick);g_oEd.detachEvent("RenameFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("NewFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("MoveFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("CopyFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("DeleteFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("EmptyFolder",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("RemoveFromView",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("RemoveNavigation",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("RenameNavigation",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("NewNavigation",this,"_cbClearHtmlCacheAfterOEH");g_oEd.detachEvent("UpdateCount",this,"_cbClearHtmlCacheAfterCountChanged")};Owa.UIControls.FolderPickerDialog.prototype._get_TreeControl=function Owa$UIControls$FolderPickerDialog$_get_TreeControl(){return this._oTree};Owa.UIControls.FolderPickerDialog.prototype._get_ButtonDialog=function Owa$UIControls$FolderPickerDialog$_get_ButtonDialog(){return this._oButtonDialog};Owa.UIControls.FolderPickerDialog.prototype.enableButton=function Owa$UIControls$FolderPickerDialog$enableButton(sButtonCaption,fEnable){this._oButtonDialog.enableButton(sButtonCaption,fEnable)};Owa.UIControls.FolderPickerDialog.prototype.enableAllDialogButton=function Owa$UIControls$FolderPickerDialog$enableAllDialogButton(fEnable){var rgButton=this.get_ButtonCaptions();for(var i=0;i<rgButton.length;i++)this._oButtonDialog.enableButton(rgButton[i],fEnable);this._oButtonDialog.enableButton(L_CrtNewFldElps,fEnable)};Owa.UIControls.FolderPickerDialog.prototype._cbOnTreeNewFolder=function Owa$UIControls$FolderPickerDialog$_cbOnTreeNewFolder(oNewTreeNode){this._get_TreeControl().selNd(oNewTreeNode);this.enableAllDialogButton(true);this._onCheckCustomButtons()};Owa.UIControls.FolderPickerDialog.prototype._cbOnButtonClick=function Owa$UIControls$FolderPickerDialog$_cbOnButtonClick(iButtonIndex,oContext){var fCancelClose=false;var oTree=this._get_TreeControl();if(-1==iButtonIndex){if(oTree._edting)oTree.qtEdtNd()}else{if(0==iButtonIndex){oTree.nwFld(oTree.gtSelNd(),1,null);this.enableAllDialogButton(false);fCancelClose=true}else{fCancelClose=this._onButtonClick(iButtonIndex-1)}}if(!fCancelClose||-1==iButtonIndex){if(this._onBeforeClose()){fCancelClose=true}if(!fCancelClose||-1==iButtonIndex){this._sHtml=this._oDialogElement.getDescendantById("divFPTrR").get_OuterHtml();this._get_TreeControl().dispose();this._oTree=null;this._set_State(States.Loaded)}}return fCancelClose};Owa.UIControls.FolderPickerDialog.prototype._cbOnTreeDoublcClick=function Owa$UIControls$FolderPickerDialog$_cbOnTreeDoublcClick(oEvent){if(!this._get_TreeControl()._edting){var oDefaultButton=this.get_DefaultButton();if(oDefaultButton)oDefaultButton.click()}};Owa.UIControls.FolderPickerDialog.prototype._cbOnTreeSelectionChange=function Owa$UIControls$FolderPickerDialog$_cbOnTreeSelectionChange(oOriginSelectedTreeNode,oNewSelectedTreeNode){this.enableAllDialogButton(true);this.enableButton(L_CrtNewFldElps,oNewSelectedTreeNode?oNewSelectedTreeNode.canCrt():false);this._onCheckCustomButtons()};Owa.UIControls.FolderPickerDialog.prototype._cbOnTreeAfterEdit=function Owa$UIControls$FolderPickerDialog$_cbOnTreeAfterEdit(){var oSelectedTreeNode=this._get_TreeControl().gtSelNd();this.enableAllDialogButton(true);this.enableButton(L_CrtNewFldElps,oSelectedTreeNode?oSelectedTreeNode.canCrt():false);this._onCheckCustomButtons()};Owa.UIControls.FolderPickerDialog.prototype._cbClearHtmlCacheAfterOEH=function Owa$UIControls$FolderPickerDialog$_cbClearHtmlCacheAfterOEH(oResponse){if(oResponse.isErr())return;if(this._get_State()==States.Loaded)this._set_State(States.Unload)};Owa.UIControls.FolderPickerDialog.prototype._cbClearHtmlCacheAfterCountChanged=function Owa$UIControls$FolderPickerDialog$_cbClearHtmlCacheAfterCountChanged(sFolderId){if(this._get_State()==States.Loaded)this._set_State(States.Unload)};Owa.UIControls.FolderPickerDialog.prototype._onButtonClick=function Owa$UIControls$FolderPickerDialog$_onButtonClick(){if(this.onButtonClick)return this.onButtonClick.apply(this,arguments)};Owa.UIControls.FolderPickerDialog.prototype._onBeforeClose=function Owa$UIControls$FolderPickerDialog$_onBeforeClose(){if(this.onBeforeClose)return this.onBeforeClose.apply(this,arguments)};Owa.UIControls.FolderPickerDialog.prototype._onCheckCustomButtons=function Owa$UIControls$FolderPickerDialog$_onCheckCustomButtons(){if(this.onCheckCustomButtons)return this.onCheckCustomButtons.apply(this,arguments)}})();function calculateScrollBarOnTreeResize(){var oTreeRegion=getTreeRegion(this);Owa.DomUtility.calculateVerticalScrollBar(oTreeRegion)}function errorInfobarSizeChangedInTree(){var oErrorElement=$(this._sErrNm);var oInfobar=oErrorElement.getAncestorById("divInfobar");var iErrorHeight=0;if(oInfobar){iErrorHeight=oInfobar.get_OffsetHeight()}else if(oErrorElement){iErrorHeight=oErrorElement.get_OffsetHeight()}var oTreeRegion=getTreeRegion(this);if(!oErrorElement||!oErrorElement.get_IsShown())iErrorHeight=0;oTreeRegion.set_Top(iErrorHeight);Owa.DomUtility.calculateVerticalScrollBar(oTreeRegion)}function getTreeRegion(oTree){return oTree.root.get_ParentElement().get_ParentElement().get_ParentElement()}function makeTreeScrollArea(oTree){var oTreeRegion=getTreeRegion(oTree);var oDelegate=Owa.Utility.createContextDelegate(oTreeRegion,Owa.DomUtility.calculateVerticalScrollBar,oTreeRegion);Owa.Dom.Window.get_Current().attachEvent("resize",oDelegate);oTree.onResize=calculateScrollBarOnTreeResize;oTree.onErrorInfobarChanged=errorInfobarSizeChangedInTree;Owa.DomUtility.calculateVerticalScrollBar(oTreeRegion)}function unmakeTreeScrollArea(oTree){var oTreeRegion=getTreeRegion(oTree);var oDelegate=Owa.Utility.createContextDelegate(oTreeRegion,Owa.DomUtility.calculateVerticalScrollBar,oTreeRegion);Owa.Dom.Window.get_Current().detachEvent("resize",oDelegate);oTree.onResize=null;oTree.onErrorInfobarChanged=null}g_oEd.attachEvent("RenameFolder",null,"cbFolderChanged");g_oEd.attachEvent("NewFolder",null,"cbNavigationNodeChanged");g_oEd.attachEvent("MoveFolder",null,"cbNavigationNodeChanged");g_oEd.attachEvent("CopyFolder",null,"cbNavigationNodeChanged");g_oEd.attachEvent("UpdateCount",null,"cbFolderUpdateCount");g_oEd.attachEvent("DeleteFolder",null,"cbFolderChanged");g_oEd.attachEvent("EmptyFolder",null,"cbFolderChanged");g_oEd.attachEvent("RemoveFromView",null,"cbFolderChanged");g_oEd.attachEvent("RemoveNavigation",null,"cbFolderChanged");g_oEd.attachEvent("RenameNavigation",null,"cbNavigationNodeChanged");g_oEd.attachEvent("NewNavigation",null,"cbNavigationNodeChanged");function cbFolderChanged(oR){if(oR.isErr())return;updCMM();cchFpdTrH(0,null);cchFpdTrH(1,null)}function cbNavigationNodeChanged(oR){if(oR.isErr())return;cchFpdTrH(0,null);cchFpdTrH(1,null)}function cbFolderUpdateCount(){cchFpdTrH(0,null);cchFpdTrH(1,null)}function shwFPDlg(oArg,cbOnClickButton,oCtx){if(!isDf(typeof(oArg.fP)))oArg.fP=1;if(!isDf(typeof(oArg.iHTr)))oArg.iHTr=300;if(shwFPDlg.fLd)return;var oOehCtx=new Object();oOehCtx.oArg=oArg;oOehCtx.cbOnClickButton=cbOnClickButton;oOehCtx.oFpdCtx=oCtx;var oR=new oeReq("Navigation","GetFolderPickerTree",oOehCtx,cbDownloadFolderPickerTree);oR.add("pTr",oArg.fP);oR.send();shwFPDlg.fLd=1}shwFPDlg.fLd=0;function cbDownloadFolderPickerTree(oR){shwFPDlg.fLd=0;if(!cbOeh(oR))return;var o=oR.oCtx;var o=new FolderPickerDialog(oR.sBody,o.oArg,o.cbOnClickButton,o.oFpdCtx);o.show()}if(!isDf(typeof(wt()._rgFpdTrH)))wt()._rgFpdTrH=[];function cchFpdTrH(fP,sH){wt()._rgFpdTrH[fP?0:1]=sH}var g_sFPDId="divFPD";function FolderPickerDialog(sTrHtml,oArg,cbOnClickButton,oCtx){var iWTr=260;var iMgn=40;var rgB=[L_CrtNewFldElps,oArg.sBtn];var oBDCtx=new Object();oBDCtx.idxNewBtn=0;oBDCtx.onClickButton=cbOnClickButton;oBDCtx.oFpdCtx=oCtx;var oDlg=new BtnDlg(g_sFPDId,sTrHtml,oArg.sTtl,rgB,iWTr+iMgn,null,fpdOnCls,null,0,0,null,null,oBDCtx);oDlg.sBtn=oArg.sBtn;oDlg.fP=oArg.fP;oDlg.iMgn=iMgn;oDlg.gtTr=fpdGtTr;oDlg.fnBDShow=oDlg.show;oDlg.show=fpdShw;oDlg.fnOnBfCls=oArg.cbOnBfCls;var oT=oDlg.gtTr();var oTCntr=oT.parentNode;oDlg.tree=new Owa.UIControls.FolderTree(Owa.Dom.Node.wrapDomNode(oT),1);oTCntr.parentNode.parentNode.parentNode.style.height=oArg.iHTr+"px";oTCntr.parentNode.parentNode.parentNode.style.width=iWTr+"px";makeTreeScrollArea(oDlg.tree);oDlg.tree.onSelChng=fpdTrOnSelNd;oDlg.tree.onAfEdt=fpdTrOnAfEdt;oDlg.tree.onNwFld=fpdSelNwFld;oDlg.tree.onBfEdt=fpdTrOnBfEdt;oT.ondblclick=fpdTrOnDblClk;enbFpdBtns(0);if(oArg.cbOnCrt)oArg.cbOnCrt(oDlg);return oDlg}function fpdSelNwFld(oJN){this.selNd(oJN)}function fpdOnCls(i,oCtx){var fKpOn;var oFpd=getFpd();var oT=oFpd.tree;if(-1==i){fKpOn=oT._edting}else{if(!oT.hsSelNd()){fKpOn=1}else{if(oCtx.idxNewBtn==i){oT.nwFld(oT.gtSelNd(),1,null);fKpOn=1}else if(oCtx.onClickButton){var fD=oT.isAncstr(oT.gtNdByAls(ALP_DFT+DFT_DEL),oT.gtSelNd(),1)?1:0;fKpOn=oCtx.onClickButton([oT.gtSelNd().gtFId(),fD,oT.gtSelNd().gtDspNm(),oT.gtSelNd().gtFCC(),oCtx.oFpdCtx])}}}if(!fKpOn){var sH=oFpd.gtTr().parentNode.parentNode.outerHTML;cchFpdTrH(oFpd.fP,sH.replace(/\r\n/g,""));if(oFpd.fnOnBfCls)oFpd.fnOnBfCls();oT.dispose()}return fKpOn}function fpdTrOnDblClk(e){if(!e)e=getEvt(this);var o=getEvtTgt(e);var oFp=getFpd();var oTr=oFp.tree;var oJN=oTr.gtNd(Owa.Dom.Node.wrapDomNode(o));if(oJN)oFp.getBtn(oFp.sBtn).click()}function enbFpdBtns(fE){if(!wtda(g_sFPDId))return;wtda(g_sFPDId).oDlg.enableButton(L_CrtNewFldElps,fE);wtda(g_sFPDId).oDlg.enableButton(getFpd().sBtn,fE)}function fpdGtTr(){return getOneDescendant(wtda(this.sId),TR)}function fpdShw(){this.fnBDShow();var oTCntr=this.gtTr().parentNode;if(oTCntr)spw(oTCntr.parentNode.parentNode.parentNode,gow(wtda(this.sId))-this.iMgn)}function fpdTrOnSelNd(oJO,oJN){if(!wtda(g_sFPDId))return;wtda(g_sFPDId).oDlg.enableButton(L_CrtNewFldElps,oJN?oJN.canCrt():0);wtda(g_sFPDId).oDlg.enableButton(getFpd().sBtn,oJN?oJN.canHvChld():0)}function fpdTrOnAfEdt(){fpdTrOnSelNd.call(this,null,this.gtSelNd())}function fpdTrOnBfEdt(){enbFpdBtns(0)}function getFpd(){return wtda(g_sFPDId).oDlg}if(!Owa.IM){Owa.IM={}}(function(){var MAX_PRSNC=200;var MIN_OTHRS_PRSNC=10;Owa.IM.MAX_CHT_SSNS=20;Owa.IM.SUPPORTED_USER=1;Owa.IM.BUDDY_TYPE={None:0,WindowsLive:1,OfficeCommunicator:2,Yahoo:32};Owa.IM.GROUP_FLAGS={None:0,Favorites:1,OtherContacts:2};Owa.IM.IMMgr=function Owa$IM$IMMgr(){if(isDf(typeof(a_isMstr))&&a_isMstr){this.bdyLst=new Owa.IM.BdyLst();this.othrsLst=new Owa.IM.OthrsLst();this.pxyLst=new Owa.IM.ProxyList();this.blkLst=new Owa.IM.BlkLst();this.intChtSsns={};this.intChtSsnCnt=0;this.chtSsns={};this.chtSsnCnt=0}};Owa.IM.IMMgr.prototype.gtPrsnc=function Owa$IM$IMMgr$gtPrsnc(sUri){var prsnc=gtDfltPrsnc();if(!isDf(typeof(sUri))||!sUri)return prsnc;if(isSlfUri(sUri))return gtSlfPrsnc();if(this.IsBlkd(sUri))return IM_PR_BLKD;var isBdy=this.bdyLst.IsBdy(sUri);if(isBdy)return this.bdyLst.GtPrsnc(sUri);return this.othrsLst.GtPrsnc(sUri)};Owa.IM.IMMgr.prototype.gtDN=function Owa$IM$IMMgr$gtDN(sUri){if(this.bdyLst.IsBdy(sUri))return this.bdyLst.GtBdy(sUri).dn;else if(this.othrsLst.IsPrsnt(sUri))return this.othrsLst.GtBdy(sUri).dn;else return 0};Owa.IM.IMMgr.prototype.gtPrsncArr=function Owa$IM$IMMgr$gtPrsncArr(rgoUri){if(!rgoUri||rgoUri.length<=0)return;for(var i=0;i<rgoUri.length;i++){var sUri=rgoUri[i].sUri;if(sUri)rgoUri[i].prsnc=this.gtPrsnc(sUri)}};Owa.IM.IMMgr.prototype.pshUkwnPrsnc=function Owa$IM$IMMgr$pshUkwnPrsnc(){var rgoPrsnc=[];var iprsnc=gtDfltPrsnc();var sUri,oPrsnc,utBuddyList=this.bdyLst._utBuddyList;for(sUri in utBuddyList.Keys()){var oBuddy=utBuddyList.Get(sUri);if(oBuddy){oPrsnc={};oPrsnc.prsnc=iprsnc;oPrsnc.fNm=gtIMFFrmId(iprsnc);oPrsnc.sDN=oBuddy.dn;oPrsnc.sUri=sUri;rgoPrsnc.push(oPrsnc);oBuddy.prsnc=iprsnc}}utBuddyList=this.othrsLst._utOthersList;for(sUri in utBuddyList.Keys()){var oBuddy=utBuddyList.Get(sUri);if(oBuddy){oPrsnc={};oPrsnc.prsnc=iprsnc;oPrsnc.fNm=gtIMFFrmId(iprsnc);oPrsnc.sDN=oBuddy.dn;oPrsnc.sUri=sUri;rgoPrsnc.push(oPrsnc);oBuddy.prsnc=iprsnc}}pushPrsnc(rgoPrsnc);stSlfPrsnc(iprsnc)};Owa.IM.IMMgr.prototype.prscMnuDsbl=function Owa$IM$IMMgr$prscMnuDsbl(fDsbl){var oMIs;var imType=gtIMType();if(!g_oPresenceMenu)return;if(imType==IM_TYPE_OCS){oMIs=["divAVLBL","divBSY","divDND","divBRB","divAWAY"]}else{oMIs=["divAVLBL","divBSY","divAWAY","divOFFL"]}for(var i=0;i<oMIs.length;i++){g_oPresenceMenu.enableMenuItem(oMIs[i],!fDsbl)}};Owa.IM.IMMgr.prototype.IsBdy=function Owa$IM$IMMgr$IsBdy(sUri){if(!isDf(typeof(sUri))||!sUri)return 0;return this.bdyLst.IsBdy(sUri)};Owa.IM.IMMgr.prototype.StStlUri=function Owa$IM$IMMgr$StStlUri(sUri,sStlUri){if(!isDf(typeof(sUri))||!sUri)return;if(!isDf(typeof(sStlUri))||!sStlUri)return;if(isSameUri(sUri,sStlUri))return;if(sStlUri)this.bdyLst._utStaleUris.Set(sStlUri,sUri);else this.bdyLst._utStaleUris=new Owa.IM.UriTable()};Owa.IM.IMMgr.prototype.GtStlUri=function Owa$IM$IMMgr$GtStlUri(sStlUri){return this.bdyLst._utStaleUris.Get(sStlUri)};Owa.IM.IMMgr.prototype.IsBlkd=function Owa$IM$IMMgr$IsBlkd(sUri){if(!isDf(typeof(sUri))||!sUri)return 0;return this.blkLst.Contains(sUri)};Owa.IM.IMMgr.prototype.SetBlkd=function Owa$IM$IMMgr$SetBlkd(sUri){if(!isDf(typeof(sUri))||!sUri)return;this.blkLst.SetBlkd(sUri)};Owa.IM.IMMgr.prototype.SetUnblkd=function Owa$IM$IMMgr$SetUnblkd(sUri){if(!isDf(typeof(sUri))||!sUri)return;this.blkLst.SetUnblkd(sUri)};Owa.IM.IMMgr.prototype.SubPrsnc=function Owa$IM$IMMgr$SubPrsnc(rgoRcps){if(!rgoRcps||!isDf(typeof(rgoRcps.length))||rgoRcps.length<1){return}if(!Owa.IM.SUPPORTED_USER){return}var iAvl=MAX_PRSNC-(this.bdyLst.GtLen()+this.othrsLst.GtLen());var iExp=rgoRcps.length;var iMin=MIN_OTHRS_PRSNC;var iNum=iExp;if(iAvl>iMin){if(iExp>iAvl){iNum=iAvl}}else if(iExp>iMin){iNum=iMin}var oRCtx;if(iAvl<iNum){oRCtx=this.othrsLst.Decay(1,1,iNum-iAvl)}if(!oRCtx&&iNum>0){oRCtx={}}var rgUrisSub=[];for(var i=0;i<iNum;i++){var sUri=rgoRcps[i];if(this.gtPrsnc(sUri)!=gtDfltPrsnc()){continue}rgUrisSub.push(sUri)}if(oRCtx){oRCtx.sUrisSub=rgUrisSub.join(",");sndIMReq(IM_SC,this.othrsLst.cbDecay,null,oRCtx)}};Owa.IM.IMMgr.prototype.QryPrsnc=function Owa$IM$IMMgr$QryPrsnc(rgoRcps){if(!rgoRcps||!isDf(typeof(rgoRcps.length))||rgoRcps.length<1){return}if(!Owa.IM.SUPPORTED_USER){return}var oRCtx={};oRCtx.sQryUris=rgoRcps.join(",");sndIMReq(IM_QP,0,0,oRCtx)};Owa.IM.IMMgr.prototype.NwChtSsnMw=function Owa$IM$IMMgr$NwChtSsnMw(sSub,o,sFId,sMsgId,gtNrmSub){if(this.GtChtSsnCnt()>=Owa.IM.MAX_CHT_SSNS){this.ErrMaxChats();return}if(isDf(typeof(sSub))&&(sSub||sSub==="")&&isDf(typeof(o))&&o){this.NwChtSsnMsg(sSub,o)}else if(isDf(typeof(sMsgId))&&sMsgId&&isDf(typeof(sFId))&&sFId){var oRCtx={};oRCtx.sMsgId=sMsgId;oRCtx.feOnErr=failStrtCht;if(isDf(typeof(gtNrmSub)))oRCtx.gtNrmSub=gtNrmSub;sndIMReq(IM_ITMINFO,this.cbProcMsgInfo,0,oRCtx)}};Owa.IM.IMMgr.prototype.cbProcMsgInfo=function Owa$IM$IMMgr$cbProcMsgInfo(oR,sBody){if(isDf(typeof(sBody))&&sBody){var o=eval('('+sBody+')');gtIMMgr().NwChtSsnMsg(o._sub,new Recip(o._dn,"",0,0,RT_SMTP,AO_O,0,0,0,o._uri))}};Owa.IM.IMMgr.prototype.NwChtSsnMsg=function Owa$IM$IMMgr$NwChtSsnMsg(sSub,o){var sUri=gtRcpIM(o);sUri=this.pxyLst.GetBuddyPrimaryUri(sUri);var sDN=gtRcpDn(o);if(!sUri){noIMInfoErr();return}else if(isSlfUri(sUri)){slfChtErr();return}var fExst=this.LdExstChtSsn(sUri,sSub);if(fExst)return;var sIntChtId=rndm();var oC={};oC.iNtry=Owa.IM.CHT_MSG;oC.fNN=0;oC.iS=Owa.IM.CHT_SSN_ST_INIT;oC.sChtId=sIntChtId;oC.iInt=1;if(Owa.Utility.isDefined(typeof o.getAttribute))oC.oRcp=crtRecipObjectFromDomObject(o);else oC.oRcp=o;var oBuddy=this.bdyLst.GtBdy(sUri);if(oBuddy){oC.oRcp._dn=oBuddy.dn;oC.oRcp._uri=oBuddy.uri;oC.oRcp._type=oBuddy.iType}else{if(oC.oRcp._dn==""){oC.oRcp._dn=sDN}oC.oRcp._uri=sUri}if((sSub&&sSub!="")){oC.sSub=sDN+" - "+sSub;oC.fUseExistingTitle=1}this._addChatSession(sIntChtId,oC)};Owa.IM.IMMgr.prototype._addChatSession=function Owa$IM$IMMgr$_addChatSession(sChatId,oContext){var oChatSession=new Owa.IM.ChtSsn(sChatId,oContext);if(oContext.iInt){this.intChtSsns[sChatId]=oChatSession;this.intChtSsnCnt++}else{this.chtSsns[sChatId]=oChatSession;this.chtSsnCnt++}var sDn=oContext.oRcp._dn;if(oContext.rgoRcp&&oContext.rgoRcp.length&&isSlfUri(oContext.oRcp._uri)){sDn=oContext.rgoRcp[oContext.rgoRcp.length-1]._dn}Owa.UIControls.ActiveChatsDialog.getDialog().addChat(sChatId,sDn,oContext.oRcp._type,oContext.sMsg);oChatSession.OpenWindow()};Owa.IM.IMMgr.prototype.NwChtSsnRcp=function Owa$IM$IMMgr$NwChtSsnRcp(o){if(this.GtChtSsnCnt()>=Owa.IM.MAX_CHT_SSNS){this.ErrMaxChats();return}if(!o)return;var fSndPreAcnt=0;var sUri=gtRcpIM(o);sUri=this.pxyLst.GetBuddyPrimaryUri(sUri);sUri=sUri.lc();sUri=Owa.IM.IMUtils.FrmSipUri(sUri);if(!sUri){noIMInfoErr();return}var sDN=gtRcpDn(o);var fHasAttributes=Owa.Utility.isDefined(typeof o.getAttribute);if(fHasAttributes&&o.getAttribute("_sipTrsp"))fSndPreAcnt=1;var sSub=sDN;var fExst=this.LdExstChtSsn(sUri,sSub);if(fExst)return;var sIntChtId=rndm();var oC={};oC.iNtry=Owa.IM.CHT_RCP;if(Owa.Utility.isDefined(typeof o.getAttribute))oC.oRcp=crtRecipObjectFromDomObject(o);else oC.oRcp=o;if(!!oC.oRcp._lgDn){oC.oRcp._em=oC.oRcp._lgDn}var oBuddy=this.bdyLst.GtBdy(sUri);if(oBuddy){oC.oRcp._dn=oBuddy.dn;oC.oRcp._uri=oBuddy.uri;oC.oRcp._type=oBuddy.iType}else{if(oC.oRcp._dn==""){oC.oRcp._dn=sDN}oC.oRcp._uri=sUri}oC.fNN=1;oC.iS=Owa.IM.CHT_SSN_ST_INIT;oC.sChtId=sIntChtId;oC.iInt=1;if(fSndPreAcnt)oC.sLDN=o._em;this._addChatSession(sIntChtId,oC)};Owa.IM.IMMgr.prototype.NwChtSsnIn=function Owa$IM$IMMgr$NwChtSsnIn(sChtId,sSub,sUri,sNm,sMsg,sFrmt,rgoRcp,iType,fIsConf){if(!sChtId||!sUri){return}if(this.GtChtSsnCnt()>=Owa.IM.MAX_CHT_SSNS){this.ErrMaxChats();return}var oChtSsn=this.GtChtSsn(sChtId);if(oChtSsn&&!oChtSsn.iInt){oChtSsn.InMsg(sUri,sMsg,sFrmt);return}if(!sSub){sSub=sNm}if(isSlfUri(sUri)){for(var i=0;i<rgoRcp.length;i++){var oRcp=rgoRcp[i];if(oRcp&&oRcp._uri&&!isSlfUri(oRcp._uri)){sSub=gtRcpDn(oRcp);break}}}var isMsnSlf=0;if(!fIsConf&&(!oChtSsn||!oChtSsn.fIsConf)){if(isMSNPrv()&&isSlfUri(sUri)){var oRcp;if(rgoRcp.length>0)oRcp=rgoRcp[0];if(oRcp&&oRcp._uri){if(rgoRcp.length<2){oChtSsn=this.LdExstChtSsn(oRcp._uri,sSub,1,sChtId)}}isMsnSlf=1}else{if(rgoRcp.length<2){oChtSsn=this.LdExstChtSsn(sUri,sSub,1,sChtId)}}}if(oChtSsn){this.MkChtSsnAct(oChtSsn.sChtId,sChtId);oChtSsn.InMsg(sUri,sMsg,sFrmt);return}var oC={};oC.iNtry=Owa.IM.CHT_IN;oC.iS=Owa.IM.CHT_SSN_ST_INIT;oC.sChtId=sChtId;oC.sSub=sSub;oC.oRcp=new Recip(sNm,imns.IMUtils.NrmSipUri(sUri),"",0,RT_SMTP,AO_O,0,0,0,sUri,iType);oC.fNN=isMsnSlf;oC.sMsg=sMsg;oC.sFrmt=sFrmt;oC.rgoRcp=rgoRcp;oC.iInt=0;oC.fIsConf=(fIsConf)?1:0;oC.fNotUserActivity=1;this._addChatSession(sChtId,oC)};Owa.IM.IMMgr.prototype.IsIntCht=function Owa$IM$IMMgr$IsIntCht(sChtId){if(!isDf(typeof(sChtId))||!sChtId)return 1;var chtSsn=this.intChtSsns[sChtId];if(isDf(typeof(chtSsn))&&chtSsn&&chtSsn.iInt)return 1;else{chtSsn=this.chtSsns[sChtId];if(isDf(typeof(chtSsn))&&chtSsn)return 0;else return -1}};Owa.IM.IMMgr.prototype.MkChtSsnAct=function Owa$IM$IMMgr$MkChtSsnAct(sIntChtId,sChtId){if(this.chtSsns[sChtId])return;var chtSsn=this.intChtSsns[sIntChtId];if(!chtSsn)return;chtSsn.sChtId=sChtId;chtSsn.iInt=0;this.chtSsns[sChtId]=chtSsn;this.chtSsnCnt++;this.intChtSsns[sIntChtId]=0;this.intChtSsnCnt--;if(chtSsn.oContext){chtSsn.oContext.sChtId=sChtId;chtSsn.oContext.iInt=0}if(chtSsn.oChtWin){chtSsn.oChtWin.sChtId=sChtId;chtSsn.oChtWin.iInt=0}Owa.UIControls.ActiveChatsDialog.getDialog().updateChat(sIntChtId,chtSsn.sChtId)};Owa.IM.IMMgr.prototype.ReplaceChtId=function Owa$IM$IMMgr$ReplaceChtId(chtSsn,sChtId){var sOldChtId=chtSsn.sChtId;chtSsn.sChtId=sChtId;this.chtSsns[sChtId]=chtSsn;this.chtSsns[sOldChtId]=0;if(chtSsn.oContext){chtSsn.oContext.sChtId=sChtId}if(chtSsn.oChtWin){chtSsn.oChtWin.sChtId=sChtId}Owa.UIControls.ActiveChatsDialog.getDialog().updateChat(sOldChtId,chtSsn.sChtId)};Owa.IM.IMMgr.prototype.MkChtSsnIdle=function Owa$IM$IMMgr$MkChtSsnIdle(sChtId,fChangeId){var sNewChatId=sChtId;var chtSsn=this.chtSsns[sChtId];if(!chtSsn)return;if(fChangeId){sNewChatId=rndm()}chtSsn.sChtId=sNewChatId;chtSsn.iInt=1;this.intChtSsns[sNewChatId]=chtSsn;this.intChtSsnCnt++;this.chtSsns[sChtId]=0;this.chtSsnCnt--;if(chtSsn.oContext){chtSsn.oContext.sChtId=sNewChatId;chtSsn.oContext.iInt=1}try{if(chtSsn.oChtWin){chtSsn.oChtWin.iInt=1;chtSsn.oChtWin.sChtId=sNewChatId;chtSsn.oChtWin.UpdActBarLstMsg()}}catch(e){}if(sChtId!=sNewChatId){var oActiveChatsDialog=Owa.UIControls.ActiveChatsDialog.getDialog();if(oActiveChatsDialog){oActiveChatsDialog.updateChat(sChtId,sNewChatId)}}};Owa.IM.IMMgr.prototype.GtChtSsn=function Owa$IM$IMMgr$GtChtSsn(sChtId){if(!isDf(typeof(sChtId))||!sChtId)return 0;var oChtSsn=0;oChtSsn=this.intChtSsns[sChtId];if(!isDf(typeof(oChtSsn))||!oChtSsn)oChtSsn=this.chtSsns[sChtId];if(!isDf(typeof(oChtSsn)))return 0;else return oChtSsn};Owa.IM.IMMgr.prototype.LdExstChtSsn=function Owa$IM$IMMgr$LdExstChtSsn(sUri,sSub,fIn,sChtId){var oChtSsn=this.FndExstChtSsn(sUri,fIn,sChtId);if(oChtSsn&&(oChtSsn.iSsnState==Owa.IM.CHT_SSN_ST_RDY||oChtSsn.iSsnState==Owa.IM.CHT_SSN_ST_INIT)){if(sSub&&oChtSsn.sSub!=sSub){oChtSsn.UpdSub(sSub);try{oChtSsn.oChtWin.UpdHdr(sSub)}catch(e){gtIMMgr().EndChtSsn(oChtSsn.sChtId);return 0}}if(oChtSsn.iSsnState==Owa.IM.CHT_SSN_ST_RDY){try{oChtSsn.oChtWin.Focus()}catch(e){gtIMMgr().EndChtSsn(oChtSsn.sChtId);return 0}}return oChtSsn}};Owa.IM.IMMgr.prototype.FndExstChtSsn=function Owa$IM$IMMgr$FndExstChtSsn(sUri,fIn,sChtId){if(!isDf(typeof(sUri))||!sUri)return 0;var oChtSsn,sTmpChtId;for(sTmpChtId in this.intChtSsns){oChtSsn=this.intChtSsns[sTmpChtId];if(oChtSsn&&!oChtSsn.fIsConf&&this.AssmChtSsn(oChtSsn,sUri,fIn,sChtId)){return oChtSsn}}for(sTmpChtId in this.chtSsns){oChtSsn=this.chtSsns[sTmpChtId];if(oChtSsn&&!oChtSsn.fIsConf&&this.AssmChtSsn(oChtSsn,sUri,fIn,sChtId)){return oChtSsn}}return 0};Owa.IM.IMMgr.prototype.AssmChtSsn=function Owa$IM$IMMgr$AssmChtSsn(oChtSsn,sUri,fIn,sChtId){var fRet=0;if(!isDf(typeof(sUri))||!sUri||!isDf(typeof(oChtSsn))||!oChtSsn)return 0;var utParticipants=oChtSsn._utParticipants;var iRecipCount=utParticipants.Count();var fHasOnlyUser=0;if(iRecipCount==0&&oChtSsn.rgoMsgCch&&oChtSsn.rgoMsgCch.length){var rgoMsgCch=oChtSsn.rgoMsgCch;var oCachedRecipTable=new Owa.IM.UriTable();for(var index=0;index<rgoMsgCch.length;index++){var oMsg=rgoMsgCch[index];if(oMsg.iMsgTp==Owa.IM.CHT_ADD_PCP){var oRecip=oMsg.o;oCachedRecipTable.Set(oRecip._uri,oRecip)}}if(oCachedRecipTable.Count()==1){fHasOnlyUser=oCachedRecipTable.Get(sUri)}}else if(iRecipCount==1){fHasOnlyUser=utParticipants.Get(sUri)}if(!isDf(typeof(fIn))&&!fIn){return(fHasOnlyUser?1:0)}if(fHasOnlyUser){if(!oChtSsn.iInt){this.ReplaceChtId(oChtSsn,sChtId)}return 1}return 0};Owa.IM.IMMgr.prototype.GtChtSsnCnt=function Owa$IM$IMMgr$GtChtSsnCnt(){return this.intChtSsnCnt+this.chtSsnCnt};Owa.IM.IMMgr.prototype.UpdChtTtl=function Owa$IM$IMMgr$UpdChtTtl(sChtId,sNwTtl,sUri,sDN){if(!sChtId)return;var oChtSsn=this.GtChtSsn(sChtId);if(oChtSsn){if(sUri&&sDN&&oChtSsn._utParticipants){var oRecip=oChtSsn._utParticipants.Get(sUri);if(oRecip){oRecip._dn=sDN}}if(!sNwTtl){sNwTtl=oChtSsn.CalcTtl()}oChtSsn.UpdSub(sNwTtl);if(oChtSsn.oChtWin){oChtSsn.oChtWin.UpdHdr(sNwTtl)}Owa.UIControls.ActiveChatsDialog.getDialog().updateParticipants(sChtId,oChtSsn.CalcAllDisplayNames())}};Owa.IM.IMMgr.prototype.EndChtSsn=function Owa$IM$IMMgr$EndChtSsn(sChtId){if(!isDf(typeof(sChtId))||!sChtId)return;var isInt=this.IsIntCht(sChtId);if(isInt==-1)return;if(isInt){var oChtSsn=this.intChtSsns[sChtId];oChtSsn.End();delete oChtSsn;this.intChtSsns[sChtId]=0;this.intChtSsnCnt--}else{var oChtSsn=this.chtSsns[sChtId];var utParticipants=oChtSsn._utParticipants;var sUri;var fDisc=0;for(sUri in utParticipants.Keys()){if(gtIMMgr().IsBlkd(sUri)){fDisc=1}}var oRCtx={};oRCtx.sChtId=sChtId;oRCtx.fDisc=fDisc;sndIMReq(IM_ECS,0,0,oRCtx);oChtSsn.End();delete oChtSsn;this.chtSsns[sChtId]=0;this.chtSsnCnt--}Owa.UIControls.ActiveChatsDialog.getDialog().removeChat(sChtId)};Owa.IM.IMMgr.prototype.EnableAllChatSessions=function Owa$IM$IMMgr$EnableAllChatSessions(){var sChtId,oChtSsn;for(sChtId in this.chtSsns){oChtSsn=this.chtSsns[sChtId];if(oChtSsn&&oChtSsn.oChtWin&&!oChtSsn.fIsConf){oChtSsn.oChtWin.Enable()}}for(sChtId in this.intChtSsns){oChtSsn=this.intChtSsns[sChtId];if(oChtSsn&&oChtSsn.oChtWin&&!oChtSsn.fIsConf){oChtSsn.oChtWin.Enable()}}};Owa.IM.IMMgr.prototype.DsblAllChtsSsns=function Owa$IM$IMMgr$DsblAllChtsSsns(){var sChtId,oChtSsn;for(sChtId in this.intChtSsns){oChtSsn=this.intChtSsns[sChtId];if(oChtSsn&&oChtSsn.oChtWin){oChtSsn.oChtWin.Disable()}}for(sChtId in this.chtSsns){oChtSsn=this.chtSsns[sChtId];if(oChtSsn){if(oChtSsn.oChtWin){oChtSsn.oChtWin.Disable()}gtIMMgr().MkChtSsnIdle(oChtSsn.sChtId,true)}}};Owa.IM.IMMgr.prototype.removeAllBuddies=function Owa$IM$IMMgr$removeAllBuddies(){if(g_oBddyLst&&this.bdyLst){var rgGroupIDs=this.bdyLst.GetGroups();for(var sGroupID in rgGroupIDs){g_oBddyLst.removeGroup(sGroupID)}Owa.IM.BdyGrp.sOtherContactsID=null;if(g_oBddyLst._edting){g_oBddyLst.qtEdtNd()}}this.bdyLst=new Owa.IM.BdyLst()};Owa.IM.IMMgr.prototype.ErrMaxChats=function Owa$IM$IMMgr$ErrMaxChats(iIncoming){if(!isDf(typeof(iIncoming))||!iIncoming)alrt(L_MaxChat.replace(/\{0\}/,Owa.IM.MAX_CHT_SSNS));else alrt(L_MaxIncomingChat.replace(/\{0\}/,Owa.IM.MAX_CHT_SSNS))};Owa.IM.IMMgr.prototype.Chk=function Owa$IM$IMMgr$Chk(){return 1};Owa.IM.IMMgr.prototype.Disp=function Owa$IM$IMMgr$Disp(){this.bdyLst=this.othrsLst=this.blkLst=this.intChtSsns=this.intChtSsnCnt=this.chtSsns=this.chtSsnCnt=null}})();(function(){Owa.IM.CHT_SSN_ST_NONE=0;Owa.IM.CHT_SSN_ST_INIT=1;Owa.IM.CHT_SSN_ST_RDY=3;Owa.IM.CHT_SSN_ST_CLSNG=4;Owa.IM.CHT_WIN_ST_NONE=0;Owa.IM.CHT_WIN_ST_OPNNG=1;Owa.IM.CHT_WIN_ST_RDY=2;Owa.IM.CHT_WIN_ST_CLSNG=3;Owa.IM.CHT_MSG=0;Owa.IM.CHT_RCP=1;Owa.IM.CHT_IN=4;Owa.IM.CHT_MSG_NRM=0;Owa.IM.CHT_ADD_PCP=2;Owa.IM.CHT_RMV_PCP=3;Owa.IM.ACT_NONE=0;Owa.IM.ACT_TYPNG=1;Owa.IM.ACT_STPTYPNG=2;Owa.IM.ACT_TWOTYPNG=3;Owa.IM.ACT_UJOINDCHT=4;Owa.IM.ACT_LSTMSG=5;Owa.IM.ACT_EXTUSR=6;Owa.IM.ACT_LSTACTBR=7;Owa.IM.ACT_CHTSUB=8;Owa.IM.ACT_OJOINDCHT=9;Owa.IM.ACT_OLFTCHT=10;Owa.IM.ACT_FAILINV=11;Owa.IM.ACT_FAILMSGDLV=12;Owa.IM.ACT_FAILMSGDLVSRVRPLCY=13;Owa.IM.ACT_EVERYONELEFT=14;Owa.IM.ACT_LSTACTMSG=15;Owa.IM.CHT_TYPNG_TMR=3000;Owa.IM.CHT_MSN_TYPNG_TMR=7000;Owa.IM.CHT_FLSH_TMR=1000;Owa.IM.CHT_FLSH_MAX=10;Owa.IM.ChtSsn=function Owa$IM$ChtSsn(sChtId,oC){this.iSsnState=oC.iS;this.sChtId=oC.sChtId;this.iInt=oC.iInt;this.fUseExistingTitle=oC.fUseExistingTitle;if(oC.sLDN)this.sLDN=oC.sLDN;if(!this.fUseExistingTitle){var utDisplayNameParticipants=new Owa.IM.UriTable();utDisplayNameParticipants.Set(oC.oRcp._uri,oC.oRcp);this.sSub=this.CalcTtl(utDisplayNameParticipants)}else{this.sSub=((isDf(typeof(oC.sSub))&&oC.sSub)?oC.sSub:"")}oC.sSub=this.sSub;this.fIsConf=(isDf(typeof(oC.fIsConf)))?oC.fIsConf:0;this.rgoMsgCch=[];this._utParticipants=new Owa.IM.UriTable();if(oC.oRcp&&!isSlfUri(oC.oRcp._uri))this.AddRcp(oC.oRcp,oC.fNN);this.iWinState=Owa.IM.CHT_WIN_ST_NONE;this.fIsPopOut=1;this.oContext=oC};Owa.IM.ChtSsn.prototype.OpenWindow=function Owa$IM$ChtSsn$OpenWindow(fPreventFocus){if(this.oChtWin&&!fPreventFocus){try{this.oChtWin.Focus()}catch(e){}}else if(!this.domWin){var sParameters=this.oContext&&this.oContext.fNotUserActivity?"?UA=0&ae=Dialog&t=ChatWindow":"?ae=Dialog&t=ChatWindow";var oMasterWindow=gtMstr();var fUseActiveWindow=Owa.Utility.isIE();if(fUseActiveWindow&&oMasterWindow&&oMasterWindow.g_winMgr){var oActiveWindow=oMasterWindow.g_winMgr.GetActiveWindow();if(oActiveWindow&&oActiveWindow.location.href.indexOf("t=ChatWindow")>=0){fUseActiveWindow=false}}this.oChtWin=0;this.domWin=opnWin(sParameters+gtCCUrl(),470,376,0,this.sChtId,0,1,Owa.Components.Application.get_RootSubPage(),null,fUseActiveWindow,1)}if(!this.domWin){Owa.UIControls.ActiveChatsDialog.getDialog().show()}};Owa.IM.ChtSsn.prototype.UpdWinState=function Owa$IM$ChtSsn$UpdWinState(oChtWin,iState){this.iWinState=iState;this.oChtWin=oChtWin};Owa.IM.ChtSsn.prototype.CalcAllDisplayNames=function Owa$IM$ChtSsn$CalcAllDisplayNames(utDisplayNameParticipants){var sDisplayNames="";var utParticipants,sUri;if(utDisplayNameParticipants){utParticipants=utDisplayNameParticipants}else{utParticipants=this._utParticipants}for(sUri in utParticipants.Keys()){var oRecip=utParticipants.Get(sUri);if(!oRecip){continue}if(sDisplayNames){sDisplayNames+=", "}sDisplayNames+=oRecip._dn}return sDisplayNames};Owa.IM.ChtSsn.prototype.CalcTtl=function Owa$IM$ChtSsn$CalcTtl(utDisplayNameParticipants){if(!this.fUseExistingTitle){return this.CalcAllDisplayNames(utDisplayNameParticipants)}else{return this.sSub}};Owa.IM.ChtSsn.prototype.InMsg=function Owa$IM$ChtSsn$InMsg(sUri,sMsg,sFrmt,fNC){if(!fNC){this.OpenWindow(true);Owa.UIControls.ActiveChatsDialog.getDialog().updateChat(this.sChtId,null,null,sMsg)}if(!this.ChtWinRdy()&&(!isDf(typeof(fNC))||!fNC)){this.AddMsgToCch(Owa.IM.CHT_MSG_NRM,sUri,sMsg,sFrmt);return}var oRcp=this._utParticipants.Get(sUri);var sNm;if(!oRcp){if(isMSNPrv()){if(isSlfUri(sUri))sNm=gtDN()}else return}else sNm=oRcp._dn;if(!sNm){sNm=sUri}try{this.oChtWin.InMsg(sNm,sMsg,sFrmt);if(!this.oChtWin.isFcsed){this.oChtWin.Blnk();Owa.UIControls.ActiveChatsDialog.getDialog().fadeInFadeOut()}}catch(e){}};Owa.IM.ChtSsn.prototype.InActMsg=function Owa$IM$ChtSsn$InActMsg(iAct,sUri,sNm,sFrmt,sSub,sHr,sTxt){if(!this.ChtWinRdy())return;if(!isDf(typeof(sNm))||!sNm)sNm=this.GtPrNm(sUri);if(iAct<Owa.IM.ACT_LSTACTBR)try{this.oChtWin.InActBarMsg(iAct,sUri,sNm)}catch(e){}else if(iAct>Owa.IM.ACT_LSTACTBR)try{this.oChtWin.InActMsg(iAct,sNm,sFrmt,sSub,sHr,sTxt)}catch(e){}};Owa.IM.ChtSsn.prototype.GtPrNm=function Owa$IM$ChtSsn$GtPrNm(sUri){if(!isDf(typeof(sUri))||!sUri)return"";var oRcp=this._utParticipants.Get(sUri);if(!oRcp||!isDf(typeof(oRcp._dn))||!oRcp._dn)return Owa.IM.IMUtils.NrmSipUri(sUri);else return oRcp._dn};Owa.IM.ChtSsn.prototype.ChtWinRdy=function Owa$IM$ChtSsn$ChtWinRdy(){if(this.oChtWin&&this.iWinState==Owa.IM.CHT_WIN_ST_RDY)return 1;else return 0};Owa.IM.ChtSsn.prototype.AddMsgToCch=function Owa$IM$ChtSsn$AddMsgToCch(iMsgTp,sUri,sMsg,sFrmt){var oMsg={};oMsg.iMsgTp=iMsgTp;oMsg.sUri=sUri;oMsg.sMsg=sMsg;oMsg.sFrmt=sFrmt;this.rgoMsgCch.push(oMsg)};Owa.IM.ChtSsn.prototype.AddRcpAddMsgToCch=function Owa$IM$ChtSsn$AddRcpAddMsgToCch(o,fNN,fWin){var oMsg={};oMsg.iMsgTp=Owa.IM.CHT_ADD_PCP;oMsg.o=o;oMsg.fNN=fNN;oMsg.fWin=fWin;this.rgoMsgCch.push(oMsg)};Owa.IM.ChtSsn.prototype.AddRcpRmMsgToCch=function Owa$IM$ChtSsn$AddRcpRmMsgToCch(sUri){if(sUri){var oMsg={};oMsg.iMsgTp=Owa.IM.CHT_RMV_PCP;oMsg.sUri=sUri;this.rgoMsgCch.push(oMsg)}};Owa.IM.ChtSsn.prototype.FlshMsgCch=function Owa$IM$ChtSsn$FlshMsgCch(){for(var i=0;i<this.rgoMsgCch.length;i++){var oMsg=this.rgoMsgCch[i];if(oMsg.iMsgTp==Owa.IM.CHT_MSG_NRM){this.InMsg(oMsg.sUri,oMsg.sMsg,oMsg.sFrmt,1)}else if(oMsg.iMsgTp==Owa.IM.CHT_ADD_PCP){this.AddRcp(oMsg.o,oMsg.fNN,oMsg.fWin)}else if(oMsg.iMsgTp==Owa.IM.CHT_RMV_PCP){this.RmRcp(oMsg.sUri)}}this.rgoMsgCch=[]};Owa.IM.ChtSsn.prototype.UpdSub=function Owa$IM$ChtSsn$UpdSub(sSub){if(isDf(typeof(sSub))&&sSub)this.sSub=sSub};Owa.IM.ChtSsn.prototype.AddRcp=function Owa$IM$ChtSsn$AddRcp(o,fNN,fWin){if(!this.ChtWinRdy()){this.AddRcpAddMsgToCch(o,fNN,fWin);return 1}if(!o||!isDf(typeof(o._uri))||!o._uri||this._utParticipants.Get(o._uri))return 0;var oRcp;if(isDf(typeof(fNN))&&fNN)oRcp=o;else oRcp=new Recip(o._dn,o._em,o._sa,o._al,o._rt,o._ao,o._id,o._rf,o._ei,o._uri,o._type);if(isDf(typeof(fWin))&&fWin&&this.ChtWinRdy()){this.oChtWin.AddRcp(oRcp);this.InActMsg(imns.ACT_OJOINDCHT,oRcp._uri,oRcp._dn);if(gtIMMgr().gtPrsnc(oRcp._uri)==gtDfltPrsnc())gtIMMgr().SubPrsnc([oRcp._uri])}this._utParticipants.Set(o._uri,oRcp);if(this._utParticipants.Count()>1)this.fIsConf=1;this.lstMsgName=0;return 1};Owa.IM.ChtSsn.prototype.IsRcp=function Owa$IM$ChtSsn$IsRcp(sUri){if(!isDf(typeof(sUri))||!sUri)return 0;return(!this._utParticipants.Get(sUri)?0:1)};Owa.IM.ChtSsn.prototype.UpdRcpSip=function Owa$IM$ChtSsn$UpdRcpSip(sStlUri,sUri){if(!isDf(typeof(sUri))||!sUri)return;if(!isDf(typeof(sStlUri))||!sStlUri)return;var o=this._utParticipants.Get(sStlUri);if(o){o._uri=sUri;this.oChtWin.AddRcp(o);this.oChtWin.RmRcp(sStlUri);if(gtIMMgr().gtPrsnc(o._uri)==gtDfltPrsnc()){gtIMMgr().SubPrsnc([o._uri])}this._utParticipants.Remove(sStlUri,true);this._utParticipants.Set(o._uri,o)}};Owa.IM.ChtSsn.prototype.RmRcp=function Owa$IM$ChtSsn$RmRcp(sUri){if(!sUri){return 0}if(!this.ChtWinRdy()){this.AddRcpRmMsgToCch(sUri);return 1}if(!this.fIsConf&&this._utParticipants.Count()<2){return 0}if(this.IsRcp(sUri)&&this.ChtWinRdy()){this.oChtWin.RmRcp(sUri);var sDn="";var oRecip=this._utParticipants.Get(sUri);if(oRecip){sDn=oRecip.dn}this.InActMsg(imns.ACT_OLFTCHT,sUri,sDn);this._utParticipants.Remove(sUri,true)}else if(this.fIsConf&&isSlfUri(sUri)){var sDn=gtDN();this.InActMsg(imns.ACT_OLFTCHT,sUri,sDn);this.oChtWin.Disable()}if(this.fIsConf&&this._utParticipants.Count()==0){this.InActMsg(imns.ACT_EVERYONELEFT);this.oChtWin.Disable()}this.lstMsgName=0;return 1};Owa.IM.ChtSsn.prototype.End=function Owa$IM$ChtSsn$End(){this.iSsnState=Owa.IM.CHT_SSN_ST_CLSNG;this.Disp();this.iSsnState=Owa.IM.CHT_SSN_ST_NONE};Owa.IM.ChtSsn.prototype.Disp=function Owa$IM$ChtSsn$Disp(){this.iSsnState=this.sChtId=this.sSub=this.iInt=this.rgoMsgCch=this._utParticipants=this.iWinState=this.fIsPopOut=this.domWin=this.oChtWin=null}})();(function(){Owa.IM.ChtWin=function Owa$IM$ChtWin(fIsPopOut,oDocumentElement,sChtId){this.fIsPopOut=fIsPopOut;this.oDocumentElement=oDocumentElement;this.sChtId=sChtId};Owa.IM.ChtWin.prototype.Load=function Owa$IM$ChtWin$Load(){this.sDN=gtDN();this.hdr=0;this.rw=$(TO);this.rdArea=this.oDocumentElement.getDescendantById("rdArea");this.rdArea.attachEvent("keydown",SlctRdArea);this.txtBox=new Owa.IM.CmpArea(this.oDocumentElement.getDescendantById("txtBox"),this);this.btnSnd=new Owa.IM.BtnSnd(this.oDocumentElement.getDescendantById("btnSnd"),this.txtBox);this.lstInMsgTime=0;this.lstMsgName=0;this.fLMA=0;this.oFlshTmr=0;this.iFlshCnt=0;this._utTypingList=new Owa.IM.UriTable();this.isFcsed=1;this.chtSsn=0;try{this.chtSsn=gtIMMgr().GtChtSsn(this.sChtId);if(this.chtSsn){this.chtSsn.UpdWinState(this,Owa.IM.CHT_WIN_ST_RDY)}}catch(e){}};Owa.IM.ChtWin.prototype.PostOnLoad=function Owa$IM$ChtWin$PostOnLoad(oC){if(!oC)return;switch(oC.iNtry){case Owa.IM.CHT_MSG:case Owa.IM.CHT_RCP:if(isDf(typeof(oC.oRcp))&&oC.oRcp){if(!isDf(typeof(oC.oRcp._uri))||!oC.oRcp._uri)return;this.AddRcp(oC.oRcp);if(this.chtSsn)this.chtSsn.AddRcp(oC.oRcp)}break;case Owa.IM.CHT_IN:if(isDf(typeof(oC.oRcp))&&oC.oRcp&&!isSlfUri(oC.oRcp._uri)){this.AddRcp(oC.oRcp);if(this.chtSsn)this.chtSsn.AddRcp(oC.oRcp)}if(isDf(typeof(oC.rgoRcp))&&oC.rgoRcp&&oC.rgoRcp.length>0){var o=oC.rgoRcp;var oRcp;for(var i=0;i<o.length;i++){oRcp=o[i];if(!isDf(typeof(oRcp._uri))||!oRcp._uri)continue;if(isDf(typeof(oC.oRcp._uri))&&oC.oRcp._uri){if(isSameUri(oRcp._uri,oC.oRcp._uri))continue}this.AddRcp(oRcp);if(this.chtSsn)this.chtSsn.AddRcp(oRcp,1)}}if(isDf(typeof(oC.sMsg))&&oC.sMsg)this.InMsg(oC.oRcp._dn,oC.sMsg,oC.sFrmt);break;default:break}if(this.chtSsn.FlshMsgCch){this.chtSsn.FlshMsgCch()}try{gtIMMgr().UpdChtTtl(this.chtSsn.sChtId)}catch(e){}this.txtBox.SetFocus();this.chtSsn.iSsnState=Owa.IM.CHT_SSN_ST_RDY};Owa.IM.ChtWin.prototype.RmRcp=function Owa$IM$ChtWin$RmRcp(sUri){removeRcpForIM(this.rw,sUri)};Owa.IM.ChtWin.prototype.AddRcp=function Owa$IM$ChtWin$AddRcp(oRcp){if(oRcp){addRcpForIM(this.rw,oRcp._dn,oRcp._em,oRcp._rt,oRcp._sa,oRcp._ao,oRcp._rf,oRcp._id,oRcp._ei,oRcp._uri)}if(isDf(typeof(onChatWinResize))){onChatWinResize()}};Owa.IM.ChtWin.prototype.ShwABCht=function Owa$IM$ChtWin$ShwABCht(){var oP={};var divTo=wda("divTo");oP.sTo=divTo.innerHTML;oP.sTgt="divTo";shwDlg("AddressBook",a_iABW,a_iABH,DLG_MOD|DLG_CTR|DLG_RSZ,oP,"&a=PickParticipants");setRwHtml(divTo,oP.sTo);revtRSpn()};Owa.IM.ChtWin.prototype.UpdHdr=function Owa$IM$ChtWin$UpdHdr(sHdr){if(!isDf(typeof(this.hdr))||!this.hdr){this.hdr=this.oDocumentElement.getDescendantById("divChatHdr")}if(this.hdr){this.hdr.set_TextContent(sHdr)}if(isDf(typeof(onChatWinResize))){onChatWinResize()}this.UpdTtl(sHdr)};Owa.IM.ChtWin.prototype.UpdTtl=function Owa$IM$ChtWin$UpdTtl(sTtl){if(!isDf(typeof(sTtl)||!sTtl))return;this.sTtl=sTtl;if(isDf(typeof(window.a_fChtWin))&&window.a_fChtWin)document.title=sTtl;this.sFlshTtl=L_NwMsgs+" - "+this.sTtl};Owa.IM.ChtWin.prototype.InMsg=function Owa$IM$ChtWin$InMsg(sNm,sMsg,sFrmt,oDt){var oDt=new Date();var ret=this.InsRdMsg(sNm,sMsg,sFrmt,oDt);if(ret)this.lstInMsgTime=oDt;this.UpdActBarLstMsg()};Owa.IM.ChtWin.prototype.InActBarMsg=function Owa$IM$ChtWin$InActBarMsg(iAct,sUri,sNm){if(iAct>=Owa.IM.ACT_LSTACTBR)return;switch(iAct){case Owa.IM.ACT_TYPNG:if(!this._utTypingList.Get(sUri)){this._utTypingList.Set(sUri,sNm)}this.ProcTypngMsg();break;case Owa.IM.ACT_STPTYPNG:if(this._utTypingList.Get(sUri)){this._utTypingList.Remove(sUri)}this.ProcTypngMsg();break;default:this.UpdActBar(iAct,sNm);break}};Owa.IM.ChtWin.prototype.ProcTypngMsg=function Owa$IM$ChtWin$ProcTypngMsg(){var iTypingListCount=this._utTypingList.Count();if(iTypingListCount==0){this.UpdActBarLstMsg()}else if(iTypingListCount==1){for(var sUri in this._utTypingList.Keys()){var sNm=this._utTypingList.Get(sUri);if(sNm){this.UpdActBar(imns.ACT_TYPNG,sNm)}break}}else if(iTypingListCount>1){this.UpdActBar(imns.ACT_TWOTYPNG)}};Owa.IM.ChtWin.prototype.InActMsg=function Owa$IM$ChtWin$InActMsg(iAct,sNm,sFrmt,sSub,sHr,sTxt){if(iAct<=Owa.IM.ACT_LSTACTBR||iAct>=Owa.IM.ACT_LSTACTMSG)return;var sIcn,sMsg;var sStl="";var fBDR=1;var fLnk=0;switch(iAct){case Owa.IM.ACT_CHTSUB:sIcn=getThmF("chat-arw.gif");if(!isDf(typeof(sSub))||!sSub)sSub="";sMsg=htmlEnc(L_ChtSubLnk.replace(/\{0\}/,sSub));if(isDf(typeof(sHr))&&sHr)sMsg+="<A class='oLnk' id='aLnk' _lnk='"+htmlEnc(sHr)+"'>"+htmlEnc(" "+L_ChtSubClk)+"</A>";fLnk=1;fBDR=0;break;case Owa.IM.ACT_OJOINDCHT:sIcn=getThmF("joinchat.gif");sMsg=htmlEnc(sNm+" "+L_OJoindCht);sStl="color:#006633;";break;case Owa.IM.ACT_OLFTCHT:sIcn=getThmF("leftchat.gif");sMsg=htmlEnc(sNm+" "+L_OLftCht);sStl="color:#8b0000;";break;case Owa.IM.ACT_FAILINV:sIcn=getThmF("failinv.gif");sMsg=htmlEnc(L_FailInv.replace(/\{0\}/,sNm));sStl="color:#8b0000;";break;case Owa.IM.ACT_EVERYONELEFT:sIcn=getThmF("leftchat.gif");sMsg=htmlEnc(L_AllParticipantsLeft);sStl="color:#8b0000;";break;case Owa.IM.ACT_FAILMSGDLV:case Owa.IM.ACT_FAILMSGDLVSRVRPLCY:sIcn=getThmF("leftchat.gif");if(iAct==Owa.IM.ACT_FAILMSGDLV)sMsg=htmlEnc(L_FailDeliv);else sMsg=htmlEnc(L_FailDelivSrvrPlcy);sStl="color:#8b0000;";if(isDf(typeof(sHr))&&sHr)sMsg+="<A class='oLnk' id='aLnk' _lnk='"+htmlEnc(sHr)+"'>"+htmlEnc(" "+L_FailDelivClk)+"</A>";fLnk=0;if(isDf(typeof(sTxt))&&sTxt)sMsg+=htmlEnc(" "+sTxt);break;default:break}var sRow=((this.fLMA||!fBDR)?"":"<div style='border-top:1px solid #999999;width:50;font-size:20%;'>&nbsp;</div>")+"<table><tr><td valign=top class='chtArrw'><img class='imgCht' src='"+sIcn+"'></td><td id='tdChtMsg' class='chtMsg' style='"+sStl+"'>"+sMsg+"</td></tr></table>"+(fBDR?"<div style='margin:5 0 0 0;border-top:1px solid #999999;width:50;font-size:0%;'>&nbsp;</div>":"");var oPara=Owa.Dom.Document.get_Current().createElement("div");this.rdArea.appendChild(oPara);oPara.set_InnerHtml(sRow);oPara._get_DomNode().style.marginTop="4";if(fLnk){var oLink=oPara.getDescendantById("aLnk");if(oLink){oLink.attachEvent("click",function(){if(isDf(typeof(oLink._lnk))&&oLink._lnk){opnWin(oLink._lnk)}})}}if(fBDR){this.fLMA=1}this.ScToBtm()};Owa.IM.ChtWin.prototype.OutGoingMsg=function Owa$IM$ChtWin$OutGoingMsg(sMsg,sFrmt){this.InsRdMsg(this.sDN,sMsg,sFrmt)};Owa.IM.ChtWin.prototype.UpdActBar=function Owa$IM$ChtWin$UpdActBar(iAct,sNm){if(!isDf(typeof(this.oTypng))||!this.oTypng)this.oTypng=$("divTypng");if(!isDf(typeof(this.oJoin))||!this.oJoin)this.oJoin=$("divJoin");if(!isDf(typeof(this.oLstMsg))||!this.oLstMsg)this.oLstMsg=$("divLstMsg");switch(iAct){case Owa.IM.ACT_NONE:this.oJoin.set_IsShown(false);this.oLstMsg.set_IsShown(false);this.oTypng.set_IsShown(false);break;case Owa.IM.ACT_TYPNG:if(!isDf(typeof(sNm))||!sNm||sNm=="")return;this.oJoin.set_IsShown(false);this.oLstMsg.set_IsShown(false);this.oTypng.getChildById("typInd").set_TextContent(sNm+" "+L_IsTypng);this.oTypng.set_IsShown(true);break;case Owa.IM.ACT_TWOTYPNG:this.oJoin.set_IsShown(false);this.oLstMsg.set_IsShown(false);this.oTypng.getChildById("typInd").set_TextContent(L_TwoTypng);this.oTypng.set_IsShown(true);break;case Owa.IM.ACT_UJOINDCHT:this.oTypng.set_IsShown(false);this.oLstMsg.set_IsShown(false);this.oJoin.getChildById("joinInd").set_TextContent(L_UJoindCht);this.oJoin.set_IsShown(true);break;case Owa.IM.ACT_LSTMSG:this.oJoin.set_IsShown(false);this.oTypng.set_IsShown(false);var oDt=this.lstInMsgTime;if(!oDt){this.oLstMsg.set_IsShown(false);return}var sDt=fmtDt(oDt,a_sFlWkdDtFmt,1);var sOn=L_On+" ";var sTm=fmtDt(oDt,a_sShtTmFmt,1);this.oLstMsg.getChildById("lstMsgInd").set_TextContent(L_LstMsg.replace(/\{0\}/,sOn).replace(/\{1\}/,sDt).replace(/\{2\}/,sTm));this.oLstMsg.set_IsShown(true);break;case Owa.IM.ACT_EXTUSR:break;default:return}};Owa.IM.ChtWin.prototype.UpdActBarLstMsg=function Owa$IM$ChtWin$UpdActBarLstMsg(){if(this.lstInMsgTime)this.UpdActBar(imns.ACT_LSTMSG);else this.ClrActBar()};Owa.IM.ChtWin.prototype.ClrActBar=function Owa$IM$ChtWin$ClrActBar(){this.UpdActBar(imns.ACT_NONE)};Owa.IM.ChtWin.prototype.InsRdMsg=function Owa$IM$ChtWin$InsRdMsg(sNm,sMsg,sFrmt,oDt){if(!isDf(typeof(sNm))||!sNm)return 0;if(!isDf(typeof(sMsg))||!sMsg)return 0;if(this.lstMsgName!=sNm)this.InsRdMsgHdr(sNm,oDt);this.InsRdMsgCnt(sMsg,sFrmt);this.ScToBtm();this.fLMA=0;return 1};Owa.IM.ChtWin.prototype.InsRdMsgHdr=function Owa$IM$ChtWin$InsRdMsgHdr(sNm,oDt){if(!isDf(typeof(oDt))||!oDt)oDt=new Date();var sTm=fmtDt(oDt,a_sShtTmFmt,1);var sRow=htmlEnc(sNm)+" "+g_sDE+"["+sTm+"]"+g_sDE+":";var oPara=Owa.Dom.Document.get_Current().createElement("div");this.rdArea.appendChild(oPara);oPara.set_InnerHtml(sRow);oPara.addCssClass("chtRdHdr");this.lstMsgName=sNm};Owa.IM.ChtWin.prototype.InsRdMsgCnt=function Owa$IM$ChtWin$InsRdMsgCnt(sMsg,sFrmt){sMsg=this.htmlEnc(sMsg);var MAX_CHAR_LENGTH=15;if(sMsg&&(Owa.Utility.isFirefox())){var rgWords=sMsg.split(' ');for(var i=0;i<rgWords.length;i++){if((rgWords[i])&&(rgWords[i].length>MAX_CHAR_LENGTH)){var iIndex=MAX_CHAR_LENGTH;var sTemp=rgWords[i];while(iIndex<sTemp.length){sTemp=sTemp.substring(0,iIndex)+"<wbr>"+sTemp.substring(iIndex);iIndex+=MAX_CHAR_LENGTH+5}rgWords[i]=sTemp}}sMsg=rgWords.join(' ')}var sRow="<table style=\"table-layout: fixed;\"><tr>"+"<td style=\"width: 4px;\" valign=top>"+"<img class='imgCht' src='"+getThmF("chat-arw.gif")+"'></td><td id='tdChtMsg' class='chtMsg'>"+"<pre style=\"margin: 0px; word-wrap: break-word;\">"+sMsg+"</pre>"+"</td></tr></table>";var oPara=Owa.Dom.Document.get_Current().createElement("div");this.rdArea.appendChild(oPara);oPara.set_InnerHtml(sRow)};Owa.IM.ChtWin.prototype.htmlEnc=function Owa$IM$ChtWin$htmlEnc(str){str=str.replace(new RegExp("&","g"),"&amp;");str=str.replace(new RegExp("<","g"),"&lt;");str=str.replace(new RegExp(">","g"),"&gt;");return str};Owa.IM.ChtWin.prototype.ScToBtm=function Owa$IM$ChtWin$ScToBtm(){this.rdArea.set_ScrollTop(this.rdArea.get_ScrollHeight())};Owa.IM.ChtWin.prototype.Blnk=function Owa$IM$ChtWin$Blnk(fS){if(this.fIsPopOut){if(isDf(typeof(fS))&&fS){if(this.oFlshTmr){window.clearInterval(this.oFlshTmr);this.oFlshTmr=0;this.iFlshCnt=0}document.title=this.sTtl}else{this.sFlshTtl=L_NwMsgs+" - "+this.sTtl;if(!this.oFlshTmr)this.oFlshTmr=window.setInterval(FlshTtl,Owa.IM.CHT_FLSH_TMR)}}};Owa.IM.ChtWin.prototype.FlshTtl=function Owa$IM$ChtWin$FlshTtl(){if(this.iFlshCnt>=Owa.IM.CHT_FLSH_MAX*2){window.clearInterval(this.oFlshTmr);this.oFlshTmr=0;this.iFlshCnt=0;document.title=this.sFlshTtl}else{document.title=(document.title==this.sTtl)?this.sFlshTtl:this.sTtl;this.iFlshCnt++}};Owa.IM.ChtWin.prototype.Focus=function Owa$IM$ChtWin$Focus(){if(this.fIsPopOut){self.focus()}this.txtBox.SetFocus()};Owa.IM.ChtWin.prototype.Disable=function Owa$IM$ChtWin$Disable(){showErr($("divErr"),L_ErrChtInct);this.txtBox.Disable();this.btnSnd.Disable();this.UpdActBarLstMsg();onChatWinResize()};Owa.IM.ChtWin.prototype.Enable=function Owa$IM$ChtWin$Disable(){hideErr($("divErr"));this.txtBox.Enable();this.btnSnd=new Owa.IM.BtnSnd(this.oDocumentElement.getDescendantById("btnSnd"),this.txtBox);onChatWinResize()};Owa.IM.ChtWin.prototype.Unload=function Owa$IM$ChtWin$Unload(){this.iWinState=Owa.IM.CHT_WIN_ST_CLSNG;try{gtIMMgr().EndChtSsn(this.sChtId)}catch(e){}this.Disp()};Owa.IM.ChtWin.prototype.Disp=function Owa$IM$ChtWin$Disp(){this.rdArea.detachAllEvents();this.sDN=this.hdr=this.rw=this.rdArea=this.txtBox=this.btnSnd=this.lstInMsgTime=this.lstMsgName=this.fLMA=this._utTypingList=this.chtSsn=null}})();(function(){Owa.IM.CmpArea=function Owa$IM$CmpArea(oInput,oChtWin){this.oInput=oInput;this.oInput.set_Value("");this.chtWin=oChtWin;var composeArea=this;this.oInput.attachEvent("input",function(){composeArea.OnInput(composeArea)});this.oInput.attachEvent("propertychange",function(e){composeArea.OnPropertyChange(composeArea,e)});this.oInput.attachEvent("keyup",function(){composeArea.OnInput(composeArea)});this.oInput.attachEvent("keydown",function(e){composeArea.OnKeyDown(composeArea,e)});this.oInput.attachEvent("click",function(){composeArea.OnClick(composeArea)});this.oInput.attachEvent("dragstart",function(){composeArea.OnDragStart(composeArea)});this.oInput.attachEvent("dragend",function(){composeArea.OnDragEnd(composeArea)});this.oTypngTmr=0;this.fStillTypng=0;this.font=new Font("Tahoma","000000")};Owa.IM.CmpArea.prototype.OnKeyDown=function Owa$IM$CmpArea$OnKeyDown(composeArea,e){composeArea.chtWin.Blnk(1);if(e.get_KeyCodeForKeyUpDown()==13&&!e.isShiftKeyDown()){composeArea.SndMsg();e.preventDefault()}};Owa.IM.CmpArea.prototype.OnClick=function Owa$IM$CmpArea$OnClick(composeArea){composeArea.chtWin.Blnk(1)};Owa.IM.CmpArea.prototype.OnPropertyChange=function Owa$IM$CmpArea$OnPropertyChange(composeArea,e){if(e._oEvent.propertyName=="value"){composeArea.OnInput(composeArea)}};Owa.IM.CmpArea.prototype.OnInput=function Owa$IM$CmpArea$OnInput(composeArea){composeArea.fStillTypng=1;if(composeArea.oInput.get_Value()){if(composeArea.oTypngTmr==0){composeArea.SndTypng(0);composeArea.fStillTypng=0;composeArea.oTypngTmr=window.setInterval(ChkTypngState,Owa.IM.CHT_TYPNG_TMR)}}if(!composeArea.dragging){vldtTxt(composeArea.oInput,800)}};Owa.IM.CmpArea.prototype.ChkTypngState=function Owa$IM$CmpArea$ChkTypngState(){if(!this.fStillTypng){if(gtIMType()==IM_TYPE_OCS){this.SndTypng(1)}window.clearInterval(this.oTypngTmr);this.oTypngTmr=0}this.fStillTypng=0};Owa.IM.CmpArea.prototype.SndMsg=function Owa$IM$CmpArea$SndMsg(){try{this.oInput.focus();var sMsg=this.oInput.get_Value();if(!sMsg){return}this.SndChtMsg(sMsg,this.font.ToChtFrmt());this.oInput.set_Value("");window.clearInterval(this.oTypngTmr);this.oTypngTmr=0;this.fStillTypng=0;this.oInput.focus()}catch(e){}};Owa.IM.CmpArea.prototype.SndChtMsg=function Owa$IM$CmpArea$SndChtMsg(sMsg,sFrmt){var oRCtx={};var sChtId=this.chtWin.sChtId;var isInt=0;try{isInt=gtIMMgr().IsIntCht(sChtId)}catch(e){}var utParticipants=this.chtWin.chtSsn._utParticipants;if(utParticipants){var sUri;var rgoRcp=[];var rType=[];for(sUri in utParticipants.Keys()){var oRecip=utParticipants.Get(sUri);if(oRecip){rgoRcp.push(sUri);rType.push(oRecip._type)}}oRCtx.rgoRcp=rgoRcp;oRCtx.rType=rType;oRCtx.chtSsn=this.chtWin.chtSsn}if(!isInt)oRCtx.sChtId=this.chtWin.sChtId;oRCtx.sMsg=sMsg;oRCtx.sFrmt=sFrmt;oRCtx.oChtWin=this.chtWin;oRCtx.feOnErr=failChtMsgDlv;var sLDN=this.chtWin.chtSsn.sLDN;if(sLDN)oRCtx.sLDn=sLDN;if(isInt)sndIMReq(IM_SNCM,this.cbSndNewChtMsg,0,oRCtx);else{sndIMReq(IM_SCM,this.cbSndChtMsg,0,oRCtx)}this.chtWin.OutGoingMsg(sMsg,sFrmt)};Owa.IM.CmpArea.prototype.cbSndNewChtMsg=function Owa$IM$CmpArea$cbSndNewChtMsg(oRCtx,sBdy){var oChtWin=oRCtx.oChtWin;var sChtId;if(sBdy!=""){var o=eval('('+sBdy+')');if((o._sip)&&(oChtWin.chtSsn.sLDN)){var sStlSip=oRCtx.rgoRcp[0];if(!isSameUri(sStlSip,o._sip))oRCtx.chtSsn.UpdRcpSip(sStlSip,o._sip);oChtWin.chtSsn.sLDN=null}sChtId=o._cid}else sChtId=-1;var sTmpId=oChtWin.sChtId;if(sChtId>=0){var isInt=1;try{isInt=gtIMMgr().IsIntCht(sTmpId)}catch(e){}if(isInt){try{gtIMMgr().MkChtSsnAct(sTmpId,sChtId)}catch(e){}oChtWin.sChtId=sChtId;oChtWin.iInt=0}}else if(sChtId==-1){var oChtSsn=gtIMMgr().GtChtSsn(sTmpId);oChtSsn.InActMsg(Owa.IM.ACT_FAILMSGDLV)}};Owa.IM.CmpArea.prototype.cbSndChtMsg=function Owa$IM$CmpArea$cbSndChtMsg(oRCtx,sBdy){var oChtWin=oRCtx.oChtWin;var sChtId;if(sBdy!=""){var o=eval('('+sBdy+')');sChtId=o._cid}else sChtId=-1;var sTmpId=oChtWin.sChtId;if(sChtId>=0){if(sChtId!=sTmpId){var oChtSsn=gtIMMgr().GtChtSsn(sTmpId);try{gtIMMgr().ReplaceChtId(oChtSsn,sChtId)}catch(e){}}}else if(sChtId==-1){oChtWin.InActMsg(Owa.IM.ACT_FAILMSGDLV)}};Owa.IM.CmpArea.prototype.SndTypng=function Owa$IM$CmpArea$SndTypng(fC){var oRCtx={};oRCtx.sChtId=this.chtWin.sChtId;var isInt=1;try{isInt=gtIMMgr().IsIntCht(oRCtx.sChtId)}catch(e){}if(!isInt)sndIMReq((fC?IM_NTPC:IM_NTP),0,0,oRCtx)};Owa.IM.CmpArea.prototype.OnDragStart=function Owa$IM$CmpArea$OnDragStart(composeArea){composeArea.dragging=1};Owa.IM.CmpArea.prototype.OnDragEnd=function Owa$IM$CmpArea$OnDragEnd(composeArea){composeArea.dragging=0};Owa.IM.CmpArea.prototype.Disable=function Owa$IM$CmpArea$Disable(){this.disabled=1;if(this.oInput){this.oInput.set_IsDisabled(1)}};Owa.IM.CmpArea.prototype.Enable=function Owa$IM$CmpArea$Enable(){this.disabled=0;if(this.oInput){this.oInput.set_IsDisabled(0)}};Owa.IM.CmpArea.prototype.SetFocus=function Owa$IM$CmpArea$SetFocus(){try{if(this.oInput&&!this.oInput.get_IsDisabled()){this.oInput.focus()}}catch(e){}};Owa.IM.CmpArea.prototype.Disp=function Owa$IM$CmpArea$Disp(){this.oInput.detachAllEvents();this.oTypngTmr=this.fStillTypng=this.font=this.chtWin=this.oInput=null}})();(function(){Owa.IM.BtnSnd=function Owa$IM$BtnSnd(oButton,oCmpArea){this.oButton=oButton;this.oCmpArea=oCmpArea;var sendButton=this;this.oButton.attachEvent("mouseover",function(){sendButton.onBOvr(sendButton)});this.oButton.attachEvent("mouseout",function(){sendButton.onBOut(sendButton)});this.oButton.attachEvent("mousedown",function(){sendButton.onBDn(sendButton)});this.oButton.attachEvent("mouseup",function(){sendButton.onBUp(sendButton)});this.oButton.attachEvent("click",function(){sendButton.onClkB(sendButton)});var oDocument=Owa.Dom.Document.get_Current();var o=oDocument.createElement("a");oDocument.get_Body().appendChild(o);this.oBtnSty=new Owa.IM.BtnStyle(o,"btnSnd");o.remove(true);errSty(this.oButton._get_DomNode(),0)};Owa.IM.BtnSnd.prototype.ApplyButtonStyle=function Owa$IM$BtnSnd$ApplyButtonStyle(oDomButton,oStl){var oBs=oDomButton.style;oBs.padding=oStl.padding;oBs.verticalAlign=oStl.valgn;oBs.textAlign=oStl.txtalgn};Owa.IM.BtnSnd.prototype.onBOvr=function Owa$IM$BtnSnd$onBOvr(sendButton){var oDomButton=sendButton.oButton._get_DomNode();ApplyButtonStyle(oDomButton,g_oChtBtnDn);sendButton.ApplyButtonStyle(oDomButton,sendButton.oBtnSty)};Owa.IM.BtnSnd.prototype.onBOut=function Owa$IM$BtnSnd$onBOut(sendButton){var oDomButton=sendButton.oButton._get_DomNode();ApplyButtonStyle(oDomButton,g_oChtBtnFlt);sendButton.ApplyButtonStyle(oDomButton,sendButton.oBtnSty)};Owa.IM.BtnSnd.prototype.onBDn=function Owa$IM$BtnSnd$onBDn(sendButton){var oDomButton=sendButton.oButton._get_DomNode();ApplyButtonStyle(oDomButton,g_oChtBtnDn);sendButton.ApplyButtonStyle(oDomButton,sendButton.oBtnSty)};Owa.IM.BtnSnd.prototype.onBUp=function Owa$IM$BtnSnd$onBUp(sendButton){var oDomButton=sendButton.oButton._get_DomNode();ApplyButtonStyle(oDomButton,g_oChtBtnFlt);sendButton.ApplyButtonStyle(oDomButton,sendButton.oBtnSty)};Owa.IM.BtnSnd.prototype.onClkB=function Owa$IM$BtnSnd$onClkB(sendButton){sendButton.ApplyButtonStyle(sendButton.oButton._get_DomNode(),sendButton.oBtnSty);sendButton.oCmpArea.SndMsg()};Owa.IM.BtnSnd.prototype.Disable=function Owa$IM$BtnSnd$Disable(){if(this.oButton){var oDomButton=this.oButton._get_DomNode();errSty(oDomButton,1);this.ApplyButtonStyle(oDomButton,this.oBtnSty);this.Disp()}};Owa.IM.BtnSnd.prototype.Disp=function Owa$IM$BtnSnd$Disp(){this.oButton.detachAllEvents();this.oBtnSty=this.oButton=null}})();(function(){Owa.IM.BtnStyle=function Owa$IM$BtnStyle(o,sC){o.addCssClass(sC);var oS=o._get_DomNode().style;this.padding=oS.padding;this.valgn=oS.verticalAlign;this.txtalgn=oS.textAlign}})();(function(){Owa.IM.Bdy=function Owa$IM$Bdy(sDN,sUri,iPrsnc,iPrvdr,sEml,sGid,iType,fTag){this.dn=sDN;this.uri=sUri.lc();this.prsnc=iPrsnc;this.iNumGroups=0;this.eml=sEml;this.prvdr=gtIMType();this.sGid=sGid;this.iType=iType;this.fTag=fTag};Owa.IM.Bdy.prototype.UpdateBuddyGroups=function Owa$IM$Bdy$UpdateBuddyGroups(rgGroupIds){var sGroupId,oGroup;var oBuddyList=gtIMMgr().bdyLst;var rgGrpIdsInBdyLst=oBuddyList.GetGroups();var grpLst={};for(var i=0;i<rgGroupIds.length;i++){sGroupId=rgGroupIds[i];grpLst[sGroupId]=1;if(sGroupId==oBuddyList.sOtherContactsID)continue;oGroup=oBuddyList.GetGroup(sGroupId);if(oGroup&&!oGroup.IsMember(this.uri)){oGroup.AddBuddyToGroup(this.dn,this.uri,this.prsnc,this.iType)}}if(isOCSPrv()){for(sGroupId in rgGrpIdsInBdyLst){oGroup=oBuddyList.GetGroup(sGroupId);if(oGroup&&!grpLst[sGroupId]&&oGroup.IsMember(this.uri)){oGroup.RemoveBuddyFromGroup(this.uri)}}}if(this.iNumGroups==0){oGroup=oBuddyList.GetGroup(oBuddyList.sOtherContactsID);if(oGroup){oBuddyList.GetGroup(oBuddyList.sOtherContactsID).AddBuddyToGroup(this.dn,this.uri,this.prsnc)}}};Owa.IM.Bdy.prototype.GetBuddyGroups=function Owa$IM$Bdy$GetBuddyGroups(){var rgGrp=[];var oBuddyList=gtIMMgr().bdyLst;var rgGrpIdsInBdyLst=oBuddyList.GetGroups();var fAddedOtherContactsGroup=false;for(var sGroupId in rgGrpIdsInBdyLst){var oGroup=oBuddyList.GetGroup(sGroupId);if(oGroup&&oGroup.IsMember(this.uri)){if(sGroupId==oBuddyList.sOtherContactsID)fAddedOtherContactsGroup=true;rgGrp.push(oGroup)}}if(isOCSPrv()&&!fAddedOtherContactsGroup){oGroup=oBuddyList.GetGroup(oBuddyList.sOtherContactsID);if(oGroup){rgGrp.push(oGroup)}}return rgGrp}})();(function(){Owa.IM.BdyGrp=function Owa$IM$BdyGrp(sName,sGroupID,iFlags,iExpand){this.groupID=sGroupID;this.groupName=sName;this.groupFlags=iFlags;this.groupExpand=iExpand;this._utMembers=new Owa.IM.UriTable();this._utRenderedStatus=new Owa.IM.UriTable()};Owa.IM.BdyGrp.ValidateGroupName=function Owa$IM$BdyGrp$ValidateGroupName(sGroupName,fNewGroup){var sGroupName=sGroupName.trim().lc();if(sGroupName==""){return(fNewGroup)?L_ErrIMGrpSpNew:L_ErrIMGrpSpRen}var oIMManager=gtIMMgr();if(!oIMManager){return}if(oIMManager.bdyLst.IsDuplicateGroup(sGroupName)){return L_ErrIMGE}};Owa.IM.BdyGrp.prototype.IsMember=function Owa$IM$BdyGrp$IsMember(sUri){return(this._utMembers.Get(sUri)?true:false)};Owa.IM.BdyGrp.prototype.IsOtherContactsGroup=function Owa$IM$BdyGrp$IsOtherContactsGroup(){return((this.groupFlags&Owa.IM.GROUP_FLAGS.OtherContacts)!=0)};Owa.IM.BdyGrp.prototype.IsFavoritesGroup=function Owa$IM$BdyGrp$IsFavoritesGroup(){return((this.groupFlags&Owa.IM.GROUP_FLAGS.Favorites)!=0)};Owa.IM.BdyGrp.prototype.RenameGroup=function Owa$IM$BdyGrp$RenameGroup(sNewName){this.groupName=sNewName;if(g_oBddyLst)g_oBddyLst.renameGroup(this.groupID,sNewName)};Owa.IM.BdyGrp.prototype.AddBuddyToGroup=function Owa$IM$BdyGrp$AddBuddyToGroup(sName,sUri,iPrsnc,iType){if(!sUri){return}if(this.IsMember(sUri)){return}var oIMManager=gtIMMgr();if(oIMManager){var oBuddy=oIMManager.bdyLst.GtBdy(sUri);if(oBuddy){this._utMembers.Set(sUri,sUri);oBuddy.iNumGroups++;if(!this.IsOtherContactsGroup()){var oOtherContactsGroup=oIMManager.bdyLst.GetGroup(oIMManager.bdyLst.sOtherContactsID);if(oOtherContactsGroup&&oOtherContactsGroup.IsMember(sUri)){oOtherContactsGroup.RemoveBuddyFromGroup(sUri)}}if(g_oBddyLst&&!g_oBddyLst.fRendering){g_oBddyLst.startRendering()}}}};Owa.IM.BdyGrp.prototype.RemoveBuddyFromGroup=function Owa$IM$BdyGrp$RemoveBuddyFromGroup(sUri){if(!sUri){return}if(this.IsMember(sUri)){this._utMembers.Remove(sUri);var oIMManager=gtIMMgr();if(oIMManager){var oBuddy=oIMManager.bdyLst.GtBdy(sUri);if(oBuddy){oBuddy.iNumGroups--}}if(g_oBddyLst){g_oBddyLst.rmvBddyFrmGrp(this.groupID,sUri)}}};Owa.IM.BdyGrp.prototype.GtLen=function Owa$IM$BdyGrp$GtLen(){return this._utMembers.Count()};Owa.IM.BdyGrp.prototype.GetMembers=function Owa$IM$BdyGrp$GetMembers(){return this._utMembers.Keys()};Owa.IM.BdyGrp.prototype.GetRenderingStatus=function Owa$IM$BdyGrp$GetRenderingStatus(sUri){return(this._utRenderedStatus.Get(sUri)?true:false)};Owa.IM.BdyGrp.prototype.SetRenderingStatus=function Owa$IM$BdyGrp$SetRenderingStatus(sUri,fRendered){this._utRenderedStatus.Set(sUri,fRendered)}})();(function(){Owa.IM.BdyLst=function Owa$IM$BdyLst(){this._grpLst={};this._utBuddyList=new Owa.IM.UriTable();this._utStaleUris=new Owa.IM.UriTable();this._grpLstLen=0;this.sOtherContactsID=null};Owa.IM.BdyLst.prototype.AddGrp=function Owa$IM$BdyLst$AddGrp(sName,sGroupID,iFlags,iExpand){var oGroup=this.GetGroup(sGroupID);if(oGroup){if(oGroup.groupName!=sName){oGroup.RenameGroup(sName)}return}if((iFlags&Owa.IM.GROUP_FLAGS.OtherContacts)!=0){this.sOtherContactsID=sGroupID}this._grpLst[sGroupID]=new Owa.IM.BdyGrp(sName,sGroupID,iFlags,iExpand);this._grpLstLen++;if(g_oBddyLst)g_oBddyLst.addGrpToTr(sName,sGroupID,iFlags,iExpand)};Owa.IM.BdyLst.prototype.AddBdy=function Owa$IM$BdyLst$AddBdy(sDN,rgCnt,iPrsnc,iPrvdr,sEml){if(!rgCnt||!rgCnt[0]){return}var sUri=rgCnt[0];var sGid=rgCnt[1];var fTag=rgCnt[5];var iType=rgCnt[3];if(this.IsBdy(sUri)||isSlfUri(sUri))return;if(!iPrsnc){iPrsnc=gtDfltPrsnc()}if(iPrsnc>IM_PR_UNKNWN){iPrsnc=gtPrsncIdFrmVal(iPrsnc)}if(!isDf(typeof(iPrvdr))){iPrvdr=IM_TYPE_OCS}var rgGroupIds;var sEmailAddress=null;if(sEml){sEmailAddress=sEml}var oBuddy=new Owa.IM.Bdy(sDN,sUri,iPrsnc,iPrvdr,sEmailAddress,sGid,iType,fTag);this._utBuddyList.Set(sUri,oBuddy);if(rgCnt[4]&&rgCnt[4].length){rgGroupIds=rgCnt[4]}else{rgGroupIds=[this.sOtherContactsID]}oBuddy.UpdateBuddyGroups(rgGroupIds)};Owa.IM.BdyLst.prototype.GetGroupLen=function Owa$IM$BdyLst$GetGroupLen(){return this._grpLstLen};Owa.IM.BdyLst.prototype.GetGroups=function Owa$IM$BdyLst$GetGroups(){return this._grpLst};Owa.IM.BdyLst.prototype.RmBdy=function Owa$IM$BdyLst$RmBdy(sUri){var oBuddy=this._utBuddyList.Get(sUri);if(oBuddy){this._utBuddyList.Remove(sUri);if(this._grpLstLen>0){var rgGroups=this._grpLst;for(var sGroupID in rgGroups){if(this.IsGroup(sGroupID)){rgGroups[sGroupID].RemoveBuddyFromGroup(sUri)}}}}return oBuddy};Owa.IM.BdyLst.prototype.RemoveGroup=function Owa$IM$BdyLst$RemoveGroup(sGroupID){if(!sGroupID)return;var oGroup=this.GetGroup(sGroupID);if(oGroup){if(oGroup.GtLen()>0){for(var sUri in oGroup.GetMembers()){var oBuddy=this.GtBdy(sUri);if(oBuddy){var iNumGroups=oBuddy.iNumGroups;oGroup.RemoveBuddyFromGroup(sUri);if(iNumGroups==1){var oOtherContactsGroup=this.GetGroup(this.sOtherContactsID);if(oOtherContactsGroup){oOtherContactsGroup.AddBuddyToGroup(oBuddy.dn,sUri,oBuddy.prsnc)}}}}}this._grpLst[sGroupID]=0;this._grpLstLen--;if(g_oBddyLst){g_oBddyLst.removeGroup(sGroupID)}}};Owa.IM.BdyLst.prototype.IsBdy=function Owa$IM$BdyLst$IsBdy(sUri){return(this.GtBdy(sUri)?1:0)};Owa.IM.BdyLst.prototype.GtBdy=function Owa$IM$BdyLst$GtBdy(sUri){sUri=gtIMMgr().pxyLst.GetBuddyPrimaryUri(sUri);return this._utBuddyList.Get(sUri)};Owa.IM.BdyLst.prototype.IsGroup=function Owa$IM$BdyLst$IsGroup(sGroupID){if(!isDf(typeof(sGroupID))||!sGroupID)return 0;return(this._grpLst[sGroupID]?1:0)};Owa.IM.BdyLst.prototype.IsDuplicateGroup=function Owa$IM$BdyLst$IsDuplicateGroup(sGroupName){if(isOCSPrv()&&sGroupName=="~")return true;for(var sGroupID in this._grpLst){var oGroup=this._grpLst[sGroupID];if(oGroup&&sGroupName==oGroup.groupName.lc()){return true}}return false};Owa.IM.BdyLst.prototype.GetGroup=function Owa$IM$BdyLst$GetGroup(sGroupID){if(!sGroupID)return 0;return this._grpLst[sGroupID]};Owa.IM.BdyLst.prototype.GtLen=function Owa$IM$BdyLst$GtLen(){return this._utBuddyList.Count()};Owa.IM.BdyLst.prototype.UpdPrsnc=function Owa$IM$BdyLst$UpdPrsnc(sUri,iPrsnc,sDN){if(iPrsnc>IM_PR_UNKNWN)iPrsnc=gtPrsncIdFrmVal(iPrsnc);var bdy=this.GtBdy(sUri);if(bdy){bdy.prsnc=iPrsnc;if(isDf(typeof(sDN))&&sDN&&sDN!=""){bdy.dn=sDN}if(g_oBddyLst){var rgGroups=this._grpLst;for(var sGroupID in rgGroups){if(this.IsGroup(sGroupID)){g_oBddyLst.updateGrpPrsc(sGroupID,sDN,sUri,iPrsnc)}}}}};Owa.IM.BdyLst.prototype.GetBuddyType=function Owa$IM$BdyLst$GetBuddyType(sUri){var oBuddy=this.GtBdy(sUri);if(!oBuddy||!oBuddy.iType){return Owa.IM.BUDDY_TYPE.None}else{return oBuddy.iType}};Owa.IM.BdyLst.prototype.GtPrsnc=function Owa$IM$BdyLst$GtPrsnc(sUri){if(!sUri)return gtDfltPrsnc();if(gtIMMgr().IsBlkd(sUri))return IM_PR_BLKD;var bdy=this.GtBdy(sUri);if(bdy==null)return gtDfltPrsnc();if(bdy.prsnc>IM_PR_UNKNWN||bdy.prsnc<IM_PR_AV)return gtDfltPrsnc();return bdy.prsnc}})();(function(){Owa.IM.OthrsLst=function Owa$IM$OthrsLst(){this._utOthersList=new Owa.IM.UriTable()};Owa.IM.OthrsLst.prototype.AddBdy=function Owa$IM$OthrsLst$AddBdy(sDn,rgCnt,iPrsnc,iPrvdr){if(!rgCnt||!rgCnt[0])return;var sUri=rgCnt[0];var sGid=rgCnt[1];if(iPrsnc<IM_PR_AV||iPrsnc>IM_PR_UNKNWN)return;if(this.IsPrsnt(sUri)||isSlfUri(sUri))return;var bdy=new Owa.IM.Bdy(sDn,sUri,iPrsnc,iPrvdr,null,sGid);var dt=new Date();bdy.time=dt.getTime();bdy.dcying=0;this._utOthersList.Set(sUri,bdy)};Owa.IM.OthrsLst.prototype.MvBdyFrmBdyLst=function Owa$IM$OthrsLst$MvBdyFrmBdyLst(bdy,sUri){if(!bdy)return;var dt=new Date();bdy.time=dt.getTime();bdy.dcying=0;this._utOthersList.Set(sUri,bdy)};Owa.IM.OthrsLst.prototype.RmBdy=function Owa$IM$OthrsLst$RmBdy(sUri,fDC){if(!sUri)return;var bdy=this._utOthersList.Get(sUri);if(!bdy)return;var fDel=1;if(isDf(typeof(fDC))&&fDC){if(bdy.dcying)fDel=1;else fDel=0}if(fDel){this._utOthersList.Remove(sUri,true)}};Owa.IM.OthrsLst.prototype.IsPrsnt=function Owa$IM$OthrsLst$IsPrsnt(sUri){return(this._utOthersList.Get(sUri)?1:0)};Owa.IM.OthrsLst.prototype.GtLen=function Owa$IM$OthrsLst$GtLen(){return this._utOthersList.Count()};Owa.IM.OthrsLst.prototype.UpdPrsnc=function Owa$IM$OthrsLst$UpdPrsnc(sUri,iPrsnc,sDN,fQry){if(iPrsnc>IM_PR_UNKNWN)iPrsnc=gtPrsncIdFrmVal(iPrsnc);var bdy=this._utOthersList.Get(sUri);if(bdy){bdy.prsnc=iPrsnc;if(isDf(typeof(sDN))&&sDN&&sDN!=""){bdy.dn=sDN}}else{if(!isDf(typeof(fQry))||!fQry){if(!isDf(typeof(sDN))||!sDN||sDN==""){sDN=Owa.IM.IMUtils.NrmSipUri(sUri)}this.AddBdy(sDN,[sUri],iPrsnc,IM_TYPE_OCS)}}};Owa.IM.OthrsLst.prototype.Decay=function Owa$IM$OthrsLst$Decay(fFrc,fNtSnd,iNum){var dcUris="";var utOthersList=this._utOthersList;var iPrvdrId=IM_TYPE_OCS;var cnt=0;var now=new Date();var tmStmp=now.getTime();if(!fFrc)tmStmp-=10*60*1000;else if(isDf(typeof(iNum))&&iNum==0)return 0;var bdy;for(var sUri in utOthersList.Keys()){bdy=utOthersList.Get(sUri);if(bdy&&bdy.time<tmStmp){dcUris+=bdy.uri;iPrvdrId=bdy.prvdr;dcUris+=",";bdy.dcying=1;cnt++;if(isDf(typeof(iNum))&&cnt>=iNum)break}}if(cnt>0){var oRCtx={};oRCtx.sUrisUnsub=dcUris.substr(0,dcUris.length-1);if(!fNtSnd)sndIMReq(IM_SC,this.cbDecay,null,oRCtx);else return oRCtx}return 0};Owa.IM.OthrsLst.prototype.cbDecay=function Owa$IM$OthrsLst$cbDecay(oRCtx){if(!oRCtx)return;if(isDf(typeof(oRCtx.sUrisUnsub))&&oRCtx.sUrisUnsub){var rgUris=oRCtx.sUrisUnsub.split(",");for(var i=0;i<rgUris.length;i++){gtIMMgr().othrsLst.RmBdy(rgUris[i],1)}}};Owa.IM.OthrsLst.prototype.GtBdy=function Owa$IM$OthrsLst$GtBdy(sUri){return this._utOthersList.Get(sUri)};Owa.IM.OthrsLst.prototype.GtPrsnc=function Owa$IM$OthrsLst$GtPrsnc(sUri){if(!sUri)return gtDfltPrsnc();if(gtIMMgr().IsBlkd(sUri))return IM_PR_BLKD;var bdy=this._utOthersList.Get(sUri);if(!bdy)return gtDfltPrsnc();if(bdy.prsnc>IM_PR_UNKNWN||bdy.prsnc<IM_PR_AV)return gtDfltPrsnc();var dt=new Date();bdy.time=dt.getTime();return bdy.prsnc}})();(function(){Owa.IM.BlkLst=function Owa$IM$BlkLst(){this._utBlockedList=new Owa.IM.UriTable()};Owa.IM.BlkLst.prototype.SetBlkd=function Owa$IM$BlkLst$SetBlkd(sUri){if(!isDf(typeof(sUri))||!sUri)return;sUri=gtIMMgr().pxyLst.GetBuddyPrimaryUri(sUri);this._utBlockedList.Set(sUri,1)};Owa.IM.BlkLst.prototype.SetUnblkd=function Owa$IM$BlkLst$SetUnblkd(sUri){if(!isDf(typeof(sUri))||!sUri)return;sUri=gtIMMgr().pxyLst.GetBuddyPrimaryUri(sUri);this._utBlockedList.Remove(sUri,true,true)};Owa.IM.BlkLst.prototype.Contains=function Owa$IM$BlkLst$Contains(sUri){sUri=gtIMMgr().pxyLst.GetBuddyPrimaryUri(sUri);return this._utBlockedList.Get(sUri)}})();(function(){Owa.IM.ProxyList=function Owa$IM$ProxyList(){this._utPxyLst=new Owa.IM.UriTable()};Owa.IM.ProxyList.prototype.AddProxies=function Owa$IM$ProxyList$AddProxies(sUri,rgProxies){if(!isDf(typeof(sUri))||!sUri){return}rgProxies.unshift(sUri);for(var i=0;i<rgProxies.length;i++){var sProxy=rgProxies[i];this._utPxyLst.Set(sProxy,rgProxies)}};Owa.IM.ProxyList.prototype.RemoveProxies=function Owa$IM$ProxyList$RemoveProxies(sUri){if(!isDf(typeof(sUri))||!sUri)return;var rgProxies=this._utPxyLst.Get(sUri);if(rgProxies&&rgProxies.length){for(var i=0;i<rgProxies.length;i++){var sProxy=rgProxies[i];if(this._utPxyLst.Get(sProxy)){this._utPxyLst.Remove(sProxy,true)}}}};Owa.IM.ProxyList.prototype.GetProxies=function Owa$IM$ProxyList$GetProxies(sUri){return this._utPxyLst.Get(sUri)};Owa.IM.ProxyList.prototype.GetBuddyPrimaryUri=function Owa$IM$ProxyList$GetBuddyPrimaryUri(sUri){var rgProxies=this.GetProxies(sUri);var sPrimary;if(rgProxies&&rgProxies.length){sPrimary=rgProxies[0]}if(!sPrimary){sPrimary=sUri}return Owa.IM.IMUtils.CleanUri(sPrimary)}})();function ChkTypngState(){this.g_oChtWin.txtBox.ChkTypngState()}function FlshTtl(){this.g_oChtWin.FlshTtl()}function SlctRdArea(e){var rdArea=e.get_Target()._get_DomNode();if(e.isCtrlKeyDown()&&e.get_KeyCodeForKeyUpDown()==65){var oR=rdArea.document.body.createTextRange();oR.moveToElementText(rdArea);var c="character";oR.moveStart(c,-1);oR.moveEnd(c,1);if(oR.text){oR.select()}canEvt(e)}}function APS(rgGrpsAndCntcts){if(!gtIMMgr())return;if(g_iIM_SI&&gtMstr()&&!gtMstr().g_fSigningIn){enblIM()}if(!rgGrpsAndCntcts||!rgGrpsAndCntcts.length)return;var oBuddyList=gtIMMgr().bdyLst;var oOthersList=gtIMMgr().othrsLst;var rgGrps=rgGrpsAndCntcts[0];if(rgGrps){for(var i=0;i<rgGrps.length;i++){oBuddyList.AddGrp(rgGrps[i][0],rgGrps[i][1],rgGrps[i][2],rgGrps[i][3])}}var rgCnt,sDN,sUri,iPrsnc;var rgCntcts=rgGrpsAndCntcts[1];if(rgCntcts){for(var i=0;i<rgCntcts.length;i++){rgCnt=rgCntcts[i];sUri=rgCnt[0].lc();var oBuddy=oBuddyList.GtBdy(sUri);if(oBuddy&&rgCnt[4]&&rgCnt[4].length){oBuddy.UpdateBuddyGroups(rgCnt[4]);continue}sDN=rgCnt[2];if(!sDN||sDN=="")sDN=imns.IMUtils.NrmSipUri(sUri);iPrsnc=gtDfltPrsnc();if(gtIMMgr().IsBlkd(sUri))iPrsnc=IM_PR_BLKD;oBuddyList.AddBdy(sDN,rgCnt,iPrsnc);if(oOthersList.IsPrsnt(sUri)){oBuddyList.UpdPrsnc(sUri,oOthersList.GtPrsnc(sUri),oOthersList.GtBdy(sUri).dn);oOthersList.RmBdy(sUri)}}}}function PXY(rgProxies){if(!gtIMMgr())return;if(!rgProxies||!rgProxies.length)return;var oPl=gtIMMgr().pxyLst;var sUri,rgUriProxies;var rgoPrsnc=new Array();for(var i=0;i<rgProxies.length;i++){sUri=rgProxies[i][0];var oPrsnc={};oPrsnc.sUri=sUri;oPrsnc.prsnc=gtIMMgr().gtPrsnc(sUri);oPrsnc.sDN=gtIMMgr().gtDN(sUri);rgoPrsnc.push(oPrsnc);oPl.AddProxies(sUri,rgProxies[i][1])}if(rgoPrsnc.length>0)pushPrsnc(rgoPrsnc)}function SI(fStart){if(gtMstr()&&gtMstr().g_fSignedIn){return}if(fStart){g_fSigningIn=1;if(g_oBddyLst){g_oBddyLst.shwPrgInd()}}else{g_fSigningIn=0;if(!gtIMMgr()){return}if(g_oBddyLst&&!g_oBddyLst.fRendering){g_oBddyLst.shwPrgInd(1)}g_oBddyLst.shwAddBddyLnk();stSlfPrsnc(IM_PR_AV);enblIM();if(isMSNPrv()){var oRCtx={};var rgsUris=new Array();var sUri;var utBuddyList=gtIMMgr().bdyLst._utBuddyList;for(sUri in utBuddyList.Keys()){sUri=Owa.IM.IMUtils.CleanUri(sUri);rgsUris.push(sUri)}oRCtx.rgsUris=rgsUris;sndIMReq(IM_PXY,null,null,oRCtx)}}}function RC(rgCntcts){if(!rgCntcts||!rgCntcts.length)return;if(!gtIMMgr())return;for(var i=0;i<rgCntcts.length;i++){var sUri=rgCntcts[i];sUri=imns.IMUtils.FrmSipUri(sUri);if(sUri&&gtIMMgr().bdyLst.IsBdy(sUri)){var bdy=gtIMMgr().bdyLst.RmBdy(sUri);if(bdy)gtIMMgr().othrsLst.MvBdyFrmBdyLst(bdy,sUri);gtIMMgr().pxyLst.RemoveProxies(sUri)}}}function RCG(rgContactGroupMappings){if(!rgContactGroupMappings||!rgContactGroupMappings.length)return;if(!gtIMMgr())return;var rgContactGroupMapping;for(var i=0;i<rgContactGroupMappings.length;i++){rgContactGroupMapping=rgContactGroupMappings[i];if(rgContactGroupMapping&&rgContactGroupMapping.length<2){continue}var sGroupID=rgContactGroupMapping[0];if(sGroupID&&gtIMMgr().bdyLst.IsGroup(sGroupID)){var sUri=rgContactGroupMapping[1];var oBuddyList=gtIMMgr().bdyLst;if(sUri&&oBuddyList.IsBdy(sUri)){var oBuddy=oBuddyList.GtBdy(sUri);var iNumGroups=oBuddy.iNumGroups;if(iNumGroups>1){oBuddyList.GetGroup(sGroupID).RemoveBuddyFromGroup(sUri)}else if(iNumGroups==1&&sGroupID!=oBuddyList.sOtherContactsID){oBuddyList.GetGroup(sGroupID).RemoveBuddyFromGroup(sUri);oBuddyList.GetGroup(oBuddyList.sOtherContactsID).AddBuddyToGroup(oBuddy.dn,sUri,oBuddy.prsnc)}}}}}function RG(rgGroupIds){if(!rgGroupIds||!rgGroupIds.length)return;if(!gtIMMgr())return;for(var i=0;i<rgGroupIds.length;i++){gtIMMgr().bdyLst.RemoveGroup(rgGroupIds[i])}}function GPC(sGroupId,sNewGroupName){if(!gtIMMgr())return;var oGroup=gtIMMgr().bdyLst.GetGroup(sGroupId);if(oGroup){oGroup.RenameGroup(sNewGroupName)}}function QPC(rgCntcts){PC(rgCntcts,1)}function PC(rgCntcts,fQry){if(!rgCntcts||!rgCntcts.length)return;if(!gtIMMgr())return;var rgoPrsnc=[];var rgCnt,sUri,sDN,iPrsnc,oBuddy,oPrsnc;for(var i=0;i<rgCntcts.length;i++){rgCnt=rgCntcts[i];sUri=rgCnt[0];if(!sUri||!isDf(typeof(sUri))||sUri=="")continue;sDN=rgCnt[2];sUri=imns.IMUtils.FrmSipUri(sUri);sUri=sUri.lc();iPrsnc=gtPrsncIdFrmVal(rgCnt[1]);if(gtIMMgr().IsBlkd(sUri)){if(gtIMMgr().IsBdy(sUri)){gtIMMgr().bdyLst._utBuddyList.Get(sUri).prsnc=iPrsnc}else if(gtIMMgr().othrsLst.IsPrsnt(sUri)){gtIMMgr().othrsLst._utOthersList.Get(sUri).prsnc=iPrsnc}continue}oBuddy=gtIMMgr().bdyLst.GtBdy(sUri);if(oBuddy){if(!sDN||sDN=="")sDN=oBuddy.dn;gtIMMgr().bdyLst.UpdPrsnc(sUri,iPrsnc,sDN)}else{if(!sDN||sDN==""){var oOthersBuddy=gtIMMgr().othrsLst.GtBdy(sUri);if(oOthersBuddy){sDN=oOthersBuddy.dn}}if(isDf(typeof(fQry)))gtIMMgr().othrsLst.UpdPrsnc(sUri,iPrsnc,sDN,fQry);else gtIMMgr().othrsLst.UpdPrsnc(sUri,iPrsnc,sDN,0)}oPrsnc={};oPrsnc.prsnc=iPrsnc;oPrsnc.fNm=gtIMFFrmId(iPrsnc);oPrsnc.sUri=sUri;if(sDN&&sDN!=""){oPrsnc.sDN=sDN}rgoPrsnc.push(oPrsnc)}pushPrsnc(rgoPrsnc)}function IMUP(iPrsnc){if(!isDf(typeof(iPrsnc)))return;stSlfPrsnc(gtPrsncIdFrmVal(iPrsnc),1)}function MCht(){if(!gtIMMgr())return;gtIMMgr().ErrMaxChats(1)}function PCF(sErrMsg){stSlfPrsnc(gtSlfPrsnc(1));alrt(L_ErrIMPr,null,Owa.BUTTON_DIALOG_ICON.WARNING)}function ACF(sUri){if(isDf(typeof(a_fOrgP))||(isDf(typeof(a_fDir))&&a_fDir)){var oToolbarCollection=Owa.Components.ToolbarCollection.get(Owa.Components.Application.get_RootSubPage());oToolbarCollection.set_IsButtonShown(BID_RMBLST,false);oToolbarCollection.set_IsButtonShown(BID_ABLST,true);oToolbarCollection.set_IsButtonDisabled(BID_ABLST,false)}alrt(L_ErrAblst.replace(/\{0\}/,htmlEnc(sUri)),null,Owa.BUTTON_DIALOG_ICON.WARNING,L_ErrAblstTtl)}function RCS(sUri){}function RCF(sErrMsg){if(isDf(typeof(a_fOrgP))||(isDf(typeof(a_fDir))&&a_fDir)){var oToolbarCollection=Owa.Components.ToolbarCollection.get(Owa.Components.Application.get_RootSubPage());Owa.Components.ToolbarCollection.get_Current().set_IsButtonShown(BID_RMBLST,true);Owa.Components.ToolbarCollection.get_Current().set_IsButtonShown(BID_ABLST,false)}alrt(htmlEnc(sErrMsg),null,Owa.BUTTON_DIALOG_ICON.WARNING)}function MSCF(sErrMsg){}var g_oSiTmr=null;var IM_SIGN_IN_RETRY_INTERVAL=120000;var IM_REMOTE_SIGNOUT=1002;var IM_DISC=1003;var IM_UNKN_ERR=1004;var IM_DISC_TOOMANYENDPOINTS=1006;var IM_FAIL_ADDRESS_NOT_AVAILABLE=2000;var IM_FAIL_EXTERNAL_AUTHENTICATION_DISABLED=2001;var IM_FAIL_EXTERNAL_IDENTITY_UNKNOWN=2002;var IM_FAIL_MSN_TERMS_OF_USE_NOT_SIGNED=2003;var IM_FAIL_OVER_MAX_PAYLOAD_SIZE=2004;var IM_FAIL_SERVER_TIMEOUT=3000;var IM_FAIL_SIGN_IN_FAILURE=3001;var IM_FAIL_SIGN_IN_DISCONNECTED=3002;var IM_FAIL_SESSION_DISCONNECTED=3003;var IM_FAIL_SESSION_SIGN_OUT=3004;var IM_FAIL_SERVICE_SHUTDOWN=3005;var IM_FAIL_REINITIALIZE_OWA=3006;var IM_FAIL_CLIENT_SIGN_OUT=4000;var IM_FAIL_CLIENT_LIMIT=4001;var IM_FAIL_BEGIN_SIGN_IN_ERROR=5000;var IM_FAIL_SIGN_IN_ERROR=5001;function UN(iErr,iTm){if(isDf(typeof(g_oBddyLst))&&g_oBddyLst){g_oBddyLst.shwIMUnavl(iErr)}var fClearTimer=0;dsblIM();var iRetryInterval=0;var iIntialRetryInterval=IM_SIGN_IN_RETRY_INTERVAL;switch(iErr){case IM_FAIL_ADDRESS_NOT_AVAILABLE:case IM_FAIL_EXTERNAL_AUTHENTICATION_DISABLED:case IM_FAIL_EXTERNAL_IDENTITY_UNKNOWN:case IM_FAIL_MSN_TERMS_OF_USE_NOT_SIGNED:Owa.IM.IMUtils.SetMenuSISO(true);fClearTimer=1;break;case IM_FAIL_SESSION_SIGN_OUT:case IM_FAIL_CLIENT_SIGN_OUT:case IM_FAIL_CLIENT_LIMIT:fClearTimer=1;break;case IM_FAIL_SERVER_TIMEOUT:case IM_FAIL_REINITIALIZE_OWA:case IM_FAIL_OVER_MAX_PAYLOAD_SIZE:iRetryInterval=IM_SIGN_IN_RETRY_INTERVAL;iIntialRetryInterval=0;break;case IM_FAIL_SIGN_IN_FAILURE:case IM_FAIL_BEGIN_SIGN_IN_ERROR:case IM_FAIL_SIGN_IN_ERROR:iRetryInterval=IM_SIGN_IN_RETRY_INTERVAL;break;case IM_FAIL_SIGN_IN_DISCONNECTED:case IM_FAIL_SESSION_DISCONNECTED:case IM_FAIL_SERVICE_SHUTDOWN:iRetryInterval=(isDf(typeof(iTm))&&iTm>0)?(iTm*1000):IM_SIGN_IN_RETRY_INTERVAL;iIntialRetryInterval=iRetryInterval;break;default:break}if(fClearTimer&&g_oSiTmr){clearTimeout(g_oSiTmr);g_oSiTmr=null}if(iRetryInterval&&!g_oSiTmr){g_oSiTmr=setTimeout("ImSIR("+iRetryInterval+", 0);",iIntialRetryInterval)}}function UNC(){if(isDf(typeof(g_oBddyLst))&&g_oBddyLst)g_oBddyLst.shwIMUnsupported();dsblIM();Owa.IM.SUPPORTED_USER=0}function dsblIM(){if(!gtIMMgr())return;gtIMMgr().DsblAllChtsSsns();g_iIM_SI=1;gtIMMgr().pshUkwnPrsnc();gtIMMgr().prscMnuDsbl(1);if(gtMstr()){gtMstr().g_fSignedIn=0;gtMstr().g_fSigningIn=0}Owa.IM.IMUtils.SetMenuSISO();gtIMMgr().removeAllBuddies();var oBuddyDialog=Owa.UIControls.BuddyDialog.getDialog();if(oBuddyDialog){oBuddyDialog.hide();oBuddyDialog.updateTitlebarButton(true)}var oActiveChatsDialog=Owa.UIControls.ActiveChatsDialog.getDialog();oActiveChatsDialog.hide();oActiveChatsDialog.updateTitlebarButton(true);Owa.IM.IMUtils.HideNewChatToast();enbIMBtns(getNavigationPage(),0,0,1)}function enblIM(){if(!gtIMMgr())return;gtIMMgr().EnableAllChatSessions();g_iIM_SI=0;stSlfPrsnc(gtSlfPrsnc(1));gtIMMgr().prscMnuDsbl(0);if(gtMstr()){gtMstr().g_fSignedIn=1}Owa.IM.IMUtils.SetMenuSISO();Owa.UIControls.ActiveChatsDialog.getDialog().updateTitlebarButton();enbIMBtns(getNavigationPage(),1,0,1)}function ImSIR(iRtry,fNRtry,fMnlSI){var oRCtx={};oRCtx.fMnlSI=fMnlSI;if(g_oSiTmr){clearTimeout(g_oSiTmr);g_oSiTmr=null}if(g_iIM_SI){sndIMReq(IM_SI,null,null,oRCtx);if(!isDf(typeof(fNRtry))||!fNRtry){var iRetryInterval=(isDf(typeof(iRtry))&&iRtry>0)?iRtry:IM_SIGN_IN_RETRY_INTERVAL;g_oSiTmr=setTimeout("ImSIR("+iRetryInterval+", 0);",iRetryInterval)}}}function EIM(sChtId){if(!isDf(typeof(sChtId))||!sChtId)return;if(!gtIMMgr())return;Owa.IM.IMUtils.HideNewChatToast(sChtId);gtIMMgr().MkChtSsnIdle(sChtId)}function IM(sChtId,sUri,sMsg,sFrmt){if(!isDf(typeof(sChtId))||!sChtId||!isDf(typeof(sUri))||!sUri||!isDf(typeof(sMsg))||!sMsg)return;if(!gtIMMgr())return;var oChtSsn=gtIMMgr().GtChtSsn(sChtId);if(!oChtSsn||gtIMMgr().IsIntCht(sChtId)){NIM(sChtId,sUri,sMsg,sFrmt);return}oChtSsn.InMsg(sUri,sMsg,sFrmt)}function TST(sChatId,sUri,sDN,sMessage,fIsConf){Owa.IM.IMUtils.ShowNewChatToast(sChatId,sUri,sDN,sMessage,fIsConf)}function NIM(sChtId,sUri,sMsg,sFrmt,sSub,iType,fIsConf){if(!sChtId||!sUri||!isDf(typeof(sMsg))){return}if(!gtIMMgr()){return}var sDN=gtIMMgr().gtDN(sUri);if(!sDN){sDN=imns.IMUtils.NrmSipUri(sUri)}NwIM(sChtId,sSub,sUri,sDN,sMsg,[],"",iType,fIsConf)}function NwIM(sChtId,sSub,sUri,sDN,sMsg,rgCntcts,sFrmt,iType,fIsConf){if(!gtIMMgr())return;var rgoRcp=[];if(!isDf(typeof(iType))){iType=Owa.IM.BUDDY_TYPE.None}if(isDf(typeof(rgCntcts))&&rgCntcts&&rgCntcts.length>0){var oCnt;var sCntUri;var sCntDN;for(var i=0;i<rgCntcts.length;i++){oCnt=rgCntcts[i];sCntUri=oCnt[0];if(isSlfUri(sCntUri))continue;sCntDN=gtIMMgr().gtDN(sCntUri);if(!sCntDN)sCntDN=imns.IMUtils.NrmSipUri(sCntUri);rgoRcp.push(new Recip(sCntDN,imns.IMUtils.NrmSipUri(sCntUri),"",0,RT_SMTP,AO_O,0,0,0,sCntUri,iType))}}gtIMMgr().NwChtSsnIn(sChtId,sSub,sUri,sDN,sMsg,sFrmt,rgoRcp,iType,fIsConf)}function RE(msg){alrt(msg,0,Owa.BUTTON_DIALOG_ICON.ERROR,L_ErrTtl)}function REGE(msg){if(g_oBddyLst){g_oBddyLst.shwErr(msg,true);if(g_oBddyLst._edting){g_oBddyLst.reEdtNd()}}else{RE(msg)}}function IMA(sChtId,iAct,sUri){if(!isDf(typeof(sChtId))||!sChtId||!isDf(typeof(iAct))||!iAct)return;if(!gtIMMgr())return;var oChtSsn=gtIMMgr().GtChtSsn(sChtId);if(!oChtSsn)return;if(isMSNPrv()&&iAct==imns.ACT_TYPNG){clearTimeout(oChtSsn.iTypngTimeout);oChtSsn.iTypngTimeout=setTimeout("IMA(\""+sChtId+"\", "+imns.ACT_STPTYPNG+", \""+sUri+"\");",imns.CHT_MSN_TYPNG_TMR)}oChtSsn.InActMsg(iAct,sUri)}function CLSC(sChtId){if(!isDf(typeof(sChtId))||!sChtId)return;if(!gtIMMgr())return;var oChtSsn=gtIMMgr().GtChtSsn(sChtId);if(oChtSsn&&oChtSsn.domWin){oChtSsn.domWin.close()}}function ACC(sChtId,sUri,sDN){if(!isDf(typeof(sChtId))||!sChtId||!isDf(typeof(sUri))||!sUri||sUri=="")return;if(!gtIMMgr())return;var oChtSsn=gtIMMgr().GtChtSsn(sChtId);if(!oChtSsn){NIM(sChtId,sUri,"","","",null,1);oChtSsn=gtIMMgr().GtChtSsn(sChtId);if(!oChtSsn){return}}if(oChtSsn.IsRcp(sUri))return;if(!isDf(typeof(sDN))||!sDN){sDN=gtIMMgr().gtDN(sUri);if(!sDN)sDN=imns.IMUtils.NrmSipUri(sUri)}var oRcp=new Recip(sDN,imns.IMUtils.NrmSipUri(sUri),"",0,RT_SMTP,AO_O,0,0,0,sUri);var fAdd=oChtSsn.AddRcp(oRcp,0,1);if(fAdd){try{gtIMMgr().UpdChtTtl(sChtId,oChtSsn.CalcTtl())}catch(e){}oChtSsn.OpenWindow(true)}}function RCC(sChtId,sUri){if(!isDf(typeof(sChtId))||!sChtId||!isDf(typeof(sUri))||!sUri||sUri=="")return;if(!gtIMMgr())return;var oChtSsn=gtIMMgr().GtChtSsn(sChtId);if(!oChtSsn||gtIMMgr().IsIntCht(sChtId))return;var fRm=oChtSsn.RmRcp(sUri);if(fRm){try{gtIMMgr().UpdChtTtl(sChtId,oChtSsn.CalcTtl())}catch(e){}}}function PCL(rgCntcts){if(!rgCntcts||!rgCntcts.length)return;if(!gtIMMgr())return;var oDlg=Owa.UIControls.BuddyDialog.getDialog();if(!oDlg)return;oDlg.addBuddies(rgCntcts)}function CRL(buddyId){if(!gtIMMgr())return;var oDlg=Owa.UIControls.BuddyDialog.getDialog();if(!oDlg)return;oDlg.removeBuddy(buddyId)}function BCL(rgCntcts,fBlk){if(!rgCntcts||!rgCntcts.length)return;if(!gtIMMgr())return;var rgoPrsnc=[];for(var i=0;i<rgCntcts.length;i++){var sUri=rgCntcts[i];var iPrsnc;if(!sUri||sUri=="")continue;sUri=imns.IMUtils.FrmSipUri(sUri);var sDN=gtIMMgr().gtDN(sUri);if(isDf(typeof(fBlk))&&fBlk){gtIMMgr().SetBlkd(sUri);iPrsnc=IM_PR_BLKD}else{gtIMMgr().SetUnblkd(sUri);if(gtIMMgr().IsBdy(sUri)){iPrsnc=gtIMMgr().gtPrsnc(sUri);if(iPrsnc==IM_PR_BLKD)iPrsnc=gtDfltPrsnc()}else iPrsnc=gtDfltPrsnc()}if(g_oBddyLst){var rgGroups=gtIMMgr().bdyLst._grpLst;for(var sGroupID in rgGroups){if(gtIMMgr().bdyLst.IsGroup(sGroupID)){g_oBddyLst.updateGrpPrsc(sGroupID,sDN,sUri,iPrsnc)}}}var oPrsnc={};oPrsnc.sUri=sUri;oPrsnc.prsnc=iPrsnc;oPrsnc.sDN=sDN;rgoPrsnc.push(oPrsnc)}if(rgoPrsnc.length>0)pushPrsnc(rgoPrsnc)}function MB(sOldGroupId,sNewGroupId,sUri){if(!gtIMMgr())return;if(!sOldGroupId||!gtIMMgr().bdyLst.IsGroup(sOldGroupId))return;if(!sNewGroupId||!gtIMMgr().bdyLst.IsGroup(sNewGroupId))return;if(!sUri||!gtIMMgr().bdyLst.IsBdy(sUri))return;var oBuddy=gtIMMgr().bdyLst.GtBdy(sUri);var oOldGroup=gtIMMgr().bdyLst.GetGroup(sOldGroupId);var oNewGroup=gtIMMgr().bdyLst.GetGroup(sNewGroupId);if(!oOldGroup.IsMember(sUri))return;oNewGroup.AddBuddyToGroup(oBuddy.dn,sUri,oBuddy.prsnc);oOldGroup.RemoveBuddyFromGroup(sUri)}function CB(sGroupId,sUri){if(!gtIMMgr())return;if(!sGroupId||!gtIMMgr().bdyLst.IsGroup(sGroupId))return;if(!sUri||!gtIMMgr().bdyLst.IsBdy(sUri))return;var oBuddy=gtIMMgr().bdyLst.GtBdy(sUri);var oGroup=gtIMMgr().bdyLst.GetGroup(sGroupId);oGroup.AddBuddyToGroup(oBuddy.dn,sUri,oBuddy.prsnc)}function vldtTxt(oTxt,iLen){var len=oTxt.get_Value().length;if(len>iLen){len=iLen;while(len){var endC=parseInt(oTxt.get_Value().charCodeAt(len-1));if(endC!=10&&endC!=13)break;--len}oTxt.set_Value(oTxt.get_Value().substr(0,len))}}var processMailTipsResponse;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\components/MailTipsResponder.js".toLowerCase()])(function(){Type.createNamespace("Owa.Components.MailTipsResponder");var EXPIRY_CONFIG_NAME="iClientCacheEntryExpiryInHours";var NORMAL_EXPIRY_HOURS=2;var MAX_UPDATE_RETRY=6;var _oNamespace=Owa.Components.MailTipsResponder;processMailTipsResponse=_oNamespace.processServerResponse=function Owa$Components$MailTipsResponder$processServerResponse(oMailTipsResult,oMailTipsConfig){if(!g_CC){return}var i=0;do{if(oMailTipsConfig){tryUpdCC(CC_MTCFG,oMailTipsConfig,REF)}tryUpdCC(CC_MTC,oMailTipsResult,REF);if(isDf(typeof(g_CC.oMailTipsCache))&&isDf(typeof(g_CC.oMailTipsConfig))&&g_CC.oMailTipsCache){_oNamespace.pushDataToForms(g_CC.oMailTipsCache,g_CC.oMailTipsConfig)}else{i++}}while((!isDf(typeof(g_CC.oMailTipsCache))||!isDf(typeof(g_CC.oMailTipsConfig)))&&i<MAX_UPDATE_RETRY)};_oNamespace.updateClientCache=function Owa$Components$MailTipsResponder$updateClientCache(oMailTipsResult,oClientCache){var oNow=new Date();var oExpiry=new Date(oNow);if(g_CC&&g_CC.oMailTipsConfig&&g_CC.oMailTipsConfig[EXPIRY_CONFIG_NAME]){oExpiry.setHours(oNow.getHours()+g_CC.oMailTipsConfig[EXPIRY_CONFIG_NAME])}else{oExpiry.setHours(oNow.getHours()+NORMAL_EXPIRY_HOURS)}for(var sRecipientAddress in oMailTipsResult){oMailTipsResult[sRecipientAddress].oUpdateTime=oNow;oMailTipsResult[sRecipientAddress].oExpiry=oExpiry}_oNamespace.mergeCache(oMailTipsResult,oClientCache)};_oNamespace.mergeCache=function Owa$Components$MailTipsResponder$mergeCache(oSourceCache,oTargetCache){if(oSourceCache){for(var sRecipientAddress in oSourceCache){if(!oTargetCache[sRecipientAddress]){oTargetCache[sRecipientAddress]={}}_oNamespace.copyProperties(oSourceCache[sRecipientAddress],oTargetCache[sRecipientAddress]);delete oTargetCache[sRecipientAddress].fIsPending}}};_oNamespace.copyProperties=function Owa$Components$MailTipsResponder$copyProperties(oSource,oTarget){for(var sPropertyName in oSource){var oValue=oSource[sPropertyName];if(oValue&&"object"==typeof(oValue)){if("oExpiry"==sPropertyName){oTarget.oExpiry=new Date(Date.parse(oValue))}else if("oUpdateTime"==sPropertyName){oTarget.oUpdateTime=new Date(Date.parse(oValue))}else if("oRestricted"==sPropertyName){if(!oTarget.oRestricted){oTarget.oRestricted={}}for(var sSenderName in oValue){oTarget.oRestricted[sSenderName]=oValue[sSenderName]}}}else{oTarget[sPropertyName]=oValue}}};_oNamespace.pushDataToForms=function Owa$Components$MailTipsResponder$pushDataToForms(oCache,oConfig){if(!g_CC){return}for(var iHash in g_CC.oMailTipsRequesters){var oMailTipsRequester=g_CC.oMailTipsRequesters[iHash];try{if(oMailTipsRequester){oMailTipsRequester.processServerUpdate(oCache,oConfig)}}catch(e){}}}})();g_fModuleLoaded[".\\components/MailTipsResponder.js".toLowerCase()]=1;var MAPI_NOTIFICATION_RESTART_TIMER=15*60*1000;var g_iMapiNotificationResetTimerMultiple=1;var g_oMapiNotificationResetTimer=null;function cancelFolderSubscription(sFolderId){var oR=new oeReq("Notify","DeleteCA",null,null,null,null,0,1);oR.add("sId",sFolderId);oR.send()}function stMapiDrty(id,f){stMapiDrtyInternal(id,f);if(g_winMgr)g_winMgr.SetMapiDrty(id,f);restartMapiNotificationsResetTimer()}function stMapiDrtyInternal(id,f){var oColl=$("divMainView");var fFound=false;var frId;var fExternalCalendar=false;if(oColl){oColl.forEachChild(function(oChild){frId=oChild.get_Id();if(frId){if(frId.charAt(0)=="b")frId=frId.substring(1);var prvFrId=GetPrvFid(frId,0,frId.length);var prvId=GetPrvFid(id,0,id.length);if(FEqPrvId(prvId,prvFrId)==true){fFound=true;return true}else{var oV=getNavigationPage().getLstVw(frId);if(oV&&isDf(typeof(oV.sDataFolderId))&&oV.sDataFolderId){prvFrId=GetPrvFid(oV.sDataFolderId,0,oV.sDataFolderId.length);if(FEqPrvId(prvId,prvFrId)==true){fFound=true;return true}}var oV=getCalVw(frId);if(oV&&oV.rgCalendar){for(var idx=0;idx<oV.rgCalendar.length;idx++){if(oV.rgCalendar[idx].sPromotedFolderId){prvFrId=GetPrvFid(oV.rgCalendar[idx].sPromotedFolderId,0,oV.rgCalendar[idx].sPromotedFolderId.length);if(FEqPrvId(prvId,prvFrId)==true){fFound=true;fExternalCalendar=oV.rgCalendar[idx].fExternalCal;break}}}if(fFound){return true}}}}});if(fFound){stDrty(frId,f)}}else{var oRootSubPage=Owa.Components.Application.get_RootSubPage();var oLV=isFolderViewSubPageObject(oRootSubPage)?oRootSubPage.get_VirtualListView():null;if(oLV&&oLV.isDumpsterVw()&&isDf(typeof(oLV.sDataFolderId))&&oLV.sDataFolderId){var prvFrId=GetPrvFid(oLV.sDataFolderId,0,oLV.sDataFolderId.length);var prvId=GetPrvFid(id,0,id.length);if(FEqPrvId(prvId,prvFrId)==true){oLV.rfrsh(1);return true}}}if(isDrty(a_sLstFID,1)){var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(oSubPageController){var oV=getNavigationPage().getLstVw(a_sLstFID);if(oV&&isDf(typeof(oV.fSrch))&&oV.fSrch){oV.rfrsh(1)}else{oSubPageController.invokeFunction("throttledRefresh",[true,fExternalCalendar])}}}}function folderChangeNotification(sFolderId,rgoNotification){if(sFolderId!=a_sLstFID){stDrty(sFolderId);return}var oLV=getNavigationPage().getLstVw(a_sLstFID);if(oLV){oLV.processRowNotification(rgoNotification)}restartMapiNotificationsResetTimer()}function updMapiCnt(fId,iTC,iUC){g_oEd.fire("UpdateCount",fId,iTC,iUC);var oLV=getNavigationPage().getLstVw(a_sLstFID);if(oLV&&oLV.iT==0&&!oLV.isFltrd()&&((!oLV.gtFltr()&&fId==a_sLstFID)||(oLV.gtFltr()&&oLV.sDataFolderId&&fId==oLV.sDataFolderId))){var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(oSubPageController){oSubPageController.invokeFunction("updateFolderItemCounts",[null,{iTotalCount:iTC,iUnreadCount:iUC}])}}restartMapiNotificationsResetTimer()}function stMapiRfrshAll(fFromResetTimer,fForceRefresh){var oColl=$("divMainView");if(oColl){oColl.forEachChild(function(oChild){var frId=oChild.get_Id();if(frId){if(frId.charAt(0)=="b"){frId=frId.substring(1)}stDrty(frId)}})}if(isDrty(a_sLstFID,1)){var oSubPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(oSubPageController){oSubPageController.invokeFunction("throttledRefresh",[true,false,null,fForceRefresh])}}if(!fFromResetTimer){restartMapiNotificationsResetTimer()}}function GetPrvFid(s,iS,len){if(len<=4)return null;var prfx=s.slice(iS,iS+4);if(prfx=="PSF."){iS+=4;len-=4}else if(prfx=="PSI."){return null}else if(prfx=="CID."||prfx=="ACI."){return null}else if(prfx=="OUM."||prfx=="AMB."){iS+=4;len-=4;for(var i=0;i<len;i++){if(s.charAt(iS+i)=='.')break}len=i}else{}var bOut=bsfD(s,iS,len);return bOut}function bsfD(s,iS,len){var a=new Array(4);var i,j,ch;if(len<=0||((len%4)!=0))return null;if(iS<0||iS>len)return null;var l=(len/4)*3;if(s.charAt(iS+len-1)=="="){l--;if(s.charAt(iS+len-2)=="=")l--}var bOut=new Array(l);j=0;for(;len>0;len-=4){for(i=0;i<4;i++,iS++){ch=s.charAt(iS);if(ch>='A'&&ch<='Z'){var sA="A";a[i]=0+(s.charCodeAt(iS)-sA.charCodeAt(0))}else if(ch>='a'&&ch<='z'){var sA="a";a[i]=26+(s.charCodeAt(iS)-sA.charCodeAt(0))}else if(ch>='0'&&ch<='9'){var sA="0";a[i]=52+(s.charCodeAt(iS)-sA.charCodeAt(0))}else if(ch=='+')a[i]=62;else if(ch=='/')a[i]=63;else if(ch=='='&&i>=2)a[i]=64;else return null}bOut[j++]=(a[0]<<2)|(a[1]>>4);if(a[2]!=64){bOut[j++]=((a[1]&0xf)<<4)|(a[2]>>2);if(a[3]!=64)bOut[j++]=((a[2]&0x3)<<6)|(a[3])}}return bOut}function FEqPrvId(rgb1,rgb2){var len;var fRet=false;if(rgb1==null||rgb2==null)return fRet;len=rgb1.length;if(len<=1||(len!=rgb2.length))return fRet;len--;for(var i=0;i<len;i++){if(rgb1[i]!=rgb2[i])break}if(i==len)fRet=true;return fRet}function resetMapiNotifications(){stMapiRfrshAll(true);restartMapiNotificationsResetTimer(++g_iMapiNotificationResetTimerMultiple)}function restartMapiNotificationsResetTimer(iMultiple){if(!iMultiple){iMultiple=1;g_iMapiNotificationResetTimerMultiple=1}if(g_oMapiNotificationResetTimer){Owa.Dom.Window.get_Current().clearTimeout(g_oMapiNotificationResetTimer);g_oMapiNotificationResetTimer=null}g_oMapiNotificationResetTimer=Owa.Dom.Window.get_Current().setTimeout(resetMapiNotifications,MAPI_NOTIFICATION_RESTART_TIMER*iMultiple)}var processIrmLicenseResponse;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\components/IrmLicensingManager.js".toLowerCase()])(function(){Type.createNamespace("Owa.Components.IrmLicensingManager");var RP_UPDATE_INITIAL_DELAY=500;var RP_UPDATE_MAX_RETRIES=10;var RP_UPDATE_RETRY_DELAY=1000;var LICENSING_SPINNER_DIV_ID="divIrmReqSpinner";var REQUEST_CORRELATOR_ATTRIBUTE_NAME="sReqCorrelator";var _oNamespace=Owa.Components.IrmLicensingManager;processIrmLicenseResponses=_oNamespace.processIrmLicenseResponses=function Owa$Components$IrmLicensingManager$processIrmLicenseResponses(rgLicensingResponses){if(!rgLicensingResponses||0==rgLicensingResponses.length){return}if(!a_sLstFID){return}var oPageController=getViewSubPageControllerByFolderId(a_sLstFID);if(!oPageController){return}var oLv=Owa.PageHierarchy.getVirtualListViewFromSubPageController(oPageController);if(!oLv){return}var oSubPage=oLv.get_SubPage();if(oSubPage){var fn=function(){_oNamespace.refreshRPIfShowingItems(oSubPage,rgLicensingResponses,RP_UPDATE_MAX_RETRIES)};Owa.Dom.Window.get_Current().setTimeout(fn,RP_UPDATE_INITIAL_DELAY)}};_oNamespace.refreshRPIfShowingItems=function Owa$Components$IrmLicensingManager$refreshRPIfShowingItems(oSubPage,rgLicensingResponses,iRemainingRetries){if(!oSubPage.isReadingPaneOn()){return}var oVLV=oSubPage.get_VirtualListView();if(oVLV.isCnvVw&&oVLV.isCnvVw()){var oRP=oSubPage.gtCnvRP();if(!oRP||!oRP.oItemParts){if(iRemainingRetries>0){var fn=function(){_oNamespace.refreshRPIfShowingItems(oSubPage,rgLicensingResponses,iRemainingRetries-1)};Owa.Dom.Window.get_Current().setTimeout(fn,RP_UPDATE_RETRY_DELAY)}return}var fItemPartFullyLoaded=true;for(var i=0;i<rgLicensingResponses.length;i++){var oResponse=rgLicensingResponses[i];var sItemPartId=oResponse.sMessageId;var oItemPart=oRP.oItemParts[sItemPartId];if(!oItemPart){fItemPartFullyLoaded=false;continue}var oDivBdy=oItemPart._get_Element().getDescendantById("divBdy");if(!oDivBdy){fItemPartFullyLoaded=false;continue}var oDivSpinner=oDivBdy.getDescendantById(LICENSING_SPINNER_DIV_ID);if(!oDivSpinner||oDivSpinner.getAttribute(REQUEST_CORRELATOR_ATTRIBUTE_NAME)!=oResponse.sReqCorrelator){fItemPartFullyLoaded=false;continue}if(oResponse.fSuccess){oSubPage.refreshConversationRP(true);return}else{oDivBdy.set_InnerHtml(oResponse.sErrorBody);oRP._refPipe()}}if(!fItemPartFullyLoaded&&iRemainingRetries>0){var fn=function(){_oNamespace.refreshRPIfShowingItems(oSubPage,rgLicensingResponses,iRemainingRetries-1)};Owa.Dom.Window.get_Current().setTimeout(fn,RP_UPDATE_RETRY_DELAY)}}else{var sItemIdInRP=oSubPage.get_ItemIdInReadingPane();for(var i=0;i<rgLicensingResponses.length;i++){var oResponse=rgLicensingResponses[i];if(oResponse.sMessageId!=sItemIdInRP){continue}var oRP=null;try{oRP=$("ifRP")}catch(e){}if(!oRP){return}var oRPDoc=oRP.get_ContentDocument();if(!oRPDoc){continue}var oFrame=oRPDoc.getElementById("ifBdy");if(!oFrame){continue}var oFrameDoc=oFrame.get_ContentDocument();if(!oFrameDoc){continue}var oDivSpinner=oFrameDoc.getElementById(LICENSING_SPINNER_DIV_ID);if(!oDivSpinner||oDivSpinner.getAttribute(REQUEST_CORRELATOR_ATTRIBUTE_NAME)!=oResponse.sReqCorrelator){continue}if(oResponse.fSuccess){oVLV.rfrsh(0);oSubPage.udRP(true);return}else{wrtBdy(oFrameDoc,"<html><body>"+oResponse.sErrorBody+"</body></html>");return}}if(iRemainingRetries>0){var fn=function(){_oNamespace.refreshRPIfShowingItems(oSubPage,rgLicensingResponses,iRemainingRetries-1)};Owa.Dom.Window.get_Current().setTimeout(fn,RP_UPDATE_RETRY_DELAY)}}}})();g_fModuleLoaded[".\\components/IrmLicensingManager.js".toLowerCase()]=1;Type.createNamespace("Owa.Utility");var g_iReInitRetryCount=0;if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\components/reinitializeowa.js".toLowerCase()])(function(){var MAX_REINIT_RETRY_COUNT=3;Owa.Utility.ReInitializeOWA=function $Owa$Utility$ReInitializeOWA(){if(g_iReInitRetryCount<MAX_REINIT_RETRY_COUNT){g_iReInitRetryCount++;var oR=new Owa.Dom.AjaxRequest("?reInit=1",GET,null,Owa.Utility.cbReInitializeOWA,false);oR.send()}};Owa.Utility.cbReInitializeOWA=function $Owa$Utility$cbReInitializeOWA(oResponse){var oXH=oResponse.oXmlHttp;if(oXH.status!=200||oXH.responseText.indexOf("id=\"errorAspx\"")!=-1){return}stMapiRfrshAll(false,true);if(g_fIsIMEnab&&gtMstr()&&gtMstr().g_fSignedIn){UN(IM_FAIL_REINITIALIZE_OWA)}g_iReInitRetryCount=0}})();g_fModuleLoaded[".\\components/reinitializeowa.js".toLowerCase()]=1;stJS("startpage.js");