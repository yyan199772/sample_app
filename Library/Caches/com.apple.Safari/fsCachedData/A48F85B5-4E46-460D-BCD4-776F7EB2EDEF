function deletePortlet(a,b){var c=$j("#e_"+a);b||(b=!1),(b||confirm('Are you sure you want to delete the element titled: "'+$j(".portlet_title",c).text()+'"? It will not be recoverable.'))&&$j.ajax({url:"cf_elements/elementremote.cfc",cache:!1,data:{method:"deleteElement",elementID:a},type:"post",dataType:"html",success:function(a){/<script/.test(a)?($j(a).appendTo("body"),$j.jGrowl("There was an error deleting the element.")):c.remove()},error:function(){$j.jGrowl("There was an error deleting the element. Please try again.")}})}function togglePortlet(a){var b=$j(a),c=b.parent().parent().parent(),d=c.parent().attr("id"),e=c.find(".portlet_content"),f=!0;"none"!=e.css("display")?(b.attr({src:"images/toggle_arrow_left.png",alt:"Expand",title:"Expand"}),f=!1):b.attr({src:"images/toggle_arrow_down.png",alt:"Collapse",title:"Collapse"}),e.slideToggle(),e.trigger(f?"elementOpened":"elementClosed"),"element_preview"!=d&&$j.ajax({url:"cf_elements/elementremote.cfc",cache:!1,data:{method:"toggleElement",elementID:c.attr("id").split("_").pop(),isOpen:f},type:"post",dataType:"html",success:function(a){a.search(/script/)>=0&&$j(a).appendTo("body")}})}function editSettings(a,b){$settingsDiv.dialog("option","title","Settings For "+b),$settingsDiv.html("Loading element settings..."),lastSettingsID=a,$settingsDiv.dialog("open"),$j.ajax({url:"cf_elements/elementremote.cfc",cache:!1,data:{method:"getSettings",elementID:a},type:"post",dataType:"html",success:function(a,b){-1==b.search(/success/)?(lastSettingsID=0,$settingsDiv.dialog("close"),$j.jGrowl("There was an error loading the settings for this element. Please try clicking the pencil again.")):($settingsDiv.html(a),$j("#element_settings_div").tabs(),"undefined"!=typeof contentEditorSettings&&(window.hasRedactor?$j("textarea.tinymceinst").redactor(contentEditorSettings):$j("textarea.tinymceinst").tinymce(contentEditorSettings)))},error:function(){$j.jGrowl("There was an error loading the settings for this element. Please click the pencil and try again.")}}),$elementLibrary&&$j(".addable_element",$elementLibrary).qtip("hide")}function refreshPortlet(a,b){var c=$j("#e_"+a),b=b?b:{};"element_preview"!=c.parent().attr("id")&&$j.ajax({url:"cf_elements/elementremote.cfc",cache:!1,data:$j.extend({},{method:"buildElement",id:a,inUnpublished:!(!window.topframe||!window.topframe.unpublished)},b),type:"post",dataType:"html",success:function(a){if(a.search(/Error<\/span>/)>0)$j.jGrowl("There was an error refreshing this element. Please try again.");else{var b=$j(a),d=b.find(".data_fs_link_color");d.length&&b.find(".portlet_content a").css("color",d.text()),"undefined"!=typeof formatElementStructure&&formatElementStructure(b.filter("div.portlet")),c.replaceWith(b)}},error:function(){$j.jGrowl("There was an error refreshing this element. Please try again.")}})}function loadPortletContent(a,b,c){var d={url:"cf_elements/elementremote.cfc",cache:!1,data:{method:"buildElement",id:a,firstLoad:!1,inUnpublished:!(!window.topframe||!window.topframe.unpublished)},type:"post",dataType:"html",success:function(b){var c=$j(b),d=c.find(".data_fs_link_color");d.length&&c.find(".portlet_content a").css("color",d.text()),$j("#c_"+a).html(c)},error:function(a,c){("error"!=c||0!=a.status)&&$j.jGrowl("There was an error loading "+b+".")}};a>0?c?$j("#e_"+a).parent().ajaxQueue(d):$j.ajax(d):$j.jGrowl("You are trying to load an invalid element")}function selectLayout(a){var b=$j("#layout_library_selected");$j("#layout_element_"+b.val()).removeClass("layout_library_selected"),$j("#layout_element_"+a).addClass("layout_library_selected"),b.val(a)}function togglePortletMenu(a){$j("#e_"+a+" .portlet_menu").slideToggle()}function toggleCustomizeSettings(a){var b=$j(a);0==b.val()?b.parent().parent().nextAll().hide():b.parent().parent().nextAll().show()}var $settingsDiv=$j("#settings_div"),lastSettingsID=0,$previewDiv=$j("#element_preview"),firstSort=!0;$settingsDiv.dialog({position:"center",modal:!0,draggable:!0,resizable:!1,autoOpen:!1,width:450,close:function(){if($j(window).trigger("resize"),!window.hasRedactor){var a=$j("textarea.tinymceinst",this);a.length&&a.tinymce().remove()}},buttons:{Cancel:function(){$j(this).dialog("close")},Save:function(){window.hasRedactor&&$j("textarea.tinymceinst",this).redactor("core.destroy");var a=$j(this),b=$j("#e_"+lastSettingsID),c=$j(":input:not(.system_attr,.ignore_attr)",a).serializeArray(),d=$j("#layout_library_selected"),e={method:"saveSettings",elementID:lastSettingsID,systemAttributes:JSON.stringify($j(".system_attr",a).serializeArray())};fsElements.onSave(e.elementID)&&(c.length>0&&(e.otherAttributes=JSON.stringify(c)),d.length>0&&(e.layoutID=d.val(),b=$j("#tabID_"+lastSettingsID)),b.length>0&&$j.ajax({url:"cf_elements/elementremote.cfc",cache:!1,data:e,type:"post",dataType:"html",success:function(a){if(a.search(/Error<\/span>/)>0)$j.jGrowl("There was an error saving the settings for this element. Please try clicking the pencil again.");else{var c=$j(a),d=c.find(".data_fs_link_color");d.length&&c.find(".portlet_content a").css("color",d.text()),"undefined"!=typeof formatElementStructure&&formatElementStructure(c.filter("div.portlet")),b.hide(),b.replaceWith(c)}},error:function(){$j.jGrowl("There was an error saving the settings for this element. Please click the pencil and try again.")}}),a.dialog("close"))}}}),initSortable=function(a,b){var c=$j(".portal_column",b),d=$j("#add_elements_menu");"undefined"!=typeof formatElementStructure&&formatElementStructure($j("div.portlet",b)),c.find("div.data_fs_link_color").each(function(){var a=$j(this);a.parent().find("a").css("color",a.text())}),d.hasClass("selected")&&c.addClass("portal_column_bottom"),c.sortable({opacity:.6,connectWith:".portal_column",dropOnEmpty:!0,distance:3,items:".portlet:not(.docked)",forcePlaceholderSize:!0,handle:".portlet_header",scroll:!0,scrollSensitivity:40,activate:function(){var a=$j(this);firstSort&&$j.browser.msie&&a.sortable("refresh"),a.addClass("portal_column_bottom")},deactivate:function(){firstSort=!1,d.hasClass("selected")||$j(this).removeClass("portal_column_bottom")},start:function(a,b){b.placeholder.height(b.helper.height()),b.helper.width($j(this).width())},update:function(a,b){var c=b.item.prev().attr("id"),d=b.item.attr("data-eid"),e=b.item.parent();if(0!=e.length&&!b.item.hasClass("ie_makes_us_do_this"))if(e=e.attr("id").split("_").pop(),b.item.hasClass("addable_element")){var f=("tempID-"+Math.floor(100*Math.random()),b.item.wrap('<div class="new_element"></div>').parent("div")),g={method:"addelement",pageID:pageid,elementID:d,olderSiblingID:-1,parentID:e};f.html("Loading element..."),void 0!=c&&""!=c&&(g.olderSiblingID=c.split("_").pop()),f.load("cf_elements/elementremote.cfc",g,function(){var a=f.find("div.portlet");f.replaceWith(a),"undefined"!=typeof formatElementStructure&&formatElementStructure(a)})}else if(null==b.sender){var g={method:"changeElementOrder",elementID:d,parentID:e,siblingID:-1};void 0!=c&&(g.siblingID=c.split("_").pop()),$j.ajax({url:"cf_elements/elementremote.cfc",cache:!1,data:g,type:"post",dataType:"html",success:function(a){/<script/.test(a)&&($j(a).appendTo("body"),$j.jGrowl("You must be logged in to move elements"))},error:function(){$j.jGrowl("There was an error moving the element. The changes will not be saved.")}}),b.item.hasClass("fsEl_Twitter")&&refreshPortlet(d,null)}},tolerance:"intersect"})},$previewDiv.dialog({position:"center",modal:!0,draggable:!0,resizable:!0,autoOpen:!1,title:"Preview",width:400,minHeight:350,buttons:{Cancel:function(){$j(this).dialog("close")},Add:function(){var a=$j(this).children("div").attr("data-eid"),b=$j(".portal_column:visible:first"),c=$j('<div class="addable_element" id="temp_'+a+'">Loading element...</div>');b.append(c),c.load("cf_elements/elementremote.cfc",{method:"addelement",pageID:pageid,elementID:a,parentID:b.attr("id").split("_").pop()},function(){c.replaceWith(c.html()),b.sortable("refresh")}),$previewDiv.dialog("close")}}}),$j("div.portlet").live("mouseover",function(){$j(this).find("div.portlet_actions_container").show()}),$j("div.portlet").live("mouseout",function(){$j(this).find("div.portlet_actions_container").hide()}),$j(".addable_element").live("click",function(){var a=$j(this);$previewDiv.html("Loading..."),$previewDiv.dialog("open"),$j.ajax({url:"cf_elements/elementremote.cfc",cache:!1,data:{method:"buildElement",id:a.attr("id").split("_").pop(),firstLoad:!0,includeDescription:!0,inUnpublished:!(!window.topframe||!window.topframe.unpublished)},type:"post",dataType:"html",success:function(a){var b=$j(a),c=b.find(".data_fs_link_color");c.length&&b.find(".portlet_content a").css("color",c.text()),$previewDiv.html(b)},error:function(){$j.jGrowl("There was an error loading the preview for "+a.text()+".")}}),$elementLibrary&&$j(".addable_element",$elementLibrary).qtip("hide")}),function(a){a.fn.ajaxQueue=function(b){var c=b.complete,d=a(this);b.complete=function(){c&&c.apply(this,arguments),d.dequeue("ajax")},d.queue("ajax",function(){a.ajax(b)})}}(jQuery),0==$j("#portal_tabs").length&&$j(function(){$j(".portal_column").dequeue("ajax")});