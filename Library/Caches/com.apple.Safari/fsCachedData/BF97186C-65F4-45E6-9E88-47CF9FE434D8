if(!g_fModuleLoaded)var g_fModuleLoaded={};if(!g_fModuleLoaded[".\\uicontrols/editor.js".toLowerCase()])(function(){Type.createNamespace("Owa.UIControls");var MRU_FONT_SIZE=5;var DEFAULT_BUTTONS_SHOWN=BTN_BIU|BTN_JUSTIFY|BTN_LISTS|BTN_INDENT|BTN_FORE_COLOR|BTN_BACK_COLOR|BTN_UNDO_REDO|BTN_LINKS|BTN_STRIKE|BTN_CUSTOMIZE;var DEFAULT_FONT_NAME="Tahoma";var DEFAULT_FONT_SIZE=2;var RG_CUSTOM_BUTTONS_IDS=new Array(new Array("divBiu",BTN_BIU),new Array("divStrkThr",BTN_STRIKE),new Array("divJstfy",BTN_JUSTIFY),new Array("divLsts",BTN_LISTS),new Array("divIndntg",BTN_INDENT),new Array("divBkClr",BTN_BACK_COLOR),new Array("divFrClr",BTN_FORE_COLOR),new Array("divRmvFmt",BTN_REMOVE_FORMAT),new Array("divInsRl",BTN_INSERT_RULE),new Array("divUndng",BTN_UNDO_REDO),new Array("divHLkng",BTN_LINKS),new Array("divSprSb",BTN_SUBSCRIPT_SUPERSCRIPT),new Array("divDir",BTN_DIR));var FONT_SIZE_PIXEL_MAPPING=new Array("","10px","13px","16px","18px","24px","32px","48px");var FONT_SIZE_POINT_MAPPING=new Array("","8pt","10pt","12pt","14pt","18pt","24pt","36pt");var BUTTON_MOUSE_DOWN_STYLE="fbBtnMsDn";var BUTTON_DISABLED_STYLE="fbBtnDa";var FB_BUTTON_WIDTH=27;var FB_BKFR_BUTTON_WIDTH=38;var RG_COLORS=new Array(new Array("000000","993300","333300","003300","003366","000080","333399","333333"),new Array("800000","FF6600","808000","008000","008080","0000FF","666699","808080"),new Array("FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","999999"),new Array("FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0"),new Array("FF99CC","FFCC99","FFFF99","CCFFCC","CCFFFF","99CCFF","CC99FF","FFFFFF"));var IE_OPEN_ANCHOR_MARKUP="<a onclick=\"event.returnValue=false;\" href=\"#\" unselectable=\"on\" tabindex=\"-1\">";var IE_CLOSE_ANCHOR_MARKUP="</a>";Owa.UIControls.Editor=function Owa$UIControls$Editor(oEm,oD,rgsBIU,rgsButtonTooltips,rgsCustomizeTooltips,rgsMoreNoneStrings,fnGetImagePath,iFmtBrSt,dlgHelper,sInitialHtml,sDefaultFontName,iDefaultFontSize,sDefaultCss,fIsNonEditable,cbRdy,cbClientCache,cbUpdateButtonState,cbUpdateFontsMru,fnOnBeforeUnload){Owa.UIControls.Editor.constructBase(this);this._oFormatBarElement=oEm;this._oEditor=oD;this._oPopupCustom=null;this._oPopupForeColorPicker=null;this._oPopupBackColorPicker=null;this._rgButtonGroups=null;this._rgCustomButtons=null;this._rgMruFonts=new Array();this._oBookmark=null;this._oDialogHelper=dlgHelper?dlgHelper:null;this._sMruFontList="";this._sFontList="";this._sInitialHtml=sInitialHtml;this._rgsBIU=rgsBIU;this._rgsButtonTooltips=rgsButtonTooltips;this._rgsCustomizeTooltips=rgsCustomizeTooltips;this._rgsMoreNoneStrings=rgsMoreNoneStrings;this._fnOnready=cbRdy;this._fnUpdateClientCache=cbClientCache;this._fnUpdateButtonState=cbUpdateButtonState;this._fnUpdateFontsMru=cbUpdateFontsMru;this._fnGetImagePath=fnGetImagePath;this._fnOnBeforeUnload=fnOnBeforeUnload;this._iButtonState=iFmtBrSt?iFmtBrSt:DEFAULT_BUTTONS_SHOWN;this._sDefaultFont=sDefaultFontName?sDefaultFontName:DEFAULT_FONT_NAME;this._iDefaultFontSize=iDefaultFontSize?iDefaultFontSize:DEFAULT_FONT_SIZE;this._sDefaultCss=sDefaultCss?sDefaultCss:this._generateCss(this._sDefaultFont,this._iDefaultFontSize);this._iUpdateCounter=0;this._fIsEnabled=true;this._fInitSelection=0;this._iTimerId=null;this._fIsNonEditable=fIsNonEditable?fIsNonEditable:0;this._fRdy=0;this._initialize()};Owa.UIControls.Editor.prototype.getHtml=function Owa$UIControls$Editor$getHtml(fGetBody,fDoNotRestoreHtml){var sHtml;var fWasDefaultFontApplied=this._fAppliedDefaultFonts;if(fGetBody){var sOriginalBodyInnerHtml=this._oEditor.get_Body().get_InnerHtml();if(fWasDefaultFontApplied){this._wrapElementChildrenWithDefaultFont(this._sDefaultCss,this._oEditor.get_Body())}sHtml=this._oEditor.get_DocumentElement().get_OuterHtml();if(!fDoNotRestoreHtml){this._oEditor.get_Body().set_InnerHtml(sOriginalBodyInnerHtml)}}else{if(fWasDefaultFontApplied){var oBodyClone=this._wrapElementChildrenWithDefaultFont(this._sDefaultCss,this._oEditor.get_Body().clone(1));sHtml=oBodyClone.get_InnerHtml()}else{sHtml=this._oEditor.get_Body().get_InnerHtml()}}return sHtml};Owa.UIControls.Editor.prototype.setHtml=function Owa$UIControls$Editor$setHtml(sHtml){this._oEditor.get_Body().set_InnerHtml(sHtml)};Owa.UIControls.Editor.prototype.focus=function Owa$UIControls$Editor$focus(){this._oEditor.get_ContainerWindow()._domWindow.focus()};Owa.UIControls.Editor.prototype.getFormatBarState=function Owa$UIControls$Editor$getFormatBarState(){var oFontNameComboBox=this._getFontNameComboBox();var oFontSizeComboBox=this._getFontSizeComboBox();var sSelectedFont=oFontNameComboBox.get_SelectedValue();var iSelectedSize=parseInt(oFontSizeComboBox.get_SelectedValue());var fBold=this._oFormatBarElement.getDescendantById("divBoldBtn").getBoolAttribute("_pushed");var fItalics=this._oFormatBarElement.getDescendantById("divItalicsBtn").getBoolAttribute("_pushed");var fUnderline=this._oFormatBarElement.getDescendantById("divUnderlineBtn").getBoolAttribute("_pushed");var sTextColor=this._getForeColorPicker().sColorValue;var sHighlightColor=this._getBackColorPicker().sColorValue;return new this.FormatBarState(sSelectedFont,iSelectedSize,fBold,fItalics,fUnderline,sTextColor,sHighlightColor)};Owa.UIControls.Editor.prototype.setFormatBarState=function Owa$UIControls$Editor$setFormatBarState(oFormatBarState){var oFontNameComboBox=this._getFontNameComboBox();var oFontSizeComboBox=this._getFontSizeComboBox();if(oFormatBarState.sFontName){if(!oFontNameComboBox.get_DropDownList().hasValue(oFormatBarState.sFontName)){this._addFont(oFormatBarState.sFontName,oFontNameComboBox.get_DropDownList())}oFontNameComboBox.set_SelectedValue(oFormatBarState.sFontName)}if(oFormatBarState.iFontSize){if(oFontSizeComboBox.get_DropDownList().hasValue(oFormatBarState.iFontSize)){oFontSizeComboBox.set_SelectedValue(oFormatBarState.iFontSize)}}var oBoldButton=this._oFormatBarElement.getDescendantById("divBoldBtn");if(!!oFormatBarState.fBold!=oBoldButton.getBoolAttribute("_pushed")){this._pushButton(oBoldButton,!!oFormatBarState.fBold);this._execCommand("bold")}var oItalicButton=this._oFormatBarElement.getDescendantById("divItalicsBtn");if(!!oFormatBarState.fItalics!=oItalicButton.getBoolAttribute("_pushed")){this._pushButton(oItalicButton,!!oFormatBarState.fItalics);this._execCommand("italic")}var oUnderlineButton=this._oFormatBarElement.getDescendantById("divUnderlineBtn");if(!!oFormatBarState.fUnderline!=oUnderlineButton.getBoolAttribute("_pushed")){this._pushButton(oUnderlineButton,!!oFormatBarState.fUnderline);this._execCommand("underline")}if(oFormatBarState.sTextColor){this._getForeColorPicker().sColorValue=oFormatBarState.sTextColor;this._execCommand("forecolor",0,oFormatBarState.sTextColor)}if(oFormatBarState.sHighlightColor){this._getBackColorPicker().sColorValue=oFormatBarState.sHighlightColor;this._execCommand("backcolor",0,oFormatBarState.sHighlightColor)}};Owa.UIControls.Editor.prototype.FormatBarState=function Owa$UIControls$Editor$FormatBarState(sFontName,iFontSize,fBold,fItalics,fUnderline,sTextColor,sHighlightColor){this.sFontName=sFontName;this.iFontSize=iFontSize;this.fBold=fBold;this.fItalics=fItalics;this.fUnderline=fUnderline;this.sTextColor=sTextColor;this.sHighlightColor=sHighlightColor};Owa.UIControls.Editor.prototype.dispose=function Owa$UIControls$Editor$dispose(){this.deactivateFormatBar();this._oFormatBarElement.detachAllEvents();this._oFormatBarElement.setExpando("formatBar",null);var oFontNameComboBox=this._getFontNameComboBox();var oFontSizeComboBox=this._getFontSizeComboBox();if(oFontNameComboBox){oFontNameComboBox.dispose()}if(oFontSizeComboBox){oFontSizeComboBox.dispose()}this._fnOnready=null;this._getIframeContentWindow().detachAllEvents();this._setFormatBar(this._oEditor,null);if(this._oPopupForeColorPicker){this._oPopupForeColorPicker.dispose()}if(this._oPopupBackColorPicker){this._oPopupBackColorPicker.dispose()}this._oPopupCustom=null;this._oPopupForeColorPicker=null;this._oPopupBackColorPicker=null;this._rgButtonGroups=this._rgCustomButtons=this._oEditor=null;this._execCommand=this._updateMRUFonts=this._insertMRUFonts=null;this._initCustomizePane=this._updateButtonsShown=this._saveButtonsShown=this._displayButtons=null;this._initFontComboBoxes=this._initFonts=this._updateButton=this._enableFormatbar=null;Owa.UIControls.Editor.callBase(this,"dispose")};Owa.UIControls.Editor.prototype.enableFormatbar=function Owa$UIControls$Editor$enableFormatbar(fEnable,fLockBody){if(!this._fRdy||this._fIsEnabled==fEnable){return}this._iUpdateCounter=fEnable?this._iUpdateCounter-1:this._iUpdateCounter+1;if(fLockBody){if(!fEnable){this._getIframe().addCssClass("editorDisabled")}else{this._getIframe().removeCssClass("editorDisabled")}this._changeDesignMode(fEnable)}if(fEnable){this.activateFormatBar()}else{this.deactivateFormatBar()}if(this._rgButtonGroups){for(var i=0;i<this._rgButtonGroups.length;i++){if(this._rgButtonGroups[i].get_IsShown()){var rgGrpsChildren=this._rgButtonGroups[i].getChildrenSnapshot();for(var j=0;j<rgGrpsChildren.length;j++){var oBtn=rgGrpsChildren[j];if(fEnable&&(oBtn.getAttribute("_cmd")!="customize")){this._updateButton(oBtn)}else{this._enableButton(oBtn,fEnable)}}}}}var oFontNameComboBox=this._getFontNameComboBox();var oFontSizeComboBox=this._getFontSizeComboBox();oFontNameComboBox.set_IsEnabled(fEnable);oFontSizeComboBox.set_IsEnabled(fEnable);this._fIsEnabled=fEnable};Owa.UIControls.Editor.prototype.activateFormatBar=function Owa$UIControls$Editor$activateFormatBar(){if(!this._iTimerId&&this._oFormatBarElement.get_IsShown()){var sUpdateCall="Owa.UIControls.Editor.prototype._updateFormatbar(\""+this._oFormatBarElement.get_Id()+"\")";this._iTimerId=window.setInterval(sUpdateCall,500)}};Owa.UIControls.Editor.prototype.deactivateFormatBar=function Owa$UIControls$Editor$deactivateFormatBar(){if(this._iTimerId!=null){window.clearInterval(this._iTimerId);this._iTimerId=null}};Owa.UIControls.Editor.prototype._initialize=function Owa$UIControls$Editor$_initialize(){Owa.UIControls.Editor.callBase(this,"initialize");if(!this._fIsNonEditable){this._getIframe().get_ContentDocument().set_DesignMode(1)}this._oFormatBarElement.setExpando("formatBar",this);if(!this._oEditor._get_DomDocument().body||this._sInitialHtml){this._initDocument(this._sInitialHtml?this._sInitialHtml:"")}this._getIframe().get_ContentDocument().set_IsRtl(g_fRtl);this._buildSingleFormatbar();if(!this._fIsNonEditable){this._applyEditorStyles();this._attachContentWindowEvents()}this._fRdy=1;if(this._fnOnready){this._fnOnready()}};Owa.UIControls.Editor.prototype._applyEditorStyles=function Owa$UIControls$Editor$_applyEditorStyles(){this._applyDefaultFonts();applyParagraphStylesToDocument(this._oEditor,0)};Owa.UIControls.Editor.prototype._initDocument=function Owa$UIControls$Editor$_initDocument(sHtml){var oEditor=this._oEditor._oDomNode;oEditor.open();oEditor.write(sHtml);oEditor.close()};Owa.UIControls.Editor.prototype._attachContentWindowEvents=function Owa$UIControls$Editor$_attachContentWindowEvents(){var oContentWindow=this._getIframeContentWindow();if(Owa.Utility.isIE()){this._oEditor.attachEvent("mousedown",this._createCallback(this._onMouseDownBody));this._oEditor.attachEvent("activate",this._createCallback(this._onFocus));this._oEditor.attachEvent("deactivate",this._createCallback(this._onBlur))}else if(Owa.Utility.isSafari()){oContentWindow.attachEvent("mousedown",this._createCallback(this._onMouseDownBody));oContentWindow.attachEvent("DOMFocusIn",this._createCallback(this._onFocus));oContentWindow.attachEvent("DOMFocusOut",this._createCallback(this._onBlur))}else{oContentWindow.attachEvent("mousedown",this._createCallback(this._onMouseDownBody));oContentWindow.attachEvent("focus",this._createCallback(this._onFocus));oContentWindow.attachEvent("blur",this._createCallback(this._onBlur))}if(this._fnOnBeforeUnload){oContentWindow.attachEvent("beforeunload",this._createCallback(this._fnOnBeforeUnload))}};Owa.UIControls.Editor.prototype._buildSingleFormatbar=function Owa$UIControls$Editor$_buildSingleFormatbar(){this._oFormatBarElement.set_InnerHtml(this._generateFormatBarMarkup());var rgGrpsAll=this._oFormatBarElement.getDescendantsByTagName("div");this._rgButtonGroups=new Array();for(var i=0;i<rgGrpsAll.length;i++){if(rgGrpsAll[i].hasCssClass("fbBtnGrp")){this._rgButtonGroups.push(rgGrpsAll[i])}}this._oFormatBarElement.attachEvent("click",this._createCallback(this._onClickFormatbar));var divFntNm=this._getFontNameComboBoxElement();var divFntSz=this._getFontSizeComboBoxElement();divFntNm.getDescendantById("divCmbDd")._get_DomNode().tabIndex=divFntSz.getDescendantById("divCmbDd")._get_DomNode().tabIndex=-1;this._setFormatBar(this._oEditor,this);if(g_fRtl){if(this._rgsButtonTooltips.length==24){var sTp=this._rgsButtonTooltips[4];this._rgsButtonTooltips[4]=this._rgsButtonTooltips[6];this._rgsButtonTooltips[6]=sTp;sTp=this._rgsButtonTooltips[21];this._rgsButtonTooltips[21]=this._rgsButtonTooltips[22];this._rgsButtonTooltips[22]=sTp}}var iTpIdx=0;var rgFmtBrChdrn=this._oFormatBarElement.getChildrenSnapshot();for(var i=0;i<rgFmtBrChdrn.length;i++){var oGrp=rgFmtBrChdrn[i];if(oGrp.hasCssClass("fbBtnGrp")){var rgGrpChdrn=oGrp.getChildrenSnapshot();for(var j=0;j<rgGrpChdrn.length;j++){var oBtn=rgGrpChdrn[j].hasChildNodes()?rgGrpChdrn[j].get_FirstChild():rgGrpChdrn[j];oBtn.setAttribute("alt",this._rgsButtonTooltips[iTpIdx]);oBtn.set_Title(this._rgsButtonTooltips[iTpIdx]);iTpIdx++;oBtn.setExpando("_pushed",false);oBtn.attachEvent("mouseout",this._onMouseFormatbar);oBtn.attachEvent("mouseover",this._onMouseFormatbar);oBtn.attachEvent("mousedown",this._onMouseFormatbar)}}}this._oPopupForeColorPicker=null;this._oPopupBackColorPicker=null;this._initFonts();this._displayButtons()};Owa.UIControls.Editor.prototype._initFonts=function Owa$UIControls$Editor$_initFonts(){var i,s;var nl="\r\n";if((typeof(a_sMruFnts)!="undefined")&&a_sMruFnts&&a_sMruFnts!=""){this._rgMruFonts=a_sMruFnts.split(";");for(i=0;i<this._rgMruFonts.length;i++){if(i>0){this._sMruFontList+=nl}this._sMruFontList+=this._generateMRUFontEntryMarkup(this._rgMruFonts[i])}}if(!this._sFontList||this._sFontList==""){var rgDefaultFonts;if(this._oDialogHelper&&this._oDialogHelper.fonts){rgDefaultFonts=new Array(this._oDialogHelper.fonts.count);for(var i=0;i<rgDefaultFonts.length;i++){rgDefaultFonts[i]=this._oDialogHelper.fonts(i+1)}rgDefaultFonts.sort()}else{rgDefaultFonts=new Array("Arial","Courier New","Tahoma","Times New Roman","Verdana")}this._sFontList="";for(var i=0;i<rgDefaultFonts.length;i++){this._sFontList+=this._generateFontEntryMarkup(rgDefaultFonts[i])}if(this._fnUpdateClientCache){this._fnUpdateClientCache(CC_FNTLST,this._sFontList)}}if(this._sMruFontList&&this._sMruFontList!=""){this._sMruFontList+=nl}var divCmbList=this._oFormatBarElement.getDescendantById("divFntNm").getDescendantById("divCmbList");if(Owa.Utility.isIE()){divCmbList.set_InnerHtmlIEWorkaround(this._sMruFontList+this._sFontList)}else{divCmbList.set_InnerHtml(this._sMruFontList+this._sFontList)}var divSizeList=this._oFormatBarElement.getDescendantById("divFntSz").getDescendantById("divCmbList");var sSizeEntries=this._generateFontSizeEntriesMarkup();if(Owa.Utility.isIE()){divSizeList.set_InnerHtmlIEWorkaround(sSizeEntries)}else{divSizeList.set_InnerHtml(sSizeEntries)}this._initFontComboBoxes()};Owa.UIControls.Editor.prototype._addFont=function Owa$UIControls$Editor$_addFont(sFontName,oFontDropDown){var oEm=Owa.Dom.Document.get_Current().createElement("div");oEm.set_InnerHtml(this._generateFontEntryMarkup(sFontName));oEm=oEm.get_FirstChild();oFontDropDown._get_Element().insertAdjacentElement(Owa.ElementInsertionPoint.BeforeEnd,oEm);if(Owa.Utility.isIE()){oEm=oEm.get_FirstChild()}oFontDropDown._addDomItem(oEm,sFontName)};Owa.UIControls.Editor.prototype._initFontComboBoxes=function Owa$UIControls$Editor$_initFontComboBoxes(){var oDivFntNm=this._getFontNameComboBoxElement();var oDivFntSz=this._getFontSizeComboBoxElement();var fDisableOffscreenComboBoxInput=Owa.Utility.isIE()&&!this._fIsNonEditable;var oFontNameComboBox=new Owa.UIControls.ComboBox(oDivFntNm,null,fDisableOffscreenComboBoxInput,1);var oFontSizeComboBox=new Owa.UIControls.ComboBox(oDivFntSz,null,fDisableOffscreenComboBoxInput,1);oFontNameComboBox.initialize();oFontSizeComboBox.initialize();oDivFntNm.setExpando("oComboBox",oFontNameComboBox);oDivFntSz.setExpando("oComboBox",oFontSizeComboBox);oFontNameComboBox.get_OnChange().add(this._createCallback(this._onChangeFont));oFontSizeComboBox.get_OnChange().add(this._createCallback(this._onChangeFont));if(this._sDefaultFont&&!oFontNameComboBox.get_DropDownList().hasValue(this._sDefaultFont)){this._addFont(this._sDefaultFont,oFontNameComboBox.get_DropDownList())}oFontNameComboBox.set_SelectedValue(this._sDefaultFont,1);var rg=new Array(0,8,10,12,14,18,24,36);oFontSizeComboBox.set_SelectedValue(this._iDefaultFontSize,1)};Owa.UIControls.Editor.prototype._initCustomizePane=function Owa$UIControls$Editor$_initCustomizePane(oDoc){var oDiv=oDoc.createElement("DIV");oDiv.set_IsShown(false);oDiv.set_InnerHtml(this._generateCustomButtonsPaneMarkup());this._rgCustomButtons=new Array(oDiv.getDescendantById("chkBiu"),oDiv.getDescendantById("chkStrkThr"),oDiv.getDescendantById("chkJstfy"),oDiv.getDescendantById("chkLsts"),oDiv.getDescendantById("chkIndntg"),oDiv.getDescendantById("chkBkClr"),oDiv.getDescendantById("chkFrClr"),oDiv.getDescendantById("chkRmvFmt"),oDiv.getDescendantById("chkInsRl"),oDiv.getDescendantById("chkUndng"),oDiv.getDescendantById("chkHLkng"),oDiv.getDescendantById("chkSprSb"),oDiv.getDescendantById("chkDir"));for(var i=0;i<this._rgCustomButtons.length;i++){this._rgCustomButtons[i].set_IsChecked((RG_CUSTOM_BUTTONS_IDS[i][1]&this._iButtonState));this._rgCustomButtons[i].attachEvent("click",this._createCallback(this._updateButtonsShown));this._rgCustomButtons[i].set_Title((i<this._rgsCustomizeTooltips.length)?this._rgsCustomizeTooltips[i]:"")}var oPopupElement=oDiv.get_FirstChild();this._oFormatBarElement.appendChild(oPopupElement);return oPopupElement};Owa.UIControls.Editor.prototype._applyDefaultFonts=function Owa$UIControls$Editor$_applyDefaultFonts(){var oStyleSheet=getSS(this._oEditor,"owaTempEditStyle");if(!oStyleSheet){oStyleSheet=insertSS(this._oEditor,"owaTempEditStyle")}try{oStyleSheet.addRule("BODY",this._sDefaultCss);this._fAppliedDefaultFonts=1}catch(e){}};Owa.UIControls.Editor.prototype._wrapElementChildrenWithDefaultFont=function Owa$UIControls$Editor$_wrapElementChildrenWithDefaultFont(sCssText,oEm){var divFnt=this._oEditor.createElement("div");this._applyCssToDomNode(divFnt._get_DomNode(),sCssText);var rgChildren=oEm.getChildrenSnapshot();if(rgChildren.length==1&&rgChildren[0].get_NodeType()==Owa.NodeType.Element&&rgChildren[0].get_TagName().toLowerCase()=="div"&&getElementStyle(rgChildren[0])==getElementStyle(divFnt)){return oEm}for(var i=0;i<rgChildren.length;i++){divFnt.appendChild(rgChildren[i])}oEm.appendChild(divFnt);return oEm};function getElementStyle(oDomNode){if(Owa.Utility.isIE()){return oDomNode._get_DomNode().style.getAttribute("cssText")}else{return oDomNode._get_DomNode().getAttribute("style")}}Owa.UIControls.Editor.prototype._applyCssToDomNode=function Owa$UIControls$Editor$_applyCssToDomNode(oDomNode,sCssText){if(Owa.Utility.isIE()){oDomNode.style.setAttribute("cssText",sCssText)}else{oDomNode.setAttribute("style",sCssText)}};Owa.UIControls.Editor.prototype._removeStyleSheetRulesFromEditor=function Owa$UIControls$Editor$_removeStyleSheetRulesFromEditor(){var oStyleSheet=getSS(this._oEditor,"owaTempEditStyle");if(oStyleSheet){oStyleSheet.remove()}this._fAppliedDefaultFonts=0};Owa.UIControls.Editor.prototype._updateFormatbar=function Owa$UIControls$Editor$_updateFormatbar(sFormatbarId){var oFb=$(sFormatbarId).getExpando("formatBar");try{var fIsDesignMode=oFb._oEditor.get_IsDesignMode()}catch(e){this.deactivateFormatBar();return}if((oFb==null)||!oFb._fRdy||oFb._iUpdateCounter||!fIsDesignMode){return}oFb._iUpdateCounter++;for(var i=0;i<oFb._rgButtonGroups.length;i++){if(oFb._rgButtonGroups[i].get_IsShown()){if(oFb._rgButtonGroups[i].get_Id()=="divCstmz"){continue}var rgGrpsChildren=oFb._rgButtonGroups[i].getChildrenSnapshot();for(var j=0;j<rgGrpsChildren.length;j++){var oDiv=rgGrpsChildren[j];oFb._updateButton(oDiv)}}}var f=oFb._oEditor._oDomNode.queryCommandEnabled("fontname");var oDivFntNm=oFb._getFontNameComboBoxElement();var oDivFntSz=oFb._getFontSizeComboBoxElement();var oFontNameComboBox=oFb._getFontNameComboBox();var oFontSizeComboBox=oFb._getFontSizeComboBox();oFontNameComboBox.set_IsEnabled(f);oFontSizeComboBox.set_IsEnabled(f);oDivFntNm.getDescendantById("divCmbDd")._get_DomNode().tabIndex=oDivFntSz.getDescendantById("divCmbDd")._get_DomNode().tabIndex=-1;if(f){var sCmdFontName=oFb._oEditor._oDomNode.queryCommandValue("fontname");var sCmdFontSize=oFb._oEditor._oDomNode.queryCommandValue("fontsize");var sSelectedFont=oFontNameComboBox.get_SelectedValue();var sSelectedSize=oFontSizeComboBox.get_SelectedValue();var oSel=createSelectionRange(oFb._oEditor._oDomNode);var fIsSelEmpty=(oSel.getText().length==0);if(sCmdFontName){sCmdFontName=sCmdFontName.split(",")[0];sCmdFontName=this._trimQuotes(sCmdFontName);if(sCmdFontName&&!oFontNameComboBox.get_DropDownList().hasValue(sCmdFontName)){this._addFont(sCmdFontName,oFontNameComboBox.get_DropDownList())}if(sCmdFontName&&sCmdFontName!=sSelectedFont){oFontNameComboBox.set_SelectedValue(sCmdFontName,1)}}else{if(fIsSelEmpty&&oFb._fAppliedDefaultFonts){oFontNameComboBox.set_SelectedValue(oFb._sDefaultFont,1)}else{oFontNameComboBox.renderValue("")}}if(Owa.Utility.isSafari()&&sCmdFontSize&&sCmdFontSize.substr(sCmdFontSize.length-2,2)=="px"){sCmdFontSize=this._convertPixelSizeToBrowserSize(sCmdFontSize)}if(!sCmdFontSize){var oSelD=oSel.duplicate();oSelD.collapse(true);var oE=Owa.Dom.Node.wrapDomNode(oSelD.parentElement());while(oE.get_NodeType()==Owa.NodeType.Text||(!oE.get_FontSize()&&oE.get_TagName().toLowerCase()!="body")){oE=oE.get_ParentElement()}var sFontSize=oE.get_FontSize();if(sFontSize){var sUnit=(sFontSize.substring(sFontSize.length-2)).toLowerCase();var iBrowserSize=0;switch(sUnit){case Owa.Style.Unit.Pixels:iBrowserSize=oFb._convertPixelSizeToBrowserSize(sFontSize);break;case Owa.Style.Unit.Points:iBrowserSize=oFb._convertPointSizeToBrowserSize(sFontSize);break}if(iBrowserSize){oFontSizeComboBox.set_SelectedValue(iBrowserSize,1)}else if(sUnit==Owa.Style.Unit.Points){oFontSizeComboBox.renderValue(sFontSize.substr(0,sFontSize.length-2))}else{oFontSizeComboBox.renderValue("")}}else{if(fIsSelEmpty&&oFb._fAppliedDefaultFonts){oFontSizeComboBox.set_SelectedValue(oFb._iDefaultFontSize,1)}else{oFontSizeComboBox.renderValue("")}}}else if((sCmdFontSize!=sSelectedSize)&&(oFontSizeComboBox.get_DropDownList().hasValue(sCmdFontSize))){oFontSizeComboBox.set_SelectedValue(sCmdFontSize,1)}}oFb._iUpdateCounter--};Owa.UIControls.Editor.prototype._onChangeFont=function Owa$UIControls$Editor$_onChangeFont(oSelectedValue){var oFb=this;var sCmd=oSelectedValue._get_Element().getAttribute("_cmd");oFb._iUpdateCounter++;if((sCmd=="fontname")&&(!this._fIsNonEditable)){oFb._updateMRUFonts()}oFb._restoreSelection();oFb._execCommand(sCmd,false,oSelectedValue.get_SelectedValue());oFb._iUpdateCounter--};Owa.UIControls.Editor.prototype._onMouseFormatbar=function Owa$UIControls$Editor$_onMouseFormatbar(oEvent){oEvent.cancelBubble();var oButtonElement=oEvent.get_Target();var sBiuClass="fbBiu";var fBiuButton=0;if(oButtonElement.hasCssClass(sBiuClass)){oButtonElement=oButtonElement.get_ParentElement();fBiuButton=1}if(!Owa.UIControls.Editor.prototype._isButton(oButtonElement)){return}var oDivAncestor=oButtonElement.getAncestorByTag("div");var oButtonFrame=(oDivAncestor&&!fBiuButton)?oDivAncestor:oButtonElement;if(oButtonFrame.hasCssClass(BUTTON_DISABLED_STYLE)){return}};Owa.UIControls.Editor.prototype._onClickFormatbar=function Owa$UIControls$Editor$_onClickFormatbar(oEvent){var oFb=this;oFb._iUpdateCounter++;var o=oEvent.get_Target();while(!o.getAttribute("_cmd")&&(o.get_TagName().toLowerCase()!="body")){o=o.get_ParentElement()}if(o.hasCssClass(BUTTON_DISABLED_STYLE)){oFb._iUpdateCounter--;return}var sCmd=o.getAttribute("_cmd");oFb._closePopups(sCmd);if(!sCmd||(o._get_DomNode().disabled)){oFb._iUpdateCounter--;return}oEvent.preventDefault();oEvent.cancelBubble();if(typeof(g_fDrty)!="undefined")g_fDrty=1;switch(sCmd){case"customize":if(!oFb._oPopupCustom){var oPopup=oFb._initCustomizePane(o.get_OwnerDocument());oFb._oPopupCustom=new Owa.UIControls.Popup(oPopup);oFb._oPopupCustom.initialize()}oFb._oPopupCustom.showUnder(o);var sCustomId=oFb._oPopupCustom._get_Element().get_Id();var iY=o.get_PositionalTop()+o.get_OffsetHeight();window.setTimeout("$(\""+sCustomId+"\").set_Top("+iY+");",5);break;case"backcolor":oFb._getBackColorPicker().showUnderParent();break;case"forecolor":oFb._getForeColorPicker().showUnderParent();break;case"superscript":oFb._execCommand(sCmd);if(oFb._oEditor._oDomNode.queryCommandState("subscript")){oFb._execCommand("subscript")}break;case"subscript":oFb._execCommand(sCmd);if(oFb._oEditor._oDomNode.queryCommandState("superscript")){oFb._execCommand("superscript")}break;case"fontname":case"fontsize":break;default:oFb._execCommand(sCmd);break}if(oFb._fIsNonEditable&&((sCmd=="bold")||(sCmd=="italic")||(sCmd=="underline"))){oFb._pushButton(o,!o.getBoolAttribute("_pushed"))}oFb._iUpdateCounter--};Owa.UIControls.Editor.prototype._onBlur=function Owa$UIControls$Editor$_onBlur(oEvent){if(oEvent._oEvent.toElement!=null){return}if(Owa.Utility.isIE()){this._storeSelection()}this.deactivateFormatBar()};Owa.UIControls.Editor.prototype._onFocus=function Owa$UIControls$Editor$_onFocus(oEvent){var oFb=this;oFb._closePopups();if(Owa.Utility.isSafari()&&!oFb._fInitSelection){var oR=createSelectionRange(this._oEditor._get_DomDocument());oR.moveToElementText(this._oEditor.get_Body().get_FirstChild()._get_DomNode());oR.collapse(0);oR.select();oFb._fInitSelection=1}oFb.activateFormatBar()};Owa.UIControls.Editor.prototype._onMouseDownBody=function Owa$UIControls$Editor$_onMouseDownBody(){var oFb=this;if(oFb){oFb._oBookmark=null}};Owa.UIControls.Editor.prototype._closePopups=function Owa$UIControls$Editor$_closePopups(sCmd){var oFontNameDropDown=this._getFontNameComboBox().get_DropDownList();var oFontSizeDropDown=this._getFontSizeComboBox().get_DropDownList();var oForeColorPicker=this._oPopupForeColorPicker;var oBackColorPicker=this._oPopupBackColorPicker;if(oFontNameDropDown.fIsOpen&&sCmd!="fontname"){oFontNameDropDown.close()}if(oFontSizeDropDown.fIsOpen&&sCmd!="fontsize"){oFontSizeDropDown.close()}if(oForeColorPicker&&oForeColorPicker.fIsOpen&&sCmd!="forecolor"){oForeColorPicker.close()}if(oBackColorPicker&&oBackColorPicker.fIsOpen&&sCmd!="backcolor"){oBackColorPicker.close()}};Owa.UIControls.Editor.prototype._execCommand=function Owa$UIControls$Editor$_execCommand(sCmd,fUI,oV){var oExecCommandTarget;if(!this._fIsNonEditable){this._restoreSelection();oExecCommandTarget=this._oEditor._oDomNode;Owa.ExecCommand.execute(oExecCommandTarget,sCmd,fUI,oV)}else{if(!Owa.Utility.isIE()){oExecCommandTarget=this._oEditor._oDomNode;this._changeDesignMode(1);Owa.ExecCommand.execute(oExecCommandTarget,"selectall");Owa.ExecCommand.execute(oExecCommandTarget,sCmd,fUI,oV);this._changeDesignMode(0)}else{var oR=createTextRange(this._oEditor._get_DomDocument());oExecCommandTarget=oR.range;Owa.ExecCommand.execute(oExecCommandTarget,sCmd,fUI,oV)}}this._postExecCommand(this,sCmd)};Owa.UIControls.Editor.prototype._postExecCommand=function Owa$UIControls$Editor$_postExecCommand(oFb,sCmd){switch(sCmd){case"insertorderedlist":case"insertunorderedlist":var oP=createSelectionRange(oFb._oEditor._oDomNode).parentElement();var eO=/^ol$/i;var eU=/^ul$/i;if(oP&&((oP.nodeName.match(eO)||oP.nodeName.match(eU))||((oP=oP.parentNode)&&(oP=oP.parentNode)&&(oP.nodeName.match(eO)||oP.nodeName.match(eU))))){var oFontNameComboBox=oFb._getFontNameComboBox();var oFontSizeComboBox=oFb._getFontSizeComboBox();var sSelectedFontName=oFontNameComboBox.get_SelectedValue();var sSelectedFontSize=oFontSizeComboBox.get_SelectedValue();oP.style.fontFamily=(sSelectedFontName?sSelectedFontName:a_sInitFntNm);oP.style.fontSize=FONT_SIZE_POINT_MAPPING[(sSelectedFontSize?sSelectedFontSize:this._iDefaultFontSize)]}break}};Owa.UIControls.Editor.prototype._getFormatBar=function Owa$UIControls$Editor$_getFormatBar(oEdtr){return oEdtr.get_ContainerWindow().getGlobalVariable("formatBar")};Owa.UIControls.Editor.prototype._setFormatBar=function Owa$UIControls$Editor$_setFormatBar(oEdtr,oFb){oEdtr.get_ContainerWindow().setGlobalVariable("formatBar",oFb)};Owa.UIControls.Editor.prototype._changeDesignMode=function Owa$UIControls$Editor$_changeDesignMode(fDesignModeOn){var sHtml=this.getHtml(1);this._getIframe().get_ContentDocument().set_DesignMode(fDesignModeOn);this._initDocument(sHtml)};Owa.UIControls.Editor.prototype._storeSelection=function Owa$UIControls$Editor$_storeSelection(){try{var oR=createSelectionRange(this._oEditor._oDomNode);if(!Owa.Dom.Node.wrapDomNode(oR.parentElement()).get_OwnerDocument().get_IsDesignMode()){return}if(oR.selectionExists()){this._oBookmark=oR.duplicate()}else{this._oBookmark=null}}catch(e){}};Owa.UIControls.Editor.prototype._restoreSelection=function Owa$UIControls$Editor$_restoreSelection(){if(this._oBookmark&&Owa.Utility.isIE()){this._oBookmark.select()}else{this._oEditor.get_ContainerWindow()._domWindow.focus()}};Owa.UIControls.Editor.prototype._imageData=function Owa$UIControls$Editor$_imageData(sId,sC,fC){this.id=sId;this.cmd=sC;this.isColor=!!fC};Owa.UIControls.Editor.prototype._isButton=function Owa$UIControls$Editor$_isButton(o){return((!o._oDomNode.disabled)&&((o.get_TagName()=="IMG")||(o.get_Id()=="divBoldBtn")||(o.get_Id()=="divItalicsBtn")||(o.get_Id()=="divUnderlineBtn")))};Owa.UIControls.Editor.prototype._updateButtonsShown=function Owa$UIControls$Editor$_updateButtonsShown(){var oFb=this;oFb._saveButtonsShown();oFb._displayButtons()};Owa.UIControls.Editor.prototype._saveButtonsShown=function Owa$UIControls$Editor$_saveButtonsShown(){var iBtnSt=0;for(var i=0;i<this._rgCustomButtons.length;i++){if(this._rgCustomButtons[i].get_IsChecked()){iBtnSt|=RG_CUSTOM_BUTTONS_IDS[i][1]}}this.oldBtnSt=iBtnSt;this._iButtonState=iBtnSt;if(this._fnUpdateButtonState){this._fnUpdateButtonState(iBtnSt)}if(this._fnUpdateClientCache){this._fnUpdateClientCache(CC_FBST,iBtnSt)}};Owa.UIControls.Editor.prototype._displayButtons=function Owa$UIControls$Editor$_displayButtons(){for(var i=0;i<RG_CUSTOM_BUTTONS_IDS.length;i++){var sGroupId=RG_CUSTOM_BUTTONS_IDS[i][0].toString();var oGrp=this._oFormatBarElement.getDescendantById(sGroupId);oGrp.set_IsShown(RG_CUSTOM_BUTTONS_IDS[i][1]&this._iButtonState)}if($("divHdrMessage")){safeResizeBodies()}};Owa.UIControls.Editor.prototype._updateButton=function Owa$UIControls$Editor$_updateButton(o){var sCmd=o.getAttribute("_cmd");var fEnb=0;var fSt=0;try{if(Owa.Utility.isFirefox()){if(sCmd=="outdent"||sCmd=="indent"||sCmd=="backcolor"||sCmd=="forecolor"||sCmd=="removeformat"||sCmd=="inserthorizontalrule"||sCmd=="createlink"||sCmd=="undo"||sCmd=="redo"){fEnb=1;fSt=0}else{fEnb=this._oEditor._oDomNode.queryCommandEnabled(sCmd);fSt=this._oEditor._oDomNode.queryCommandState(sCmd)}}else{fEnb=this._oEditor._oDomNode.queryCommandEnabled(sCmd);fEnb=this._oEditor._oDomNode.queryCommandSupported(sCmd)&&fEnb;if(fEnb){fSt=this._oEditor._oDomNode.queryCommandState(sCmd)}}}catch(e){fEnb=0}this._pushButton(o,fEnb&&fSt);this._enableButton(o,fEnb)};Owa.UIControls.Editor.prototype._enableButton=function Owa$UIControls$Editor$_enableButton(o,f){if(f){o.removeCssClass(BUTTON_DISABLED_STYLE)}else{o.addCssClass(BUTTON_DISABLED_STYLE);o.removeCssClass(BUTTON_MOUSE_DOWN_STYLE)}};Owa.UIControls.Editor.prototype._pushButton=function Owa$UIControls$Editor$_pushButton(o,f){if(f!=o.getBoolAttribute("_pushed")){if(f){o.addCssClass(BUTTON_MOUSE_DOWN_STYLE)}else{o.removeCssClass(BUTTON_MOUSE_DOWN_STYLE)}o.setBoolAttribute("_pushed",f)}};Owa.UIControls.Editor.prototype._updateMRUFonts=function Owa$UIControls$Editor$_updateMRUFonts(){var oFontNameComboBox=this._getFontNameComboBox();if(oFontNameComboBox.get_DropDownList().fIsOpen||oFontNameComboBox.get_DropDownList()._rgListItems.length<MRU_FONT_SIZE){return}var sSelectedFont=oFontNameComboBox.get_SelectedValue();var rg=new Array();rg.push(sSelectedFont);for(var i=0;i<this._rgMruFonts.length;i++){if((this._rgMruFonts[i])&&(this._rgMruFonts[i]!=sSelectedFont)&&i<MRU_FONT_SIZE-1){rg.push(this._rgMruFonts[i])}}this._rgMruFonts=rg;var rgListItems=oFontNameComboBox.get_DropDownList()._rgListItems;for(var i=0;i<rgListItems.length;i++){if(rgListItems[i].oDomItem.getAttribute("_mru")==""){oFontNameComboBox.get_DropDownList()._remove(i)}}this._insertMRUFonts(this._rgMruFonts);if(this._fnUpdateFontsMru){this._fnUpdateFontsMru(this._rgMruFonts)}if(this._fnUpdateClientCache){this._fnUpdateClientCache(CC_MRUFNTS,this._rgMruFonts.join(";"))}};Owa.UIControls.Editor.prototype._insertMRUFonts=function Owa$UIControls$Editor$_insertMRUFonts(rgMruFonts){for(var i=MRU_FONT_SIZE-1;i>=0;i--){if(rgMruFonts[i]){var oEm=Owa.Dom.Document.get_Current().createElement("DIV");var sHtml=this._generateMRUFontEntryMarkup(rgMruFonts[i]);oEm.set_InnerHtml(sHtml);oEm=oEm.get_FirstChild();var oFontNameDropDown=this._getFontNameComboBox().get_DropDownList();oFontNameDropDown._get_Element().insertAdjacentElement(Owa.ElementInsertionPoint.AfterBegin,oEm);if(Owa.Utility.isIE()){oEm=oEm.get_FirstChild()}oFontNameDropDown._addDomItem(oEm,rgMruFonts[i])}}};Owa.UIControls.Editor.prototype._generateFormatBarMarkup=function Owa$UIControls$Editor$_generateFormatBarMarkup(){var sFrmBar=this._generateSpacerMarkup(5);sFrmBar+=this._generateFontComboBoxMarkup();sFrmBar+=this._generateSpacerMarkup(3);sFrmBar+=this._generateFontSizeComboBoxMarkup();sFrmBar+=this._generateSpacerMarkup(1);sFrmBar+=this._generateBIUButtonGroupMarkup();sFrmBar+=this._generateButtonsMarkup(this._generateButtonGroupMarkup);if(BTN_CUSTOMIZE&this._iButtonState){sFrmBar+=this._generateButtonGroupMarkup("Cstmz",new Array(new this._imageData("imgCstmz","customize")),this._fnGetImagePath)}return sFrmBar};Owa.UIControls.Editor.prototype._generateSpacerMarkup=function Owa$UIControls$Editor$_generateSpacerMarkup(iWidth){return"<img class=\"fltSp"+iWidth+"\" src=\""+this._fnGetImagePath("clear1x1.gif")+"\">"};Owa.UIControls.Editor.prototype._generateFontComboBoxMarkup=function Owa$UIControls$Editor$_generateFontComboBoxMarkup(){var sCmb="";sCmb+=Owa.Utility.isIE()?IE_OPEN_ANCHOR_MARKUP:"";sCmb+="<div id=\"divFntNm\" class=\"cmb\" _cmd=\"fontname\" fEnbld=\"1\" fd=\"1\">";sCmb+=this._generateComboBoxImageMarkup();sCmb+="<span id=\"spanCmbSel\" class=\"nowrap\">&nbsp;</span><img class=\"cmbVASp\"/>";sCmb+="<div id=\"divCmbList\" class=\"pu\" oV=\"0\" style=\"display:none\" ";sCmb+=Owa.Utility.isIE()?"_fUseChildItem=\"1\"":"";sCmb+="></div>";sCmb+="</div>";sCmb+=Owa.Utility.isIE()?IE_CLOSE_ANCHOR_MARKUP:"";return sCmb};Owa.UIControls.Editor.prototype._generateFontEntryMarkup=function Owa$UIControls$Editor$_generateFontEntryMarkup(sFontName){var sEntry="";sEntry+=Owa.Utility.isIE()?IE_OPEN_ANCHOR_MARKUP:"";sEntry+="<span style=\"display:block;\" class=\"listItm\" tabIndex=\"0\" oV=\"";sEntry+=sFontName;sEntry+="\">";sEntry+=sFontName;sEntry+="</span>";sEntry+=Owa.Utility.isIE()?IE_CLOSE_ANCHOR_MARKUP:"";return sEntry};Owa.UIControls.Editor.prototype._generateMRUFontEntryMarkup=function Owa$UIControls$Editor$_generateMRUFontEntryMarkup(sFontName){var sEntry="";sEntry+=Owa.Utility.isIE()?IE_OPEN_ANCHOR_MARKUP:"";sEntry+="<span style=\"display:block;\" class=\"mruFont listItm\" tabIndex=\"0\" oV=\"";sEntry+=sFontName;sEntry+="\" _mru>";sEntry+=sFontName;sEntry+="</span>";sEntry+=Owa.Utility.isIE()?IE_CLOSE_ANCHOR_MARKUP:"";return sEntry};Owa.UIControls.Editor.prototype._generateFontSizeComboBoxMarkup=function Owa$UIControls$Editor$_generateFontSizeComboBoxMarkup(){var sCmb="";sCmb+=Owa.Utility.isIE()?IE_OPEN_ANCHOR_MARKUP:"";sCmb+="<div id=\"divFntSz\" class=\"cmb\" _cmd=\"fontsize\" fEnbld=\"1\" fd=\"1\">";sCmb+=this._generateComboBoxImageMarkup();sCmb+="<span id=\"spanCmbSel\">&nbsp;</span><img class=\"cmbVASp\"/>";sCmb+="<div id=\"divCmbList\" class=\"pu\" oV=\"0\" style=\"display:none\" ";sCmb+=Owa.Utility.isIE()?"_fUseChildItem=\"1\"":"";sCmb+=">";sCmb+="</div>";sCmb+="</div>";sCmb+=Owa.Utility.isIE()?IE_CLOSE_ANCHOR_MARKUP:"";return sCmb};Owa.UIControls.Editor.prototype._generateFontSizeEntriesMarkup=function Owa$UIControls$Editor$_generateFontSizeEntriesMarkup(){var sEntries=this._generateFontSizeEntryMarkup(1,8);sEntries+=this._generateFontSizeEntryMarkup(2,10);sEntries+=this._generateFontSizeEntryMarkup(3,12);sEntries+=this._generateFontSizeEntryMarkup(4,14);sEntries+=this._generateFontSizeEntryMarkup(5,18);sEntries+=this._generateFontSizeEntryMarkup(6,24);sEntries+=this._generateFontSizeEntryMarkup(7,36);return sEntries};Owa.UIControls.Editor.prototype._generateFontSizeEntryMarkup=function Owa$UIControls$Editor$_generateFontSizeEntryMarkup(iIndex,iSize){var sEntry="";sEntry+=Owa.Utility.isIE()?IE_OPEN_ANCHOR_MARKUP:"";sEntry+="<span style=\"display:block;\" class=\"listItm\" tabIndex=\"0\" oV=\"";sEntry+=iIndex;sEntry+="\">";sEntry+=iSize;sEntry+="</span>";sEntry+=Owa.Utility.isIE()?IE_CLOSE_ANCHOR_MARKUP:"";return sEntry};Owa.UIControls.Editor.prototype._generateComboBoxImageMarkup=function Owa$UIControls$Editor$_generateComboBoxImageMarkup(){return"<img id=\"divCmbDd\" src=\""+this._fnGetImagePath("drparw.gif")+"\">"};Owa.UIControls.Editor.prototype._generateBIUButtonsMarkup=function Owa$UIControls$Editor$_generateBIUButtonsMarkup(sBtnId,sBtnTxt,sOtherClasses,sCommand){var sBtn="<div class=\"fbBiuBtn\" id=\""+sBtnId;sBtn+="\" style=\"width:"+(FB_BUTTON_WIDTH-2)+"px\" unselectable=\"on\"";if(sCommand){sBtn+=" _cmd=\"";sBtn+=sCommand}sBtn+="\">";sBtn+=Owa.Utility.isIE()?IE_OPEN_ANCHOR_MARKUP:"";sBtn+="<span class=\"fbBiu";if(sOtherClasses!=null){sBtn+=" "+sOtherClasses}sBtn+="\" >";sBtn+=sBtnTxt;sBtn+="</span>";sBtn+=Owa.Utility.isIE()?IE_CLOSE_ANCHOR_MARKUP:"";sBtn+="</div>";return sBtn};Owa.UIControls.Editor.prototype._generateBIUButtonGroupMarkup=function Owa$UIControls$Editor$_generateBIUButtonGroupMarkup(){var iGroupWidth=(FB_BUTTON_WIDTH*3);var sGrp="<div id=\"divBiu\" class=\"fbBtnGrp\"  style=\"width:";sGrp+=iGroupWidth;sGrp+="px\">";var sBtns=this._generateBIUButtonsMarkup("divBoldBtn",this._rgsBIU[0],null,"bold");sBtns+=this._generateBIUButtonsMarkup("divItalicsBtn",this._rgsBIU[1],"iT","italic");sBtns+=this._generateBIUButtonsMarkup("divUnderlineBtn",this._rgsBIU[2],"uT","underline");sGrp+=sBtns;sGrp+="</div>";return sGrp};Owa.UIControls.Editor.prototype._generateCustomButtonGroupMarkup=function Owa$UIControls$Editor$_generateCustomButtonGroupMarkup(){var sGrp="<div id=\"divBiu\" class=\"fbCustomBtnGrp\">";sGrp+="<div class=\"fbBtnGrpChk\">";sGrp+="<input type=\"checkbox\" id=\"chkBiu\" tabIndex=\"0\" hidefocus=\"true\"/>";sGrp+="</div>";var sBtns=this._generateBIUButtonsMarkup("divBoldBtn",this._rgsBIU[0],null);sBtns+=this._generateBIUButtonsMarkup("divItalicsBtn",this._rgsBIU[1],"iT");sBtns+=this._generateBIUButtonsMarkup("divUnderlineBtn",this._rgsBIU[2],"uT");sGrp+=sBtns;sGrp+="</div>";return sGrp};Owa.UIControls.Editor.prototype._generateCustomButtonsPaneMarkup=function Owa$UIControls$Editor$_generateCustomButtonsPaneMarkup(){var sPane="<div id=\"divCstPn\" class=\"pu fbPopup\" style=\"display:none\">";sPane+=this._generateCustomButtonGroupMarkup();sPane+=this._generateButtonsMarkup(this._generateCustomButtonsGroupMarkup);sPane+="</div>";return sPane};Owa.UIControls.Editor.prototype._generateCustomButtonsGroupMarkup=function Owa$UIControls$Editor$_generateCustomButtonsGroupMarkup(sCbId,rgImg,fnGetImagePath){var sGrp="<div class=\"fbCustomBtnGrp\">";sGrp+="<div class=\"fbBtnGrpChk\">";sGrp+="<input type=\"checkbox\" id=\"chk"+sCbId+"\">";sGrp+="</div>";for(var i=0;i<rgImg.length;i++){sGrp+=Owa.UIControls.Editor.prototype._generateSingleButtonMarkup(rgImg[i],fnGetImagePath)}sGrp+="</div>";return sGrp};Owa.UIControls.Editor.prototype._generateButtonsMarkup=function Owa$UIControls$Editor$_generateButtonsMarkup(fn){var f=g_fRtl;return fn("StrkThr",new Array(new this._imageData("imgStrkThr","strikethrough")),this._fnGetImagePath)+fn("Jstfy",new Array(new this._imageData(f?"imgJstfyRt":"imgJstfyLft",f?"justifyright":"justifyleft"),new this._imageData("imgJstfyCtr","justifycenter"),new this._imageData(f?"imgJstfyLft":"imgJstfyRt",f?"justifyleft":"justifyright")),this._fnGetImagePath)+fn("Lsts",new Array(new this._imageData("imgLstNm","insertunorderedlist"),new this._imageData("imgLstBl","insertorderedlist")),this._fnGetImagePath)+fn("Indntg",new Array(new this._imageData("imgOutdnt","outdent"),new this._imageData("imgIndnt","indent")),this._fnGetImagePath)+fn("BkClr",new Array(new this._imageData("imgBkClr","backcolor",1)),this._fnGetImagePath)+fn("FrClr",new Array(new this._imageData("imgFrClr","forecolor",1)),this._fnGetImagePath)+fn("RmvFmt",new Array(new this._imageData("imgRmvFmt","removeformat")),this._fnGetImagePath)+fn("InsRl",new Array(new this._imageData("imgInsRl","inserthorizontalrule")),this._fnGetImagePath)+fn("Undng",new Array(new this._imageData("imgUndo","undo"),new this._imageData("imgRedo","redo")),this._fnGetImagePath)+fn("HLkng",new Array(new this._imageData("imgCrtLnk","createlink"),new this._imageData("imgUnlnk","unlink")),this._fnGetImagePath)+fn("SprSb",new Array(new this._imageData("imgSprScr","superscript"),new this._imageData("imgSbScr","subscript")),this._fnGetImagePath)+fn("Dir",new Array(new this._imageData(f?"imgBlkDrRtl":"imgblkdrltr",f?"blockdirrtl":"blockdirltr"),new this._imageData(f?"imgBlkDrLtr":"imgblkdrrtl",f?"blockdirltr":"blockdirrtl")),this._fnGetImagePath)};Owa.UIControls.Editor.prototype._generateButtonGroupMarkup=function Owa$UIControls$Editor$_generateButtonGroupMarkup(sGrpId,rgImg,fnGetImagePath){var fIsBkFrClr=(sGrpId=="BkClr")||(sGrpId=="FrClr");var iButtonWidth=(fIsBkFrClr?FB_BKFR_BUTTON_WIDTH:FB_BUTTON_WIDTH);var iGroupWidth=rgImg.length*iButtonWidth;var sGrp="<div id=\"div"+sGrpId+"\" class=\"fbBtnGrp\"";sGrp+=" style=\"width:"+iGroupWidth+"px\">";for(var i=0;i<rgImg.length;i++){sGrp+="<div class=\"fbBtn\" id=\"div";sGrp+=rgImg[i].cmd;sGrp+="\" style=\"width:"+(iButtonWidth-2)+"px\" unselectable=on tabIndex=-1"+" _cmd="+rgImg[i].cmd+">";sGrp+=Owa.UIControls.Editor.prototype._generateSingleButtonMarkup(rgImg[i],fnGetImagePath);sGrp+="</div>"}sGrp+="</div>";return sGrp};Owa.UIControls.Editor.prototype._generateSingleButtonMarkup=function Owa$UIControls$Editor$_generateSingleButtonMarkup(oImg,fnGetImagePath){var sFileName=oImg.cmd;if(g_fRtl){switch(oImg.cmd.toLowerCase()){case"outdent":case"indent":case"insertorderedlist":case"insertunorderedlist":sFileName+="rtl";break;default:break}}sFileName+=".png";return Owa.Components.CssSprites.getImageMarkup(sFileName,null,null,fnGetImagePath)};Owa.UIControls.Editor.prototype._getForeColorPicker=function Owa$UIControls$Editor$_getForeColorPicker(){if(!this._oPopupForeColorPicker){this._oPopupForeColorPicker=new Owa.UIControls.ColorPickerPopup(this.get_SubPage(),this._oFormatBarElement.getDescendantById("divforecolor"),"divFbFrClrPckr",5,8,Owa.UIControls.Editor.prototype._getColorProperties,Owa.UIControls.Editor.prototype._onClickColorPicker,this._rgsMoreNoneStrings,"000000",1,this._oDialogHelper,Owa.Utility.isIE());this._oPopupForeColorPicker.oFb=this;this._oPopupForeColorPicker.sCmd="forecolor"}return this._oPopupForeColorPicker};Owa.UIControls.Editor.prototype._getBackColorPicker=function Owa$UIControls$Editor$_getBackColorPicker(){if(!this._oPopupBackColorPicker){this._oPopupBackColorPicker=new Owa.UIControls.ColorPickerPopup(this.get_SubPage(),this._oFormatBarElement.getDescendantById("divbackcolor"),"divFbBkClrPckr",5,8,Owa.UIControls.Editor.prototype._getColorProperties,Owa.UIControls.Editor.prototype._onClickColorPicker,this._rgsMoreNoneStrings,"FFFFFF",1,this._oDialogHelper,Owa.Utility.isIE());this._oPopupBackColorPicker.oFb=this;this._oPopupBackColorPicker.sCmd="backcolor"}return this._oPopupBackColorPicker};Owa.UIControls.Editor.prototype._getColorProperties=function Owa$UIControls$Editor$_getColorProperties(iR,iC){var s=RG_COLORS[iR][iC];var o=new Object();o.sStyle="background-color:#"+s;o.sValue=s;return o};Owa.UIControls.Editor.prototype._onClickColorPicker=function Owa$UIControls$Editor$_onClickColorPicker(oColorPicker){oColorPicker.oFb._execCommand(oColorPicker.sCmd,false,oColorPicker.sColorValue)};Owa.UIControls.Editor.prototype._getIframe=function Owa$UIControls$Editor$_getIframe(){return this._oEditor.get_ContainerWindow().get_FrameElement()};Owa.UIControls.Editor.prototype._getFontNameComboBoxElement=function Owa$UIControls$Editor$_getFontNameComboBoxElement(){return this._oFormatBarElement.getDescendantById("divFntNm")};Owa.UIControls.Editor.prototype._getFontSizeComboBoxElement=function Owa$UIControls$Editor$_getFontSizeComboBoxElement(){return this._oFormatBarElement.getDescendantById("divFntSz")};Owa.UIControls.Editor.prototype._getFontNameComboBox=function Owa$UIControls$Editor$_getFontNameComboBox(){return this._getFontNameComboBoxElement().getExpando("oComboBox")};Owa.UIControls.Editor.prototype._getFontSizeComboBox=function Owa$UIControls$Editor$_getFontSizeComboBox(){return this._getFontSizeComboBoxElement().getExpando("oComboBox")};Owa.UIControls.Editor.prototype._getIframeContentWindow=function Owa$UIControls$Editor$_getIframeContentWindow(){return this._getIframe().get_ContentWindow()};Owa.UIControls.Editor.prototype._generateCss=function Owa$UIControls$Editor$_generateCss(sFontName,iFontSize){return"font-family: "+sFontName+"; font-size: "+this._convertBrowserSizeToPixelSize(iFontSize)+";"};Owa.UIControls.Editor.prototype._trimQuotes=function Owa$UIControls$Editor$_trimQuotes(sString){if((sString.startsWith("'")&&sString.endsWith("'"))||(sString.startsWith("\"")&&sString.endsWith("\""))){sString=sString.substr(1,sString.length-2)}return sString};Owa.UIControls.Editor.prototype._convertPixelSizeToBrowserSize=function Owa$UIControls$Editor$_convertPixelSizeToBrowserSize(sPixelSize){var sPixelSizeLower=sPixelSize.toLowerCase();for(var i=0;i<FONT_SIZE_PIXEL_MAPPING.length;i++){if(sPixelSizeLower==FONT_SIZE_PIXEL_MAPPING[i]){return i}}return null};Owa.UIControls.Editor.prototype._convertBrowserSizeToPixelSize=function Owa$UIControls$Editor$_convertBrowserSizeToPixelSize(iBrowserSize){if(iBrowserSize>(FONT_SIZE_PIXEL_MAPPING.length+1)||iBrowserSize<0){iBrowserSize=this._iDefaultFontSize}return FONT_SIZE_PIXEL_MAPPING[iBrowserSize]};Owa.UIControls.Editor.prototype._convertPointSizeToBrowserSize=function Owa$UIControls$Editor$_convertPointSizeToBrowserSize(sPointSize){var sPointSizeLower=sPointSize.toLowerCase();for(var i=0;i<FONT_SIZE_POINT_MAPPING.length;i++){if(sPointSizeLower==FONT_SIZE_POINT_MAPPING[i]){return i}}return null};Owa.UIControls.Editor.createClass("Owa.UIControls.Editor",Owa.UIControls.UIControl)})();g_fModuleLoaded[".\\uicontrols/editor.js".toLowerCase()]=1;var RGS_BIU=new Array(L_BtB,L_BtI,L_BtU);var RGS_BUTTON_TOOLTIPS=new Array(L_FbTp00,L_FbTp01,L_FbTp02,L_FbTp03,L_FbTp04,L_FbTp05,L_FbTp06,L_FbTp07,L_FbTp08,L_FbTp09,L_FbTp10,L_FbTp11,L_FbTp12,L_FbTp13,L_FbTp14,L_FbTp15,L_FbTp16,L_FbTp17,L_FbTp18,L_FbTp19,L_FbTp20,L_FbTp21,L_FbTp22,L_FbTp23);var RGS_CUST_TOOLTIPS=new Array(L_FbCstTp00,L_FbCstTp01,L_FbCstTp02,L_FbCstTp03,L_FbCstTp04,L_FbCstTp05,L_FbCstTp06,L_FbCstTp07,L_FbCstTp08,L_FbCstTp09,L_FbCstTp10,L_FbCstTp11,L_FbCstTp12,L_FbCstTp13);var RGS_MORE_NONE=new Array(L_MrClrs,L_None);function GetNewOwaEditor(oDivFmtBr,oEdD,oDialogHelper,sInitialHtml){if(!(a_iFmtBrSt&this._iButtonState)){a_iFmtBrSt=a_iFmtBrSt|BTN_CUSTOMIZE}var oEditor=new Owa.UIControls.Editor(oDivFmtBr,oEdD,RGS_BIU,RGS_BUTTON_TOOLTIPS,RGS_CUST_TOOLTIPS,RGS_MORE_NONE,getThmF,a_iFmtBrSt,oDialogHelper,sInitialHtml,a_sInitFntNm,a_sInitFntSz,a_sDefFntStyl,0,null,tryUpdCC,updateButtonStateOptions,updateFontsMRU,Owa.Pages.FormSubPage.prototype.onBeforeUnload);return oEditor}function updateFontsMRU(rgFonts){var oReq=new oeReq("Options","SaveFmtBrSt",0,0,POST);oReq.add("mruFnts",rgFonts.join(";"));oReq.send()}function updateButtonStateOptions(iBtnSt){var oReq=new oeReq("Options","SaveFmtBrSt",0,cbSaveButtonsShown,POST);oReq.add("btnSt",iBtnSt);oReq.send()}function cbSaveButtonsShown(oR){if(oR.fST){popLgn();this._iButtonState=this.oldBtnSt;this._displayButtons()}}stJS("owaeditor.js");